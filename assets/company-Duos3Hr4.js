import{Q as s,T as h,r as p,X as P,C as f}from"./index-D_u9nkte.js";const x=[{value:"CONTRACTOR",label:"營造廠商",color:"primary"},{value:"SUPERVISOR",label:"監造單位",color:"info"},{value:"CONSULTING",label:"顧問公司",color:"success"},{value:"OTHER",label:"其他",color:"secondary"}],M=[{value:"ACTIVE",label:"啟用",color:"success"},{value:"INACTIVE",label:"停用",color:"danger"}],m={async create(e){return await s.post("/management/company/create",e)},async getList(e){return await s.get("/management/company/list",{params:e})},async getMemberList(){return await s.get("/management/companyMember/list")},async getDetail(e){return await s.get(`/management/company/${e}`)},async update(e,t){return await s.put(`/management/company/${e}`,t)},async delete(e){await s.delete(`/management/company/${e}`)},async checkPermission(e){return await s.get(`/management/company/${e}/permission`)}},v={fromApi(e){return{id:e.id,companyId:e.companyId||e.company_id,companyName:e.companyName||e.company_name,companyCode:e.companyUnifiedNumber||e.companyCode||e.company_code,companyType:e.companyType||e.company_type,contractorLevel:e.contractorLevel||e.contractor_level,contactPerson:e.contactPerson||e.contact_person||"",contactPhone:e.contactPhone||e.contact_phone||"",contactEmail:e.contactEmail||e.contact_email||"",address:e.address||"",description:e.description||"",status:e.status||"ACTIVE",ownerUserId:e.ownerUserId||e.owner_user_id,createdAt:e.createdAt||e.created_at,updatedAt:e.updatedAt||e.updated_at}},fromMemberApi(e){return{id:e.companyId,companyId:e.companyId,companyName:e.companyName,companyCode:e.companyUnifiedNumber,companyType:e.companyType,contractorLevel:e.contractorLevel,contactPerson:"",contactPhone:"",contactEmail:"",address:"",description:"",status:e.companyStatus,ownerUserId:"",createdAt:e.createdAt,updatedAt:e.updatedAt,userRole:e.userRole,joinedAt:e.joinedAt,memberCount:e.memberCount}},toApi(e){const t={companyName:e.companyName,companyUnifiedNumber:e.companyCode,companyType:e.companyType,contactPerson:e.contactPerson,contactPhone:e.contactPhone,contactEmail:e.contactEmail,address:e.address,description:e.description,status:e.status};return e.companyType==="CONTRACTOR"&&e.contractorLevel&&(t.contractorLevel=e.contractorLevel),t}},F=h("company",()=>{const e=p([]),t=p(null),y=p(!1),i=p(null),u=p({total:0,page:1,pageSize:10});P();const g=f(()=>e.value.map(n=>({...n,ownerName:"當前用戶"}))),A=f(()=>e.value.filter(n=>n.status==="ACTIVE")),I=f(()=>e.value),r=n=>{y.value=n},a=n=>{i.value=n},l=()=>{i.value=null};return{companies:e,currentCompany:t,isLoading:y,error:i,pagination:u,companiesWithUserInfo:g,activeCompanies:A,myCompanies:I,initCompanies:async()=>{r(!0),l();try{const n=await m.getMemberList();e.value=n.map(v.fromMemberApi),u.value.total=n.length}catch(n){console.error("Failed to load companies:",n),a("載入公司列表失敗"),e.value=[]}finally{r(!1)}},createCompany:async n=>{r(!0),l();try{const o=await m.create(n),c=v.fromApi(o);return e.value.unshift(c),u.value.total+=1,c}catch(o){return console.error("Failed to create company:",o),a("建立公司失敗"),null}finally{r(!1)}},getCompanyDetail:async n=>{r(!0),l();try{const o=await m.getDetail(n),c=v.fromApi(o),d=e.value.findIndex(C=>C.companyId===n);return d!==-1&&(e.value[d]=c),c}catch(o){return console.error("Failed to get company detail:",o),a("載入公司詳情失敗"),null}finally{r(!1)}},updateCompany:async(n,o)=>{r(!0),l();try{const c=await m.update(n,o),d=v.fromApi(c),C=e.value.findIndex(T=>T.companyId===n);return C!==-1&&(e.value[C]=d),d}catch(c){return console.error("Failed to update company:",c),a("更新公司失敗"),null}finally{r(!1)}},deleteCompany:async n=>{r(!0),l();try{await m.delete(n);const o=e.value.findIndex(c=>c.companyId===n);return o!==-1&&(e.value.splice(o,1),u.value.total-=1),!0}catch(o){return console.error("Failed to delete company:",o),a("刪除公司失敗"),!1}finally{r(!1)}},checkCompanyPermission:async n=>{try{return await m.checkPermission(n)}catch(o){return console.error("Failed to check company permission:",o),{hasPermission:!1,userRole:""}}},setCurrentCompany:n=>{t.value=n},getCompanyById:n=>e.value.find(o=>o.companyId===n),resetState:()=>{e.value=[],t.value=null,y.value=!1,i.value=null,u.value={total:0,page:1,pageSize:10}},setLoading:r,setError:a,clearError:l}});export{x as C,M as a,F as u};
