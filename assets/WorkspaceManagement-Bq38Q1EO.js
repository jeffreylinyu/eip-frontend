import{d as de,r as h,I as R,x as ee,o as be,C as ie,g as i,p as C,h as e,w as ve,f as u,i as I,j as V,k as v,z as M,F as G,D as Y,t as r,E as fe,v as F,T as re,_ as ue,U as _e,n as w,L as z,K as J,m as A,J as me,V as he,W as $e,G as Te}from"./index-0fEq5Ai7.js";import{u as we,C as pe,a as Ce}from"./company-CEpg23Or.js";import{_ as Re}from"./ProjectForm.vue_vue_type_script_setup_true_lang-D6H6gZRS.js";import{t as Ee,c as Ne}from"./construction-DkjzJ5BA.js";const Me={class:"mb-3"},Se=["disabled"],Ae=["value"],Pe={key:0,class:"invalid-feedback"},Ue={key:1,class:"form-text text-warning"},Le={class:"mb-3"},je=["disabled"],We={key:0,class:"invalid-feedback"},Oe={class:"form-text"},Ve={class:"mb-3"},qe=["disabled"],De={key:0,class:"invalid-feedback"},Ge={class:"form-text"},Be={key:0,class:"alert alert-danger"},He={class:"mb-0 mt-2"},ze=de({__name:"WorkspaceFormModal",props:{show:{type:Boolean},workspace:{}},emits:["update:show","hide","submit"],setup(K,{emit:E}){const k=K,j=E,d=h({name:"",description:"",companyId:""}),N=we(),g=h(!1),f=h({}),P=R(()=>!!k.workspace),x=R(()=>P.value?"ç·¨è¼¯å·¥ä½œç©ºé–“":"æ–°å¢žå·¥ä½œç©ºé–“"),_=R(()=>P.value?"æ›´æ–°":"å‰µå»º"),U=R(()=>N.activeCompanies),T=()=>{j("update:show",!1),j("hide")},$=()=>{var c;d.value={name:"",description:"",companyId:((c=U.value[0])==null?void 0:c.companyId)||""},f.value={}};ee(()=>k.workspace,c=>{c?d.value={name:c.name,description:c.description,companyId:c.companyId||""}:$()},{immediate:!0}),ee(()=>k.show,c=>{console.log("WorkspaceFormModal show changed:",c),c&&(f.value={},!d.value.companyId&&U.value.length>0&&(d.value.companyId=U.value[0].companyId))});const S=()=>(f.value={},d.value.name.trim()?d.value.name.trim().length<2?f.value.name="å·¥ä½œç©ºé–“åç¨±è‡³å°‘éœ€è¦2å€‹å­—ç¬¦":d.value.name.trim().length>50&&(f.value.name="å·¥ä½œç©ºé–“åç¨±ä¸èƒ½è¶…éŽ50å€‹å­—ç¬¦"):f.value.name="å·¥ä½œç©ºé–“åç¨±ä¸èƒ½ç‚ºç©º",d.value.companyId.trim()||(f.value.companyId="è«‹é¸æ“‡ä¸€å€‹å…¬å¸"),d.value.description.trim().length>200&&(f.value.description="å·¥ä½œç©ºé–“æè¿°ä¸èƒ½è¶…éŽ200å€‹å­—ç¬¦"),Object.keys(f.value).length===0),W=async()=>{if(!S()){console.log("âš ï¸ è¡¨å–®é©—è­‰å¤±æ•—");return}g.value=!0,console.log("ðŸ“‹ å·¥ä½œç©ºé–“è¡¨å–®æäº¤ä¸­...");try{const c={name:d.value.name.trim(),description:d.value.description.trim(),companyId:d.value.companyId.trim()};console.log("ðŸ“¤ æäº¤çš„è¡¨å–®è³‡æ–™:",c),console.log("ðŸ¢ é¸æ“‡çš„å…¬å¸ ID:",c.companyId),j("submit",c)}catch(c){console.error("âŒ è¡¨å–®æäº¤éŒ¯èª¤:",c)}finally{g.value=!1}},B=()=>{W()},n=c=>{f.value[c]&&delete f.value[c]};return be(()=>{N.initCompanies()}),(c,p)=>(i(),ie(re,{show:k.show,title:x.value,icon:"fa fa-building",size:"lg","modal-id":"workspaceFormModal","confirm-text":_.value,"confirm-icon":"fa fa-save","is-loading":g.value,"loading-text":"è™•ç†ä¸­...",onHide:T,onConfirm:B},{body:C(()=>[e("form",{onSubmit:ve(W,["prevent"])},[e("div",Me,[p[8]||(p[8]=e("label",{for:"companyId",class:"form-label"},[v(" æ‰€å±¬å…¬å¸ "),e("span",{class:"text-danger"},"*")],-1)),V(e("select",{id:"companyId",class:M(["form-select",{"is-invalid":f.value.companyId}]),"onUpdate:modelValue":p[0]||(p[0]=y=>d.value.companyId=y),onChange:p[1]||(p[1]=y=>n("companyId")),disabled:g.value},[p[6]||(p[6]=e("option",{value:""},"è«‹é¸æ“‡å…¬å¸",-1)),(i(!0),u(G,null,Y(U.value,y=>(i(),u("option",{key:y.companyId,value:y.companyId},r(y.companyName)+" ("+r(y.companyCode)+") ",9,Ae))),128))],42,Se),[[fe,d.value.companyId]]),f.value.companyId?(i(),u("div",Pe,r(f.value.companyId),1)):I("",!0),U.value.length===0?(i(),u("div",Ue,p[7]||(p[7]=[e("i",{class:"fa fa-exclamation-triangle me-1"},null,-1),v(" ç›®å‰æ²’æœ‰å¯ç”¨çš„å…¬å¸ï¼Œè«‹å…ˆå»ºç«‹å…¬å¸ ")]))):I("",!0)]),e("div",Le,[p[9]||(p[9]=e("label",{for:"workspaceName",class:"form-label"},[v(" å·¥ä½œç©ºé–“åç¨± "),e("span",{class:"text-danger"},"*")],-1)),V(e("input",{id:"workspaceName",type:"text",class:M(["form-control",{"is-invalid":f.value.name}]),"onUpdate:modelValue":p[2]||(p[2]=y=>d.value.name=y),onInput:p[3]||(p[3]=y=>n("name")),placeholder:"è«‹è¼¸å…¥å·¥ä½œç©ºé–“åç¨±",maxlength:"50",disabled:g.value},null,42,je),[[F,d.value.name]]),f.value.name?(i(),u("div",We,r(f.value.name),1)):I("",!0),e("div",Oe,r(d.value.name.length)+"/50 å­—ç¬¦ ",1)]),e("div",Ve,[p[10]||(p[10]=e("label",{for:"workspaceDescription",class:"form-label"},"å·¥ä½œç©ºé–“æè¿°",-1)),V(e("textarea",{id:"workspaceDescription",class:M(["form-control",{"is-invalid":f.value.description}]),"onUpdate:modelValue":p[4]||(p[4]=y=>d.value.description=y),onInput:p[5]||(p[5]=y=>n("description")),placeholder:"è«‹è¼¸å…¥å·¥ä½œç©ºé–“æè¿°ï¼ˆé¸å¡«ï¼‰",rows:"3",maxlength:"200",disabled:g.value},null,42,qe),[[F,d.value.description]]),f.value.description?(i(),u("div",De,r(f.value.description),1)):I("",!0),e("div",Ge,r(d.value.description.length)+"/200 å­—ç¬¦ ",1)]),Object.keys(f.value).length>0?(i(),u("div",Be,[p[11]||(p[11]=e("i",{class:"fa fa-exclamation-triangle me-2"},null,-1)),p[12]||(p[12]=v(" è«‹ä¿®æ­£ä»¥ä¸‹éŒ¯èª¤ï¼š ")),e("ul",He,[(i(!0),u(G,null,Y(f.value,(y,H)=>(i(),u("li",{key:H},r(y),1))),128))])])):I("",!0)],32)]),_:1},8,["show","title","confirm-text","is-loading"]))}}),Je=ue(ze,[["__scopeId","data-v-5a6d992a"]]),Ye={class:"d-flex align-items-center justify-content-between w-100"},Fe={class:"modal-title"},Ke={class:"btn-group",role:"group"},Qe=de({__name:"ProjectFormModal",props:{show:{type:Boolean},project:{}},emits:["update:show","hide","submit"],setup(K,{emit:E}){const k=K,j=E,d=_e(),N=h({project_name:"",contract_number:"",project_location:"",host_agency:"",supervision_unit:"",contractor_name:"",construction_period:"",project_amount:"",project_grade:"",project_category:"",funding_source:"",start_date:"",completion_date:"",payment_method:"",advance_payment_ratio:"",retention_ratio:"",inspection_methods:[],insurance_policy_number:"",insurance_company:"",insurance_start_date:"",insurance_end_date:"",insurance_type:"",workspaceId:""}),g=h(!1),f=h(null),P=R(()=>!!k.project),x=R(()=>P.value?"ç·¨è¼¯é …ç›®":"æ–°å¢žé …ç›®"),_=R(()=>P.value?"æ›´æ–°":"å‰µå»º"),U={complete:{project_name:"æ–°åŒ—å¸‚è˜†æ´²å€ç¤¾å€å…¬åœ’æ”¹å–„è¨ˆç•«",contract_number:"CONTRACT-2024-001",project_location:"æ–°åŒ—å¸‚è˜†æ´²å€ä¸­æ­£è·¯1è™Ÿ",host_agency:"æ–°åŒ—å¸‚æ”¿åºœå·¥å‹™å±€",supervision_unit:"ä¸­èˆˆå·¥ç¨‹é¡§å•è‚¡ä»½æœ‰é™å…¬å¸",contractor_name:"ä¸­è¯å·¥ç¨‹è‚¡ä»½æœ‰é™å…¬å¸",construction_period:"180å¤©",project_amount:"7500000",project_grade:"ç”²ç­‰",project_category:"åœŸæœ¨å·¥ç¨‹",funding_source:"ä¸€èˆ¬é ç®—",start_date:"2024-06-01",completion_date:"2024-12-01",payment_method:"åˆ†æœŸä»˜æ¬¾",advance_payment_ratio:"30",retention_ratio:"5",inspection_methods:["åˆ†æ®µé©—æ”¶","ç«£å·¥é©—æ”¶"],insurance_policy_number:"INS-2024-001",insurance_company:"è¯å—ç”¢ç‰©ä¿éšª",insurance_start_date:"2024-06-01",insurance_end_date:"2025-06-01",insurance_type:"å·¥ç¨‹éšª"},partial:{project_name:"å°åŒ—å¸‚ä¿¡ç¾©å€é“è·¯æ”¹å–„å·¥ç¨‹",contract_number:"CONTRACT-2024-002",project_location:"å°åŒ—å¸‚ä¿¡ç¾©å€ä¿¡ç¾©è·¯äº”æ®µ",host_agency:"å°åŒ—å¸‚æ”¿åºœå·¥å‹™å±€",supervision_unit:"",contractor_name:"",construction_period:"120å¤©",project_amount:"5000000",project_grade:"ä¹™ç­‰",project_category:"é“è·¯å·¥ç¨‹",funding_source:"å‰çž»åŸºç¤Žå»ºè¨­è¨ˆç•«",start_date:"2024-07-01",completion_date:"2024-11-01",payment_method:"å·¥ç¨‹æ¬¾æ”¯ä»˜",advance_payment_ratio:"25",retention_ratio:"3",inspection_methods:["ç«£å·¥é©—æ”¶"],insurance_policy_number:"",insurance_company:"å¯Œé‚¦ç”¢ç‰©ä¿éšª",insurance_start_date:"2024-07-01",insurance_end_date:"2025-07-01",insurance_type:"é›‡ä¸»è²¬ä»»éšª"},empty:{project_name:"",contract_number:"",project_location:"",host_agency:"",supervision_unit:"",contractor_name:"",construction_period:"",project_amount:"",project_grade:"",project_category:"",funding_source:"",start_date:"",completion_date:"",payment_method:"",advance_payment_ratio:"",retention_ratio:"",inspection_methods:[],insurance_policy_number:"",insurance_company:"",insurance_start_date:"",insurance_end_date:"",insurance_type:""}},T=n=>{var p,y;console.log(`ðŸ“‹ è¼‰å…¥å·¥ç¨‹é …ç›®æ¸¬è©¦è³‡æ–™: ${n}`),N.value={...U[n],workspaceId:((p=d.currentWorkspace)==null?void 0:p.id)||((y=d.workspaces[0])==null?void 0:y.id)||""},alert(`å·²è¼‰å…¥${n==="complete"?"å®Œæ•´æ¸¬è©¦è³‡æ–™":n==="partial"?"éƒ¨åˆ†æ¸¬è©¦è³‡æ–™":"ç©ºæ¸¬è©¦è³‡æ–™"}ï¼`)},$=()=>{j("update:show",!1),j("hide")},S=()=>{var n,c;N.value={project_name:"",contract_number:"",project_location:"",host_agency:"",supervision_unit:"",contractor_name:"",construction_period:"",project_amount:"",project_grade:"",project_category:"",funding_source:"",start_date:"",completion_date:"",payment_method:"",advance_payment_ratio:"",retention_ratio:"",inspection_methods:[],insurance_policy_number:"",insurance_company:"",insurance_start_date:"",insurance_end_date:"",insurance_type:"",workspaceId:((n=d.currentWorkspace)==null?void 0:n.id)||((c=d.workspaces[0])==null?void 0:c.id)||""}};ee(()=>k.project,n=>{n&&n.id?N.value={project_name:n.name||"",contract_number:n.contractNumber||n.id||"",project_location:n.location||"",host_agency:n.hostAgency||"",supervision_unit:n.supervisionUnit||"",contractor_name:n.managerName||"",construction_period:n.constructionPeriod||"",project_amount:n.budget||"",project_grade:n.projectGrade||"",project_category:n.projectCategory||"",funding_source:n.fundingSource||"",start_date:n.startDate||"",completion_date:n.endDate||"",payment_method:n.paymentMethod||"",advance_payment_ratio:n.advancePaymentRatio||"",retention_ratio:n.retentionRatio||"",inspection_methods:n.inspectionMethods||[],insurance_policy_number:n.insurancePolicyNumber||"",insurance_company:n.insuranceCompany||"",insurance_start_date:n.insuranceStartDate||"",insurance_end_date:n.insuranceEndDate||"",insurance_type:n.insuranceType||"",workspaceId:n.workspaceId||""}:S()},{immediate:!1}),ee(()=>k.show,n=>{n||S()});const W=async n=>{var c,p;console.log("ðŸ“‹ å·¥ç¨‹é …ç›®è¡¨å–®æäº¤ä¸­..."),console.log("ðŸ“¤ è¡¨å–®è³‡æ–™:",n),g.value=!0;try{const y=((c=d.currentWorkspace)==null?void 0:c.id)||((p=d.workspaces[0])==null?void 0:p.id);if(!y)throw new Error("ç„¡æ³•ç²å–å·¥ä½œç©ºé–“ ID");const H=Ee(n,y);console.log("ðŸ”„ è½‰æ›å¾Œçš„ API è«‹æ±‚:",H);const Q=await Ne(H);console.log("âœ… å·¥ç¨‹é …ç›®å‰µå»ºæˆåŠŸ:",Q);const q={id:Q.constructionId,name:n.project_name,workspaceId:y,location:n.project_location,budget:n.project_amount,status:"PLANNING",startDate:n.start_date,endDate:n.completion_date,managerName:n.contractor_name,description:`${n.project_category} - ${n.funding_source}`,progress:0,contractNumber:n.contract_number,hostAgency:n.host_agency,supervisionUnit:n.supervision_unit,constructionPeriod:n.construction_period,projectGrade:n.project_grade,projectCategory:n.project_category,fundingSource:n.funding_source,paymentMethod:n.payment_method,advancePaymentRatio:n.advance_payment_ratio,retentionRatio:n.retention_ratio,inspectionMethods:n.inspection_methods,insurancePolicyNumber:n.insurance_policy_number,insuranceCompany:n.insurance_company,insuranceStartDate:n.insurance_start_date,insuranceEndDate:n.insurance_end_date,insuranceType:n.insurance_type};console.log("ðŸ”„ è½‰æ›å¾Œçš„æœ¬åœ°ç‹€æ…‹è³‡æ–™:",q),j("submit",q),$()}catch(y){console.error("âŒ å‰µå»ºå·¥ç¨‹é …ç›®å¤±æ•—:",y),alert(`å‰µå»ºå·¥ç¨‹é …ç›®å¤±æ•—ï¼š${y.message||"æœªçŸ¥éŒ¯èª¤"}`)}finally{g.value=!1}},B=async()=>{console.log("ðŸ” Modal ç¢ºèªæŒ‰éˆ•é»žæ“Šï¼Œè§¸ç™¼ ProjectForm çš„æäº¤æ–¹æ³•..."),f.value?f.value.handleSubmit():console.error("âŒ ç„¡æ³•æ‰¾åˆ° ProjectForm çµ„ä»¶å¼•ç”¨")};return(n,c)=>(i(),ie(re,{show:k.show,title:x.value,icon:"fa fa-project-diagram",size:"xl","modal-id":"projectFormModal","confirm-text":_.value,"confirm-icon":"fa fa-save","is-loading":g.value,"loading-text":"è™•ç†ä¸­...",onHide:$,onConfirm:B},{header:C(()=>[e("div",Ye,[e("div",null,[e("h5",Fe,[c[4]||(c[4]=e("i",{class:"fa fa-project-diagram me-2"},null,-1)),v(" "+r(x.value),1)])]),e("div",Ke,[e("button",{type:"button",class:"btn btn-outline-success btn-sm",onClick:c[0]||(c[0]=p=>T("complete")),title:"è¼‰å…¥å®Œæ•´æ¸¬è©¦è³‡æ–™"},c[5]||(c[5]=[e("i",{class:"fa fa-check-circle me-1"},null,-1),v(" å®Œæ•´è³‡æ–™ ")])),e("button",{type:"button",class:"btn btn-outline-warning btn-sm",onClick:c[1]||(c[1]=p=>T("partial")),title:"è¼‰å…¥éƒ¨åˆ†æ¸¬è©¦è³‡æ–™ï¼ˆæœ‰éŒ¯èª¤ï¼‰"},c[6]||(c[6]=[e("i",{class:"fa fa-exclamation-triangle me-1"},null,-1),v(" éƒ¨åˆ†è³‡æ–™ ")])),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:c[2]||(c[2]=p=>T("empty")),title:"è¼‰å…¥ç©ºæ¸¬è©¦è³‡æ–™ï¼ˆå…¨éƒ¨éŒ¯èª¤ï¼‰"},c[7]||(c[7]=[e("i",{class:"fa fa-times-circle me-1"},null,-1),v(" ç©ºè³‡æ–™ ")]))])])]),body:C(()=>[w(Re,{ref_key:"projectFormRef",ref:f,modelValue:N.value,"onUpdate:modelValue":c[3]||(c[3]=p=>N.value=p),"is-submitting":g.value,"show-submit-button":!1,"show-reset-button":!1,onSubmit:W,onReset:S},null,8,["modelValue","is-submitting"])]),_:1},8,["show","title","confirm-text","is-loading"]))}}),Xe=ue(Qe,[["__scopeId","data-v-a3abf774"]]),Ze={class:"workspace-company-management"},et={class:"d-flex align-items-center justify-content-between mb-4"},tt={class:"mb-1"},st={class:"text-muted small mt-2"},nt={class:"row mb-4"},ot={class:"col-md-3"},at={class:"fs-18px fw-600 text-theme"},lt={class:"col-md-3"},it={class:"fs-18px fw-600 text-primary"},rt={class:"col-md-3"},dt={class:"fs-18px fw-600 text-info"},ut={class:"col-md-3"},ct={class:"fs-18px fw-600 text-success"},mt={class:"nav nav-tabs mb-3"},pt={class:"nav-item"},vt={class:"nav-item"},ft={key:0,class:"badge bg-warning rounded-pill ms-1"},bt={class:"nav-item"},_t={key:0,class:"badge bg-danger rounded-pill ms-1"},yt={key:0},gt={class:"d-flex align-items-center justify-content-between"},xt={class:"d-flex gap-2"},kt={class:"input-group",style:{width:"300px"}},ht=["value"],Ct={key:0,class:"text-center py-4"},wt={key:1,class:"text-center py-4"},It={key:2,class:"table-responsive"},$t={class:"table table-hover"},Tt={class:"fw-600"},Rt={class:"text-muted small"},Et={key:1,class:"text-muted"},Nt={class:"text-muted small"},Mt={class:"text-center"},St={class:"badge border border-secondary text-secondary px-2 pt-5px pb-5px rounded fs-12px"},At={class:"text-center"},Pt=["onClick"],Ut={key:1},Lt={key:0,class:"text-center py-4"},jt={key:1,class:"table-responsive"},Wt={class:"table table-hover"},Ot={class:"fw-600"},Vt={class:"text-muted small"},qt={class:"text-muted"},Dt={class:"text-muted small"},Gt={class:"text-center"},Bt={key:2},Ht={key:0,class:"text-center py-4"},zt={key:1,class:"table-responsive"},Jt={class:"table table-hover"},Yt={class:"fw-600"},Ft={class:"text-muted"},Kt={class:"text-muted small"},Qt={class:"text-center"},Xt=["onClick"],Zt=["onClick"],es={class:"mb-3"},ts={class:"input-group"},ss=["disabled"],ns={key:0,class:"spinner-border spinner-border-sm me-1"},os={key:1,class:"fa fa-search me-1"},as={key:0,class:"invalid-feedback d-block"},ls={key:0,class:"mb-3"},is={class:"card border-success"},rs={class:"card-body py-2"},ds={class:"d-flex align-items-center"},us={class:"flex-grow-1"},cs={class:"fw-600"},ms={class:"text-muted small"},ps={class:"text-muted small"},vs={class:"mb-3"},fs=["value","disabled"],bs={key:0},_s={class:"mb-3"},ys={class:"d-flex justify-content-end gap-2"},gs=["disabled"],xs={class:"alert alert-warning"},ks={class:"mb-3"},hs={class:"mb-3"},Cs={class:"form-check"},ws={class:"form-check"},Is={key:0,class:"mb-3"},$s={class:"d-flex justify-content-end gap-2"},Ts=["disabled"],Rs=de({__name:"WorkspaceCompanyManagement",props:{workspace:{}},emits:["back"],setup(K,{emit:E}){const k=K,j=E,d=_e();we();const N=h(!1),g=h("companies"),f=h(!1),P=h(!1);h(!1);const x=h({companyCode:"",companyId:"",role:"",message:""}),_=h(null),U=h(!1),T=h(""),$=h({companyId:"",reason:"",requestType:"MUTUAL_AGREEMENT",customerServiceNote:""}),S=h(""),W=h(""),B=h(null),n=R(()=>{let l=d.workspaceCompanies;return S.value&&(l=l.filter(t=>t.companyName.toLowerCase().includes(S.value.toLowerCase())||t.companyUnifiedNumber.includes(S.value))),W.value&&(l=l.filter(t=>t.companyType===W.value)),l}),c=R(()=>{var l,t;return((l=k.workspace)==null?void 0:l.role)==="OWNER"||((t=k.workspace)==null?void 0:t.role)==="ADMIN"}),p=R(()=>{const l=d.workspaceCompanies.filter(t=>t.role==="MAIN_CONTRACTOR"&&t.status==="ACTIVE");return c.value&&l.length===0}),y=R(()=>{const l=d.workspaceCompanies.filter(t=>t.role==="SUPERVISOR"&&t.status==="ACTIVE");return c.value&&l.length===0}),H=R(()=>c.value),Q=R(()=>[{value:"MAIN_CONTRACTOR",label:"ä¸»è¦æ‰¿åŒ…å•†",disabled:!p.value},{value:"SUPERVISOR",label:"ç›£é€ å–®ä½",disabled:!y.value},{value:"THIRD_PARTY",label:"ç¬¬ä¸‰æ–¹å…¬å¸",disabled:!H.value}]),q=async()=>{if(k.workspace){N.value=!0;try{await Promise.all([d.loadWorkspaceCompanies(k.workspace.id),d.searchAvailableCompanies()])}catch(l){console.error("Failed to load data:",l)}finally{N.value=!1}}},te=()=>{x.value={companyCode:"",companyId:"",role:"",message:""},_.value=null,T.value="",f.value=!0},se=()=>{f.value=!1,x.value={companyCode:"",companyId:"",role:"",message:""},_.value=null,T.value=""},Z=async()=>{await d.searchAvailableCompanies(S.value,W.value)},X=async()=>{const l=x.value.companyCode.trim();if(!l){T.value="è«‹è¼¸å…¥å…¬å¸ä»£ç¢¼",_.value=null;return}U.value=!0,T.value="";try{const t=await $e.searchCompanyByCode(l);t?(_.value=t,x.value.companyId=t.companyId,T.value=""):(_.value=null,T.value="æ‰¾ä¸åˆ°æ­¤å…¬å¸ä»£ç¢¼ï¼Œè«‹ç¢ºèªä»£ç¢¼æ˜¯å¦æ­£ç¢º")}catch(t){console.error("Failed to search company:",t),T.value="æœç´¢å…¬å¸æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦",_.value=null}finally{U.value=!1}},ne=async()=>{if(!(!k.workspace||!x.value.companyId||!x.value.role))try{if(x.value.role==="MAIN_CONTRACTOR"&&!p.value)throw new Error("å·¥ä½œç©ºé–“å·²æœ‰ä¸»è¦æ‰¿åŒ…å•†ï¼Œç„¡æ³•å†é‚€è«‹");if(x.value.role==="SUPERVISOR"&&!y.value)throw new Error("å·¥ä½œç©ºé–“å·²æœ‰ç›£é€ å–®ä½ï¼Œç„¡æ³•å†é‚€è«‹");if(!c.value)throw new Error("æ‚¨æ²’æœ‰é‚€è«‹å…¬å¸çš„æ¬Šé™");await d.inviteCompanyToWorkspace(k.workspace.id,{companyId:x.value.companyId,role:x.value.role,message:x.value.message}),se(),await q()}catch(l){console.error("Failed to invite company:",l),alert(l instanceof Error?l.message:"é‚€è«‹å¤±æ•—")}},ce=l=>{B.value=l,$.value={companyId:l.companyId,reason:"",requestType:"MUTUAL_AGREEMENT",customerServiceNote:""},P.value=!0},a=()=>{P.value=!1,B.value=null,$.value={companyId:"",reason:"",requestType:"MUTUAL_AGREEMENT",customerServiceNote:""}},s=async()=>{if(!(!k.workspace||!$.value.companyId||!$.value.reason))try{await d.requestRemoveCompany(k.workspace.id,$.value),a(),await q()}catch(l){console.error("Failed to request removal:",l),alert("è«‹æ±‚ç§»é™¤å¤±æ•—")}},m=async(l,t)=>{try{await d.respondToCompanyInvite(l,t),await q()}catch(L){console.error("Failed to respond to invite:",L),alert("å›žæ‡‰é‚€è«‹å¤±æ•—")}},b=async(l,t)=>{if(k.workspace)try{await d.respondToRemovalRequest(k.workspace.id,l,t),await q()}catch(L){console.error("Failed to respond to removal request:",L),alert("å›žæ‡‰ç§»é™¤è«‹æ±‚å¤±æ•—")}},D=l=>{var t;return((t=pe.find(L=>L.value===l))==null?void 0:t.label)||l},oe=l=>{var t;return((t=pe.find(L=>L.value===l))==null?void 0:t.color)||"secondary"},ye=l=>{var t;return l?((t=Ce.find(L=>L.value===l))==null?void 0:t.label)||l:""},ae=l=>{var t;return l&&((t=Ce.find(L=>L.value===l))==null?void 0:t.color)||"secondary"},ge=l=>({MAIN_CONTRACTOR:"ä¸»è¦æ‰¿åŒ…å•†",SUPERVISOR:"ç›£é€ å–®ä½",THIRD_PARTY:"ç¬¬ä¸‰æ–¹å…¬å¸"})[l]||l,le=l=>({MAIN_CONTRACTOR:"primary",SUPERVISOR:"info",THIRD_PARTY:"success"})[l]||"secondary",Ie=l=>({ACTIVE:"å·²åŠ å…¥",PENDING:"å¾…å›žæ‡‰",REJECTED:"å·²æ‹’çµ•"})[l]||l,xe=l=>({ACTIVE:"success",PENDING:"warning",REJECTED:"danger"})[l]||"secondary";return ee(()=>k.workspace,l=>{l&&q()},{immediate:!0}),be(()=>{k.workspace&&q()}),(l,t)=>{var L,ke;return i(),u("div",Ze,[e("div",et,[e("div",null,[e("h5",tt,[t[18]||(t[18]=e("i",{class:"fa fa-building me-2"},null,-1)),v(" "+r((L=l.workspace)==null?void 0:L.name)+" - å…¬å¸ç®¡ç† ",1)]),t[19]||(t[19]=e("p",{class:"text-muted mb-0"},"ç®¡ç†å·¥ä½œç©ºé–“ä¸­çš„å…¬å¸æˆå“¡",-1))]),e("div",null,[e("button",{class:"btn btn-outline-secondary me-2",onClick:t[0]||(t[0]=o=>j("back"))},t[20]||(t[20]=[e("i",{class:"fa fa-arrow-left me-1"},null,-1),v(" è¿”å›ž ")])),e("button",{class:"btn btn-theme",onClick:te},t[21]||(t[21]=[e("i",{class:"fa fa-plus me-1"},null,-1),v(" é‚€è«‹å…¬å¸ ")])),e("div",st," èª¿è©¦ä¿¡æ¯ï¼šå·¥ä½œç©ºé–“è§’è‰²ï¼š"+r((ke=l.workspace)==null?void 0:ke.role)+" | æ¬Šé™æª¢æŸ¥ï¼š"+r(c.value),1)])]),e("div",nt,[e("div",ot,[w(z,{class:"text-center h-100"},{default:C(()=>[w(J,null,{default:C(()=>[e("div",at,r(A(d).activeCompaniesCount),1),t[22]||(t[22]=e("div",{class:"text-muted"},"æ´»èºå…¬å¸",-1))]),_:1,__:[22]})]),_:1})]),e("div",lt,[w(z,{class:"text-center h-100"},{default:C(()=>[w(J,null,{default:C(()=>[e("div",it,r(A(d).mainContractor?"1":"0"),1),t[23]||(t[23]=e("div",{class:"text-muted"},"ä¸»è¦æ‰¿åŒ…å•†",-1))]),_:1,__:[23]})]),_:1})]),e("div",rt,[w(z,{class:"text-center h-100"},{default:C(()=>[w(J,null,{default:C(()=>[e("div",dt,r(A(d).supervisor?"1":"0"),1),t[24]||(t[24]=e("div",{class:"text-muted"},"ç›£é€ å–®ä½",-1))]),_:1,__:[24]})]),_:1})]),e("div",ut,[w(z,{class:"text-center h-100"},{default:C(()=>[w(J,null,{default:C(()=>[e("div",ct,r(A(d).thirdPartyCompanies.length),1),t[25]||(t[25]=e("div",{class:"text-muted"},"ç¬¬ä¸‰æ–¹å…¬å¸",-1))]),_:1,__:[25]})]),_:1})])]),e("ul",mt,[e("li",pt,[e("button",{class:M(["nav-link",{active:g.value==="companies"}]),onClick:t[1]||(t[1]=o=>g.value="companies")},t[26]||(t[26]=[e("i",{class:"fa fa-building me-1"},null,-1),v(" å…¬å¸åˆ—è¡¨ ")]),2)]),e("li",vt,[e("button",{class:M(["nav-link position-relative",{active:g.value==="invites"}]),onClick:t[2]||(t[2]=o=>g.value="invites")},[t[27]||(t[27]=e("i",{class:"fa fa-envelope me-1"},null,-1)),t[28]||(t[28]=v(" å¾…è™•ç†é‚€è«‹ ")),A(d).pendingInvites.length>0?(i(),u("span",ft,r(A(d).pendingInvites.length),1)):I("",!0)],2)]),e("li",bt,[e("button",{class:M(["nav-link position-relative",{active:g.value==="removal-requests"}]),onClick:t[3]||(t[3]=o=>g.value="removal-requests")},[t[29]||(t[29]=e("i",{class:"fa fa-times-circle me-1"},null,-1)),t[30]||(t[30]=v(" ç§»é™¤è«‹æ±‚ ")),A(d).pendingRemovalRequests.length>0?(i(),u("span",_t,r(A(d).pendingRemovalRequests.length),1)):I("",!0)],2)])]),g.value==="companies"?(i(),u("div",yt,[w(z,null,{default:C(()=>[w(me,null,{default:C(()=>[e("div",gt,[t[33]||(t[33]=e("h6",{class:"mb-0"},[e("i",{class:"fa fa-building me-2"}),v(" å·¥ä½œç©ºé–“å…¬å¸åˆ—è¡¨ ")],-1)),e("div",xt,[e("div",kt,[V(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>S.value=o),type:"text",class:"form-control",placeholder:"æœç´¢å…¬å¸åç¨±æˆ–çµ±ä¸€ç·¨è™Ÿ",onInput:Z},null,544),[[F,S.value]]),e("button",{class:"btn btn-outline-secondary",onClick:Z},t[31]||(t[31]=[e("i",{class:"fa fa-search"},null,-1)]))]),V(e("select",{"onUpdate:modelValue":t[5]||(t[5]=o=>W.value=o),class:"form-select",style:{width:"150px"},onChange:Z},[t[32]||(t[32]=e("option",{value:""},"æ‰€æœ‰é¡žåž‹",-1)),(i(!0),u(G,null,Y(A(pe),o=>(i(),u("option",{key:o.value,value:o.value},r(o.label),9,ht))),128))],544),[[fe,W.value]])])])]),_:1}),w(J,null,{default:C(()=>[N.value?(i(),u("div",Ct,t[34]||(t[34]=[e("div",{class:"spinner-border text-theme",role:"status"},[e("span",{class:"visually-hidden"},"è¼‰å…¥ä¸­...")],-1)]))):n.value.length===0?(i(),u("div",wt,t[35]||(t[35]=[e("i",{class:"fa fa-building fa-3x text-muted mb-3"},null,-1),e("h6",{class:"text-muted"},"æš«ç„¡å…¬å¸",-1),e("p",{class:"text-muted"},"é»žæ“Šã€Œé‚€è«‹å…¬å¸ã€é–‹å§‹å»ºç«‹åˆä½œé—œä¿‚",-1)]))):(i(),u("div",It,[e("table",$t,[t[37]||(t[37]=e("thead",null,[e("tr",null,[e("th",null,"å…¬å¸è³‡è¨Š"),e("th",null,"å…¬å¸é¡žåž‹"),e("th",null,"ç‡Ÿé€ ç­‰ç´š"),e("th",null,"è§’è‰²"),e("th",null,"ç‹€æ…‹"),e("th",null,"åŠ å…¥æ™‚é–“"),e("th",null,"æˆå“¡æ•¸é‡"),e("th",{class:"text-center"},"æ“ä½œ")])],-1)),e("tbody",null,[(i(!0),u(G,null,Y(n.value,o=>(i(),u("tr",{key:o.companyId},[e("td",null,[e("div",null,[e("div",Tt,r(o.companyName),1),e("div",Rt,r(o.companyUnifiedNumber),1)])]),e("td",null,[e("span",{class:M(["badge border px-2 pt-5px pb-5px rounded fs-12px",`border-${oe(o.companyType)} text-${oe(o.companyType)}`])},r(D(o.companyType)),3)]),e("td",null,[o.contractorLevel?(i(),u("span",{key:0,class:M(["badge border px-2 pt-5px pb-5px rounded fs-12px",`border-${ae(o.contractorLevel)} text-${ae(o.contractorLevel)}`])},r(ye(o.contractorLevel)),3)):(i(),u("span",Et,"-"))]),e("td",null,[e("span",{class:M(["badge border px-2 pt-5px pb-5px rounded fs-12px",`border-${le(o.role)} text-${le(o.role)}`])},r(ge(o.role)),3)]),e("td",null,[e("span",{class:M(["badge border px-2 pt-5px pb-5px rounded fs-12px",`border-${xe(o.status)} text-${xe(o.status)}`])},r(Ie(o.status)),3)]),e("td",Nt,r(new Date(o.joinedAt).toLocaleDateString()),1),e("td",Mt,[e("span",St,r(o.memberCount),1)]),e("td",At,[c.value&&o.status==="ACTIVE"?(i(),u("button",{key:0,class:"btn btn-sm btn-outline-danger",onClick:O=>ce(o),title:"è«‹æ±‚ç§»é™¤å…¬å¸"},t[36]||(t[36]=[e("i",{class:"fa fa-times"},null,-1)]),8,Pt)):I("",!0)])]))),128))])])]))]),_:1})]),_:1})])):I("",!0),g.value==="invites"?(i(),u("div",Ut,[w(z,null,{default:C(()=>[w(me,null,{default:C(()=>t[38]||(t[38]=[e("h6",{class:"mb-0"},[e("i",{class:"fa fa-envelope me-2"}),v(" å¾…è™•ç†é‚€è«‹ ")],-1)])),_:1,__:[38]}),w(J,null,{default:C(()=>[A(d).pendingInvites.length===0?(i(),u("div",Lt,t[39]||(t[39]=[e("i",{class:"fa fa-envelope fa-3x text-muted mb-3"},null,-1),e("h6",{class:"text-muted"},"æš«ç„¡å¾…è™•ç†é‚€è«‹",-1)]))):(i(),u("div",jt,[e("table",Wt,[t[42]||(t[42]=e("thead",null,[e("tr",null,[e("th",null,"å…¬å¸åç¨±"),e("th",null,"è§’è‰²"),e("th",null,"é‚€è«‹äºº"),e("th",null,"é‚€è«‹æ™‚é–“"),e("th",{class:"text-center"},"æ“ä½œ")])],-1)),e("tbody",null,[(i(!0),u(G,null,Y(A(d).pendingInvites,o=>(i(),u("tr",{key:o.companyId},[e("td",null,[e("div",null,[e("div",Ot,r(o.companyName),1),e("div",Vt,r(o.companyUnifiedNumber),1)])]),e("td",null,[e("span",{class:M(["badge border px-2 pt-5px pb-5px rounded fs-12px",`border-${le(o.role)} text-${le(o.role)}`])},r(ge(o.role)),3)]),e("td",qt,r(o.invitedBy),1),e("td",Dt,r(new Date(o.joinedAt).toLocaleDateString()),1),e("td",Gt,[e("button",{class:"btn btn-sm btn-success me-1",onClick:t[6]||(t[6]=O=>m(l.workspace.id,"ACCEPT")),title:"æŽ¥å—é‚€è«‹"},t[40]||(t[40]=[e("i",{class:"fa fa-check"},null,-1)])),e("button",{class:"btn btn-sm btn-danger",onClick:t[7]||(t[7]=O=>m(l.workspace.id,"REJECT")),title:"æ‹’çµ•é‚€è«‹"},t[41]||(t[41]=[e("i",{class:"fa fa-times"},null,-1)]))])]))),128))])])]))]),_:1})]),_:1})])):I("",!0),g.value==="removal-requests"?(i(),u("div",Bt,[w(z,null,{default:C(()=>[w(me,null,{default:C(()=>t[43]||(t[43]=[e("h6",{class:"mb-0"},[e("i",{class:"fa fa-times-circle me-2"}),v(" å…¬å¸ç§»é™¤è«‹æ±‚ ")],-1)])),_:1,__:[43]}),w(J,null,{default:C(()=>[A(d).pendingRemovalRequests.length===0?(i(),u("div",Ht,t[44]||(t[44]=[e("i",{class:"fa fa-times-circle fa-3x text-muted mb-3"},null,-1),e("h6",{class:"text-muted"},"æš«ç„¡ç§»é™¤è«‹æ±‚",-1)]))):(i(),u("div",zt,[e("table",Jt,[t[47]||(t[47]=e("thead",null,[e("tr",null,[e("th",null,"å…¬å¸åç¨±"),e("th",null,"ç§»é™¤åŽŸå› "),e("th",null,"è™•ç†æ–¹å¼"),e("th",null,"è«‹æ±‚äºº"),e("th",null,"è«‹æ±‚æ™‚é–“"),e("th",{class:"text-center"},"æ“ä½œ")])],-1)),e("tbody",null,[(i(!0),u(G,null,Y(A(d).pendingRemovalRequests,o=>(i(),u("tr",{key:o.id},[e("td",Yt,r(o.companyName),1),e("td",null,r(o.reason),1),e("td",null,[e("span",{class:M(["badge border px-2 pt-5px pb-5px rounded fs-12px",o.requestType==="MUTUAL_AGREEMENT"?"border-info text-info":"border-warning text-warning"])},r(o.requestType==="MUTUAL_AGREEMENT"?"é›™æ–¹å”è­°":"å®¢æœè™•ç†"),3)]),e("td",Ft,r(o.requestedBy),1),e("td",Kt,r(new Date(o.requestedAt).toLocaleDateString()),1),e("td",Qt,[e("button",{class:"btn btn-sm btn-success me-1",onClick:O=>b(o.id,"APPROVE"),title:"åŒæ„ç§»é™¤"},t[45]||(t[45]=[e("i",{class:"fa fa-check"},null,-1)]),8,Xt),e("button",{class:"btn btn-sm btn-danger",onClick:O=>b(o.id,"REJECT"),title:"æ‹’çµ•ç§»é™¤"},t[46]||(t[46]=[e("i",{class:"fa fa-times"},null,-1)]),8,Zt)])]))),128))])])]))]),_:1})]),_:1})])):I("",!0),w(re,{show:f.value,"onUpdate:show":t[12]||(t[12]=o=>f.value=o),title:"é‚€è«‹å…¬å¸åŠ å…¥å·¥ä½œç©ºé–“",size:"lg"},{default:C(()=>[e("form",{onSubmit:ve(ne,["prevent"])},[e("div",es,[t[49]||(t[49]=e("label",{class:"form-label"},[v("å…¬å¸ä»£ç¢¼ "),e("span",{class:"text-danger"},"*")],-1)),e("div",ts,[V(e("input",{"onUpdate:modelValue":t[8]||(t[8]=o=>x.value.companyCode=o),type:"text",class:M(["form-control",{"is-invalid":T.value}]),placeholder:"è«‹è¼¸å…¥å…¬å¸ä»£ç¢¼",onInput:t[9]||(t[9]=o=>{T.value="",_.value=null}),required:""},null,34),[[F,x.value.companyCode]]),e("button",{type:"button",class:"btn btn-outline-primary",onClick:X,disabled:U.value||!x.value.companyCode.trim()},[U.value?(i(),u("span",ns)):(i(),u("i",os)),t[48]||(t[48]=v(" æœç´¢ "))],8,ss)]),T.value?(i(),u("div",as,r(T.value),1)):I("",!0),t[50]||(t[50]=e("div",{class:"form-text"}," è«‹è¼¸å…¥è¦é‚€è«‹å…¬å¸åœ¨ç³»çµ±ä¸­çš„å”¯ä¸€ä»£ç¢¼ ",-1))]),_.value?(i(),u("div",ls,[t[51]||(t[51]=e("label",{class:"form-label"},"å…¬å¸ä¿¡æ¯",-1)),e("div",is,[e("div",rs,[e("div",ds,[e("div",us,[e("div",cs,r(_.value.companyName),1),e("div",ms," å…¬å¸ä»£ç¢¼ï¼š"+r(x.value.companyCode),1),e("div",ps," çµ±ä¸€ç·¨è™Ÿï¼š"+r(_.value.companyUnifiedNumber),1)]),e("div",null,[e("span",{class:M(["badge border px-2 pt-5px pb-5px rounded fs-12px",`border-${oe(_.value.companyType)} text-${oe(_.value.companyType)}`])},r(D(_.value.companyType)),3),_.value.contractorLevel?(i(),u("span",{key:0,class:M(["badge border px-2 pt-5px pb-5px rounded fs-12px ms-1",`border-${ae(_.value.contractorLevel)} text-${ae(_.value.contractorLevel)}`])},r(ye(_.value.contractorLevel)),3)):I("",!0)])])])])])):I("",!0),e("div",vs,[t[53]||(t[53]=e("label",{class:"form-label"},[v("å…¬å¸è§’è‰² "),e("span",{class:"text-danger"},"*")],-1)),V(e("select",{"onUpdate:modelValue":t[10]||(t[10]=o=>x.value.role=o),class:"form-select",required:""},[t[52]||(t[52]=e("option",{value:""},"è«‹é¸æ“‡è§’è‰²",-1)),(i(!0),u(G,null,Y(Q.value,o=>(i(),u("option",{key:o.value,value:o.value,disabled:o.disabled},[v(r(o.label)+" ",1),o.disabled?(i(),u("span",bs," (å·²æœ‰æ­¤è§’è‰²å…¬å¸)")):I("",!0)],8,fs))),128))],512),[[fe,x.value.role]]),t[54]||(t[54]=e("div",{class:"form-text"},[e("ul",{class:"mb-0 small text-muted"},[e("li",null,"ä¸»è¦æ‰¿åŒ…å•†ï¼šæ¯å€‹å·¥ä½œç©ºé–“åªèƒ½æœ‰ä¸€é–“"),e("li",null,"ç›£é€ å–®ä½ï¼šæ¯å€‹å·¥ä½œç©ºé–“åªèƒ½æœ‰ä¸€é–“"),e("li",null,"ç¬¬ä¸‰æ–¹å…¬å¸ï¼šå¯ä»¥é‚€è«‹å¤šé–“")])],-1))]),e("div",_s,[t[55]||(t[55]=e("label",{class:"form-label"},"é‚€è«‹è¨Šæ¯",-1)),V(e("textarea",{"onUpdate:modelValue":t[11]||(t[11]=o=>x.value.message=o),class:"form-control",rows:"3",placeholder:"è¼¸å…¥é‚€è«‹è¨Šæ¯ï¼ˆé¸å¡«ï¼‰"},null,512),[[F,x.value.message]])]),e("div",ys,[e("button",{type:"button",class:"btn btn-secondary",onClick:se}," å–æ¶ˆ "),e("button",{type:"submit",class:"btn btn-theme",disabled:!_.value||!x.value.role},t[56]||(t[56]=[e("i",{class:"fa fa-paper-plane me-1"},null,-1),v(" ç™¼é€é‚€è«‹ ")]),8,gs)])],32)]),_:1},8,["show"]),w(re,{show:P.value,"onUpdate:show":t[17]||(t[17]=o=>P.value=o),title:"è«‹æ±‚ç§»é™¤å…¬å¸",size:"lg"},{default:C(()=>{var o;return[e("form",{onSubmit:ve(s,["prevent"])},[e("div",xs,[t[57]||(t[57]=e("i",{class:"fa fa-exclamation-triangle me-2"},null,-1)),v(" æ‚¨æ­£åœ¨è«‹æ±‚ç§»é™¤å…¬å¸ã€Œ"+r((o=B.value)==null?void 0:o.companyName)+"ã€ ",1)]),e("div",ks,[t[58]||(t[58]=e("label",{class:"form-label"},[v("ç§»é™¤åŽŸå›  "),e("span",{class:"text-danger"},"*")],-1)),V(e("textarea",{"onUpdate:modelValue":t[13]||(t[13]=O=>$.value.reason=O),class:"form-control",rows:"3",placeholder:"è«‹è©³ç´°èªªæ˜Žç§»é™¤åŽŸå› ",required:""},null,512),[[F,$.value.reason]])]),e("div",hs,[t[61]||(t[61]=e("label",{class:"form-label"},[v("è™•ç†æ–¹å¼ "),e("span",{class:"text-danger"},"*")],-1)),e("div",Cs,[V(e("input",{id:"mutual-agreement","onUpdate:modelValue":t[14]||(t[14]=O=>$.value.requestType=O),class:"form-check-input",type:"radio",value:"MUTUAL_AGREEMENT"},null,512),[[he,$.value.requestType]]),t[59]||(t[59]=e("label",{class:"form-check-label",for:"mutual-agreement"},[v(" é›™æ–¹å”è­° "),e("div",{class:"form-text"},"éœ€è¦å°æ–¹å…¬å¸åŒæ„æ‰èƒ½å®Œæˆç§»é™¤")],-1))]),e("div",ws,[V(e("input",{id:"customer-service","onUpdate:modelValue":t[15]||(t[15]=O=>$.value.requestType=O),class:"form-check-input",type:"radio",value:"CUSTOMER_SERVICE"},null,512),[[he,$.value.requestType]]),t[60]||(t[60]=e("label",{class:"form-check-label",for:"customer-service"},[v(" å®¢æœè™•ç† "),e("div",{class:"form-text"},"ç”±å®¢æœåœ˜éšŠä»‹å…¥è™•ç†ç§»é™¤è«‹æ±‚")],-1))])]),$.value.requestType==="CUSTOMER_SERVICE"?(i(),u("div",Is,[t[62]||(t[62]=e("label",{class:"form-label"},"å®¢æœå‚™è¨»",-1)),V(e("textarea",{"onUpdate:modelValue":t[16]||(t[16]=O=>$.value.customerServiceNote=O),class:"form-control",rows:"2",placeholder:"æä¾›çµ¦å®¢æœçš„é¡å¤–èªªæ˜Ž"},null,512),[[F,$.value.customerServiceNote]])])):I("",!0),e("div",$s,[e("button",{type:"button",class:"btn btn-secondary",onClick:a}," å–æ¶ˆ "),e("button",{type:"submit",class:"btn btn-danger",disabled:!$.value.reason},t[63]||(t[63]=[e("i",{class:"fa fa-paper-plane me-1"},null,-1),v(" æäº¤ç§»é™¤è«‹æ±‚ ")]),8,Ts)])],32)]}),_:1},8,["show"])])}}}),Es=ue(Rs,[["__scopeId","data-v-638feb44"]]),Ns={class:"container-xxl"},Ms={class:"row justify-content-center"},Ss={class:"col-xl-12"},As={class:"d-flex align-items-center justify-content-between mb-4"},Ps=["disabled"],Us={key:0,class:"text-center py-4"},Ls={key:1,class:"text-center py-5"},js={key:2},Ws={key:3,class:"workspace-hierarchy"},Os={class:"workspace-list"},Vs={class:"workspace-header"},qs=["onClick"],Ds={class:"workspace-name"},Gs={class:"workspace-description text-muted mb-2"},Bs={class:"workspace-meta"},Hs={class:"badge border border-primary text-primary px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center me-2"},zs={class:"badge border border-success text-success px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center me-2"},Js={class:"badge border border-info text-info px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center me-2"},Ys={class:"badge border border-teal text-teal px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center"},Fs={key:0,class:"workspace-actions"},Ks=["onClick"],Qs=["onClick"],Xs=["onClick"],Zs={key:0,class:"project-list"},en={class:"project-list-header"},tn={class:"mb-2"},sn=["onClick"],nn={key:0,class:"text-center py-4"},on=["onClick"],an={key:1,class:"project-grid"},ln={class:"project-header"},rn={class:"project-name"},dn={key:0,class:"project-buttons"},un=["onClick"],cn=["onClick"],mn={class:"project-status mb-2"},pn={class:"project-info"},vn={class:"text-muted small mb-1"},fn={class:"text-muted small mb-1"},bn={class:"text-muted small mb-2"},_n={class:"progress mb-2",style:{height:"6px"}},yn={class:"text-muted small"},gn=de({__name:"WorkspaceManagement",setup(K){const E=_e(),k=h(new Set),j=h(!1),d=h(!1),N=h(!1),g=h(null),f=h(null),P=h(!1),x=h(null),_=R(()=>E.workspaces.map(a=>{const s=E.getProjectsByWorkspace(a.id),m=s.filter(D=>D.status==="IN_PROGRESS").length,b=s.filter(D=>D.status==="COMPLETED").length;return{...a,projects:s,projectCount:s.length,activeProjectCount:m,completedProjectCount:b}})),U=a=>{k.value.has(a)?k.value.delete(a):k.value.add(a)},T=a=>k.value.has(a),$=a=>a.role==="OWNER"||a.role==="ADMIN",S=a=>a.role!=="VIEWER",W=()=>{g.value=null,d.value=!0},B=(a,s)=>{s.stopPropagation(),console.log("ç·¨è¼¯å·¥ä½œç©ºé–“è¢«é»žæ“Š:",a),g.value={...a},d.value=!0,console.log("showWorkspaceModal.value:",d.value),console.log("editingWorkspace.value:",g.value)},n=()=>{d.value=!1,g.value=null},c=async a=>{console.log("ä¿å­˜å·¥ä½œç©ºé–“:",a);try{g.value?await E.updateWorkspace(g.value.id,a):await E.addWorkspace(a),n(),await X()}catch(s){console.error("ä¿å­˜å·¥ä½œç©ºé–“å¤±æ•—:",s),alert("ä¿å­˜å·¥ä½œç©ºé–“å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦")}},p=async(a,s)=>{if(s.stopPropagation(),window.confirm(`ç¢ºå®šè¦åˆªé™¤å·¥ä½œç©ºé–“ã€Œ${a.name}ã€å—Žï¼Ÿæ­¤æ“ä½œç„¡æ³•æ’¤éŠ·ã€‚`))try{await E.removeWorkspace(a.id),console.log("åˆªé™¤å·¥ä½œç©ºé–“æˆåŠŸ:",a.name),await X()}catch(b){console.error("åˆªé™¤å·¥ä½œç©ºé–“å¤±æ•—:",b),alert("åˆªé™¤å·¥ä½œç©ºé–“å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦")}},y=(a,s)=>{s.stopPropagation(),f.value={...a},N.value=!0},H=()=>{N.value=!1,f.value=null},Q=async a=>{console.log("ä¿å­˜é …ç›®:",a);try{f.value?E.updateProject(f.value.id,a):E.addProject(a),H(),await X()}catch(s){console.error("ä¿å­˜é …ç›®å¤±æ•—:",s),alert("ä¿å­˜é …ç›®å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦")}},q=async(a,s)=>{if(s.stopPropagation(),window.confirm(`ç¢ºå®šè¦åˆªé™¤é …ç›®ã€Œ${a.name}ã€å—Žï¼Ÿæ­¤æ“ä½œç„¡æ³•æ’¤éŠ·ã€‚`))try{E.removeProject(a.id),console.log("åˆªé™¤é …ç›®æˆåŠŸ:",a.name),await X()}catch(b){console.error("åˆªé™¤é …ç›®å¤±æ•—:",b),alert("åˆªé™¤é …ç›®å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦")}},te=(a,s)=>{s.stopPropagation(),console.log("æ–°å¢žé …ç›®åˆ°å·¥ä½œç©ºé–“:",a.name),f.value=null;const m={id:"",name:"",workspaceId:a.id,location:"",budget:"",status:"PLANNING",startDate:"",endDate:"",progress:0,managerName:"",description:""};f.value=m,N.value=!0},se=(a,s)=>{s.stopPropagation(),x.value=a,P.value=!0},Z=()=>{P.value=!1,x.value=null},X=async()=>{j.value=!0;try{await E.initWorkspaces()}catch(a){console.error("Failed to refresh data:",a)}finally{j.value=!1}},ne=a=>({PLANNING:"info",IN_PROGRESS:"success",COMPLETED:"primary",SUSPENDED:"warning"})[a]||"secondary",ce=a=>({PLANNING:"è¦åŠƒä¸­",IN_PROGRESS:"é€²è¡Œä¸­",COMPLETED:"å·²å®Œæˆ",SUSPENDED:"æš«åœ"})[a]||a;return R(()=>_.value.length),R(()=>_.value.filter(a=>a.role==="OWNER").length),R(()=>_.value.filter(a=>a.role==="ADMIN").length),R(()=>_.value.reduce((a,s)=>{var m;return a+(((m=s.projects)==null?void 0:m.length)||0)},0)),R(()=>_.value.reduce((a,s)=>{var m;return a+(((m=s.projects)==null?void 0:m.filter(b=>b.status==="IN_PROGRESS").length)||0)},0)),R(()=>_.value.reduce((a,s)=>{var m;return a+(((m=s.projects)==null?void 0:m.filter(b=>b.status==="COMPLETED").length)||0)},0)),be(async()=>{console.log("WorkspaceManagement mounted"),await E.initWorkspaces(),console.log("Workspaces after init:",E.workspaces)}),(a,s)=>(i(),u(G,null,[e("div",Ns,[e("div",Ms,[e("div",Ss,[e("div",As,[s[3]||(s[3]=e("div",null,[e("h1",{class:"page-header-title"},[e("i",{class:"fa fa-sitemap me-3"}),v(" å·¥ä½œç©ºé–“èˆ‡å·¥ç¨‹é …ç›®ç®¡ç† ")]),e("p",{class:"text-muted mb-0"},"ç®¡ç†æ‚¨çš„å·¥ä½œç©ºé–“ã€å·¥ç¨‹é …ç›®")],-1)),e("button",{class:"btn btn-theme",onClick:W,disabled:j.value},s[2]||(s[2]=[e("i",{class:"fa fa-plus me-2"},null,-1),v(" æ–°å¢žå·¥ä½œç©ºé–“ ")]),8,Ps)]),A(E).isLoading?(i(),u("div",Us,s[4]||(s[4]=[e("div",{class:"spinner-border text-theme",role:"status"},[e("span",{class:"visually-hidden"},"è¼‰å…¥ä¸­...")],-1),e("div",{class:"mt-2 text-muted"},"è¼‰å…¥å·¥ä½œç©ºé–“è³‡æ–™ä¸­...",-1)]))):_.value.length===0?(i(),u("div",Ls,[s[6]||(s[6]=e("div",{class:"mb-3"},[e("i",{class:"fa fa-building fa-3x text-muted"})],-1)),s[7]||(s[7]=e("h5",{class:"text-muted mb-2"},"å°šæœªå»ºç«‹ä»»ä½•å·¥ä½œç©ºé–“",-1)),s[8]||(s[8]=e("p",{class:"text-muted mb-3"},"é–‹å§‹å»ºç«‹æ‚¨çš„ç¬¬ä¸€å€‹å·¥ä½œç©ºé–“",-1)),e("button",{class:"btn btn-theme",onClick:W},s[5]||(s[5]=[e("i",{class:"fa fa-plus me-2"},null,-1),v(" æ–°å¢žå·¥ä½œç©ºé–“ ")]))])):I("",!0),P.value?(i(),u("div",js,[w(Es,{workspace:x.value,onBack:Z},null,8,["workspace"])])):!A(E).isLoading&&_.value.length>0?(i(),u("div",Ws,[e("div",Os,[(i(!0),u(G,null,Y(_.value,m=>(i(),ie(z,{key:m.id,class:M(["workspace-item",{expanded:T(m.id)}])},{default:C(()=>[w(J,null,{default:C(()=>[e("div",Vs,[e("div",{class:"workspace-info",onClick:b=>U(m.id)},[e("h5",Ds,[s[9]||(s[9]=e("i",{class:"fa fa-building me-2"},null,-1)),v(" "+r(m.name)+" ",1),e("i",{class:M(["fa fa-chevron-down ms-2 expand-icon",{rotated:T(m.id)}])},null,2)]),e("p",Gs,r(m.description),1),e("div",Bs,[e("span",Hs,[s[10]||(s[10]=e("i",{class:"fa fa-crown me-1"},null,-1)),v(" "+r(m.role),1)]),e("span",zs,[s[11]||(s[11]=e("i",{class:"fa fa-project-diagram me-1"},null,-1)),v(" "+r(m.projectCount)+" å€‹é …ç›® ",1)]),e("span",Js,[s[12]||(s[12]=e("i",{class:"fa fa-play me-1"},null,-1)),v(" "+r(m.activeProjectCount)+" é€²è¡Œä¸­ ",1)]),e("span",Ys,[s[13]||(s[13]=e("i",{class:"fa fa-check me-1"},null,-1)),v(" "+r(m.completedProjectCount)+" å·²å®Œæˆ ",1)])])],8,qs),$(m)?(i(),u("div",Fs,[e("button",{class:"btn btn-sm btn-outline-info me-1",onClick:b=>se(m,b),title:"ç®¡ç†å…¬å¸æˆå“¡ - é»žæ­¤é‚€è«‹å…¬å¸"},s[14]||(s[14]=[e("i",{class:"fa fa-building"},null,-1),e("span",{class:"d-none d-md-inline ms-1"},"å…¬å¸ç®¡ç†",-1)]),8,Ks),e("button",{class:"btn btn-sm btn-outline-primary me-1",onClick:b=>B(m,b),title:"ç·¨è¼¯å·¥ä½œç©ºé–“"},s[15]||(s[15]=[e("i",{class:"fa fa-edit"},null,-1)]),8,Qs),e("button",{class:"btn btn-sm btn-outline-danger",onClick:b=>p(m,b),title:"åˆªé™¤å·¥ä½œç©ºé–“"},s[16]||(s[16]=[e("i",{class:"fa fa-trash"},null,-1)]),8,Xs)])):I("",!0)])]),_:2},1024),T(m.id)?(i(),u("div",Zs,[e("div",en,[e("h6",tn,[s[17]||(s[17]=e("i",{class:"fa fa-project-diagram me-2"},null,-1)),v(" "+r(m.name)+" çš„å·¥ç¨‹é …ç›® ",1)]),S(m)?(i(),u("button",{key:0,class:"btn btn-sm btn-theme",onClick:b=>te(m,b)},s[18]||(s[18]=[e("i",{class:"fa fa-plus me-1"},null,-1),v(" æ–°å¢žé …ç›® ")]),8,sn)):I("",!0)]),m.projects.length===0?(i(),u("div",nn,[s[20]||(s[20]=e("i",{class:"fa fa-project-diagram fa-2x text-muted mb-2"},null,-1)),s[21]||(s[21]=e("p",{class:"text-muted"},"æ­¤å·¥ä½œç©ºé–“å°šæœªå»ºç«‹ä»»ä½•å·¥ç¨‹é …ç›®",-1)),S(m)?(i(),u("button",{key:0,class:"btn btn-theme btn-sm",onClick:b=>te(m,b)},s[19]||(s[19]=[e("i",{class:"fa fa-plus me-1"},null,-1),v(" å»ºç«‹ç¬¬ä¸€å€‹é …ç›® ")]),8,on)):I("",!0)])):(i(),u("div",an,[(i(!0),u(G,null,Y(m.projects,b=>(i(),ie(z,{key:b.id,class:"project-card"},{default:C(()=>[w(J,null,{default:C(()=>[e("div",ln,[e("h6",rn,r(b.name),1),S(m)?(i(),u("div",dn,[e("button",{class:"btn btn-sm btn-outline-theme me-1",onClick:D=>y(b,D),title:"ç·¨è¼¯é …ç›®"},s[22]||(s[22]=[e("i",{class:"fa fa-edit"},null,-1)]),8,un),e("button",{class:"btn btn-sm btn-outline-danger",onClick:D=>q(b,D),title:"åˆªé™¤é …ç›®"},s[23]||(s[23]=[e("i",{class:"fa fa-trash"},null,-1)]),8,cn)])):I("",!0)]),e("div",mn,[e("span",{class:M(["badge border px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center",`border-${ne(b.status)} text-${ne(b.status)}`])},r(ce(b.status)),3)]),e("div",pn,[e("div",vn,[s[24]||(s[24]=e("i",{class:"fa fa-map-marker-alt me-1"},null,-1)),v(" "+r(b.location),1)]),e("div",fn,[s[25]||(s[25]=e("i",{class:"fa fa-calendar me-1"},null,-1)),v(" "+r(b.startDate)+" - "+r(b.endDate),1)]),e("div",bn,[s[26]||(s[26]=e("i",{class:"fa fa-dollar-sign me-1"},null,-1)),v(" "+r(b.budget),1)]),e("div",_n,[e("div",{class:"progress-bar",style:Te({width:b.progress+"%"})},null,4)]),e("div",yn," é€²åº¦ï¼š"+r(b.progress)+"% ",1)])]),_:2},1024)]),_:2},1024))),128))]))])):I("",!0)]),_:2},1032,["class"]))),128))])])):I("",!0)])])]),w(Je,{show:d.value,"onUpdate:show":s[0]||(s[0]=m=>d.value=m),workspace:g.value,onHide:n,onSubmit:c},null,8,["show","workspace"]),w(Xe,{show:N.value,"onUpdate:show":s[1]||(s[1]=m=>N.value=m),project:f.value,onHide:H,onSubmit:Q},null,8,["show","project"])],64))}}),wn=ue(gn,[["__scopeId","data-v-b41ff861"]]);export{wn as default};
