import{d as le,r as $,C as L,D as ae,o as ne,f as o,g as r,n as g,h as a,M as J,i as v,J as D,p as b,F as R,k as _,t as i,N as re,z as C,H as I,I as M,G as N,j as Y,P as Z,_ as oe,c as ce,m as de}from"./index-D_u9nkte.js";import{u as ue}from"./project-Dnhvz_sQ.js";import{f as Q,d as se,h as K,a as me}from"./forms-CS0xek5A.js";const pe={class:"form-parameter-manager"},ve={class:"d-flex justify-content-between align-items-center"},ye={class:"mb-1"},be={class:"text-muted mb-0 small"},he={class:"text-end"},ge={class:"d-flex align-items-center"},_e={class:"progress me-2",style:{width:"80px",height:"8px"}},fe={class:"small fw-bold"},xe={class:"small text-muted"},ke={class:"form-sections"},we={class:"d-flex justify-content-between align-items-center"},qe={class:"d-flex align-items-center"},Ae={key:0,class:"badge border border-primary text-primary px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center me-2"},$e={class:"mb-1"},je={key:0,class:"text-muted small mb-0"},Pe={class:"d-flex align-items-center"},Fe={class:"me-3 text-end"},Ce={class:"small fw-bold"},De={class:"row"},Se={key:0,class:"form-group"},Ie=["for"],Me={key:0,class:"text-danger"},Ne=["id","value","onInput","placeholder","readonly"],Le={key:0,class:"invalid-feedback"},Ve={key:1,class:"form-text"},Ee={key:1,class:"form-group"},Oe=["for"],Te={key:0,class:"text-danger"},Re=["id","value","onInput","placeholder","readonly"],Ue={key:0,class:"invalid-feedback"},ze={key:1,class:"form-text"},Be={key:2,class:"form-group"},We=["for"],Xe={key:0,class:"text-danger"},He=["id","value","onInput","placeholder","readonly","min","max"],Ge={key:0,class:"invalid-feedback"},Je={key:1,class:"form-text"},Qe={key:3,class:"form-group"},Ke=["for"],Ye={key:0,class:"text-danger"},Ze=["id","value","onInput","readonly"],et={key:0,class:"invalid-feedback"},tt={key:1,class:"form-text"},at={key:4,class:"form-group"},st=["for"],lt={key:0,class:"text-danger"},nt=["id","value","onChange","disabled"],rt=["value"],ot={key:0,class:"invalid-feedback"},it={key:1,class:"form-text"},ct={key:5,class:"form-group"},dt={class:"form-label"},ut={key:0,class:"text-danger"},mt={class:"form-check-group"},pt=["id","value","checked","onChange","disabled"],vt=["for"],yt={key:0,class:"invalid-feedback d-block"},bt={key:1,class:"form-text"},ht={key:6,class:"form-group"},gt={class:"form-label"},_t={key:0,class:"text-danger"},ft={class:"form-check-group"},xt=["id","name","value","checked","onChange","disabled"],kt=["for"],wt={key:0,class:"invalid-feedback d-block"},qt={key:1,class:"form-text"},At={class:"text-danger mb-3"},$t={class:"list-unstyled mb-0"},jt=le({__name:"FormParameterManager",props:{formConfig:{},initialData:{default:()=>({})},readonly:{type:Boolean,default:!1},showSectionNumbers:{type:Boolean,default:!0}},emits:["update:modelValue","validate","section-toggle"],setup(p,{expose:w,emit:f}){const m=p,h=f,y=$({}),d=$({}),q=$(new Set),x=$(!1),P=L(()=>Object.keys(d.value).length===0),V=L(()=>m.formConfig.sections.reduce((l,s)=>l+s.fields.filter(e=>e.required).length,0)),O=L(()=>m.formConfig.sections.reduce((l,s)=>l+s.fields.filter(e=>{const n=y.value[e.name];return e.required&&n&&n!==""&&(!Array.isArray(n)||n.length>0)}).length,0)),j=L(()=>V.value===0?100:Math.round(O.value/V.value*100)),U=()=>{const l={...m.initialData};m.formConfig.sections.forEach(s=>{s.fields.forEach(e=>{var n;if(!(e.name in l))switch(e.type){case"checkbox":l[e.name]=e.defaultValue||[];break;case"number":l[e.name]=e.defaultValue||((n=e.validation)==null?void 0:n.min)||0;break;case"date":l[e.name]=e.defaultValue||"";break;default:l[e.name]=e.defaultValue||""}}),s.defaultExpanded!==!1&&q.value.add(s.id)}),y.value=l},z=(l,s)=>{if(l.required&&(!s||s===""||Array.isArray(s)&&s.length===0))return`${l.label}為必填項目`;if(s&&l.validation){const e=l.validation;if(typeof s=="string"){if(e.minLength&&s.length<e.minLength)return`${l.label}至少需要${e.minLength}個字符`;if(e.maxLength&&s.length>e.maxLength)return`${l.label}不能超過${e.maxLength}個字符`;if(e.pattern&&!new RegExp(e.pattern).test(s))return`${l.label}格式不正確`}if(typeof s=="number"){if(e.min!==void 0&&s<e.min)return`${l.label}不能小於${e.min}`;if(e.max!==void 0&&s>e.max)return`${l.label}不能大於${e.max}`}if(e.custom){const n=e.custom(s);if(n)return n}}return null},T=()=>{const l={};return m.formConfig.sections.forEach(s=>{s.fields.forEach(e=>{if(e.showWhen&&!e.showWhen(y.value))return;const n=z(e,y.value[e.name]);n&&(l[e.name]=n)})}),d.value=l,h("validate",l),Object.keys(l).length===0},F=(l,s)=>{y.value[l]=s,x.value=!0;const e=W().find(n=>n.name===l);if(e){const n=z(e,s);n?d.value[l]=n:delete d.value[l]}h("update:modelValue",{...y.value})},B=l=>{q.value.has(l)?q.value.delete(l):q.value.add(l),h("section-toggle",l,q.value.has(l))},W=()=>m.formConfig.sections.reduce((l,s)=>l.concat(s.fields),[]),A=l=>!l.showWhen||l.showWhen(y.value),H=l=>{const s=l.fields.filter(n=>n.required&&A(n));if(s.length===0)return 100;const e=s.filter(n=>{const t=y.value[n.name];return t&&t!==""&&(!Array.isArray(t)||t.length>0)});return Math.round(e.length/s.length*100)};return ae(()=>m.initialData,l=>{y.value={...y.value,...l}},{deep:!0}),ae(y,()=>{T()},{deep:!0}),ne(()=>{U(),T()}),w({validate:T,getFormData:()=>y.value,reset:U,setFieldValue:F,isDirty:()=>x.value,isValid:()=>P.value}),(l,s)=>(r(),o("div",pe,[g(D,{class:"mb-4"},{default:b(()=>[g(R,null,{default:b(()=>[a("div",ve,[a("div",null,[a("h5",ye,[s[0]||(s[0]=a("i",{class:"fa fa-file-alt me-2"},null,-1)),_(" "+i(l.formConfig.name)+" ("+i(l.formConfig.id)+") ",1)]),a("p",be,i(l.formConfig.description),1)]),a("div",he,[s[1]||(s[1]=a("div",{class:"small text-muted mb-1"},"完成度",-1)),a("div",ge,[a("div",_e,[a("div",{class:C(["progress-bar",{"bg-danger":j.value<30,"bg-warning":j.value>=30&&j.value<70,"bg-success":j.value>=70}]),style:re({width:j.value+"%"})},null,6)]),a("span",fe,i(j.value)+"%",1)]),a("div",xe,i(O.value)+"/"+i(V.value)+" 必填項目 ",1)])])]),_:1})]),_:1}),a("div",ke,[(r(!0),o(I,null,M(l.formConfig.sections,(e,n)=>(r(),J(D,{key:e.id,class:"mb-3"},{default:b(()=>[e.collapsible!==!1?(r(),J(R,{key:0,class:"cursor-pointer",onClick:t=>B(e.id)},{default:b(()=>[a("div",we,[a("div",qe,[l.showSectionNumbers?(r(),o("span",Ae,i(n+1),1)):v("",!0),a("div",null,[a("h6",$e,i(e.title),1),e.description?(r(),o("p",je,i(e.description),1)):v("",!0)])]),a("div",Pe,[a("div",Fe,[s[2]||(s[2]=a("div",{class:"small text-muted"},"進度",-1)),a("div",Ce,i(H(e))+"%",1)]),a("i",{class:C(["fa",{"fa-chevron-up":q.value.has(e.id),"fa-chevron-down":!q.value.has(e.id)}])},null,2)])])]),_:2},1032,["onClick"])):v("",!0),Y(g(N,null,{default:b(()=>[a("div",De,[(r(!0),o(I,null,M(e.fields,t=>{var k,S;return r(),o("div",{key:t.id,class:C([{"col-12":t.type==="textarea","col-lg-6":t.type!=="textarea","d-none":!A(t)},"mb-3"])},[t.type==="text"?(r(),o("div",Se,[a("label",{for:t.id,class:"form-label"},[_(i(t.label)+" ",1),t.required?(r(),o("span",Me,"*")):v("",!0)],8,Ie),a("input",{id:t.id,type:"text",class:C(["form-control",{"is-invalid":d.value[t.name]}]),value:y.value[t.name],onInput:u=>F(t.name,u.target.value),placeholder:t.placeholder,readonly:l.readonly},null,42,Ne),d.value[t.name]?(r(),o("div",Le,i(d.value[t.name]),1)):v("",!0),t.description?(r(),o("div",Ve,i(t.description),1)):v("",!0)])):t.type==="textarea"?(r(),o("div",Ee,[a("label",{for:t.id,class:"form-label"},[_(i(t.label)+" ",1),t.required?(r(),o("span",Te,"*")):v("",!0)],8,Oe),a("textarea",{id:t.id,class:C(["form-control",{"is-invalid":d.value[t.name]}]),value:y.value[t.name],onInput:u=>F(t.name,u.target.value),placeholder:t.placeholder,readonly:l.readonly,rows:"4"},null,42,Re),d.value[t.name]?(r(),o("div",Ue,i(d.value[t.name]),1)):v("",!0),t.description?(r(),o("div",ze,i(t.description),1)):v("",!0)])):t.type==="number"?(r(),o("div",Be,[a("label",{for:t.id,class:"form-label"},[_(i(t.label)+" ",1),t.required?(r(),o("span",Xe,"*")):v("",!0)],8,We),a("input",{id:t.id,type:"number",class:C(["form-control",{"is-invalid":d.value[t.name]}]),value:y.value[t.name],onInput:u=>F(t.name,parseInt(u.target.value)||0),placeholder:t.placeholder,readonly:l.readonly,min:(k=t.validation)==null?void 0:k.min,max:(S=t.validation)==null?void 0:S.max},null,42,He),d.value[t.name]?(r(),o("div",Ge,i(d.value[t.name]),1)):v("",!0),t.description?(r(),o("div",Je,i(t.description),1)):v("",!0)])):t.type==="date"?(r(),o("div",Qe,[a("label",{for:t.id,class:"form-label"},[_(i(t.label)+" ",1),t.required?(r(),o("span",Ye,"*")):v("",!0)],8,Ke),a("input",{id:t.id,type:"date",class:C(["form-control",{"is-invalid":d.value[t.name]}]),value:y.value[t.name],onInput:u=>F(t.name,u.target.value),readonly:l.readonly},null,42,Ze),d.value[t.name]?(r(),o("div",et,i(d.value[t.name]),1)):v("",!0),t.description?(r(),o("div",tt,i(t.description),1)):v("",!0)])):t.type==="select"?(r(),o("div",at,[a("label",{for:t.id,class:"form-label"},[_(i(t.label)+" ",1),t.required?(r(),o("span",lt,"*")):v("",!0)],8,st),a("select",{id:t.id,class:C(["form-select",{"is-invalid":d.value[t.name]}]),value:y.value[t.name],onChange:u=>F(t.name,u.target.value),disabled:l.readonly},[s[3]||(s[3]=a("option",{value:""},"請選擇...",-1)),(r(!0),o(I,null,M(t.options,u=>(r(),o("option",{key:u.value,value:u.value},i(u.label),9,rt))),128))],42,nt),d.value[t.name]?(r(),o("div",ot,i(d.value[t.name]),1)):v("",!0),t.description?(r(),o("div",it,i(t.description),1)):v("",!0)])):t.type==="checkbox"?(r(),o("div",ct,[a("label",dt,[_(i(t.label)+" ",1),t.required?(r(),o("span",ut,"*")):v("",!0)]),a("div",mt,[(r(!0),o(I,null,M(t.options,u=>(r(),o("div",{key:u.value,class:"form-check"},[a("input",{id:`${t.id}_${u.value}`,type:"checkbox",class:"form-check-input",value:u.value,checked:(y.value[t.name]||[]).includes(u.value),onChange:X=>{const te=X.target.checked,E=y.value[t.name]||[];let G;te?G=[...E,u.value]:G=E.filter(ie=>ie!==u.value),F(t.name,G)},disabled:l.readonly},null,40,pt),a("label",{for:`${t.id}_${u.value}`,class:"form-check-label"},i(u.label),9,vt)]))),128))]),d.value[t.name]?(r(),o("div",yt,i(d.value[t.name]),1)):v("",!0),t.description?(r(),o("div",bt,i(t.description),1)):v("",!0)])):t.type==="radio"?(r(),o("div",ht,[a("label",gt,[_(i(t.label)+" ",1),t.required?(r(),o("span",_t,"*")):v("",!0)]),a("div",ft,[(r(!0),o(I,null,M(t.options,u=>(r(),o("div",{key:u.value,class:"form-check"},[a("input",{id:`${t.id}_${u.value}`,type:"radio",class:"form-check-input",name:t.name,value:u.value,checked:y.value[t.name]===u.value,onChange:X=>F(t.name,u.value),disabled:l.readonly},null,40,xt),a("label",{for:`${t.id}_${u.value}`,class:"form-check-label"},i(u.label),9,kt)]))),128))]),d.value[t.name]?(r(),o("div",wt,i(d.value[t.name]),1)):v("",!0),t.description?(r(),o("div",qt,i(t.description),1)):v("",!0)])):v("",!0)],2)}),128))])]),_:2},1536),[[Z,q.value.has(e.id)]])]),_:2},1024))),128))]),!P.value&&Object.keys(d.value).length>0?(r(),J(D,{key:0,class:"border-danger"},{default:b(()=>[g(N,null,{default:b(()=>[a("h6",At,[s[4]||(s[4]=a("i",{class:"fa fa-exclamation-triangle me-2"},null,-1)),_(" 發現 "+i(Object.keys(d.value).length)+" 個驗證錯誤 ",1)]),a("ul",$t,[(r(!0),o(I,null,M(d.value,(e,n)=>(r(),o("li",{key:n,class:"text-danger small mb-1"},[s[5]||(s[5]=a("i",{class:"fa fa-times me-1"},null,-1)),_(" "+i(e),1)]))),128))])]),_:1})]),_:1})):v("",!0)]))}}),Pt=oe(jt,[["__scopeId","data-v-517ed247"]]),c={projectName:{id:"projectName",name:"projectName",label:"工程名稱",type:"text",required:!0,placeholder:"請輸入工程名稱",validation:{minLength:2,maxLength:100},category:"基本資訊"},constructionId:{id:"constructionId",name:"constructionId",label:"工程編號",type:"text",required:!0,placeholder:"請輸入工程編號",category:"工程資訊"},title:{id:"title",name:"title",label:"表單標題",type:"text",required:!0,placeholder:"請輸入表單標題",category:"工程資訊"},supervisoryName:{id:"supervisoryName",name:"supervisoryName",label:"監工姓名",type:"text",required:!1,placeholder:"請輸入監工姓名",category:"監工資訊"},supervisoryFactory:{id:"supervisoryFactory",name:"supervisoryFactory",label:"監工地址",type:"text",required:!1,placeholder:"請輸入監工地址",category:"監工資訊"},contractDate:{id:"contractDate",name:"contractDate",label:"簽約日期",type:"date",required:!1,category:"時程資訊"},workedDay:{id:"workedDay",name:"workedDay",label:"工作天數",type:"number",required:!1,placeholder:"請輸入工作天數",validation:{min:1,max:3650},category:"時程資訊"},disbursementAdvancePayment:{id:"disbursementAdvancePayment",name:"disbursementAdvancePayment",label:"預付款金額",type:"number",required:!1,placeholder:"請輸入預付款金額",validation:{min:0},category:"財務資訊"},estimateAmount:{id:"estimateAmount",name:"estimateAmount",label:"預估金額",type:"number",required:!1,placeholder:"請輸入預估金額",validation:{min:0},category:"財務資訊"},adjustPriceIndex:{id:"adjustPriceIndex",name:"adjustPriceIndex",label:"物價調整指數",type:"number",required:!1,placeholder:"請輸入物價調整指數",validation:{min:0,max:200},category:"財務資訊"},deductAmount:{id:"deductAmount",name:"deductAmount",label:"扣款金額",type:"number",required:!1,placeholder:"請輸入扣款金額",validation:{min:0},category:"財務資訊"},retention:{id:"retention",name:"retention",label:"保留款",type:"number",required:!1,placeholder:"請輸入保留款",validation:{min:0},category:"財務資訊"},deductionAdvancePayment:{id:"deductionAdvancePayment",name:"deductionAdvancePayment",label:"預付款扣款",type:"number",required:!1,placeholder:"請輸入預付款扣款",validation:{min:0},category:"財務資訊"},comment:{id:"comment",name:"comment",label:"備註",type:"textarea",required:!1,placeholder:"請輸入備註",category:"其他資訊"},deductedColumnReason:{id:"deductedColumnReason",name:"deductedColumnReason",label:"扣款原因",type:"textarea",required:!1,placeholder:"請輸入扣款原因",category:"其他資訊"},explainActualAmount:{id:"explainActualAmount",name:"explainActualAmount",label:"實際金額說明",type:"textarea",required:!1,placeholder:"請輸入實際金額說明",category:"其他資訊"},projectLocation:{id:"projectLocation",name:"projectLocation",label:"工程地點",type:"text",required:!0,placeholder:"請輸入工程地點",validation:{minLength:5,maxLength:200},category:"基本資訊"},projectOwner:{id:"projectOwner",name:"projectOwner",label:"業主單位",type:"text",required:!0,placeholder:"請輸入業主單位名稱",category:"基本資訊"},contractorName:{id:"contractorName",name:"contractorName",label:"承包商名稱",type:"text",required:!0,placeholder:"請輸入承包商名稱",category:"基本資訊"},projectManager:{id:"projectManager",name:"projectManager",label:"工程主辦",type:"text",required:!0,placeholder:"請輸入工程主辦姓名",category:"基本資訊"},supervisorUnit:{id:"supervisorUnit",name:"supervisorUnit",label:"監造單位",type:"text",required:!0,placeholder:"請輸入監造單位名稱",category:"基本資訊"},startDate:{id:"startDate",name:"startDate",label:"開工日期",type:"date",required:!0,category:"時程"},endDate:{id:"endDate",name:"endDate",label:"預定完工日期",type:"date",required:!0,category:"時程"},constructionPeriod:{id:"constructionPeriod",name:"constructionPeriod",label:"施工期間（天）",type:"number",required:!0,validation:{min:1,max:3650},category:"時程"},contractAmount:{id:"contractAmount",name:"contractAmount",label:"契約金額",type:"number",required:!0,placeholder:"請輸入契約金額（元）",validation:{min:0},category:"預算"},projectType:{id:"projectType",name:"projectType",label:"工程類別",type:"select",required:!0,options:[{value:"building",label:"建築工程"},{value:"civil",label:"土木工程"},{value:"mechanical",label:"機械工程"},{value:"electrical",label:"電機工程"},{value:"environmental",label:"環境工程"},{value:"other",label:"其他"}],category:"基本資訊"},projectScale:{id:"projectScale",name:"projectScale",label:"工程規模",type:"select",required:!0,options:[{value:"small",label:"小型工程（<1千萬）"},{value:"medium",label:"中型工程（1千萬-1億）"},{value:"large",label:"大型工程（1億-10億）"},{value:"mega",label:"巨型工程（>10億）"}],category:"基本資訊"},contactPerson:{id:"contactPerson",name:"contactPerson",label:"聯絡人",type:"text",required:!0,placeholder:"請輸入聯絡人姓名",category:"聯絡資訊"},contactPhone:{id:"contactPhone",name:"contactPhone",label:"聯絡電話",type:"text",required:!0,placeholder:"請輸入聯絡電話",validation:{pattern:"^[0-9\\-\\+\\(\\)\\s]+$"},category:"聯絡資訊"},contactEmail:{id:"contactEmail",name:"contactEmail",label:"電子郵件",type:"text",required:!1,placeholder:"請輸入電子郵件",validation:{pattern:"^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$"},category:"聯絡資訊"},qualityStandard:{id:"qualityStandard",name:"qualityStandard",label:"品質標準",type:"select",required:!0,options:[{value:"cns",label:"CNS國家標準"},{value:"astm",label:"ASTM美國標準"},{value:"jis",label:"JIS日本標準"},{value:"iso",label:"ISO國際標準"},{value:"custom",label:"客製化標準"}],category:"品質管制"},inspectionMethod:{id:"inspectionMethod",name:"inspectionMethod",label:"檢驗方式",type:"checkbox",required:!0,options:[{value:"visual",label:"目視檢查"},{value:"measurement",label:"尺寸測量"},{value:"material_test",label:"材料試驗"},{value:"ndt",label:"非破壞檢測"},{value:"load_test",label:"載重試驗"}],category:"品質管制"},safetyLevel:{id:"safetyLevel",name:"safetyLevel",label:"安全等級",type:"select",required:!0,options:[{value:"general",label:"一般等級"},{value:"high",label:"高風險等級"},{value:"special",label:"特殊等級"}],category:"安全衛生"}},ee={id:"A-5",name:"施工計畫書",version:"2.1",description:"工程施工計畫書是確保工程順利進行的重要文件",submitUrl:"/management/construction/a5/update",downloadUrl:"/management/construction/export/report/AFive",sections:[{id:"project_info",title:"工程資訊",description:"請填寫工程的基本資訊",defaultExpanded:!0,fields:[c.constructionId,c.title,c.projectName,c.projectLocation,c.projectOwner,c.contractorName,c.projectManager,c.supervisorUnit,c.projectType,c.projectScale]},{id:"supervisory_info",title:"監工資訊",description:"請填寫監工相關資訊",fields:[c.supervisoryName,c.supervisoryFactory]},{id:"schedule",title:"施工時程",description:"請填寫施工相關時程資訊",fields:[c.contractDate,c.startDate,c.endDate,c.constructionPeriod,c.workedDay,{id:"milestones",name:"milestones",label:"重要里程碑",type:"textarea",required:!0,placeholder:"請列出重要的施工里程碑",validation:{minLength:10,maxLength:1e3},category:"時程"}]},{id:"construction_method",title:"施工方法",description:"請詳細說明施工方法與程序",fields:[{id:"constructionSequence",name:"constructionSequence",label:"施工順序",type:"textarea",required:!0,placeholder:"請詳述施工順序與步驟",validation:{minLength:50,maxLength:2e3},category:"施工方法"},{id:"equipment",name:"equipment",label:"主要施工設備",type:"textarea",required:!0,placeholder:"請列出主要施工設備清單",category:"施工方法"},{id:"workforce",name:"workforce",label:"人力配置",type:"number",required:!0,placeholder:"預估所需人力數量",validation:{min:1,max:1e3},category:"施工方法"}]},{id:"safety",title:"安全衛生計畫",description:"請填寫安全衛生相關措施",fields:[c.safetyLevel,{id:"safetyMeasures",name:"safetyMeasures",label:"安全防護措施",type:"textarea",required:!0,placeholder:"請詳述安全防護措施",category:"安全衛生"},{id:"emergencyPlan",name:"emergencyPlan",label:"緊急應變計畫",type:"textarea",required:!0,placeholder:"請說明緊急應變處理程序",category:"安全衛生"}]},{id:"budget",title:"預算規劃",description:"請填寫預算相關資訊",fields:[c.contractAmount,c.disbursementAdvancePayment,c.estimateAmount,c.adjustPriceIndex,c.deductAmount,c.retention,c.deductionAdvancePayment,{id:"costBreakdown",name:"costBreakdown",label:"成本分析",type:"textarea",required:!0,placeholder:"請說明主要成本項目分析",category:"預算"}]},{id:"other_info",title:"其他資訊",description:"請填寫其他相關資訊",fields:[c.comment,c.deductedColumnReason,c.explainActualAmount]},{id:"contact",title:"聯絡資訊",description:"請填寫相關聯絡資訊",collapsible:!0,fields:[c.contactPerson,c.contactPhone,c.contactEmail]}]},Ft={id:"A-7",name:"品質管制計畫",version:"3.0",description:"品質管制計畫是確保工程品質符合規範要求的重要文件",submitUrl:"/management/construction/a7/update",downloadUrl:"/management/construction/export/report/ASeven",sections:[{id:"basic_info",title:"工程基本資訊",description:"請填寫工程的基本資訊",defaultExpanded:!0,fields:[c.projectName,c.projectLocation,c.projectOwner,c.contractorName,c.supervisorUnit,c.projectType]},{id:"quality_policy",title:"品質政策與目標",description:"請定義品質政策與目標",fields:[{id:"qualityPolicy",name:"qualityPolicy",label:"品質政策",type:"textarea",required:!0,placeholder:"請說明公司的品質政策",validation:{minLength:20,maxLength:500},category:"品質政策"},{id:"qualityObjectives",name:"qualityObjectives",label:"品質目標",type:"textarea",required:!0,placeholder:"請列出具體的品質目標",category:"品質政策"}]},{id:"quality_organization",title:"品質管制組織",description:"請說明品質管制組織架構",fields:[{id:"qualityManager",name:"qualityManager",label:"品質管理負責人",type:"text",required:!0,placeholder:"請輸入品質管理負責人姓名",category:"組織架構"},{id:"qualityTeam",name:"qualityTeam",label:"品質管制團隊",type:"textarea",required:!0,placeholder:"請說明品質管制團隊組成",category:"組織架構"},{id:"responsibilities",name:"responsibilities",label:"職責分工",type:"textarea",required:!0,placeholder:"請說明各職位的品質管制職責",category:"組織架構"}]},{id:"quality_standards",title:"品質標準與規範",description:"請說明適用的品質標準",fields:[c.qualityStandard,{id:"specifications",name:"specifications",label:"技術規範",type:"textarea",required:!0,placeholder:"請列出適用的技術規範",category:"品質標準"},{id:"acceptanceCriteria",name:"acceptanceCriteria",label:"驗收標準",type:"textarea",required:!0,placeholder:"請說明各項工程的驗收標準",category:"品質標準"}]},{id:"inspection_plan",title:"檢驗測試計畫",description:"請說明檢驗測試相關計畫",fields:[c.inspectionMethod,{id:"inspectionSchedule",name:"inspectionSchedule",label:"檢驗時程",type:"textarea",required:!0,placeholder:"請說明各階段檢驗時程安排",category:"檢驗計畫"},{id:"testingProcedures",name:"testingProcedures",label:"測試程序",type:"textarea",required:!0,placeholder:"請詳述測試程序與方法",category:"檢驗計畫"}]},{id:"material_control",title:"材料品質管制",description:"請說明材料品質管制措施",fields:[{id:"materialSpecs",name:"materialSpecs",label:"材料規格要求",type:"textarea",required:!0,placeholder:"請說明主要材料的規格要求",category:"材料管制"},{id:"supplierQualification",name:"supplierQualification",label:"供應商資格",type:"textarea",required:!0,placeholder:"請說明供應商資格要求與評估標準",category:"材料管制"},{id:"receivingInspection",name:"receivingInspection",label:"進料檢驗",type:"textarea",required:!0,placeholder:"請說明進料檢驗程序",category:"材料管制"}]},{id:"improvement",title:"持續改善計畫",description:"請說明持續改善相關措施",fields:[{id:"corrective_action",name:"corrective_action",label:"矯正措施",type:"textarea",required:!0,placeholder:"請說明發現問題時的矯正措施程序",category:"持續改善"},{id:"preventive_action",name:"preventive_action",label:"預防措施",type:"textarea",required:!0,placeholder:"請說明預防品質問題的措施",category:"持續改善"}]},{id:"contact",title:"聯絡資訊",description:"請填寫相關聯絡資訊",collapsible:!0,fields:[c.contactPerson,c.contactPhone,c.contactEmail]}]},Ct=p=>({"A-5":ee,"A-7":Ft})[p]||null,Dt=p=>{const w=Ct(p);return w?w.sections.reduce((f,m)=>f.concat(m.fields),[]):[]},St=p=>{const w=Dt(p),f={};return w.forEach(m=>{var h;if(m.defaultValue!==void 0)f[m.name]=m.defaultValue;else switch(m.type){case"checkbox":f[m.name]=[];break;case"number":f[m.name]=((h=m.validation)==null?void 0:h.min)||0;break;default:f[m.name]=""}}),f},It={constructionId:"CTq3CMSVeDUuBYCEM2KRkjl40DSjTnPf",title:"afive file",supervisoryName:"王小明",supervisoryFactory:"台北市信義區XX路XX號",contractDate:"2024-06-15T09:00:00",startDate:"2024-07-01T08:30:00",finishDate:"2025-12-31T17:00:00",workedDay:"45",disbursementAdvancePayment:"1500000",estimateAmount:"3000000",adjustPriceIndex:"102",deductAmount:"50000",retention:"100000",deductionAdvancePayment:"200000",comment:"this is test file 4",deductedColumnReason:"just want to right lol",explainActualAmount:"eight iiiilll"},Mt=(p,w)=>({constructionId:w||p.constructionId||"",title:p.title||"A-5 施工計畫書",supervisoryName:p.supervisoryName||"",supervisoryFactory:p.supervisoryFactory||"",contractDate:p.contractDate||"",startDate:p.startDate||"",finishDate:p.endDate||p.finishDate||"",workedDay:p.workedDay||p.constructionPeriod||"",disbursementAdvancePayment:p.disbursementAdvancePayment||"",estimateAmount:p.estimateAmount||"",adjustPriceIndex:p.adjustPriceIndex||"",deductAmount:p.deductAmount||"",retention:p.retention||"",deductionAdvancePayment:p.deductionAdvancePayment||"",comment:p.comment||"",deductedColumnReason:p.deductedColumnReason||"",explainActualAmount:p.explainActualAmount||""}),Nt={class:"container-xxl"},Lt={class:"row justify-content-center"},Vt={class:"col-xl-12"},Et={class:"row"},Ot={class:"col-lg-4 mb-4"},Tt={class:"row text-center mb-3"},Rt={class:"col-6"},Ut={class:"border rounded p-2"},zt={class:"fw-bold"},Bt={class:"col-6"},Wt={class:"border rounded p-2"},Xt={class:"fw-bold"},Ht={class:"row text-center"},Gt={class:"col-6"},Jt={class:"border rounded p-2"},Qt={class:"fw-bold"},Kt={class:"col-6"},Yt={class:"border rounded p-2"},Zt={class:"fw-bold text-danger"},ea={class:"d-grid gap-2"},ta=["disabled"],aa={key:0,class:"text-center py-3"},sa={key:1},la={class:"d-flex justify-content-between align-items-start mb-1"},na={class:"flex-grow-1"},ra={class:"small fw-bold"},oa={class:"d-flex align-items-center mt-1"},ia={class:"text-muted"},ca={class:"text-muted small"},da={class:"col-lg-8"},ua={class:"d-flex justify-content-between align-items-center"},ma={class:"text-muted"},pa={key:0},va={key:1,class:"text-danger"},ya={class:"btn-group"},ba=["disabled"],ha=["disabled"],ga=["disabled"],_a={key:0,class:"mt-3"},fa={class:"d-flex justify-content-between align-items-center mb-2"},xa={class:"small"},ka={class:"progress"},wa=le({__name:"FormA5WithParams",setup(p){const w=ue(),f=$(!1),m=$(!1),h=$(0),y=$(!1),d=$({}),q=$({}),x=$(null),P=$([]),V=L(()=>!m.value),O=L(()=>{var s;return!m.value&&((s=x.value)==null?void 0:s.isValid())}),j=L(()=>{const s=ee,e=s.sections.reduce((t,k)=>t+k.fields.length,0),n=s.sections.reduce((t,k)=>t+k.fields.filter(S=>S.required).length,0);return{totalSections:s.sections.length,totalFields:e,requiredFields:n,version:s.version}}),U=async()=>{if(!V.value)return;m.value=!0,h.value=0;let s=null;try{s=setInterval(()=>{h.value<90&&(h.value+=Math.random()*15)},200);const e=await Q.downloadReport();h.value=100,s&&(clearInterval(s),s=null);const k=`A-5_施工計畫書_空白表單_${new Date().toISOString().split("T")[0]}.docx`;se(e,k),B(k,e.size,!1),A("下載成功",`${k} 已開始下載`,"success")}catch(e){console.error("下載失敗:",e);const n=K(e);A("下載失敗",n,"error")}finally{s&&clearInterval(s),m.value=!1,h.value=0}},z=async()=>{var n;if(!O.value||!x.value)return;if(!x.value.validate()){A("驗證失敗","請先填寫所有必填欄位","warning");return}m.value=!0,h.value=0;let e=null;try{e=setInterval(()=>{h.value<90&&(h.value+=Math.random()*10)},250);const t=x.value.getFormData(),k=Mt(t,(n=w.currentProject)==null?void 0:n.constructionId),S=await Q.downloadReport(k);h.value=100,e&&(clearInterval(e),e=null);const X=new Date().toISOString().split("T")[0],E=`A-5_施工計畫書_${t.projectName||k.title||"未命名工程"}_${X}.docx`;se(S,E),B(E,S.size,!0),A("下載成功",`${E} 已開始下載`,"success")}catch(t){console.error("下載失敗:",t);const k=K(t);A("下載失敗",k,"error")}finally{e&&clearInterval(e),m.value=!1,h.value=0}},T=async()=>{var e;if(!x.value)return;if(!x.value.validate()){A("驗證失敗","請先填寫所有必填欄位","warning");return}f.value=!0;try{const t={formData:x.value.getFormData(),projectId:(e=w.currentProject)==null?void 0:e.constructionId,workspaceId:void 0};await Q.updateForm(t),A("儲存成功","表單資料已成功儲存","success"),x.value&&(x.value.isDirty=()=>!1)}catch(n){const t=K(n);A("儲存失敗",t,"error")}finally{f.value=!1}},F=()=>{if(!x.value)return;const s={...d.value,...It};Object.keys(s).forEach(e=>{var n;s[e]!==void 0&&((n=x.value)==null||n.setFieldValue(e,s[e]))}),A("範例資料已載入","已載入測試用的範例資料","success")},B=(s,e,n)=>{const t={id:P.value.length+1,fileName:s,downloadTime:new Date().toLocaleString("zh-TW"),fileSize:me(e),hasParameters:n};P.value.unshift(t),P.value.length>10&&(P.value=P.value.slice(0,10))},W=()=>{y.value=!y.value},A=(s,e,n="success")=>{console.log(`${n}: ${s} - ${e}`)},H=s=>{d.value=s},l=s=>{q.value=s};return ne(()=>{var s;d.value={...St("A-5"),constructionId:((s=w.currentProject)==null?void 0:s.constructionId)||"",title:"A-5 施工計畫書",supervisoryName:"",supervisoryFactory:"",contractDate:"",startDate:"",endDate:"",workedDay:"",disbursementAdvancePayment:"",estimateAmount:"",adjustPriceIndex:"",deductAmount:"",retention:"",deductionAdvancePayment:"",comment:"",deductedColumnReason:"",explainActualAmount:""}}),(s,e)=>(r(),o("div",Nt,[a("div",Lt,[a("div",Vt,[e[19]||(e[19]=ce('<div class="d-flex align-items-center mb-3" data-v-0eb91155><div data-v-0eb91155><ol class="breadcrumb" data-v-0eb91155><li class="breadcrumb-item" data-v-0eb91155><a href="javascript:;" data-v-0eb91155>表單生成與管理</a></li><li class="breadcrumb-item" data-v-0eb91155><a href="javascript:;" data-v-0eb91155>A類表單</a></li><li class="breadcrumb-item active" data-v-0eb91155>A-5 施工計畫書（含參數）</li></ol><h1 class="page-header mb-0" data-v-0eb91155><i class="fa fa-file-alt me-3" data-v-0eb91155></i> A-5 施工計畫書 <span class="badge border border-success text-success px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center ms-2" data-v-0eb91155> 參數化表單 </span><span class="badge border border-primary text-primary px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center ms-2" data-v-0eb91155> 台北市政府建管處版本 </span></h1></div></div>',1)),a("div",Et,[a("div",Ot,[g(D,{class:"mb-4"},{default:b(()=>[g(R,null,{default:b(()=>e[0]||(e[0]=[a("div",{class:"d-flex align-items-center"},[a("i",{class:"fa fa-info-circle me-2"}),a("h5",{class:"mb-0"},"表單資訊")],-1)])),_:1,__:[0]}),g(N,null,{default:b(()=>[a("div",Tt,[a("div",Rt,[a("div",Ut,[e[1]||(e[1]=a("div",{class:"text-muted small"},"版本",-1)),a("div",zt,i(j.value.version),1)])]),a("div",Bt,[a("div",Wt,[e[2]||(e[2]=a("div",{class:"text-muted small"},"區段數",-1)),a("div",Xt,i(j.value.totalSections),1)])])]),a("div",Ht,[a("div",Gt,[a("div",Jt,[e[3]||(e[3]=a("div",{class:"text-muted small"},"總欄位",-1)),a("div",Qt,i(j.value.totalFields),1)])]),a("div",Kt,[a("div",Yt,[e[4]||(e[4]=a("div",{class:"text-muted small"},"必填欄位",-1)),a("div",Zt,i(j.value.requiredFields),1)])])])]),_:1})]),_:1}),g(D,{class:"mb-4"},{default:b(()=>[g(R,null,{default:b(()=>e[5]||(e[5]=[a("div",{class:"d-flex align-items-center"},[a("i",{class:"fa fa-download me-2"}),a("h5",{class:"mb-0"},"快速下載")],-1)])),_:1,__:[5]}),g(N,null,{default:b(()=>[a("div",ea,[a("button",{class:"btn btn-outline-theme",onClick:U,disabled:!V.value},e[6]||(e[6]=[a("i",{class:"fa fa-file me-2"},null,-1),_(" 下載空白表單 "),a("small",{class:"d-block"},"台北市政府建管處版本",-1)]),8,ta),a("button",{class:"btn btn-theme",onClick:W},[e[7]||(e[7]=a("i",{class:"fa fa-edit me-2"},null,-1)),_(" "+i(y.value?"隱藏":"顯示")+"參數設定 ",1)])]),e[8]||(e[8]=a("div",{class:"mt-3 text-center"},[a("small",{class:"text-muted"}," 空白表單無需填寫參數，適合手動填寫 "),a("div",{class:"mt-2"},[a("small",{class:"text-primary"},[a("i",{class:"fa fa-info-circle me-1"}),_(" 目前提供台北市政府建管處核定版本 ")])])],-1))]),_:1,__:[8]})]),_:1}),g(D,null,{default:b(()=>[g(R,null,{default:b(()=>e[9]||(e[9]=[a("div",{class:"d-flex align-items-center"},[a("i",{class:"fa fa-history me-2"}),a("h5",{class:"mb-0"},"下載歷史")],-1)])),_:1,__:[9]}),g(N,null,{default:b(()=>[P.value.length===0?(r(),o("div",aa,e[10]||(e[10]=[a("i",{class:"fa fa-download fa-2x text-muted mb-2"},null,-1),a("p",{class:"text-muted small mb-0"},"尚無下載記錄",-1)]))):(r(),o("div",sa,[(r(!0),o(I,null,M(P.value,n=>(r(),o("div",{key:n.id,class:"border rounded p-2 mb-2"},[a("div",la,[a("div",na,[a("div",ra,i(n.fileName),1),a("div",oa,[a("span",{class:C(["badge border px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center me-1",{"border-success text-success":n.hasParameters,"border-secondary text-secondary":!n.hasParameters}])},i(n.hasParameters?"含參數":"空白表單"),3),a("small",ia,i(n.fileSize),1)])])]),a("div",ca,i(n.downloadTime),1)]))),128))]))]),_:1})]),_:1})]),a("div",da,[Y(a("div",null,[g(Pt,{ref_key:"parameterManager",ref:x,"form-config":de(ee),"initial-data":d.value,"onUpdate:modelValue":H,onValidate:l},null,8,["form-config","initial-data"]),g(D,{class:"mt-4"},{default:b(()=>[g(N,null,{default:b(()=>[a("div",ua,[a("div",ma,[e[11]||(e[11]=a("i",{class:"fa fa-info-circle me-1"},null,-1)),Object.keys(q.value).length===0?(r(),o("span",pa," 表單驗證通過，可以下載 ")):(r(),o("span",va," 發現 "+i(Object.keys(q.value).length)+" 個驗證錯誤 ",1))]),a("div",ya,[a("button",{class:"btn btn-outline-info",onClick:F,disabled:f.value},e[12]||(e[12]=[a("i",{class:"fa fa-file-text me-1"},null,-1),_(" 載入範例 ")]),8,ba),a("button",{class:"btn btn-outline-secondary",onClick:T,disabled:f.value||Object.keys(q.value).length>0},[e[13]||(e[13]=a("i",{class:"fa fa-save me-1"},null,-1)),_(" "+i(f.value?"儲存中...":"儲存資料"),1)],8,ha),a("button",{class:"btn btn-theme",onClick:z,disabled:!O.value},[a("i",{class:C(["fa me-1",{"fa-spin fa-spinner":m.value,"fa-download":!m.value}])},null,2),_(" "+i(m.value?"處理中...":"下載表單"),1)],8,ga)])]),m.value?(r(),o("div",_a,[a("div",fa,[e[14]||(e[14]=a("span",{class:"small"},"正在生成表單...",-1)),a("span",xa,i(Math.round(h.value))+"%",1)]),a("div",ka,[a("div",{class:"progress-bar progress-bar-striped progress-bar-animated",style:re({width:h.value+"%"})},null,4)])])):v("",!0)]),_:1})]),_:1})],512),[[Z,y.value]]),Y(g(D,null,{default:b(()=>[g(N,{class:"text-center py-5"},{default:b(()=>[e[16]||(e[16]=a("i",{class:"fa fa-edit fa-3x text-muted mb-3"},null,-1)),e[17]||(e[17]=a("h5",{class:"text-muted mb-2"},"參數化表單",-1)),e[18]||(e[18]=a("p",{class:"text-muted mb-3"}," 填寫表單參數後，系統將自動生成包含您資料的施工計畫書 ",-1)),a("button",{class:"btn btn-theme",onClick:W},e[15]||(e[15]=[a("i",{class:"fa fa-edit me-2"},null,-1),_(" 開始填寫參數 ")]))]),_:1,__:[16,17,18]})]),_:1},512),[[Z,!y.value]])])])])])]))}}),ja=oe(wa,[["__scopeId","data-v-0eb91155"]]);export{ja as default};
