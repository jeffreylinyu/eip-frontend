import{C as J,a as K,u as oe}from"./company-Duos3Hr4.js";import{d as X,r as N,C as G,D as ne,M as ie,g as d,p as I,h as e,w as F,f as r,i as _,j as E,k as f,v as P,z as k,t as m,y as S,H as q,I as H,m as A,V as le,_ as ee,A as re,o as ae,n as h,G as O,P as ue,J as W,F as de}from"./index-D_u9nkte.js";const ce={class:"mb-3"},me=["disabled"],ve={key:0,class:"invalid-feedback"},pe={class:"form-text"},fe={class:"mb-3"},ye=["disabled"],be={key:0,class:"invalid-feedback"},xe={class:"mb-3"},ge=["disabled"],$e=["value"],_e={key:0,class:"invalid-feedback"},Ee={key:0,class:"mb-3"},Ne=["disabled"],he=["value"],Ce={key:0,class:"invalid-feedback"},Ie={class:"mb-3"},Me=["disabled"],we={key:0,class:"invalid-feedback"},ke={class:"form-text"},Te={class:"mb-3"},Pe=["disabled"],Ve={key:0,class:"invalid-feedback"},Re={class:"mb-3"},Ue=["disabled"],Ae={key:0,class:"invalid-feedback"},De={class:"mb-3"},Se=["disabled"],Le={key:0,class:"invalid-feedback"},Be={class:"form-text"},Oe={class:"mb-3"},We=["disabled"],je={key:0,class:"invalid-feedback"},Fe={class:"form-text"},Ge={key:1,class:"alert alert-danger"},qe=X({__name:"CompanyFormModal",props:{show:{type:Boolean},company:{}},emits:["update:show","hide","submit"],setup(z,{emit:R}){const $=z,b=R,l=N({companyName:"",companyUnifiedNumber:"",companyType:"OTHER",contactPerson:"",contactPhone:"",contactEmail:"",address:"",description:""}),C=N(!1),n=N({}),w=G(()=>!!$.company),y=G(()=>w.value?"編輯公司":"新增公司"),x=G(()=>w.value?"更新":"創建"),p=()=>{b("update:show",!1),b("hide")},M=()=>{l.value={companyName:"",companyUnifiedNumber:"",companyType:"OTHER",contactPerson:"",contactPhone:"",contactEmail:"",address:"",description:""},n.value={}};ne(()=>$.company,g=>{g?l.value={companyName:g.companyName,companyUnifiedNumber:g.companyCode,companyType:g.companyType,contractorLevel:g.contractorLevel,contactPerson:g.contactPerson,contactPhone:g.contactPhone,contactEmail:g.contactEmail,address:g.address,description:g.description||"",status:g.status}:M()},{immediate:!0}),ne(()=>$.show,g=>{g&&(n.value={})});const V=()=>(n.value={},l.value.companyName.trim()?l.value.companyName.trim().length<2?n.value.companyName="公司名稱至少需要2個字符":l.value.companyName.trim().length>100&&(n.value.companyName="公司名稱不能超過100個字符"):n.value.companyName="公司名稱不能為空",l.value.companyUnifiedNumber.trim()?/^\d{8}$/.test(l.value.companyUnifiedNumber.trim())||(n.value.companyUnifiedNumber="統一編號必須為8位數字"):n.value.companyUnifiedNumber="統一編號不能為空",l.value.contactPerson.trim()?l.value.contactPerson.trim().length>50&&(n.value.contactPerson="聯絡人名稱不能超過50個字符"):n.value.contactPerson="聯絡人不能為空",l.value.contactPhone.trim()?/^[\d-+().\s]{8,20}$/.test(l.value.contactPhone.trim())||(n.value.contactPhone="請輸入有效的電話號碼"):n.value.contactPhone="聯絡電話不能為空",l.value.contactEmail.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l.value.contactEmail.trim())||(n.value.contactEmail="請輸入有效的信箱地址"):n.value.contactEmail="聯絡信箱不能為空",l.value.address.trim()?l.value.address.trim().length>200&&(n.value.address="公司地址不能超過200個字符"):n.value.address="公司地址不能為空",l.value.description&&l.value.description.trim().length>500&&(n.value.description="公司描述不能超過500個字符"),Object.keys(n.value).length===0),U=async()=>{var g,a,c,L,B;if(V()){C.value=!0;try{const D={companyName:l.value.companyName.trim(),companyUnifiedNumber:l.value.companyUnifiedNumber.trim(),companyType:l.value.companyType,contractorLevel:l.value.contractorLevel,contactPerson:(g=l.value.contactPerson)==null?void 0:g.trim(),contactPhone:(a=l.value.contactPhone)==null?void 0:a.trim(),contactEmail:(c=l.value.contactEmail)==null?void 0:c.trim(),address:(L=l.value.address)==null?void 0:L.trim(),description:(B=l.value.description)==null?void 0:B.trim()};w.value&&l.value.status&&(D.status=l.value.status),b("submit",D)}catch(D){console.error("Submit error:",D)}finally{C.value=!1}}},j=()=>{U()},T=g=>{n.value[g]&&delete n.value[g]};return(g,a)=>(d(),ie(le,{show:$.show,"onUpdate:show":a[18]||(a[18]=c=>$.show=c),title:y.value,icon:"fa fa-building",size:"lg","modal-id":"companyFormModal","confirm-text":x.value,"confirm-icon":"fa fa-save","is-loading":C.value,"loading-text":"處理中...",onHide:p,onConfirm:j},{body:I(()=>[e("form",{onSubmit:F(U,["prevent"])},[e("div",ce,[a[19]||(a[19]=e("label",{for:"companyName",class:"form-label"},[f(" 公司名稱 "),e("span",{class:"text-danger"},"*")],-1)),E(e("input",{id:"companyName",type:"text",class:k(["form-control",{"is-invalid":n.value.companyName}]),"onUpdate:modelValue":a[0]||(a[0]=c=>l.value.companyName=c),onInput:a[1]||(a[1]=c=>T("companyName")),placeholder:"請輸入公司名稱",maxlength:"100",disabled:C.value},null,42,me),[[P,l.value.companyName]]),n.value.companyName?(d(),r("div",ve,m(n.value.companyName),1)):_("",!0),e("div",pe,m(l.value.companyName.length)+"/100 字符 ",1)]),e("div",fe,[a[20]||(a[20]=e("label",{for:"companyCode",class:"form-label"},[f(" 統一編號 "),e("span",{class:"text-danger"},"*")],-1)),E(e("input",{id:"companyCode",type:"text",class:k(["form-control",{"is-invalid":n.value.companyUnifiedNumber}]),"onUpdate:modelValue":a[2]||(a[2]=c=>l.value.companyUnifiedNumber=c),onInput:a[3]||(a[3]=c=>T("companyUnifiedNumber")),placeholder:"請輸入8位數統一編號",maxlength:"8",disabled:C.value},null,42,ye),[[P,l.value.companyUnifiedNumber]]),n.value.companyUnifiedNumber?(d(),r("div",be,m(n.value.companyUnifiedNumber),1)):_("",!0),a[21]||(a[21]=e("div",{class:"form-text"}," 請輸入8位數字的統一編號 ",-1))]),e("div",xe,[a[22]||(a[22]=e("label",{for:"companyType",class:"form-label"},[f(" 公司類型 "),e("span",{class:"text-danger"},"*")],-1)),E(e("select",{id:"companyType",class:k(["form-select",{"is-invalid":n.value.companyType}]),"onUpdate:modelValue":a[4]||(a[4]=c=>l.value.companyType=c),onChange:a[5]||(a[5]=c=>T("companyType")),disabled:C.value},[(d(!0),r(q,null,H(A(J),c=>(d(),r("option",{key:c.value,value:c.value},m(c.label),9,$e))),128))],42,ge),[[S,l.value.companyType]]),n.value.companyType?(d(),r("div",_e,m(n.value.companyType),1)):_("",!0)]),w.value?(d(),r("div",Ee,[a[23]||(a[23]=e("label",{for:"status",class:"form-label"},[f(" 狀態 "),e("span",{class:"text-danger"},"*")],-1)),E(e("select",{id:"status",class:k(["form-select",{"is-invalid":n.value.status}]),"onUpdate:modelValue":a[6]||(a[6]=c=>l.value.status=c),onChange:a[7]||(a[7]=c=>T("status")),disabled:C.value},[(d(!0),r(q,null,H(A(K),c=>(d(),r("option",{key:c.value,value:c.value},m(c.label),9,he))),128))],42,Ne),[[S,l.value.status]]),n.value.status?(d(),r("div",Ce,m(n.value.status),1)):_("",!0)])):_("",!0),e("div",Ie,[a[24]||(a[24]=e("label",{for:"contactPerson",class:"form-label"},[f(" 聯絡人 "),e("span",{class:"text-danger"},"*")],-1)),E(e("input",{id:"contactPerson",type:"text",class:k(["form-control",{"is-invalid":n.value.contactPerson}]),"onUpdate:modelValue":a[8]||(a[8]=c=>l.value.contactPerson=c),onInput:a[9]||(a[9]=c=>T("contactPerson")),placeholder:"請輸入聯絡人姓名",maxlength:"50",disabled:C.value},null,42,Me),[[P,l.value.contactPerson]]),n.value.contactPerson?(d(),r("div",we,m(n.value.contactPerson),1)):_("",!0),e("div",ke,m(l.value.contactPerson.length)+"/50 字符 ",1)]),e("div",Te,[a[25]||(a[25]=e("label",{for:"contactPhone",class:"form-label"},[f(" 聯絡電話 "),e("span",{class:"text-danger"},"*")],-1)),E(e("input",{id:"contactPhone",type:"tel",class:k(["form-control",{"is-invalid":n.value.contactPhone}]),"onUpdate:modelValue":a[10]||(a[10]=c=>l.value.contactPhone=c),onInput:a[11]||(a[11]=c=>T("contactPhone")),placeholder:"請輸入聯絡電話",maxlength:"20",disabled:C.value},null,42,Pe),[[P,l.value.contactPhone]]),n.value.contactPhone?(d(),r("div",Ve,m(n.value.contactPhone),1)):_("",!0)]),e("div",Re,[a[26]||(a[26]=e("label",{for:"contactEmail",class:"form-label"},[f(" 聯絡信箱 "),e("span",{class:"text-danger"},"*")],-1)),E(e("input",{id:"contactEmail",type:"email",class:k(["form-control",{"is-invalid":n.value.contactEmail}]),"onUpdate:modelValue":a[12]||(a[12]=c=>l.value.contactEmail=c),onInput:a[13]||(a[13]=c=>T("contactEmail")),placeholder:"請輸入聯絡信箱",maxlength:"100",disabled:C.value},null,42,Ue),[[P,l.value.contactEmail]]),n.value.contactEmail?(d(),r("div",Ae,m(n.value.contactEmail),1)):_("",!0)]),e("div",De,[a[27]||(a[27]=e("label",{for:"address",class:"form-label"},[f(" 公司地址 "),e("span",{class:"text-danger"},"*")],-1)),E(e("textarea",{id:"address",class:k(["form-control",{"is-invalid":n.value.address}]),"onUpdate:modelValue":a[14]||(a[14]=c=>l.value.address=c),onInput:a[15]||(a[15]=c=>T("address")),placeholder:"請輸入公司地址",rows:"2",maxlength:"200",disabled:C.value},null,42,Se),[[P,l.value.address]]),n.value.address?(d(),r("div",Le,m(n.value.address),1)):_("",!0),e("div",Be,m(l.value.address.length)+"/200 字符 ",1)]),e("div",Oe,[a[28]||(a[28]=e("label",{for:"description",class:"form-label"},"公司描述",-1)),E(e("textarea",{id:"description",class:k(["form-control",{"is-invalid":n.value.description}]),"onUpdate:modelValue":a[16]||(a[16]=c=>l.value.description=c),onInput:a[17]||(a[17]=c=>T("description")),placeholder:"請輸入公司描述（選填）",rows:"3",maxlength:"500",disabled:C.value},null,42,We),[[P,l.value.description]]),n.value.description?(d(),r("div",je,m(n.value.description),1)):_("",!0),e("div",Fe,m((l.value.description||"").length)+"/500 字符 ",1)]),Object.keys(n.value).length>0?(d(),r("div",Ge," 請修正以上錯誤後再提交 ")):_("",!0)],32)]),_:1},8,["show","title","confirm-text","is-loading"]))}}),He=ee(qe,[["__scopeId","data-v-758edee1"]]),ze={class:"company-management-tab"},Ze={class:"d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4 gap-3"},Ye={class:"d-flex flex-column flex-md-row gap-3 flex-grow-1"},Qe={class:"flex-grow-1",style:{"max-width":"400px"}},Je={class:"input-group"},Ke={style:{"min-width":"150px"}},Xe=["value"],et={style:{"min-width":"120px"}},tt=["value"],st={key:0,class:"text-center py-4"},lt={key:1,class:"alert alert-danger"},ot={key:2,class:"text-center py-5"},at={class:"text-muted mb-2"},nt={class:"text-muted mb-3"},it={key:3,class:"row g-3"},dt={class:"d-flex justify-content-between align-items-start mb-3"},rt={class:"flex-grow-1"},ut=["title"],ct={class:"text-muted small"},mt={class:"dropdown"},vt=["onClick"],pt=["onClick"],ft=["onClick"],yt=["onClick"],bt={class:"company-info"},xt={class:"d-flex gap-2 mb-2"},gt={key:0,class:"text-muted small mb-2 d-flex align-items-center"},$t={class:"text-muted small"},_t={class:"mb-2 d-flex align-items-center"},Et={class:"d-flex align-items-center"},Nt=X({__name:"CompanyManagementTab",emits:["manage-members"],setup(z,{emit:R}){const $=re(),b=$==null?void 0:$.proxy,l=oe(),C=R,n=N(!1),w=N(null),y=N(""),x=N(""),p=N(""),M=N(null),V=N(null),U=N(null),j=G(()=>{let v=l.companiesWithUserInfo;if(y.value){const s=y.value.toLowerCase();v=v.filter(o=>o.companyName.toLowerCase().includes(s)||o.companyCode.includes(s)||o.companyType.toLowerCase().includes(s))}return x.value&&(v=v.filter(s=>s.companyType===x.value)),p.value&&(v=v.filter(s=>s.status===p.value)),v}),T=v=>{const s=J.find(o=>o.value===v);return s?s.label:v},g=v=>{const s=J.find(o=>o.value===v);return s?s.color:"secondary"},a=v=>{const s=K.find(o=>o.value===v);return s?s.label:v},c=v=>{const s=K.find(o=>o.value===v);return s?s.color:"secondary"},L=v=>{w.value=v||null,n.value=!0},B=()=>{n.value=!1,w.value=null},D=async v=>{try{w.value?await l.updateCompany(w.value.companyId,v)?(b.$toast.success("公司更新成功！"),B()):b.$toast.error("公司更新失敗，請重試！"):await l.createCompany(v)?(b.$toast.success("公司建立成功！"),B()):b.$toast.error("公司建立失敗，請重試！")}catch(s){console.error("Company form submit error:",s),b.$toast.error("操作失敗，請重試！")}},te=async v=>{if(window.confirm(`確定要刪除公司「${v.companyName}」嗎？此操作無法撤銷。`))try{await l.deleteCompany(v.companyId)?b.$toast.success("公司刪除成功！"):b.$toast.error("公司刪除失敗，請重試！")}catch(o){console.error("Delete company error:",o),b.$toast.error("刪除失敗，請重試！")}},Y=v=>{C("manage-members",v.companyId)},se=v=>{M.value=M.value===v?null:v},Z=()=>{M.value=null},u=v=>{V.value=v,U.value&&clearTimeout(U.value),U.value=setTimeout(()=>{M.value&&M.value!==v&&(M.value=null)},100)},t=()=>{V.value=null,U.value&&clearTimeout(U.value)},i=()=>{y.value="",x.value="",p.value=""};return ae(()=>{l.initCompanies()}),(v,s)=>(d(),r("div",ze,[e("div",Ze,[e("div",Ye,[e("div",Qe,[e("div",Je,[s[12]||(s[12]=e("span",{class:"input-group-text"},[e("i",{class:"fa fa-search"})],-1)),E(e("input",{type:"text",class:"form-control",placeholder:"搜索公司名稱、統編、聯絡人或信箱...","onUpdate:modelValue":s[0]||(s[0]=o=>y.value=o)},null,512),[[P,y.value]]),y.value?(d(),r("button",{key:0,class:"btn btn-outline-secondary",type:"button",onClick:s[1]||(s[1]=o=>y.value="")},s[11]||(s[11]=[e("i",{class:"fa fa-times"},null,-1)]))):_("",!0)])]),e("div",Ke,[E(e("select",{class:"form-select","onUpdate:modelValue":s[2]||(s[2]=o=>x.value=o)},[s[13]||(s[13]=e("option",{value:""},"所有類型",-1)),(d(!0),r(q,null,H(A(J),o=>(d(),r("option",{key:o.value,value:o.value},m(o.label),9,Xe))),128))],512),[[S,x.value]])]),e("div",et,[E(e("select",{class:"form-select","onUpdate:modelValue":s[3]||(s[3]=o=>p.value=o)},[s[14]||(s[14]=e("option",{value:""},"所有狀態",-1)),(d(!0),r(q,null,H(A(K),o=>(d(),r("option",{key:o.value,value:o.value},m(o.label),9,tt))),128))],512),[[S,p.value]])]),y.value||x.value||p.value?(d(),r("button",{key:0,class:"btn btn-outline-secondary",onClick:i},s[15]||(s[15]=[e("i",{class:"fa fa-eraser me-1"},null,-1),f(" 清除 ")]))):_("",!0)]),e("button",{class:"btn btn-theme",onClick:s[4]||(s[4]=o=>L())},s[16]||(s[16]=[e("i",{class:"fa fa-plus me-2"},null,-1),f(" 新增公司 ")]))]),A(l).isLoading?(d(),r("div",st,s[17]||(s[17]=[e("div",{class:"spinner-border text-theme",role:"status"},[e("span",{class:"visually-hidden"},"載入中...")],-1),e("div",{class:"mt-2 text-muted"},"載入公司資料中...",-1)]))):A(l).error?(d(),r("div",lt,[s[18]||(s[18]=e("i",{class:"fa fa-exclamation-triangle me-2"},null,-1)),f(" "+m(A(l).error)+" ",1),e("button",{class:"btn btn-sm btn-outline-danger ms-2",onClick:s[5]||(s[5]=o=>A(l).initCompanies())}," 重試 ")])):j.value.length===0?(d(),r("div",ot,[s[20]||(s[20]=e("div",{class:"mb-3"},[e("i",{class:"fa fa-building fa-3x text-muted"})],-1)),e("h5",at,m(A(l).companies.length===0?"尚未建立任何公司":"找不到符合條件的公司"),1),e("p",nt,m(A(l).companies.length===0?"開始建立您的第一個公司":"請調整搜索條件或新增公司"),1),e("button",{class:"btn btn-theme",onClick:s[6]||(s[6]=o=>L())},s[19]||(s[19]=[e("i",{class:"fa fa-plus me-2"},null,-1),f(" 新增公司 ")]))])):(d(),r("div",it,[(d(!0),r(q,null,H(j.value,o=>(d(),r("div",{key:o.companyId,class:"col-xl-4 col-lg-6 col-md-6"},[h(W,{class:k(["h-100",{"dropdown-open":M.value===o.companyId,"card-hover":V.value===o.companyId&&M.value!==o.companyId}]),onMouseenter:Q=>u(o.companyId),onMouseleave:t},{default:I(()=>[h(O,null,{default:I(()=>[e("div",dt,[e("div",rt,[e("h6",{class:"card-title mb-1 text-truncate",title:o.companyName},m(o.companyName),9,ut),e("div",ct," 統編："+m(o.companyCode),1)]),e("div",mt,[e("button",{class:"btn btn-sm btn-outline-secondary dropdown-toggle",type:"button",onClick:F(Q=>se(o.companyId),["stop"])},s[21]||(s[21]=[e("i",{class:"fa fa-cog"},null,-1)]),8,vt),E(e("ul",{class:"dropdown-menu dropdown-menu-end show",onClick:s[7]||(s[7]=F(()=>{},["stop"])),onMouseenter:s[8]||(s[8]=F(()=>{},["stop"])),onMouseleave:s[9]||(s[9]=F(()=>{},["stop"]))},[e("li",null,[e("button",{class:"dropdown-item",onClick:Q=>{L(o),Z()}},s[22]||(s[22]=[e("i",{class:"fa fa-edit me-2"},null,-1),f(" 編輯公司 ")]),8,pt)]),e("li",null,[e("button",{class:"dropdown-item",onClick:Q=>{Y(o),Z()}},s[23]||(s[23]=[e("i",{class:"fa fa-users me-2"},null,-1),f(" 管理成員 ")]),8,ft)]),s[25]||(s[25]=e("li",null,[e("hr",{class:"dropdown-divider"})],-1)),e("li",null,[e("button",{class:"dropdown-item text-danger",onClick:Q=>{te(o),Z()}},s[24]||(s[24]=[e("i",{class:"fa fa-trash me-2"},null,-1),f(" 刪除公司 ")]),8,yt)])],544),[[ue,M.value===o.companyId]])])]),e("div",bt,[e("div",xt,[e("span",{class:k(["badge border px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center",`border-${g(o.companyType)} text-${g(o.companyType)}`])},m(T(o.companyType)),3),e("span",{class:k(["badge border px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center",`border-${c(o.status)} text-${c(o.status)}`])},m(a(o.status)),3)]),o.companyType==="CONTRACTOR"&&o.contractorLevel?(d(),r("div",gt,[s[26]||(s[26]=e("i",{class:"fa fa-star me-1",style:{width:"16px","text-align":"center"}},null,-1)),f(" 營造等級："+m(o.contractorLevel==="SPECIAL"?"特等":o.contractorLevel==="CLASS_A"?"甲等":o.contractorLevel==="CLASS_B"?"乙等":o.contractorLevel==="CLASS_C"?"丙等":o.contractorLevel),1)])):_("",!0),e("div",$t,[e("div",_t,[s[27]||(s[27]=e("i",{class:"fa fa-user-tag me-1",style:{width:"16px","text-align":"center"}},null,-1)),f(" 用戶角色："+m(o.userRole==="OWNER"?"擁有者":o.userRole==="ADMIN"?"管理員":o.userRole==="MEMBER"?"成員":o.userRole==="VIEWER"?"檢視者":o.userRole),1)]),e("div",Et,[s[28]||(s[28]=e("i",{class:"fa fa-calendar me-1",style:{width:"16px","text-align":"center"}},null,-1)),f(" 加入時間："+m(new Date(o.joinedAt||o.createdAt).toLocaleDateString()),1)])])])]),_:2},1024)]),_:2},1032,["class","onMouseenter"])]))),128))])),h(He,{show:n.value,"onUpdate:show":s[10]||(s[10]=o=>n.value=o),company:w.value,onHide:B,onSubmit:D},null,8,["show","company"])]))}}),ht=ee(Nt,[["__scopeId","data-v-57d196ed"]]),Ct={class:"company-member-management"},It={class:"row mb-4"},Mt={class:"col-md-3"},wt={class:"fs-2 fw-bold text-primary"},kt={class:"col-md-3"},Tt={class:"fs-2 fw-bold text-success"},Pt={class:"col-md-3"},Vt={class:"fs-2 fw-bold text-warning"},Rt={class:"col-md-3"},Ut={class:"fs-2 fw-bold text-danger"},At={class:"row align-items-center"},Dt={class:"col-md-6"},St={class:"input-group"},Lt={class:"col-md-2"},Bt={class:"col-md-2"},Ot={class:"mb-0"},Wt={key:0,class:"text-center py-5"},jt={key:1,class:"table-responsive"},Ft={class:"table table-hover mb-0"},Gt={class:"px-4 py-3"},qt={class:"d-flex align-items-center"},Ht={class:"avatar-circle me-3"},zt={class:"fw-bold"},Zt={class:"text-muted small"},Yt={key:0,class:"text-muted small"},Qt={class:"px-4 py-3"},Jt={key:0,class:"fa fa-crown me-1"},Kt={key:1,class:"fa fa-user-shield me-1"},Xt={key:2,class:"fa fa-user me-1"},es={key:3,class:"fa fa-eye me-1"},ts={class:"px-4 py-3"},ss={class:"px-4 py-3 text-muted small"},ls={class:"px-4 py-3 text-muted small"},os={class:"px-4 py-3"},as={class:"d-flex justify-content-center gap-1"},ns=["onClick"],is=["onClick"],ds=["onClick"],rs={class:"mb-3"},us={class:"mb-3"},cs={class:"mb-3"},ms={class:"mb-3"},vs={class:"mb-3"},ps={class:"mb-3"},fs={class:"mb-3"},ys=X({__name:"CompanyMemberManagement",props:{companyId:{}},setup(z){const R=z;oe();const $=N(!1),b=N(""),l=N(""),C=N(""),n=N(!1),w=N(!1),y=N(null),x=N({email:"",role:"MEMBER",message:""}),p=N([{id:"member-001",userId:"user-001",userName:"王小明",userEmail:"wang@example.com",userPhone:"0912-345-678",role:"OWNER",joinedAt:"2024-01-15T08:00:00Z",status:"ACTIVE",companyId:"comp-001",companyName:"台灣建設股份有限公司"},{id:"member-002",userId:"user-002",userName:"李小華",userEmail:"lee@example.com",userPhone:"0923-456-789",role:"ADMIN",joinedAt:"2024-02-01T09:30:00Z",status:"ACTIVE",invitedBy:"user-001",companyId:"comp-001",companyName:"台灣建設股份有限公司"},{id:"member-003",userId:"user-003",userName:"張工程師",userEmail:"zhang@example.com",role:"MEMBER",joinedAt:"2024-02-15T14:20:00Z",status:"ACTIVE",invitedBy:"user-001",companyId:"comp-001",companyName:"台灣建設股份有限公司"},{id:"member-004",userId:"user-004",userName:"陳助理",userEmail:"chen@example.com",role:"VIEWER",joinedAt:"2024-03-01T10:15:00Z",status:"PENDING",invitedBy:"user-002",companyId:"comp-001",companyName:"台灣建設股份有限公司"}]),M=G(()=>{let u=p.value;if(b.value){const t=b.value.toLowerCase();u=u.filter(i=>i.userName.toLowerCase().includes(t)||i.userEmail.toLowerCase().includes(t)||i.userPhone&&i.userPhone.includes(t))}return l.value&&(u=u.filter(t=>t.role===l.value)),C.value&&(u=u.filter(t=>t.status===C.value)),u}),V=G(()=>{const u=p.value.length,t=p.value.filter(s=>s.status==="ACTIVE").length,i=p.value.filter(s=>s.status==="PENDING").length,v={OWNER:p.value.filter(s=>s.role==="OWNER").length,ADMIN:p.value.filter(s=>s.role==="ADMIN").length,MEMBER:p.value.filter(s=>s.role==="MEMBER").length,VIEWER:p.value.filter(s=>s.role==="VIEWER").length};return{total:u,active:t,pending:i,byRole:v}}),U=u=>({OWNER:"擁有者",ADMIN:"管理員",MEMBER:"成員",VIEWER:"檢視者"})[u]||u,j=u=>({OWNER:"danger",ADMIN:"warning",MEMBER:"primary",VIEWER:"secondary"})[u]||"secondary",T=u=>({ACTIVE:"已加入",INACTIVE:"已停用",PENDING:"待確認"})[u]||u,g=u=>({ACTIVE:"success",INACTIVE:"secondary",PENDING:"warning"})[u]||"secondary",a=u=>new Date(u).toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),c=u=>u.role!=="OWNER",L=u=>u.role!=="OWNER",B=()=>{x.value={email:"",role:"MEMBER",message:""},n.value=!0},D=async()=>{$.value=!0;try{console.log("邀請成員:",x.value);const u={id:`member-${Date.now()}`,userId:`user-${Date.now()}`,userName:x.value.email.split("@")[0],userEmail:x.value.email,role:x.value.role,joinedAt:new Date().toISOString(),status:"PENDING",invitedBy:"current-user",companyId:R.companyId,companyName:"當前公司"};p.value.push(u),n.value=!1}catch(u){console.error("邀請成員失敗:",u)}finally{$.value=!1}},te=u=>{y.value={...u},w.value=!0},Y=async()=>{if(y.value){$.value=!0;try{console.log("更新成員:",y.value);const u=p.value.findIndex(t=>t.id===y.value.id);u!==-1&&(p.value[u]={...y.value}),w.value=!1,y.value=null}catch(u){console.error("更新成員失敗:",u)}finally{$.value=!1}}},se=async u=>{if(window.confirm(`確定要移除成員「${u.userName}」嗎？`)){$.value=!0;try{console.log("移除成員:",u.id),p.value=p.value.filter(i=>i.id!==u.id)}catch(i){console.error("移除成員失敗:",i)}finally{$.value=!1}}},Z=async u=>{$.value=!0;try{console.log("重新發送邀請:",u.id)}catch(t){console.error("重新發送邀請失敗:",t)}finally{$.value=!1}};return ae(()=>{console.log("載入公司成員:",R.companyId)}),(u,t)=>(d(),r("div",Ct,[e("div",It,[e("div",Mt,[h(W,{class:"text-center"},{default:I(()=>[h(O,null,{default:I(()=>[e("div",wt,m(V.value.total),1),t[12]||(t[12]=e("div",{class:"text-muted"},"總成員數",-1))]),_:1,__:[12]})]),_:1})]),e("div",kt,[h(W,{class:"text-center"},{default:I(()=>[h(O,null,{default:I(()=>[e("div",Tt,m(V.value.active),1),t[13]||(t[13]=e("div",{class:"text-muted"},"已加入",-1))]),_:1,__:[13]})]),_:1})]),e("div",Pt,[h(W,{class:"text-center"},{default:I(()=>[h(O,null,{default:I(()=>[e("div",Vt,m(V.value.pending),1),t[14]||(t[14]=e("div",{class:"text-muted"},"待確認",-1))]),_:1,__:[14]})]),_:1})]),e("div",Rt,[h(W,{class:"text-center"},{default:I(()=>[h(O,null,{default:I(()=>[e("div",Ut,m(V.value.byRole.ADMIN),1),t[15]||(t[15]=e("div",{class:"text-muted"},"管理員",-1))]),_:1,__:[15]})]),_:1})])]),h(W,{class:"mb-4"},{default:I(()=>[h(O,null,{default:I(()=>[e("div",At,[e("div",Dt,[e("div",St,[t[16]||(t[16]=e("span",{class:"input-group-text"},[e("i",{class:"fa fa-search"})],-1)),E(e("input",{type:"text",class:"form-control",placeholder:"搜索成員姓名、信箱或電話...","onUpdate:modelValue":t[0]||(t[0]=i=>b.value=i)},null,512),[[P,b.value]])])]),e("div",Lt,[E(e("select",{class:"form-select","onUpdate:modelValue":t[1]||(t[1]=i=>l.value=i)},t[17]||(t[17]=[e("option",{value:""},"所有角色",-1),e("option",{value:"OWNER"},"擁有者",-1),e("option",{value:"ADMIN"},"管理員",-1),e("option",{value:"MEMBER"},"成員",-1),e("option",{value:"VIEWER"},"檢視者",-1)]),512),[[S,l.value]])]),e("div",Bt,[E(e("select",{class:"form-select","onUpdate:modelValue":t[2]||(t[2]=i=>C.value=i)},t[18]||(t[18]=[e("option",{value:""},"所有狀態",-1),e("option",{value:"ACTIVE"},"已加入",-1),e("option",{value:"PENDING"},"待確認",-1),e("option",{value:"INACTIVE"},"已停用",-1)]),512),[[S,C.value]])]),e("div",{class:"col-md-2"},[e("button",{class:"btn btn-theme w-100",onClick:B},t[19]||(t[19]=[e("i",{class:"fa fa-plus me-1"},null,-1),f(" 邀請成員 ")]))])])]),_:1})]),_:1}),h(W,null,{default:I(()=>[h(de,null,{default:I(()=>[e("h5",Ot,[t[20]||(t[20]=e("i",{class:"fa fa-users me-2"},null,-1)),f(" 成員列表 ("+m(M.value.length)+") ",1)])]),_:1}),h(O,{class:"p-0"},{default:I(()=>[M.value.length===0?(d(),r("div",Wt,t[21]||(t[21]=[e("i",{class:"fa fa-users fa-3x text-muted mb-3"},null,-1),e("h5",{class:"text-muted"},"沒有找到成員",-1),e("p",{class:"text-muted"},"請嘗試調整搜索條件或邀請新成員",-1)]))):(d(),r("div",jt,[e("table",Ft,[t[26]||(t[26]=e("thead",{class:""},[e("tr",null,[e("th",{class:"px-4 py-3"},"成員資訊"),e("th",{class:"px-4 py-3"},"角色"),e("th",{class:"px-4 py-3"},"狀態"),e("th",{class:"px-4 py-3"},"加入時間"),e("th",{class:"px-4 py-3"},"邀請者"),e("th",{class:"px-4 py-3 text-center"},"操作")])],-1)),e("tbody",null,[(d(!0),r(q,null,H(M.value,i=>(d(),r("tr",{key:i.id},[e("td",Gt,[e("div",qt,[e("div",Ht,m(i.userName.charAt(0)),1),e("div",null,[e("div",zt,m(i.userName),1),e("div",Zt,m(i.userEmail),1),i.userPhone?(d(),r("div",Yt,[t[22]||(t[22]=e("i",{class:"fa fa-phone me-1"},null,-1)),f(" "+m(i.userPhone),1)])):_("",!0)])])]),e("td",Qt,[e("span",{class:k(["badge border px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center",`border-${j(i.role)} text-${j(i.role)}`])},[i.role==="OWNER"?(d(),r("i",Jt)):i.role==="ADMIN"?(d(),r("i",Kt)):i.role==="MEMBER"?(d(),r("i",Xt)):(d(),r("i",es)),f(" "+m(U(i.role)),1)],2)]),e("td",ts,[e("span",{class:k(["badge border px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center",`border-${g(i.status)} text-${g(i.status)}`])},m(T(i.status)),3)]),e("td",ss,m(a(i.joinedAt)),1),e("td",ls,m(i.invitedBy?"已邀請":"-"),1),e("td",os,[e("div",as,[c(i)?(d(),r("button",{key:0,class:"btn btn-sm btn-outline-theme",onClick:v=>te(i),title:"編輯成員"},t[23]||(t[23]=[e("i",{class:"fa fa-edit"},null,-1)]),8,ns)):_("",!0),i.status==="PENDING"?(d(),r("button",{key:1,class:"btn btn-sm btn-outline-warning",onClick:v=>Z(i),title:"重新發送邀請"},t[24]||(t[24]=[e("i",{class:"fa fa-paper-plane"},null,-1)]),8,is)):_("",!0),L(i)?(d(),r("button",{key:2,class:"btn btn-sm btn-outline-danger",onClick:v=>se(i),title:"移除成員"},t[25]||(t[25]=[e("i",{class:"fa fa-trash"},null,-1)]),8,ds)):_("",!0)])])]))),128))])])]))]),_:1})]),_:1}),h(le,{show:n.value,"onUpdate:show":t[6]||(t[6]=i=>n.value=i),title:"邀請新成員",onSubmit:D,loading:$.value},{default:I(()=>[e("form",{onSubmit:F(D,["prevent"])},[e("div",rs,[t[27]||(t[27]=e("label",{class:"form-label"},"電子信箱 *",-1)),E(e("input",{type:"email",class:"form-control","onUpdate:modelValue":t[3]||(t[3]=i=>x.value.email=i),placeholder:"請輸入要邀請的電子信箱",required:""},null,512),[[P,x.value.email]])]),e("div",us,[t[29]||(t[29]=e("label",{class:"form-label"},"角色 *",-1)),E(e("select",{class:"form-select","onUpdate:modelValue":t[4]||(t[4]=i=>x.value.role=i),required:""},t[28]||(t[28]=[e("option",{value:"MEMBER"},"成員",-1),e("option",{value:"ADMIN"},"管理員",-1),e("option",{value:"VIEWER"},"檢視者",-1)]),512),[[S,x.value.role]]),t[30]||(t[30]=e("div",{class:"form-text"},[e("small",{class:"text-muted"},[f(" • "),e("strong",null,"管理員"),f("：可以管理公司資料和成員"),e("br"),f(" • "),e("strong",null,"成員"),f("：可以參與專案和查看公司資料"),e("br"),f(" • "),e("strong",null,"檢視者"),f("：只能查看被授權的內容 ")])],-1))]),e("div",cs,[t[31]||(t[31]=e("label",{class:"form-label"},"邀請訊息",-1)),E(e("textarea",{class:"form-control",rows:"3","onUpdate:modelValue":t[5]||(t[5]=i=>x.value.message=i),placeholder:"可以在邀請信中加入自訂訊息..."},null,512),[[P,x.value.message]])])],32)]),_:1},8,["show","loading"]),y.value?(d(),ie(le,{key:0,show:w.value,"onUpdate:show":t[11]||(t[11]=i=>w.value=i),title:"編輯成員",onSubmit:Y,loading:$.value},{default:I(()=>[e("form",{onSubmit:F(Y,["prevent"])},[e("div",ms,[t[32]||(t[32]=e("label",{class:"form-label"},"成員姓名",-1)),E(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[7]||(t[7]=i=>y.value.userName=i),readonly:""},null,512),[[P,y.value.userName]])]),e("div",vs,[t[33]||(t[33]=e("label",{class:"form-label"},"電子信箱",-1)),E(e("input",{type:"email",class:"form-control","onUpdate:modelValue":t[8]||(t[8]=i=>y.value.userEmail=i),readonly:""},null,512),[[P,y.value.userEmail]])]),e("div",ps,[t[35]||(t[35]=e("label",{class:"form-label"},"角色 *",-1)),E(e("select",{class:"form-select","onUpdate:modelValue":t[9]||(t[9]=i=>y.value.role=i),required:""},t[34]||(t[34]=[e("option",{value:"ADMIN"},"管理員",-1),e("option",{value:"MEMBER"},"成員",-1),e("option",{value:"VIEWER"},"檢視者",-1)]),512),[[S,y.value.role]])]),e("div",fs,[t[37]||(t[37]=e("label",{class:"form-label"},"狀態 *",-1)),E(e("select",{class:"form-select","onUpdate:modelValue":t[10]||(t[10]=i=>y.value.status=i),required:""},t[36]||(t[36]=[e("option",{value:"ACTIVE"},"已加入",-1),e("option",{value:"INACTIVE"},"已停用",-1),e("option",{value:"PENDING"},"待確認",-1)]),512),[[S,y.value.status]])])],32)]),_:1},8,["show","loading"])):_("",!0)]))}}),bs=ee(ys,[["__scopeId","data-v-af0d66c4"]]),xs={class:"container-xxl"},gs={class:"row justify-content-center"},$s={class:"col-xl-12"},_s={class:"d-flex align-items-center justify-content-between mb-4"},Es={class:"page-header-title"},Ns={key:0},hs={key:1},Cs={class:"text-muted mb-0"},Is={key:0},Ms={key:1},ws={class:"d-flex gap-2"},ks=["disabled"],Ts={key:0,class:"spinner-border spinner-border-sm me-2"},Ps={key:1,class:"fa fa-refresh me-2"},Vs={key:0},Rs={key:1},Us=X({__name:"CompanyManagement",setup(z){const R=oe(),$=N(!1),b=N("companies"),l=N(""),C=G(()=>l.value?R.companies.find(x=>x.id===l.value):null),n=async()=>{$.value=!0;try{await R.initCompanies()}catch(x){console.error("Failed to refresh data:",x)}finally{$.value=!1}},w=(x,p)=>{b.value=x,p&&(l.value=p)},y=()=>{b.value="companies",l.value=""};return ae(()=>{R.initCompanies()}),(x,p)=>{var M;return d(),r("div",xs,[e("div",gs,[e("div",$s,[e("div",_s,[e("div",null,[e("h1",Es,[p[1]||(p[1]=e("i",{class:"fa fa-building me-3"},null,-1)),b.value==="companies"?(d(),r("span",Ns,"公司管理")):b.value==="members"?(d(),r("span",hs,m(((M=C.value)==null?void 0:M.companyName)||"公司")+" - 成員管理 ",1)):_("",!0)]),e("p",Cs,[b.value==="companies"?(d(),r("span",Is,"管理您的公司資料")):b.value==="members"?(d(),r("span",Ms,"管理公司成員和權限")):_("",!0)])]),e("div",ws,[b.value==="members"?(d(),r("button",{key:0,class:"btn btn-outline-secondary",onClick:y},p[2]||(p[2]=[e("i",{class:"fa fa-arrow-left me-2"},null,-1),f(" 返回公司列表 ")]))):_("",!0),e("button",{class:"btn btn-outline-theme",onClick:n,disabled:$.value},[$.value?(d(),r("span",Ts)):(d(),r("i",Ps)),p[3]||(p[3]=f(" 重新載入 "))],8,ks)])]),b.value==="companies"?(d(),r("div",Vs,[h(W,null,{default:I(()=>[h(de,null,{default:I(()=>p[4]||(p[4]=[e("div",{class:"d-flex align-items-center"},[e("i",{class:"fa fa-building me-2"}),e("h5",{class:"mb-0"},"公司列表")],-1)])),_:1,__:[4]}),h(O,{class:"p-0"},{default:I(()=>[h(ht,{onManageMembers:p[0]||(p[0]=V=>w("members",V))})]),_:1})]),_:1})])):b.value==="members"&&l.value?(d(),r("div",Rs,[h(bs,{"company-id":l.value},null,8,["company-id"])])):_("",!0)])])])}}}),Ss=ee(Us,[["__scopeId","data-v-4c45d980"]]);export{Ss as default};
