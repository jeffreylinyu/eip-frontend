import{d as I,u as H,r as C,C as u,o as R,f as c,g as m,h as t,n as d,i as g,k as y,p as r,F as G,G as f,H as h,I as k,j as i,t as a,y as J,v as p,J as _,_ as Y}from"./index-D_u9nkte.js";import{M as q}from"./dailyReport-CO5OWQqK.js";const z={class:"materials-section"},K={class:"table-responsive"},O={class:"table table-bordered table-hover"},X=["onUpdate:modelValue","onChange"],Z=["value"],tt=["onUpdate:modelValue"],et={class:"input-group"},lt=["onUpdate:modelValue"],ot={class:"input-group"},st=["onUpdate:modelValue"],nt={class:"input-group"},at=["onUpdate:modelValue"],ut={class:"input-group"},dt=["onUpdate:modelValue"],rt={class:"input-group"},it=["onUpdate:modelValue"],ct={class:"input-group"},mt=["onUpdate:modelValue"],pt={class:"input-group"},yt=["onUpdate:modelValue"],vt={class:"input-group"},ft=["onUpdate:modelValue"],_t=["onUpdate:modelValue"],bt=["onClick"],gt={key:0},ht={class:"table-secondary"},kt={class:"row mt-4"},Wt={class:"col-md-3"},wt={class:"mb-1"},xt={class:"col-md-3"},Vt={class:"mb-1"},Qt={class:"col-md-3"},Ut={class:"mb-1"},Nt={class:"col-md-3"},Ct={class:"mb-1"},Mt={key:0,class:"alert alert-warning mt-4"},Pt={class:"mb-0"},Tt={class:"d-flex justify-content-between mt-4"},St={class:"d-flex gap-2"},$t=["disabled"],At=["disabled"],Bt=I({__name:"MaterialsSection",setup(Dt){const W=H(),n=C([]),b=C(!1),w=u(()=>q),M=u(()=>n.value.length),P=u(()=>n.value.reduce((s,e)=>s+(e.designQuantity||0),0)),x=u(()=>n.value.reduce((s,e)=>s+(e.accumulatedQuantity||0),0)),V=u(()=>n.value.reduce((s,e)=>{var l;return s+(((l=e.todayWork)==null?void 0:l.morning)||0)},0)),Q=u(()=>n.value.reduce((s,e)=>{var l;return s+(((l=e.todayWork)==null?void 0:l.afternoon)||0)},0)),T=u(()=>V.value+Q.value),S=u(()=>n.value.reduce((s,e)=>s+(e.structuralWork||0),0)),$=u(()=>n.value.reduce((s,e)=>s+(e.laborWork||0),0)),U=u(()=>n.value.reduce((s,e)=>s+(e.accumulatedPeriod||0),0)),N=u(()=>{const s=[];return n.value.forEach((e,l)=>{e.accumulatedQuantity>e.designQuantity&&s.push(`${e.materialName||`材料${l+1}`}：累計數量(${e.accumulatedQuantity})超過設計數量(${e.designQuantity})`)}),s}),A=()=>{n.value.push({materialName:"",unit:"",designQuantity:0,accumulatedQuantity:0,todayWork:{morning:0,afternoon:0},structuralWork:0,laborWork:0,accumulatedPeriod:0,remarks:""})},B=s=>{n.value.splice(s,1)},D=s=>{const e=n.value[s];if(e.materialName&&e.materialName!=="custom"){const l=w.value.find(v=>v.name===e.materialName);l&&(e.unit=l.unit)}},E=()=>{const s=[{materialName:"210kg/cm²混凝土",unit:"M3",designQuantity:477.5,accumulatedQuantity:477.5,todayWork:{morning:0,afternoon:0},structuralWork:0,laborWork:0,accumulatedPeriod:0,remarks:""},{materialName:"鋼筋",unit:"噸",designQuantity:0,accumulatedQuantity:0,todayWork:{morning:0,afternoon:0},structuralWork:0,laborWork:0,accumulatedPeriod:0,remarks:""},{materialName:"水泥",unit:"包",designQuantity:13255,accumulatedQuantity:13085,todayWork:{morning:0,afternoon:0},structuralWork:0,laborWork:0,accumulatedPeriod:0,remarks:""},{materialName:"MD120",unit:"M2",designQuantity:17975,accumulatedQuantity:17120,todayWork:{morning:0,afternoon:0},structuralWork:0,laborWork:0,accumulatedPeriod:0,remarks:""}];n.value=[...n.value,...s]},L=async()=>{b.value=!0;try{console.log("儲存材料資料:",n.value)}catch(s){console.error("儲存失敗:",s)}finally{b.value=!1}},j=()=>{W.push("/daily-report/overview")},F=()=>{W.push("/daily-report/labor")};return R(()=>{console.log("載入材料資料")}),(s,e)=>(m(),c("div",z,[t("div",{class:"d-flex justify-content-between align-items-center mb-4"},[e[2]||(e[2]=t("div",null,[t("h4",{class:"mb-1"},"材料進場與使用數量"),t("p",{class:"text-muted mb-0"},"管理每日材料進場和使用情況")],-1)),t("div",{class:"d-flex gap-2"},[t("button",{class:"btn btn-outline-primary",onClick:A},e[0]||(e[0]=[t("i",{class:"fa fa-plus me-1"},null,-1),y("新增材料 ")])),t("button",{class:"btn btn-outline-secondary",onClick:E},e[1]||(e[1]=[t("i",{class:"fa fa-download me-1"},null,-1),y("匯入範本 ")]))])]),d(_,null,{default:r(()=>[d(G,null,{default:r(()=>e[3]||(e[3]=[t("h6",{class:"mb-0"},[t("i",{class:"fa fa-truck me-2"}),y("材料進場與使用紀錄 ")],-1)])),_:1,__:[3]}),d(f,null,{default:r(()=>[t("div",K,[t("table",O,[e[12]||(e[12]=t("thead",{class:"table-light"},[t("tr",null,[t("th",{style:{width:"20%"}},"工程名稱"),t("th",{style:{width:"8%"}},"單位"),t("th",{style:{width:"10%"}},"設計數量"),t("th",{style:{width:"10%"}},"累計數量"),t("th",{style:{width:"8%"}},"上午"),t("th",{style:{width:"8%"}},"下午"),t("th",{style:{width:"8%"}},"結構工"),t("th",{style:{width:"8%"}},"口工"),t("th",{style:{width:"10%"}},"累計工期"),t("th",{style:{width:"10%"}},"備註"),t("th",{style:{width:"4%"}},"操作")])],-1)),t("tbody",null,[(m(!0),c(h,null,k(n.value,(l,v)=>(m(),c("tr",{key:l.id||v},[t("td",null,[i(t("select",{class:"form-select","onUpdate:modelValue":o=>l.materialName=o,onChange:o=>D(v)},[e[4]||(e[4]=t("option",{value:""},"請選擇材料",-1)),(m(!0),c(h,null,k(w.value,o=>(m(),c("option",{key:o.name,value:o.name},a(o.name),9,Z))),128)),e[5]||(e[5]=t("option",{value:"custom"},"其他（自訂）",-1))],40,X),[[J,l.materialName]]),l.materialName==="custom"?i((m(),c("input",{key:0,type:"text",class:"form-control mt-1","onUpdate:modelValue":o=>l.customName=o,placeholder:"請輸入材料名稱"},null,8,tt)),[[p,l.customName]]):g("",!0)]),t("td",null,[t("div",et,[i(t("input",{type:"text",class:"form-control","onUpdate:modelValue":o=>l.unit=o,placeholder:"單位"},null,8,lt),[[p,l.unit]])])]),t("td",null,[t("div",ot,[i(t("input",{type:"number",class:"form-control","onUpdate:modelValue":o=>l.designQuantity=o,min:"0",step:"0.01",placeholder:"0"},null,8,st),[[p,l.designQuantity]])])]),t("td",null,[t("div",nt,[i(t("input",{type:"number",class:"form-control","onUpdate:modelValue":o=>l.accumulatedQuantity=o,min:"0",step:"0.01",placeholder:"0"},null,8,at),[[p,l.accumulatedQuantity]])])]),t("td",null,[t("div",ut,[i(t("input",{type:"number",class:"form-control","onUpdate:modelValue":o=>l.todayWork.morning=o,min:"0",step:"0.01",placeholder:"0"},null,8,dt),[[p,l.todayWork.morning]])])]),t("td",null,[t("div",rt,[i(t("input",{type:"number",class:"form-control","onUpdate:modelValue":o=>l.todayWork.afternoon=o,min:"0",step:"0.01",placeholder:"0"},null,8,it),[[p,l.todayWork.afternoon]])])]),t("td",null,[t("div",ct,[i(t("input",{type:"number",class:"form-control","onUpdate:modelValue":o=>l.structuralWork=o,min:"0",step:"0.01",placeholder:"0"},null,8,mt),[[p,l.structuralWork]])])]),t("td",null,[t("div",pt,[i(t("input",{type:"number",class:"form-control","onUpdate:modelValue":o=>l.laborWork=o,min:"0",step:"0.01",placeholder:"0"},null,8,yt),[[p,l.laborWork]])])]),t("td",null,[t("div",vt,[i(t("input",{type:"number",class:"form-control","onUpdate:modelValue":o=>l.accumulatedPeriod=o,min:"0",step:"0.01",placeholder:"0"},null,8,ft),[[p,l.accumulatedPeriod]])])]),t("td",null,[i(t("input",{type:"text",class:"form-control","onUpdate:modelValue":o=>l.remarks=o,placeholder:"備註"},null,8,_t),[[p,l.remarks]])]),t("td",null,[t("button",{class:"btn btn-sm btn-outline-danger",onClick:o=>B(v),title:"刪除"},e[6]||(e[6]=[t("i",{class:"fa fa-trash"},null,-1)]),8,bt)])]))),128)),n.value.length===0?(m(),c("tr",gt,e[7]||(e[7]=[t("td",{colspan:"11",class:"text-center text-muted py-4"},[t("i",{class:"fa fa-inbox fa-2x mb-2"}),t("p",{class:"mb-0"},"尚未新增任何材料")],-1)]))):g("",!0)]),t("tfoot",ht,[t("tr",null,[e[8]||(e[8]=t("td",null,[t("strong",null,"總計")],-1)),e[9]||(e[9]=t("td",null,null,-1)),t("td",null,[t("strong",null,a(P.value),1)]),t("td",null,[t("strong",null,a(x.value),1)]),t("td",null,[t("strong",null,a(V.value),1)]),t("td",null,[t("strong",null,a(Q.value),1)]),t("td",null,[t("strong",null,a(S.value),1)]),t("td",null,[t("strong",null,a($.value),1)]),t("td",null,[t("strong",null,a(U.value),1)]),e[10]||(e[10]=t("td",null,null,-1)),e[11]||(e[11]=t("td",null,null,-1))])])])])]),_:1})]),_:1}),t("div",kt,[t("div",Wt,[d(_,{class:"bg-primary text-white"},{default:r(()=>[d(f,{class:"text-center"},{default:r(()=>[t("h4",wt,a(M.value),1),e[13]||(e[13]=t("p",{class:"mb-0"},"材料種類",-1))]),_:1,__:[13]})]),_:1})]),t("div",xt,[d(_,{class:"bg-success text-white"},{default:r(()=>[d(f,{class:"text-center"},{default:r(()=>[t("h4",Vt,a(T.value),1),e[14]||(e[14]=t("p",{class:"mb-0"},"本日工總量",-1))]),_:1,__:[14]})]),_:1})]),t("div",Qt,[d(_,{class:"bg-warning text-white"},{default:r(()=>[d(f,{class:"text-center"},{default:r(()=>[t("h4",Ut,a(x.value),1),e[15]||(e[15]=t("p",{class:"mb-0"},"累計數量",-1))]),_:1,__:[15]})]),_:1})]),t("div",Nt,[d(_,{class:"bg-info text-white"},{default:r(()=>[d(f,{class:"text-center"},{default:r(()=>[t("h4",Ct,a(U.value),1),e[16]||(e[16]=t("p",{class:"mb-0"},"累計工期",-1))]),_:1,__:[16]})]),_:1})])]),N.value.length>0?(m(),c("div",Mt,[e[17]||(e[17]=t("h6",null,[t("i",{class:"fa fa-exclamation-triangle me-2"}),y("使用量異常提醒")],-1)),t("ul",Pt,[(m(!0),c(h,null,k(N.value,l=>(m(),c("li",{key:l},a(l),1))),128))])])):g("",!0),t("div",Tt,[t("button",{class:"btn btn-outline-secondary",onClick:j},e[18]||(e[18]=[t("i",{class:"fa fa-arrow-left me-1"},null,-1),y("返回總覽 ")])),t("div",St,[t("button",{class:"btn btn-primary",onClick:L,disabled:b.value},e[19]||(e[19]=[t("i",{class:"fa fa-save me-1"},null,-1),y("儲存 ")]),8,$t),t("button",{class:"btn btn-success",onClick:F,disabled:b.value},e[20]||(e[20]=[y(" 下一步 "),t("i",{class:"fa fa-arrow-right ms-1"},null,-1)]),8,At)])])]))}}),jt=Y(Bt,[["__scopeId","data-v-760dfd8a"]]);export{jt as default};
