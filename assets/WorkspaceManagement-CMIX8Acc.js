import{d as H,r as $,C as x,D as F,o as Y,M as G,g as d,p as V,h as e,w as Z,f as r,i as g,j as h,k as b,z as N,H as C,I as S,t as m,y as z,v as w,V as ee,_ as J,W as te,n as A,m as K,c as ae,G as Q,J as X,N as oe}from"./index-D_u9nkte.js";import{u as le}from"./company-Duos3Hr4.js";const ne={class:"mb-3"},ie=["disabled"],de=["value"],re={key:0,class:"invalid-feedback"},ue={key:1,class:"form-text text-warning"},me={class:"mb-3"},ce=["disabled"],ve={key:0,class:"invalid-feedback"},pe={class:"form-text"},fe={class:"mb-3"},be=["disabled"],ge={key:0,class:"invalid-feedback"},ke={class:"form-text"},xe={key:0,class:"alert alert-danger"},ye={class:"mb-0 mt-2"},_e=H({__name:"WorkspaceFormModal",props:{show:{type:Boolean},workspace:{}},emits:["update:show","hide","submit"],setup(L,{emit:D}){const y=L,I=D,c=$({name:"",description:"",companyId:""}),o=le(),f=$(!1),s=$({}),k=x(()=>!!y.workspace),R=x(()=>k.value?"編輯工作空間":"新增工作空間"),j=x(()=>k.value?"更新":"創建"),_=x(()=>o.activeCompanies),M=()=>{I("update:show",!1),I("hide")},U=()=>{var v;c.value={name:"",description:"",companyId:((v=_.value[0])==null?void 0:v.companyId)||""},s.value={}};F(()=>y.workspace,v=>{v?c.value={name:v.name,description:v.description,companyId:v.companyId||""}:U()},{immediate:!0}),F(()=>y.show,v=>{console.log("WorkspaceFormModal show changed:",v),v&&(s.value={},!c.value.companyId&&_.value.length>0&&(c.value.companyId=_.value[0].companyId))});const P=()=>(s.value={},c.value.name.trim()?c.value.name.trim().length<2?s.value.name="工作空間名稱至少需要2個字符":c.value.name.trim().length>50&&(s.value.name="工作空間名稱不能超過50個字符"):s.value.name="工作空間名稱不能為空",c.value.companyId.trim()||(s.value.companyId="請選擇一個公司"),c.value.description.trim().length>200&&(s.value.description="工作空間描述不能超過200個字符"),Object.keys(s.value).length===0),W=async()=>{if(P()){f.value=!0;try{const v={name:c.value.name.trim(),description:c.value.description.trim(),companyId:c.value.companyId.trim()};I("submit",v)}catch(v){console.error("Submit error:",v)}finally{f.value=!1}}},O=()=>{W()},E=v=>{s.value[v]&&delete s.value[v]};return Y(()=>{o.initCompanies()}),(v,l)=>(d(),G(ee,{show:y.show,title:R.value,icon:"fa fa-building",size:"lg","modal-id":"workspaceFormModal","confirm-text":j.value,"confirm-icon":"fa fa-save","is-loading":f.value,"loading-text":"處理中...",onHide:M,onConfirm:O},{body:V(()=>[e("form",{onSubmit:Z(W,["prevent"])},[e("div",ne,[l[8]||(l[8]=e("label",{for:"companyId",class:"form-label"},[b(" 所屬公司 "),e("span",{class:"text-danger"},"*")],-1)),h(e("select",{id:"companyId",class:N(["form-select",{"is-invalid":s.value.companyId}]),"onUpdate:modelValue":l[0]||(l[0]=t=>c.value.companyId=t),onChange:l[1]||(l[1]=t=>E("companyId")),disabled:f.value},[l[6]||(l[6]=e("option",{value:""},"請選擇公司",-1)),(d(!0),r(C,null,S(_.value,t=>(d(),r("option",{key:t.companyId,value:t.companyId},m(t.companyName)+" ("+m(t.companyCode)+") ",9,de))),128))],42,ie),[[z,c.value.companyId]]),s.value.companyId?(d(),r("div",re,m(s.value.companyId),1)):g("",!0),_.value.length===0?(d(),r("div",ue,l[7]||(l[7]=[e("i",{class:"fa fa-exclamation-triangle me-1"},null,-1),b(" 目前沒有可用的公司，請先建立公司 ")]))):g("",!0)]),e("div",me,[l[9]||(l[9]=e("label",{for:"workspaceName",class:"form-label"},[b(" 工作空間名稱 "),e("span",{class:"text-danger"},"*")],-1)),h(e("input",{id:"workspaceName",type:"text",class:N(["form-control",{"is-invalid":s.value.name}]),"onUpdate:modelValue":l[2]||(l[2]=t=>c.value.name=t),onInput:l[3]||(l[3]=t=>E("name")),placeholder:"請輸入工作空間名稱",maxlength:"50",disabled:f.value},null,42,ce),[[w,c.value.name]]),s.value.name?(d(),r("div",ve,m(s.value.name),1)):g("",!0),e("div",pe,m(c.value.name.length)+"/50 字符 ",1)]),e("div",fe,[l[10]||(l[10]=e("label",{for:"workspaceDescription",class:"form-label"},"工作空間描述",-1)),h(e("textarea",{id:"workspaceDescription",class:N(["form-control",{"is-invalid":s.value.description}]),"onUpdate:modelValue":l[4]||(l[4]=t=>c.value.description=t),onInput:l[5]||(l[5]=t=>E("description")),placeholder:"請輸入工作空間描述（選填）",rows:"3",maxlength:"200",disabled:f.value},null,42,be),[[w,c.value.description]]),s.value.description?(d(),r("div",ge,m(s.value.description),1)):g("",!0),e("div",ke,m(c.value.description.length)+"/200 字符 ",1)]),Object.keys(s.value).length>0?(d(),r("div",xe,[l[11]||(l[11]=e("i",{class:"fa fa-exclamation-triangle me-2"},null,-1)),l[12]||(l[12]=b(" 請修正以下錯誤： ")),e("ul",ye,[(d(!0),r(C,null,S(s.value,(t,i)=>(d(),r("li",{key:i},m(t),1))),128))])])):g("",!0)],32)]),_:1},8,["show","title","confirm-text","is-loading"]))}}),he=J(_e,[["__scopeId","data-v-32e4fc69"]]),Ne={class:"row g-4"},Ie={class:"col-md-6"},$e={class:"mb-3"},we=["disabled"],De={key:0,class:"invalid-feedback"},Ce={class:"form-text"},je={class:"mb-3"},Me=["disabled"],Ee=["value"],Se={key:0,class:"invalid-feedback"},Pe={key:1,class:"form-text"},We={class:"mb-3"},Oe=["disabled"],Ve={key:0,class:"invalid-feedback"},Re={class:"form-text"},Ue={class:"mb-3"},Le={class:"input-group"},Ae=["disabled"],Fe={key:0,class:"invalid-feedback"},Ge={class:"mb-3"},Te=["disabled"],Be=["value"],ze={class:"col-md-6"},He={class:"mb-3"},Je=["disabled"],qe={class:"mb-3"},Ke=["disabled"],Qe={key:0,class:"invalid-feedback"},Xe={class:"mb-3"},Ye=["disabled"],Ze={key:0,class:"invalid-feedback"},et={class:"form-text"},tt={class:"mb-3"},st={for:"progress",class:"form-label"},at={class:"badge bg-theme text-white ms-2"},ot=["disabled"],lt={class:"mb-3"},nt=["disabled"],it={key:0,class:"invalid-feedback"},dt={class:"form-text"},rt={key:0,class:"alert alert-danger mt-3"},ut={class:"mb-0 mt-2"},mt=H({__name:"ProjectFormModal",props:{show:{type:Boolean},project:{}},emits:["update:show","hide","submit"],setup(L,{emit:D}){const y=L,I=D,c=te(),o=$({name:"",workspaceId:"",location:"",budget:"",status:"PLANNING",startDate:"",endDate:"",managerName:"",description:"",progress:0}),f=$(!1),s=$({}),k=x(()=>!!y.project),R=x(()=>k.value?"編輯項目":"新增項目"),j=x(()=>k.value?"更新":"創建"),_=x(()=>c.workspaces.filter(l=>l.role==="OWNER"||l.role==="ADMIN"||l.role==="MEMBER")),M=[{value:"PLANNING",label:"規劃中",color:"info"},{value:"IN_PROGRESS",label:"進行中",color:"success"},{value:"COMPLETED",label:"已完成",color:"primary"},{value:"SUSPENDED",label:"暫停",color:"warning"}],U=()=>{I("update:show",!1),I("hide")},P=()=>{var l;o.value={name:"",workspaceId:((l=_.value[0])==null?void 0:l.id)||"",location:"",budget:"",status:"PLANNING",startDate:"",endDate:"",managerName:"",description:"",progress:0},s.value={}};F(()=>y.project,l=>{l?o.value={name:l.name,workspaceId:l.workspaceId,location:l.location,budget:l.budget,status:l.status,startDate:l.startDate,endDate:l.endDate,managerName:l.managerName,description:l.description,progress:l.progress}:P()},{immediate:!0}),F(()=>y.show,l=>{l&&(s.value={},!k.value&&_.value.length>0&&(c.currentWorkspace&&_.value.find(t=>{var i;return t.id===((i=c.currentWorkspace)==null?void 0:i.id)})?o.value.workspaceId=c.currentWorkspace.id:o.value.workspaceId=_.value[0].id))});const W=()=>{if(s.value={},o.value.name.trim()?o.value.name.trim().length<2?s.value.name="項目名稱至少需要2個字符":o.value.name.trim().length>50&&(s.value.name="項目名稱不能超過50個字符"):s.value.name="項目名稱不能為空",o.value.workspaceId||(s.value.workspaceId="請選擇工作空間"),o.value.location.trim()?o.value.location.trim().length>100&&(s.value.location="項目地點不能超過100個字符"):s.value.location="項目地點不能為空",!o.value.budget.trim())s.value.budget="項目預算不能為空";else{const l=parseFloat(o.value.budget);(isNaN(l)||l<=0)&&(s.value.budget="請輸入有效的預算金額")}return o.value.managerName.trim()?o.value.managerName.trim().length>20&&(s.value.managerName="項目負責人姓名不能超過20個字符"):s.value.managerName="項目負責人不能為空",o.value.startDate&&o.value.endDate&&new Date(o.value.startDate)>=new Date(o.value.endDate)&&(s.value.endDate="結束日期必須晚於開始日期"),o.value.description.trim().length>500&&(s.value.description="項目描述不能超過500個字符"),Object.keys(s.value).length===0},O=async()=>{if(W()){f.value=!0;try{const l={name:o.value.name.trim(),workspaceId:o.value.workspaceId,location:o.value.location.trim(),budget:o.value.budget.trim(),status:o.value.status,startDate:o.value.startDate,endDate:o.value.endDate,managerName:o.value.managerName.trim(),description:o.value.description.trim(),progress:o.value.progress};I("submit",l)}catch(l){console.error("Submit error:",l)}finally{f.value=!1}}},E=()=>{O()},v=l=>{s.value[l]&&delete s.value[l]};return(l,t)=>(d(),G(ee,{show:y.show,title:R.value,icon:"fa fa-project-diagram",size:"xl","modal-id":"projectFormModal","confirm-text":j.value,"confirm-icon":"fa fa-save","is-loading":f.value,"loading-text":"處理中...",onHide:U,onConfirm:E},{body:V(()=>[e("form",{onSubmit:Z(O,["prevent"])},[e("div",Ne,[e("div",Ie,[e("div",$e,[t[17]||(t[17]=e("label",{for:"projectName",class:"form-label"},[b(" 項目名稱 "),e("span",{class:"text-danger"},"*")],-1)),h(e("input",{id:"projectName",type:"text",class:N(["form-control",{"is-invalid":s.value.name}]),"onUpdate:modelValue":t[0]||(t[0]=i=>o.value.name=i),onInput:t[1]||(t[1]=i=>v("name")),placeholder:"請輸入項目名稱",maxlength:"50",disabled:f.value},null,42,we),[[w,o.value.name]]),s.value.name?(d(),r("div",De,m(s.value.name),1)):g("",!0),e("div",Ce,m(o.value.name.length)+"/50 字符",1)]),e("div",je,[t[19]||(t[19]=e("label",{for:"workspaceId",class:"form-label"},[b(" 所屬工作空間 "),e("span",{class:"text-danger"},"*")],-1)),h(e("select",{id:"workspaceId",class:N(["form-select",{"is-invalid":s.value.workspaceId}]),"onUpdate:modelValue":t[2]||(t[2]=i=>o.value.workspaceId=i),onChange:t[3]||(t[3]=i=>v("workspaceId")),disabled:f.value||k.value},[t[18]||(t[18]=e("option",{value:""},"請選擇工作空間",-1)),(d(!0),r(C,null,S(_.value,i=>(d(),r("option",{key:i.id,value:i.id},m(i.name),9,Ee))),128))],42,Me),[[z,o.value.workspaceId]]),s.value.workspaceId?(d(),r("div",Se,m(s.value.workspaceId),1)):g("",!0),k.value?(d(),r("div",Pe," 項目建立後無法更改所屬工作空間 ")):g("",!0)]),e("div",We,[t[20]||(t[20]=e("label",{for:"location",class:"form-label"},[b(" 項目地點 "),e("span",{class:"text-danger"},"*")],-1)),h(e("input",{id:"location",type:"text",class:N(["form-control",{"is-invalid":s.value.location}]),"onUpdate:modelValue":t[4]||(t[4]=i=>o.value.location=i),onInput:t[5]||(t[5]=i=>v("location")),placeholder:"請輸入項目地點",maxlength:"100",disabled:f.value},null,42,Oe),[[w,o.value.location]]),s.value.location?(d(),r("div",Ve,m(s.value.location),1)):g("",!0),e("div",Re,m(o.value.location.length)+"/100 字符",1)]),e("div",Ue,[t[22]||(t[22]=e("label",{for:"budget",class:"form-label"},[b(" 項目預算 "),e("span",{class:"text-danger"},"*")],-1)),e("div",Le,[t[21]||(t[21]=e("span",{class:"input-group-text"},"NT$",-1)),h(e("input",{id:"budget",type:"number",class:N(["form-control",{"is-invalid":s.value.budget}]),"onUpdate:modelValue":t[6]||(t[6]=i=>o.value.budget=i),onInput:t[7]||(t[7]=i=>v("budget")),placeholder:"請輸入預算金額",min:"0",step:"1000",disabled:f.value},null,42,Ae),[[w,o.value.budget]])]),s.value.budget?(d(),r("div",Fe,m(s.value.budget),1)):g("",!0)]),e("div",Ge,[t[23]||(t[23]=e("label",{for:"status",class:"form-label"},"項目狀態",-1)),h(e("select",{id:"status",class:"form-select","onUpdate:modelValue":t[8]||(t[8]=i=>o.value.status=i),disabled:f.value},[(d(),r(C,null,S(M,i=>e("option",{key:i.value,value:i.value},m(i.label),9,Be)),64))],8,Te),[[z,o.value.status]])])]),e("div",ze,[e("div",He,[t[24]||(t[24]=e("label",{for:"startDate",class:"form-label"},"開始日期",-1)),h(e("input",{id:"startDate",type:"date",class:"form-control","onUpdate:modelValue":t[9]||(t[9]=i=>o.value.startDate=i),disabled:f.value},null,8,Je),[[w,o.value.startDate]])]),e("div",qe,[t[25]||(t[25]=e("label",{for:"endDate",class:"form-label"},"結束日期",-1)),h(e("input",{id:"endDate",type:"date",class:N(["form-control",{"is-invalid":s.value.endDate}]),"onUpdate:modelValue":t[10]||(t[10]=i=>o.value.endDate=i),onInput:t[11]||(t[11]=i=>v("endDate")),disabled:f.value},null,42,Ke),[[w,o.value.endDate]]),s.value.endDate?(d(),r("div",Qe,m(s.value.endDate),1)):g("",!0)]),e("div",Xe,[t[26]||(t[26]=e("label",{for:"managerName",class:"form-label"},[b(" 項目負責人 "),e("span",{class:"text-danger"},"*")],-1)),h(e("input",{id:"managerName",type:"text",class:N(["form-control",{"is-invalid":s.value.managerName}]),"onUpdate:modelValue":t[12]||(t[12]=i=>o.value.managerName=i),onInput:t[13]||(t[13]=i=>v("managerName")),placeholder:"請輸入負責人姓名",maxlength:"20",disabled:f.value},null,42,Ye),[[w,o.value.managerName]]),s.value.managerName?(d(),r("div",Ze,m(s.value.managerName),1)):g("",!0),e("div",et,m(o.value.managerName.length)+"/20 字符",1)]),e("div",tt,[e("label",st,[t[27]||(t[27]=b(" 項目進度 ")),e("span",at,m(o.value.progress)+"%",1)]),h(e("input",{id:"progress",type:"range",class:"form-range","onUpdate:modelValue":t[14]||(t[14]=i=>o.value.progress=i),min:"0",max:"100",step:"5",disabled:f.value},null,8,ot),[[w,o.value.progress,void 0,{number:!0}]]),t[28]||(t[28]=e("div",{class:"d-flex justify-content-between small text-muted mt-1"},[e("span",null,"0%"),e("span",null,"50%"),e("span",null,"100%")],-1))]),e("div",lt,[t[29]||(t[29]=e("label",{for:"description",class:"form-label"},"項目描述",-1)),h(e("textarea",{id:"description",class:N(["form-control",{"is-invalid":s.value.description}]),"onUpdate:modelValue":t[15]||(t[15]=i=>o.value.description=i),onInput:t[16]||(t[16]=i=>v("description")),placeholder:"請輸入項目描述（選填）",rows:"4",maxlength:"500",disabled:f.value},null,42,nt),[[w,o.value.description]]),s.value.description?(d(),r("div",it,m(s.value.description),1)):g("",!0),e("div",dt,m(o.value.description.length)+"/500 字符",1)])])]),Object.keys(s.value).length>0?(d(),r("div",rt,[t[30]||(t[30]=e("i",{class:"fa fa-exclamation-triangle me-2"},null,-1)),t[31]||(t[31]=b(" 請修正以下錯誤： ")),e("ul",ut,[(d(!0),r(C,null,S(s.value,(i,T)=>(d(),r("li",{key:T},m(i),1))),128))])])):g("",!0)],32)]),_:1},8,["show","title","confirm-text","is-loading"]))}}),ct=J(mt,[["__scopeId","data-v-8c2b9ffc"]]),vt={class:"container-xxl"},pt={class:"row justify-content-center"},ft={class:"col-xl-12"},bt={class:"d-flex align-items-center justify-content-between mb-4"},gt=["disabled"],kt={key:0,class:"spinner-border spinner-border-sm me-2"},xt={key:1,class:"fa fa-refresh me-2"},yt={key:0,class:"text-center py-4"},_t={key:1,class:"text-center py-5"},ht={key:2,class:"workspace-hierarchy"},Nt={class:"workspace-list"},It={class:"workspace-header"},$t=["onClick"],wt={class:"workspace-name"},Dt={class:"workspace-description text-muted mb-2"},Ct={class:"workspace-meta"},jt={class:"badge border border-primary text-primary px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center me-2"},Mt={class:"badge border border-success text-success px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center me-2"},Et={class:"badge border border-info text-info px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center me-2"},St={class:"badge border border-teal text-teal px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center"},Pt={key:0,class:"workspace-actions"},Wt=["onClick"],Ot=["onClick"],Vt={key:0,class:"project-list"},Rt={class:"project-list-header"},Ut={class:"mb-2"},Lt=["onClick"],At={key:0,class:"text-center py-4"},Ft=["onClick"],Gt={key:1,class:"project-grid"},Tt={class:"project-header"},Bt={class:"project-name"},zt={key:0,class:"project-buttons"},Ht=["onClick"],Jt=["onClick"],qt={class:"project-status mb-2"},Kt={class:"project-info"},Qt={class:"text-muted small mb-1"},Xt={class:"text-muted small mb-1"},Yt={class:"text-muted small mb-2"},Zt={class:"progress mb-2",style:{height:"6px"}},es={class:"text-muted small"},ts=H({__name:"WorkspaceManagement",setup(L){const D=te(),y=$(new Set),I=$(!1),c=$(!1),o=$(!1),f=$(null),s=$(null),k=x(()=>[{id:"ws-001",name:"台北市政府工務局",description:"負責台北市各項公共工程建設管理",companyId:"comp-001",companyName:"台北市政府",ownerId:"user-001",ownerName:"張主任",memberCount:15,createdAt:"2024-01-15",isOwner:!0,role:"OWNER",projects:[{id:"proj-001",name:"台北市信義區道路拓寬工程",workspaceId:"ws-001",location:"台北市信義區信義路五段",budget:"8億元",status:"IN_PROGRESS",startDate:"2024-01-15",endDate:"2024-12-31",progress:65,managerName:"王工程師",description:"道路拓寬及人行道改善工程"},{id:"proj-002",name:"台北市大安區公園整建工程",workspaceId:"ws-001",location:"台北市大安區大安森林公園",budget:"5億元",status:"PLANNING",startDate:"2024-06-01",endDate:"2025-03-31",progress:15,managerName:"李主任",description:"公園設施更新及綠化工程"},{id:"proj-003",name:"台北市中山區橋樑維修工程",workspaceId:"ws-001",location:"台北市中山區中山橋",budget:"3億元",status:"COMPLETED",startDate:"2023-09-01",endDate:"2024-02-28",progress:100,managerName:"陳技師",description:"橋樑結構安全檢測及維修"}],projectCount:3,activeProjectCount:1,completedProjectCount:1},{id:"ws-002",name:"鴻泰建設工程股份有限公司",description:"專業建築工程承包商",companyId:"comp-002",companyName:"鴻泰建設股份有限公司",ownerId:"user-002",ownerName:"王總經理",memberCount:25,createdAt:"2024-02-01",isOwner:!1,role:"ADMIN",projects:[{id:"proj-004",name:"新北市板橋區住宅大樓新建工程",workspaceId:"ws-002",location:"新北市板橋區文化路一段",budget:"15億元",status:"IN_PROGRESS",startDate:"2024-03-01",endDate:"2026-06-30",progress:35,managerName:"林經理",description:"地上25層住宅大樓，含地下3層停車場"},{id:"proj-005",name:"三重重陽重劃區商辦大樓",workspaceId:"ws-002",location:"新北市三重區重陽路一段",budget:"25億元",status:"SUSPENDED",startDate:"2024-02-15",endDate:"2026-08-15",progress:45,managerName:"劉經理",description:"地上20層商辦大樓，含地下3層停車場"}],projectCount:2,activeProjectCount:1,completedProjectCount:0},{id:"ws-003",name:"新北市住宅發展處",description:"新北市社會住宅開發建設",companyId:"comp-003",companyName:"新北市政府",ownerId:"user-003",ownerName:"李處長",memberCount:10,createdAt:"2024-01-20",isOwner:!1,role:"MEMBER",projects:[{id:"proj-006",name:"中和秀峰段社會住宅新建工程",workspaceId:"ws-003",location:"新北市中和區秀峰段",budget:"15億元",status:"PLANNING",startDate:"2024-07-01",endDate:"2026-12-31",progress:5,managerName:"郭主任",description:"地上12層，共計250戶社會住宅"}],projectCount:1,activeProjectCount:0,completedProjectCount:0}]),R=n=>{y.value.has(n)?y.value.delete(n):y.value.add(n)},j=n=>y.value.has(n),_=n=>n.role==="OWNER"||n.role==="ADMIN",M=n=>n.role!=="VIEWER",U=(n,a)=>{a.stopPropagation(),console.log("編輯工作空間被點擊:",n),f.value={...n},c.value=!0,console.log("showWorkspaceModal.value:",c.value),console.log("editingWorkspace.value:",f.value)},P=()=>{c.value=!1,f.value=null},W=n=>{console.log("保存工作空間:",n),P()},O=(n,a)=>{a.stopPropagation(),window.confirm(`確定要刪除工作空間「${n.name}」嗎？此操作無法撤銷。`)&&console.log("刪除工作空間:",n.name)},E=(n,a)=>{a.stopPropagation(),s.value={...n},o.value=!0},v=()=>{o.value=!1,s.value=null},l=n=>{console.log("保存項目:",n),v()},t=(n,a)=>{a.stopPropagation(),window.confirm(`確定要刪除項目「${n.name}」嗎？此操作無法撤銷。`)&&console.log("刪除項目:",n.name)},i=(n,a)=>{a.stopPropagation(),console.log("新增項目到工作空間:",n.name)},T=async()=>{I.value=!0;try{await D.initWorkspaces()}catch(n){console.error("Failed to refresh data:",n)}finally{I.value=!1}},q=n=>({PLANNING:"info",IN_PROGRESS:"success",COMPLETED:"primary",SUSPENDED:"warning"})[n]||"secondary",se=n=>({PLANNING:"規劃中",IN_PROGRESS:"進行中",COMPLETED:"已完成",SUSPENDED:"暫停"})[n]||n;return x(()=>k.value.length),x(()=>k.value.filter(n=>n.role==="OWNER").length),x(()=>k.value.filter(n=>n.role==="ADMIN").length),x(()=>k.value.reduce((n,a)=>{var u;return n+(((u=a.projects)==null?void 0:u.length)||0)},0)),x(()=>k.value.reduce((n,a)=>{var u;return n+(((u=a.projects)==null?void 0:u.filter(p=>p.status==="IN_PROGRESS").length)||0)},0)),x(()=>k.value.reduce((n,a)=>{var u;return n+(((u=a.projects)==null?void 0:u.filter(p=>p.status==="COMPLETED").length)||0)},0)),Y(async()=>{console.log("WorkspaceManagement mounted"),await D.initWorkspaces(),console.log("Workspaces after init:",D.workspaces)}),(n,a)=>(d(),r(C,null,[e("div",vt,[e("div",pt,[e("div",ft,[e("div",bt,[a[3]||(a[3]=e("div",null,[e("h1",{class:"page-header-title"},[e("i",{class:"fa fa-sitemap me-3"}),b(" 工作空間與工程項目管理 ")]),e("p",{class:"text-muted mb-0"},"管理您的工作空間、工程項目")],-1)),e("button",{class:"btn btn-outline-theme",onClick:T,disabled:I.value},[I.value?(d(),r("span",kt)):(d(),r("i",xt)),a[2]||(a[2]=b(" 重新載入 "))],8,gt)]),K(D).isLoading?(d(),r("div",yt,a[4]||(a[4]=[e("div",{class:"spinner-border text-theme",role:"status"},[e("span",{class:"visually-hidden"},"載入中...")],-1),e("div",{class:"mt-2 text-muted"},"載入工作空間資料中...",-1)]))):k.value.length===0?(d(),r("div",_t,a[5]||(a[5]=[ae('<div class="mb-3" data-v-215b9c37><i class="fa fa-building fa-3x text-muted" data-v-215b9c37></i></div><h5 class="text-muted mb-2" data-v-215b9c37>尚未建立任何工作空間</h5><p class="text-muted mb-3" data-v-215b9c37>開始建立您的第一個工作空間</p><button class="btn btn-theme" data-v-215b9c37><i class="fa fa-plus me-2" data-v-215b9c37></i> 新增工作空間 </button>',4)]))):g("",!0),!K(D).isLoading&&k.value.length>0?(d(),r("div",ht,[e("div",Nt,[(d(!0),r(C,null,S(k.value,u=>(d(),G(X,{key:u.id,class:N(["workspace-item",{expanded:j(u.id)}])},{default:V(()=>[A(Q,null,{default:V(()=>[e("div",It,[e("div",{class:"workspace-info",onClick:p=>R(u.id)},[e("h5",wt,[a[6]||(a[6]=e("i",{class:"fa fa-building me-2"},null,-1)),b(" "+m(u.name)+" ",1),e("i",{class:N(["fa fa-chevron-down ms-2 expand-icon",{rotated:j(u.id)}])},null,2)]),e("p",Dt,m(u.description),1),e("div",Ct,[e("span",jt,[a[7]||(a[7]=e("i",{class:"fa fa-crown me-1"},null,-1)),b(" "+m(u.role),1)]),e("span",Mt,[a[8]||(a[8]=e("i",{class:"fa fa-project-diagram me-1"},null,-1)),b(" "+m(u.projectCount)+" 個項目 ",1)]),e("span",Et,[a[9]||(a[9]=e("i",{class:"fa fa-play me-1"},null,-1)),b(" "+m(u.activeProjectCount)+" 進行中 ",1)]),e("span",St,[a[10]||(a[10]=e("i",{class:"fa fa-check me-1"},null,-1)),b(" "+m(u.completedProjectCount)+" 已完成 ",1)])])],8,$t),_(u)?(d(),r("div",Pt,[e("button",{class:"btn btn-sm btn-outline-primary me-1",onClick:p=>U(u,p),title:"編輯工作空間"},a[11]||(a[11]=[e("i",{class:"fa fa-edit"},null,-1)]),8,Wt),e("button",{class:"btn btn-sm btn-outline-danger",onClick:p=>O(u,p),title:"刪除工作空間"},a[12]||(a[12]=[e("i",{class:"fa fa-trash"},null,-1)]),8,Ot)])):g("",!0)])]),_:2},1024),j(u.id)?(d(),r("div",Vt,[e("div",Rt,[e("h6",Ut,[a[13]||(a[13]=e("i",{class:"fa fa-project-diagram me-2"},null,-1)),b(" "+m(u.name)+" 的工程項目 ",1)]),M(u)?(d(),r("button",{key:0,class:"btn btn-sm btn-theme",onClick:p=>i(u,p)},a[14]||(a[14]=[e("i",{class:"fa fa-plus me-1"},null,-1),b(" 新增項目 ")]),8,Lt)):g("",!0)]),u.projects.length===0?(d(),r("div",At,[a[16]||(a[16]=e("i",{class:"fa fa-project-diagram fa-2x text-muted mb-2"},null,-1)),a[17]||(a[17]=e("p",{class:"text-muted"},"此工作空間尚未建立任何工程項目",-1)),M(u)?(d(),r("button",{key:0,class:"btn btn-theme btn-sm",onClick:p=>i(u,p)},a[15]||(a[15]=[e("i",{class:"fa fa-plus me-1"},null,-1),b(" 建立第一個項目 ")]),8,Ft)):g("",!0)])):(d(),r("div",Gt,[(d(!0),r(C,null,S(u.projects,p=>(d(),G(X,{key:p.id,class:"project-card"},{default:V(()=>[A(Q,null,{default:V(()=>[e("div",Tt,[e("h6",Bt,m(p.name),1),M(u)?(d(),r("div",zt,[e("button",{class:"btn btn-sm btn-outline-theme me-1",onClick:B=>E(p,B),title:"編輯項目"},a[18]||(a[18]=[e("i",{class:"fa fa-edit"},null,-1)]),8,Ht),e("button",{class:"btn btn-sm btn-outline-danger",onClick:B=>t(p,B),title:"刪除項目"},a[19]||(a[19]=[e("i",{class:"fa fa-trash"},null,-1)]),8,Jt)])):g("",!0)]),e("div",qt,[e("span",{class:N(["badge border px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center",`border-${q(p.status)} text-${q(p.status)}`])},m(se(p.status)),3)]),e("div",Kt,[e("div",Qt,[a[20]||(a[20]=e("i",{class:"fa fa-map-marker-alt me-1"},null,-1)),b(" "+m(p.location),1)]),e("div",Xt,[a[21]||(a[21]=e("i",{class:"fa fa-calendar me-1"},null,-1)),b(" "+m(p.startDate)+" - "+m(p.endDate),1)]),e("div",Yt,[a[22]||(a[22]=e("i",{class:"fa fa-dollar-sign me-1"},null,-1)),b(" "+m(p.budget),1)]),e("div",Zt,[e("div",{class:"progress-bar",style:oe({width:p.progress+"%"})},null,4)]),e("div",es," 進度："+m(p.progress)+"% ",1)])]),_:2},1024)]),_:2},1024))),128))]))])):g("",!0)]),_:2},1032,["class"]))),128))])])):g("",!0)])])]),A(he,{show:c.value,"onUpdate:show":a[0]||(a[0]=u=>c.value=u),workspace:f.value,onHide:P,onSubmit:W},null,8,["show","workspace"]),A(ct,{show:o.value,"onUpdate:show":a[1]||(a[1]=u=>o.value=u),project:s.value,onHide:v,onSubmit:l},null,8,["show","project"])],64))}}),os=J(ts,[["__scopeId","data-v-215b9c37"]]);export{os as default};
