import{d as K,r as u,C as j,o as Y,f as d,g as r,h as e,t as l,k as b,n as o,p as i,F as S,G as h,H as z,I as D,J as g,z as $,i as F,w as G,j as M,v as J,l as V,N as Q,_ as Z}from"./index-D_u9nkte.js";import{u as ee}from"./project-Dnhvz_sQ.js";import{b as O,d as P,a as se,h as X}from"./forms-CS0xek5A.js";const te={class:"container-xxl"},le={class:"row justify-content-center"},ae={class:"col-xl-12"},oe={class:"d-flex align-items-center mb-3"},ie={class:"breadcrumb"},ne={class:"breadcrumb-item active"},de={class:"page-header mb-0"},re={class:"row"},ce={class:"col-lg-4 mb-4"},me={class:"mb-3"},ue={class:"d-flex align-items-center mb-2"},fe={class:"badge border border-primary text-primary px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center me-2"},ve={class:"badge border border-secondary text-secondary px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center"},_e={class:"mb-2"},pe={class:"text-muted small mb-3"},be={class:"mb-3"},he={class:"row text-center"},ge={class:"col-6"},xe={class:"border rounded p-2"},we={class:"fw-bold"},ye={class:"col-6"},ke={class:"border rounded p-2"},Ce={class:"fw-bold small"},Se={class:"small"},je={class:"col-lg-8 mb-4"},ze={class:"row"},De={class:"d-flex align-items-start mb-3"},Me={class:"flex-grow-1"},Be={class:"d-flex align-items-center mb-2"},Te={class:"mb-0 me-2"},Ne={key:0,class:"fa fa-check-circle text-success"},Ue={class:"text-muted small mb-2"},Ae={class:"mb-2"},Ie={class:"d-flex justify-content-between align-items-center mb-1"},$e={class:"badge border border-secondary text-secondary px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center"},Fe={class:"text-muted"},Ve={class:"small text-muted"},Oe={class:"small text-muted"},Pe=["onClick"],Xe={class:"row"},Ee={class:"col-lg-8 mb-4"},qe={class:"row"},Re={class:"col-lg-6"},We={class:"mb-3"},Le={class:"form-text small"},He={class:"col-lg-6"},Ke={class:"mb-3"},Ye={class:"form-check mb-2"},Ge={class:"form-check"},Je={class:"d-flex justify-content-between align-items-center mt-3 pt-3 border-top"},Qe={class:"text-muted"},Ze={key:0},es={key:1},ss=["disabled"],ts={key:0,class:"mt-3"},ls={class:"d-flex justify-content-between align-items-center mb-2"},as={class:"small"},os={class:"progress"},is={class:"col-lg-4 mb-4"},ns={key:0,class:"text-center py-3"},ds={key:1},rs={class:"d-flex justify-content-between align-items-start mb-2"},cs={class:"mb-1 small"},ms=["onClick"],us={class:"text-muted small mb-1"},fs={class:"d-flex justify-content-between"},vs={class:"text-muted"},_s={class:"text-muted"},ps=K({__name:"FormA7Download",setup(bs){const B=ee();u(!1);const m=u(!1),f=u(0),x=u("standard"),k=u(""),T=u(!1),N=u(!0),c={code:"A-7",name:"勞安報備書",description:"勞安報備書是確保工程安全衛生符合法規要求的重要文件，包含安全衛生計畫、危害評估、防護措施等內容。",category:"A類表單",version:"v2.1",lastUpdate:"2024-01-20",requiredFields:["安全衛生政策","危害辨識與評估","安全衛生組織","安全衛生教育訓練","個人防護設備","緊急應變計畫","安全衛生檢查","事故調查與改善"]},U=[{id:"taipei",name:"台北市政府建管處版本",description:"台北市建築管理工程處核定的勞安報備書格式",fileSize:"1.2 MB",format:"DOCX",preview:"/assets/img/forms/a7-taipei-preview.jpg",authority:"台北市政府建管處",lastUpdate:"2024-01-15"},{id:"newtaipei",name:"新北市政府工務局版本",description:"新北市政府工務局核定的勞安報備書格式",fileSize:"1.1 MB",format:"DOCX",preview:"/assets/img/forms/a7-newtaipei-preview.jpg",authority:"新北市政府工務局",lastUpdate:"2024-01-10"},{id:"taoyuan",name:"桃園市政府建管處版本",description:"桃園市政府建築管理處核定的勞安報備書格式",fileSize:"1.3 MB",format:"DOCX",preview:"/assets/img/forms/a7-taoyuan-preview.jpg",authority:"桃園市政府建管處",lastUpdate:"2024-01-20"},{id:"taichung",name:"台中市政府都發局版本",description:"台中市政府都市發展局核定的勞安報備書格式",fileSize:"1.0 MB",format:"DOCX",preview:"/assets/img/forms/a7-taichung-preview.jpg",authority:"台中市政府都發局",lastUpdate:"2024-01-12"},{id:"tainan",name:"台南市政府工務局版本",description:"台南市政府工務局核定的勞安報備書格式",fileSize:"1.4 MB",format:"DOCX",preview:"/assets/img/forms/a7-tainan-preview.jpg",authority:"台南市政府工務局",lastUpdate:"2024-01-18"},{id:"kaohsiung",name:"高雄市政府工務局版本",description:"高雄市政府工務局核定的勞安報備書格式",fileSize:"1.2 MB",format:"DOCX",preview:"/assets/img/forms/a7-kaohsiung-preview.jpg",authority:"高雄市政府工務局",lastUpdate:"2024-01-22"}],v=u([{id:1,fileName:"A-7_勞安報備書_台北市政府建管處版本_2024-01-20.docx",template:"台北市政府建管處版本",downloadTime:"2024-01-20 16:45:12",fileSize:"1.2 MB"},{id:2,fileName:"A-7_勞安報備書_新北市政府工務局版本_2024-01-18.docx",template:"新北市政府工務局版本",downloadTime:"2024-01-18 11:20:35",fileSize:"1.1 MB"}]),p=j(()=>U.find(a=>a.id===x.value)),A=j(()=>x.value&&!m.value),I=j(()=>{var n;if(k.value.trim())return k.value.trim();const s=new Date().toISOString().split("T")[0];return`A-7_勞安報備書_${((n=p.value)==null?void 0:n.name)||"台北市政府建管處版本"}_${s}`}),E=a=>{x.value=a},q=async()=>{var s,t,n;if(!A.value||m.value)return;console.log("開始下載流程，防止重複調用"),m.value=!0,f.value=0;let a=null;try{const y={constructionId:((s=B.currentProject)==null?void 0:s.constructionId)||"CTq3CMSVeDUuBYCEM2KRkjl40DSjTnPf"};a=setInterval(()=>{f.value<90&&(f.value+=Math.random()*10)},200),console.log("發送 A-7 下載請求，參數:",y);const _=await O.downloadReport(y);console.log("收到 blob 回應:",{size:_.size,type:_.type,isBlob:_ instanceof Blob}),f.value=100,a&&(clearInterval(a),a=null);const L=((t=p.value)==null?void 0:t.format.toLowerCase())||"docx",C=`${I.value}.${L}`;console.log("準備下載檔案:",C),P(_,C),console.log("下載函數已執行");const H={id:v.value.length+1,fileName:C,template:((n=p.value)==null?void 0:n.name)||"",downloadTime:new Date().toLocaleString("zh-TW"),fileSize:se(_.size)};v.value.unshift(H),v.value.length>10&&(v.value=v.value.slice(0,10)),w("下載成功！",`${C} 已開始下載`,"success")}catch(y){console.error("下載失敗:",y);const _=X(y);w("下載失敗",_,"error")}finally{a&&clearInterval(a),m.value=!1,f.value=0}},w=(a,s,t="success")=>{console.log(`${t}: ${a} - ${s}`)},R=a=>{w("預覽功能",`正在載入 ${a.name} 的預覽...`,"success")},W=async a=>{var s;try{m.value=!0;const t={constructionId:((s=B.currentProject)==null?void 0:s.constructionId)||"CTq3CMSVeDUuBYCEM2KRkjl40DSjTnPf"},n=await O.downloadReport(t);P(n,a.fileName),w("重新下載成功",`${a.fileName} 已開始下載`,"success")}catch(t){const n=X(t);w("重新下載失敗",n,"error")}finally{m.value=!1}};return Y(()=>{}),(a,s)=>(r(),d("div",te,[e("div",le,[e("div",ae,[e("div",oe,[e("div",null,[e("ol",ie,[s[3]||(s[3]=e("li",{class:"breadcrumb-item"},[e("a",{href:"javascript:;"},"表單生成與管理")],-1)),s[4]||(s[4]=e("li",{class:"breadcrumb-item"},[e("a",{href:"javascript:;"},"A類表單")],-1)),e("li",ne,l(c.code)+" "+l(c.name),1)]),e("h1",de,[s[5]||(s[5]=e("i",{class:"fa fa-shield-alt me-3"},null,-1)),b(" "+l(c.code)+" - "+l(c.name),1)])])]),e("div",re,[e("div",ce,[o(g,{class:"h-100"},{default:i(()=>[o(S,null,{default:i(()=>s[6]||(s[6]=[e("div",{class:"d-flex align-items-center"},[e("i",{class:"fa fa-info-circle me-2"}),e("h5",{class:"mb-0"},"表單資訊")],-1)])),_:1,__:[6]}),o(h,null,{default:i(()=>[e("div",me,[e("div",ue,[e("span",fe,l(c.code),1),e("span",ve,l(c.category),1)]),e("h6",_e,l(c.name),1),e("p",pe,l(c.description),1)]),e("div",be,[e("div",he,[e("div",ge,[e("div",xe,[s[7]||(s[7]=e("div",{class:"text-muted small"},"版本",-1)),e("div",we,l(c.version),1)])]),e("div",ye,[e("div",ke,[s[8]||(s[8]=e("div",{class:"text-muted small"},"更新日期",-1)),e("div",Ce,l(c.lastUpdate),1)])])])]),e("div",null,[s[10]||(s[10]=e("h6",{class:"mb-2"},"必填欄位",-1)),e("div",Se,[(r(!0),d(z,null,D(c.requiredFields,t=>(r(),d("div",{key:t,class:"d-flex align-items-center mb-1"},[s[9]||(s[9]=e("i",{class:"fa fa-check-circle text-success me-2"},null,-1)),b(" "+l(t),1)]))),128))])])]),_:1})]),_:1})]),e("div",je,[o(g,{class:"h-100"},{default:i(()=>[o(S,null,{default:i(()=>s[11]||(s[11]=[e("div",{class:"d-flex align-items-center"},[e("i",{class:"fa fa-layer-group me-2"}),e("h5",{class:"mb-0"},"選擇模板")],-1)])),_:1,__:[11]}),o(h,null,{default:i(()=>[e("div",ze,[(r(),d(z,null,D(U,t=>e("div",{key:t.id,class:"col-lg-4 mb-3"},[o(g,{class:$(["h-100 cursor-pointer template-card",{"border-theme":x.value===t.id}]),onClick:n=>E(t.id)},{default:i(()=>[o(h,{class:"p-3"},{default:i(()=>[e("div",De,[e("div",Me,[e("div",Be,[e("h6",Te,l(t.name),1),x.value===t.id?(r(),d("i",Ne)):F("",!0)]),e("p",Ue,l(t.description),1)])]),e("div",Ae,[e("div",Ie,[e("span",$e,l(t.format),1),e("small",Fe,l(t.fileSize),1)]),e("div",Ve,[s[12]||(s[12]=e("i",{class:"fa fa-building me-1"},null,-1)),b(" "+l(t.authority),1)]),e("div",Oe,[s[13]||(s[13]=e("i",{class:"fa fa-calendar me-1"},null,-1)),b(" 更新："+l(t.lastUpdate),1)])]),e("button",{class:"btn btn-outline-theme btn-sm w-100",onClick:G(n=>R(t),["stop"])},s[14]||(s[14]=[e("i",{class:"fa fa-eye me-1"},null,-1),b(" 預覽模板 ")]),8,Pe)]),_:2},1024)]),_:2},1032,["class","onClick"])])),64))])]),_:1})]),_:1})])]),e("div",Xe,[e("div",Ee,[o(g,null,{default:i(()=>[o(S,null,{default:i(()=>s[15]||(s[15]=[e("div",{class:"d-flex align-items-center"},[e("i",{class:"fa fa-cog me-2"}),e("h5",{class:"mb-0"},"下載設定")],-1)])),_:1,__:[15]}),o(h,null,{default:i(()=>[e("div",qe,[e("div",Re,[e("div",We,[s[16]||(s[16]=e("label",{class:"form-label"},"自訂檔案名稱",-1)),M(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[0]||(s[0]=t=>k.value=t),placeholder:"留空則使用預設名稱"},null,512),[[J,k.value]]),e("div",Le," 預設名稱："+l(I.value),1)])]),e("div",He,[e("div",Ke,[s[19]||(s[19]=e("label",{class:"form-label"},"附加選項",-1)),e("div",Ye,[M(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":s[1]||(s[1]=t=>T.value=t),id:"includeWatermark"},null,512),[[V,T.value]]),s[17]||(s[17]=e("label",{class:"form-check-label small",for:"includeWatermark"}," 包含浮水印 ",-1))]),e("div",Ge,[M(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":s[2]||(s[2]=t=>N.value=t),id:"includeSignature"},null,512),[[V,N.value]]),s[18]||(s[18]=e("label",{class:"form-check-label small",for:"includeSignature"}," 包含簽名欄位 ",-1))])])])]),e("div",Je,[e("div",Qe,[s[20]||(s[20]=e("i",{class:"fa fa-info-circle me-1"},null,-1)),p.value?(r(),d("span",Ze," 已選擇："+l(p.value.name)+" ("+l(p.value.fileSize)+") ",1)):(r(),d("span",es,"請選擇模板"))]),e("button",{class:"btn btn-theme btn-lg",onClick:q,disabled:!A.value},[e("i",{class:$(["fa me-2",{"fa-spin fa-spinner":m.value,"fa-download":!m.value}])},null,2),b(" "+l(m.value?"處理中...":"下載表單"),1)],8,ss)]),m.value?(r(),d("div",ts,[e("div",ls,[s[21]||(s[21]=e("span",{class:"small"},"正在生成文件...",-1)),e("span",as,l(Math.round(f.value))+"%",1)]),e("div",os,[e("div",{class:"progress-bar progress-bar-striped progress-bar-animated",style:Q({width:f.value+"%"})},null,4)])])):F("",!0)]),_:1})]),_:1})]),e("div",is,[o(g,null,{default:i(()=>[o(S,null,{default:i(()=>s[22]||(s[22]=[e("div",{class:"d-flex align-items-center"},[e("i",{class:"fa fa-history me-2"}),e("h5",{class:"mb-0"},"最近下載")],-1)])),_:1,__:[22]}),o(h,null,{default:i(()=>[v.value.length===0?(r(),d("div",ns,s[23]||(s[23]=[e("i",{class:"fa fa-download fa-2x text-muted mb-2"},null,-1),e("p",{class:"text-muted small mb-0"},"尚無下載記錄",-1)]))):(r(),d("div",ds,[(r(!0),d(z,null,D(v.value,t=>(r(),d("div",{key:t.id,class:"mb-3"},[o(g,{class:"download-item"},{default:i(()=>[o(h,{class:"p-3"},{default:i(()=>[e("div",rs,[e("h6",cs,l(t.template),1),e("button",{class:"btn btn-outline-theme btn-sm",onClick:n=>W(t)},s[24]||(s[24]=[e("i",{class:"fa fa-download"},null,-1)]),8,ms)]),e("p",us,l(t.fileName),1),e("div",fs,[e("small",vs,l(t.downloadTime),1),e("small",_s,l(t.fileSize),1)])]),_:2},1024)]),_:2},1024)]))),128))]))]),_:1})]),_:1})])])])])]))}}),ws=Z(ps,[["__scopeId","data-v-597a6d57"]]);export{ws as default};
