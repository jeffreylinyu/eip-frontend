import{d as w,s as h,r as t,x,o as S,e as j,y as F,f,g as v,c as N,h as r,n as k,i as D,k as d,z as V,t as B,F as C,A as J,_ as O}from"./index-0fEq5Ai7.js";import{_ as P}from"./ProjectForm.vue_vue_type_script_setup_true_lang-D6H6gZRS.js";const $={class:"row gx-4"},R={class:"col-lg-12"},U={class:"d-flex justify-content-end gap-2"},E=["disabled"],L=["disabled"],T={key:0,class:"alert alert-warning mt-3",role:"alert"},z=w({__name:"BasicData",setup(I){const{proxy:c}=h(),o=t({project_name:"",contract_number:"",project_location:"",host_agency:"",supervision_unit:"",contractor_name:"",construction_period:"",project_amount:"",project_grade:"",project_category:"",funding_source:"",start_date:"",completion_date:"",payment_method:"",advance_payment_ratio:"",retention_ratio:"",inspection_methods:[],insurance_policy_number:"",insurance_company:"",insurance_start_date:"",insurance_end_date:"",insurance_type:""}),u=t({}),s=t(!1),n=t(!1);t(""),t([{text:"土木工程"},{text:"建築工程"}]),t(""),t([{text:"甲等"},{text:"乙等"}]),t(""),t([{text:"交通部"}]),t(""),t([]),t([{text:"道路工程"},{text:"橋梁工程"},{text:"隧道工程"}]);const l=t(null);x(o,()=>{J(()=>{_()})},{deep:!0});const _=()=>{const e=JSON.stringify(o.value)!==JSON.stringify(u.value);n.value!==e&&(n.value=e)},m=e=>{if(n.value)return e.preventDefault(),e.returnValue="您有未保存的變更，確定要離開嗎？","您有未保存的變更，確定要離開嗎？"},p=async()=>{var e,a;console.log("🚀 開始保存表單..."),console.log("📊 BasicData formData:",o.value),l.value?(console.log("📋 觸發 ProjectForm 的提交方法..."),console.log("🔍 ProjectForm 驗證狀態:",(a=(e=l.value.validation)==null?void 0:e.errors)==null?void 0:a.value),await l.value.handleSubmit()):(console.error("❌ 無法找到 ProjectForm 組件引用"),c.$toast.error("表單組件未正確載入，請重新整理頁面"))},b=async e=>{console.log("📤 接收到 ProjectForm 提交的數據:",e),s.value=!0;try{await g(e),u.value=JSON.parse(JSON.stringify(o.value)),n.value=!1,c.$toast.success("工程資料保存成功！")}catch(a){console.error("保存失敗:",a),c.$toast.error("保存失敗，請重試！")}finally{s.value=!1}},g=async e=>{await new Promise(a=>setTimeout(a,1e3)),console.log("提交表單數據:",e||o.value)},y=()=>{n.value&&!window.confirm("確定要重置表單嗎？所有未保存的變更將會丟失。")||(o.value=JSON.parse(JSON.stringify(u.value)),n.value=!1,l.value&&l.value.handleReset(),c.$toast.info("表單已重置"))};return S(()=>{u.value=JSON.parse(JSON.stringify(o.value)),window.addEventListener("beforeunload",m)}),j(()=>{window.removeEventListener("beforeunload",m)}),F((e,a,i)=>{n.value?window.confirm("您有未保存的變更，確定要離開嗎？")?i():i(!1):i()}),(e,a)=>(v(),f(C,null,[a[3]||(a[3]=N('<div class="d-flex align-items-center mb-3" data-v-d8f1356c><div data-v-d8f1356c><ol class="breadcrumb" data-v-d8f1356c><li class="breadcrumb-item" data-v-d8f1356c><a href="javascript:;" data-v-d8f1356c>表單生成與管理</a></li><li class="breadcrumb-item active" data-v-d8f1356c>基本資料維護</li></ol><h1 class="page-header mb-0" data-v-d8f1356c>基本資料維護</h1></div></div>',1)),r("div",$,[r("div",R,[k(P,{ref_key:"projectFormRef",ref:l,class:"mb-4",modelValue:o.value,"onUpdate:modelValue":a[0]||(a[0]=i=>o.value=i),"is-submitting":s.value,"show-submit-button":!1,"show-reset-button":!1,onSubmit:b},null,8,["modelValue","is-submitting"]),r("div",U,[r("button",{type:"button",class:"btn btn-outline-secondary",onClick:y,disabled:s.value},a[1]||(a[1]=[r("i",{class:"fa fa-undo me-1"},null,-1),d(" 重置 ")]),8,E),r("button",{type:"button",class:"btn btn-theme",onClick:p,disabled:s.value},[r("i",{class:V(["fa me-1",{"fa-spin fa-spinner":s.value,"fa-save":!s.value}])},null,2),d(" "+B(s.value?"處理中...":"保存"),1)],8,L)]),n.value?(v(),f("div",T,a[2]||(a[2]=[r("i",{class:"fa fa-exclamation-triangle me-2"},null,-1),d(" 您有未保存的變更 ")]))):D("",!0)])])],64))}}),q=O(z,[["__scopeId","data-v-d8f1356c"]]);export{q as default};
