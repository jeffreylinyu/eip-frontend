import{P as Q,r as m,I as x,d as X,u as Z,o as ee,f as b,g,h as e,n as T,i as S,k,p as C,K as $,j as y,v as I,E as q,L as H,J as te,t as v,l as N,F as z,D as W,z as V,_ as le}from"./index-0fEq5Ai7.js";const se=Q("dailyReport",()=>{const u=m(null),n=m(!1),r=m(null),p=m([]),i=x(()=>!1),R=x(()=>u.value?u.value.status==="DRAFT"&&u.value.basicInfo.projectName.trim()!=="":!1),h=x(()=>{var a;return((a=u.value)==null?void 0:a.materials.length)||0}),d=x(()=>u.value?u.value.laborRecords.reduce((a,o)=>a+(o.morning||0)+(o.afternoon||0)+(o.night||0),0):0),w=x(()=>u.value?u.value.equipmentRecords.reduce((a,o)=>a+(o.todayUsage||0),0):0);return{currentReport:u,isLoading:n,error:r,reportHistory:p,hasUnsavedChanges:i,canSubmit:R,totalMaterials:h,totalLabor:d,totalEquipment:w,createNewReport:(a,o)=>{u.value={projectId:a,reportDate:o,status:"DRAFT",basicInfo:{projectName:"",contractPeriod:0,cumulativePeriod:0,todayPeriod:0,todayLaborCount:0,todayEquipmentCount:0,todayMaterialInbound:0},weather:{morning:"",afternoon:""},materials:[],laborRecords:[],equipmentRecords:[],incomingRecords:[],materialInspections:[],safetyRecords:[],constructionRecords:[],importantNotes:[],tomorrowPlans:[],preparer:{reportingDepartment:"",supervisingDepartment:"",reviewer:"",associateManager:"",manager:"",siteManager:"",generalManager:""}}},loadReport:async a=>{n.value=!0,r.value=null;try{console.log("載入日報表:",a),await new Promise(o=>setTimeout(o,1e3))}catch(o){r.value="載入日報表失敗",console.error("載入日報表失敗:",o)}finally{n.value=!1}},saveDraft:async()=>{if(u.value){n.value=!0,r.value=null;try{console.log("儲存草稿:",u.value),await new Promise(a=>setTimeout(a,1e3))}catch(a){r.value="儲存草稿失敗",console.error("儲存草稿失敗:",a)}finally{n.value=!1}}},submitReport:async()=>{if(!(!u.value||!R.value)){n.value=!0,r.value=null;try{console.log("送出審核:",u.value),await new Promise(a=>setTimeout(a,1e3)),u.value.status="SUBMITTED"}catch(a){r.value="送出審核失敗",console.error("送出審核失敗:",a)}finally{n.value=!1}}},copyFromYesterday:async()=>{if(u.value){n.value=!0,r.value=null;try{console.log("複製昨天的資料"),await new Promise(a=>setTimeout(a,1e3))}catch(a){r.value="複製昨天資料失敗",console.error("複製昨天資料失敗:",a)}finally{n.value=!1}}},loadReportHistory:async(a,o,M)=>{n.value=!0,r.value=null;try{console.log("載入日報表歷史:",{projectId:a,startDate:o,endDate:M}),await new Promise(D=>setTimeout(D,1e3))}catch(D){r.value="載入歷史記錄失敗",console.error("載入歷史記錄失敗:",D)}finally{n.value=!1}},exportToExcel:async a=>{n.value=!0,r.value=null;try{console.log("匯出 Excel:",a),await new Promise(o=>setTimeout(o,2e3))}catch(o){r.value="匯出 Excel 失敗",console.error("匯出 Excel 失敗:",o)}finally{n.value=!1}},importFromExcel:async a=>{n.value=!0,r.value=null;try{console.log("匯入 Excel:",a.name),await new Promise(o=>setTimeout(o,2e3))}catch(o){r.value="匯入 Excel 失敗",console.error("匯入 Excel 失敗:",o)}finally{n.value=!1}},clearError:()=>{r.value=null},reset:()=>{u.value=null,n.value=!1,r.value=null,p.value=[]}}}),ae={class:"daily-report-history"},oe={class:"d-flex justify-content-between align-items-center mb-4"},ne={class:"d-flex gap-2"},re=["disabled"],ue={class:"row"},ie={class:"col-md-3 mb-3"},de={class:"col-md-2 mb-3"},ce={class:"col-md-2 mb-3"},ve={class:"col-md-2 mb-3"},me={class:"col-md-3 mb-3 d-flex align-items-end"},pe={class:"d-flex gap-2 w-100"},fe=["disabled"],be={class:"d-flex justify-content-between align-items-center"},ge={class:"d-flex align-items-center gap-2"},ye={class:"text-muted fs-sm"},xe={class:"form-check"},Re={class:"table-responsive"},De={class:"table table-hover"},Ee={class:"table-light"},we={style:{width:"40px"}},Te=["value"],ke={class:"fw-bold"},Ce={class:"text-muted"},he={class:"badge bg-primary"},Pe={class:"badge bg-success"},Me={class:"badge bg-warning"},Ve={class:"btn-group btn-group-sm"},Se=["onClick"],Ie=["onClick"],Ne=["onClick"],Ue={key:0},Ae={class:"d-flex justify-content-between align-items-center mt-4"},Fe={class:"d-flex align-items-center gap-2"},je={class:"pagination pagination-sm mb-0"},Be=["onClick"],Le={key:0,class:"loading-overlay"},_e=X({__name:"DailyReportHistory",setup(u){const n=Z(),r=se(),p=m([]),i=m([]),R=m(!1),h=m(0),d=m(1),w=m(20),c=m({projectName:"",startDate:"",endDate:"",status:""}),E=x({get:()=>i.value.length===p.value.length&&p.value.length>0,set:s=>{s?i.value=p.value.map(t=>t.id).filter(Boolean):i.value=[]}}),P=x(()=>Math.ceil(h.value/w.value)),U=x(()=>{const s=[],t=Math.max(1,d.value-2),l=Math.min(P.value,d.value+2);for(let f=t;f<=l;f++)s.push(f);return s}),A=s=>new Date(s).toLocaleDateString("zh-TW"),F=s=>s?new Date(s).toLocaleString("zh-TW"):"-",j=s=>({DRAFT:"bg-secondary",SUBMITTED:"bg-primary",REVIEWED:"bg-warning",APPROVED:"bg-success",REJECTED:"bg-danger"})[s]||"bg-secondary",B=s=>({DRAFT:"草稿",SUBMITTED:"已送出",REVIEWED:"審核中",APPROVED:"已核准",REJECTED:"已退回"})[s]||"未知",L=s=>s.laborRecords.reduce((t,l)=>t+(l.morning||0)+(l.afternoon||0)+(l.night||0),0),_=s=>s.equipmentRecords.reduce((t,l)=>t+(l.todayUsage||0),0),a=async()=>{R.value=!0;try{console.log("搜尋日報表:",c.value),await new Promise(s=>setTimeout(s,1e3))}catch(s){console.error("搜尋失敗:",s)}finally{R.value=!1}},o=()=>{c.value={projectName:"",startDate:"",endDate:"",status:""},d.value=1,a()},M=()=>{E.value?i.value=p.value.map(s=>s.id).filter(Boolean):i.value=[]},D=s=>{s>=1&&s<=P.value&&(d.value=s,a())},J=()=>{n.push("/daily-report")},O=s=>{n.push(`/daily-report/view/${s}`)},Y=s=>{n.push(`/daily-report/edit/${s}`)},K=async s=>{try{await r.exportToExcel(s)}catch(t){console.error("匯出失敗:",t)}},G=async()=>{if(i.value.length!==0)try{console.log("批次匯出:",i.value)}catch(s){console.error("批次匯出失敗:",s)}};return ee(()=>{a()}),(s,t)=>(g(),b("div",ae,[e("div",oe,[t[12]||(t[12]=e("div",null,[e("h4",{class:"mb-1"},"日報表歷史記錄"),e("p",{class:"text-muted mb-0"},"瀏覽和管理歷史日報表")],-1)),e("div",ne,[e("button",{class:"btn btn-outline-primary",onClick:J},t[10]||(t[10]=[e("i",{class:"fa fa-plus me-1"},null,-1),k("新增日報表 ")])),e("button",{class:"btn btn-outline-success",onClick:G,disabled:i.value.length===0},t[11]||(t[11]=[e("i",{class:"fa fa-download me-1"},null,-1),k("匯出選取 ")]),8,re)])]),T(H,{class:"mb-4"},{default:C(()=>[T($,null,{default:C(()=>[e("div",ue,[e("div",ie,[t[13]||(t[13]=e("label",{class:"form-label"},"工程名稱",-1)),y(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=l=>c.value.projectName=l),placeholder:"搜尋工程名稱"},null,512),[[I,c.value.projectName]])]),e("div",de,[t[14]||(t[14]=e("label",{class:"form-label"},"開始日期",-1)),y(e("input",{type:"date",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=l=>c.value.startDate=l)},null,512),[[I,c.value.startDate]])]),e("div",ce,[t[15]||(t[15]=e("label",{class:"form-label"},"結束日期",-1)),y(e("input",{type:"date",class:"form-control","onUpdate:modelValue":t[2]||(t[2]=l=>c.value.endDate=l)},null,512),[[I,c.value.endDate]])]),e("div",ve,[t[17]||(t[17]=e("label",{class:"form-label"},"狀態",-1)),y(e("select",{class:"form-select","onUpdate:modelValue":t[3]||(t[3]=l=>c.value.status=l)},t[16]||(t[16]=[e("option",{value:""},"全部狀態",-1),e("option",{value:"DRAFT"},"草稿",-1),e("option",{value:"SUBMITTED"},"已送出",-1),e("option",{value:"REVIEWED"},"審核中",-1),e("option",{value:"APPROVED"},"已核准",-1),e("option",{value:"REJECTED"},"已退回",-1)]),512),[[q,c.value.status]])]),e("div",me,[e("div",pe,[e("button",{class:"btn btn-primary flex-fill",onClick:a,disabled:R.value},t[18]||(t[18]=[e("i",{class:"fa fa-search me-1"},null,-1),k("搜尋 ")]),8,fe),e("button",{class:"btn btn-outline-secondary",onClick:o},t[19]||(t[19]=[e("i",{class:"fa fa-times me-1"},null,-1),k("清除 ")]))])])])]),_:1})]),_:1}),T(H,null,{default:C(()=>[T(te,null,{default:C(()=>[e("div",be,[t[21]||(t[21]=e("h6",{class:"mb-0"},[e("i",{class:"fa fa-list me-2"}),k("日報表列表 ")],-1)),e("div",ge,[e("span",ye,"共 "+v(h.value)+" 筆記錄",1),e("div",xe,[y(e("input",{class:"form-check-input",type:"checkbox",id:"selectAll","onUpdate:modelValue":t[4]||(t[4]=l=>E.value=l),onChange:M},null,544),[[N,E.value]]),t[20]||(t[20]=e("label",{class:"form-check-label fs-sm",for:"selectAll"}," 全選 ",-1))])])])]),_:1}),T($,null,{default:C(()=>[e("div",Re,[e("table",De,[e("thead",Ee,[e("tr",null,[e("th",we,[y(e("input",{type:"checkbox",class:"form-check-input","onUpdate:modelValue":t[5]||(t[5]=l=>E.value=l),onChange:M},null,544),[[N,E.value]])]),t[22]||(t[22]=e("th",null,"工程名稱",-1)),t[23]||(t[23]=e("th",null,"日期",-1)),t[24]||(t[24]=e("th",null,"狀態",-1)),t[25]||(t[25]=e("th",null,"材料種類",-1)),t[26]||(t[26]=e("th",null,"出工人數",-1)),t[27]||(t[27]=e("th",null,"機具數量",-1)),t[28]||(t[28]=e("th",null,"製表人",-1)),t[29]||(t[29]=e("th",null,"建立時間",-1)),t[30]||(t[30]=e("th",{style:{width:"120px"}},"操作",-1))])]),e("tbody",null,[(g(!0),b(z,null,W(p.value,l=>(g(),b("tr",{key:l.id},[e("td",null,[y(e("input",{type:"checkbox",class:"form-check-input",value:l.id,"onUpdate:modelValue":t[6]||(t[6]=f=>i.value=f)},null,8,Te),[[N,i.value]])]),e("td",null,[e("div",ke,v(l.basicInfo.projectName),1),e("small",Ce,v(l.projectId),1)]),e("td",null,v(A(l.reportDate)),1),e("td",null,[e("span",{class:V(["badge",j(l.status)])},v(B(l.status)),3)]),e("td",null,[e("span",he,v(l.materials.length),1)]),e("td",null,[e("span",Pe,v(L(l)),1)]),e("td",null,[e("span",Me,v(_(l)),1)]),e("td",null,v(l.preparer.reportingDepartment||"-"),1),e("td",null,v(F(l.createdAt)),1),e("td",null,[e("div",Ve,[e("button",{class:"btn btn-outline-primary",onClick:f=>O(l.id),title:"檢視"},t[31]||(t[31]=[e("i",{class:"fa fa-eye"},null,-1)]),8,Se),l.status==="DRAFT"?(g(),b("button",{key:0,class:"btn btn-outline-secondary",onClick:f=>Y(l.id),title:"編輯"},t[32]||(t[32]=[e("i",{class:"fa fa-edit"},null,-1)]),8,Ie)):S("",!0),e("button",{class:"btn btn-outline-success",onClick:f=>K(l.id),title:"匯出"},t[33]||(t[33]=[e("i",{class:"fa fa-download"},null,-1)]),8,Ne)])])]))),128)),p.value.length===0?(g(),b("tr",Ue,t[34]||(t[34]=[e("td",{colspan:"10",class:"text-center text-muted py-4"},[e("i",{class:"fa fa-inbox fa-2x mb-2"}),e("p",{class:"mb-0"},"沒有找到符合條件的日報表")],-1)]))):S("",!0)])])])]),_:1})]),_:1}),e("div",Ae,[e("div",Fe,[t[36]||(t[36]=e("span",{class:"text-muted"},"每頁顯示",-1)),y(e("select",{class:"form-select form-select-sm",style:{width:"auto"},"onUpdate:modelValue":t[7]||(t[7]=l=>w.value=l)},t[35]||(t[35]=[e("option",{value:"10"},"10",-1),e("option",{value:"20"},"20",-1),e("option",{value:"50"},"50",-1),e("option",{value:"100"},"100",-1)]),512),[[q,w.value]]),t[37]||(t[37]=e("span",{class:"text-muted"},"筆記錄",-1))]),e("nav",null,[e("ul",je,[e("li",{class:V(["page-item",{disabled:d.value===1}])},[e("button",{class:"page-link",onClick:t[8]||(t[8]=l=>D(d.value-1))},t[38]||(t[38]=[e("i",{class:"fa fa-chevron-left"},null,-1)]))],2),(g(!0),b(z,null,W(U.value,l=>(g(),b("li",{key:l,class:V(["page-item",{active:l===d.value}])},[e("button",{class:"page-link",onClick:f=>D(l)},v(l),9,Be)],2))),128)),e("li",{class:V(["page-item",{disabled:d.value===P.value}])},[e("button",{class:"page-link",onClick:t[9]||(t[9]=l=>D(d.value+1))},t[39]||(t[39]=[e("i",{class:"fa fa-chevron-right"},null,-1)]))],2)])])]),R.value?(g(),b("div",Le,t[40]||(t[40]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"載入中...")],-1)]))):S("",!0)]))}}),qe=le(_e,[["__scopeId","data-v-20b630f6"]]);export{qe as default};
