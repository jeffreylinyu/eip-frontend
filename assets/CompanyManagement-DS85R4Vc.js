import{C as ne,a as pe,u as ce,b as ue}from"./company-CEpg23Or.js";import{d as oe,r as I,I as F,x as me,C as ve,g as o,p as D,h as e,w as Z,f as a,i as A,j as N,k as g,v as S,z as U,t as i,E as V,F as P,D as j,m as L,T as ie,_ as ae,s as fe,o as re,n as M,K as H,M as ye,L as J,N as z,U as be,J as ge}from"./index-0fEq5Ai7.js";const xe={class:"mb-3"},Ne=["disabled"],Ie={key:0,class:"invalid-feedback"},$e={class:"form-text"},Ee={class:"mb-3"},_e=["disabled"],Ce={key:0,class:"invalid-feedback"},Te={class:"mb-3"},we=["disabled"],he=["value"],ke={key:0,class:"invalid-feedback"},Ae={key:0,class:"mb-3"},Me=["disabled"],De=["value"],Re={key:0,class:"invalid-feedback"},Se={key:1,class:"alert alert-danger"},Ve=oe({__name:"CompanyFormModal",props:{show:{type:Boolean},company:{}},emits:["update:show","hide","submit"],setup(k,{emit:_}){const $=k,v=_,d=I({companyName:"",companyUnifiedNumber:"",companyType:"THIRD_PARTY",contractorLevel:"CLASS_A"}),w=I(!1),m=I({}),R=F(()=>!!$.company),f=F(()=>R.value?"編輯公司":"新增公司"),C=F(()=>R.value?"更新":"創建"),x=()=>{v("update:show",!1),v("hide")},E=()=>{d.value={companyName:"",companyUnifiedNumber:"",companyType:"THIRD_PARTY",contractorLevel:"CLASS_A"},m.value={}};me(()=>$.company,h=>{h?(console.log("編輯公司資料:",h),d.value={companyName:h.companyName,companyUnifiedNumber:h.companyCode,companyType:h.companyType,contractorLevel:h.contractorLevel},console.log("表單資料:",d.value)):E()},{immediate:!0}),me(()=>$.show,h=>{h?m.value={}:E()});const y=()=>(m.value={},d.value.companyName.trim()?d.value.companyName.trim().length<2?m.value.companyName="公司名稱至少需要2個字符":d.value.companyName.trim().length>100&&(m.value.companyName="公司名稱不能超過100個字符"):m.value.companyName="公司名稱不能為空",d.value.companyUnifiedNumber.trim()?/^\d{8}$/.test(d.value.companyUnifiedNumber.trim())||(m.value.companyUnifiedNumber="統一編號必須為8位數字"):m.value.companyUnifiedNumber="統一編號不能為空",d.value.companyType||(m.value.companyType="請選擇公司類型"),d.value.companyType==="CONTRACTOR"&&!d.value.contractorLevel&&(m.value.contractorLevel="請選擇營造等級"),Object.keys(m.value).length===0),p=async()=>{if(y()){w.value=!0;try{const h={companyName:d.value.companyName.trim(),companyUnifiedNumber:d.value.companyUnifiedNumber.trim(),companyType:d.value.companyType,contractorLevel:d.value.contractorLevel};v("submit",h)}catch(h){console.error("Submit error:",h)}finally{w.value=!1}}},O=()=>{p()},B=h=>{m.value[h]&&delete m.value[h]};return(h,b)=>(o(),ve(ie,{show:$.show,"onUpdate:show":b[8]||(b[8]=T=>$.show=T),title:f.value,icon:"fa fa-building",size:"lg","modal-id":"companyFormModal","confirm-text":C.value,"confirm-icon":"fa fa-save","is-loading":w.value,"loading-text":"處理中...",onHide:x,onConfirm:O},{body:D(()=>[e("form",{onSubmit:Z(p,["prevent"])},[e("div",xe,[b[9]||(b[9]=e("label",{for:"companyName",class:"form-label"},[g(" 公司名稱 "),e("span",{class:"text-danger"},"*")],-1)),N(e("input",{id:"companyName",type:"text",class:U(["form-control",{"is-invalid":m.value.companyName}]),"onUpdate:modelValue":b[0]||(b[0]=T=>d.value.companyName=T),onInput:b[1]||(b[1]=T=>B("companyName")),placeholder:"請輸入公司名稱",maxlength:"100",disabled:w.value},null,42,Ne),[[S,d.value.companyName]]),m.value.companyName?(o(),a("div",Ie,i(m.value.companyName),1)):A("",!0),e("div",$e,i(d.value.companyName.length)+"/100 字符 ",1)]),e("div",Ee,[b[10]||(b[10]=e("label",{for:"companyCode",class:"form-label"},[g(" 統一編號 "),e("span",{class:"text-danger"},"*")],-1)),N(e("input",{id:"companyCode",type:"text",class:U(["form-control",{"is-invalid":m.value.companyUnifiedNumber}]),"onUpdate:modelValue":b[2]||(b[2]=T=>d.value.companyUnifiedNumber=T),onInput:b[3]||(b[3]=T=>B("companyUnifiedNumber")),placeholder:"請輸入8位數統一編號",maxlength:"8",disabled:w.value},null,42,_e),[[S,d.value.companyUnifiedNumber]]),m.value.companyUnifiedNumber?(o(),a("div",Ce,i(m.value.companyUnifiedNumber),1)):A("",!0),b[11]||(b[11]=e("div",{class:"form-text"}," 請輸入8位數字的統一編號 ",-1))]),e("div",Te,[b[12]||(b[12]=e("label",{for:"companyType",class:"form-label"},[g(" 公司類型 "),e("span",{class:"text-danger"},"*")],-1)),N(e("select",{id:"companyType",class:U(["form-select",{"is-invalid":m.value.companyType}]),"onUpdate:modelValue":b[4]||(b[4]=T=>d.value.companyType=T),onChange:b[5]||(b[5]=T=>B("companyType")),disabled:w.value},[(o(!0),a(P,null,j(L(ne),T=>(o(),a("option",{key:T.value,value:T.value},i(T.label),9,he))),128))],42,we),[[V,d.value.companyType]]),m.value.companyType?(o(),a("div",ke,i(m.value.companyType),1)):A("",!0)]),d.value.companyType==="CONTRACTOR"?(o(),a("div",Ae,[b[13]||(b[13]=e("label",{for:"contractorLevel",class:"form-label"},[g(" 營造等級 "),e("span",{class:"text-danger"},"*")],-1)),N(e("select",{id:"contractorLevel",class:U(["form-select",{"is-invalid":m.value.contractorLevel}]),"onUpdate:modelValue":b[6]||(b[6]=T=>d.value.contractorLevel=T),onChange:b[7]||(b[7]=T=>B("contractorLevel")),disabled:w.value},[(o(!0),a(P,null,j(L(pe),T=>(o(),a("option",{key:T.value,value:T.value},i(T.label),9,De))),128))],42,Me),[[V,d.value.contractorLevel]]),m.value.contractorLevel?(o(),a("div",Re,i(m.value.contractorLevel),1)):A("",!0)])):A("",!0),Object.keys(m.value).length>0?(o(),a("div",Se," 請修正以上錯誤後再提交 ")):A("",!0)],32)]),_:1},8,["show","title","confirm-text","is-loading"]))}}),Le=ae(Ve,[["__scopeId","data-v-5eb77811"]]),Oe={class:"company-management-tab"},Pe={class:"d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4 gap-3"},je={class:"d-flex flex-column flex-md-row gap-3 flex-grow-1"},Ue={class:"flex-grow-1",style:{"max-width":"400px"}},Fe={class:"input-group"},Be={style:{"min-width":"150px"}},We=["value"],ze={style:{"min-width":"120px"}},Ze=["value"],qe={key:0,class:"text-center py-4"},Ye={key:1,class:"alert alert-danger"},Ge={key:2,class:"text-center py-5"},Qe={class:"text-muted mb-2"},He={class:"text-muted mb-3"},Je={key:3,class:"row g-3"},Ke={class:"d-flex justify-content-between align-items-start mb-3"},Xe={class:"flex-grow-1"},et=["title"],tt={class:"text-muted small"},lt={class:"dropdown"},st=["onClick"],ot=["onClick"],at=["onClick"],nt=["onClick"],it=["onClick"],rt={class:"company-info"},ut={class:"d-flex gap-2 mb-2"},dt={key:0,class:"text-muted small mb-2 d-flex align-items-center"},ct={class:"text-muted small"},mt={class:"mb-2 d-flex align-items-center"},pt={class:"d-flex align-items-center"},vt=oe({__name:"CompanyManagementTab",emits:["manage-members","manage-site-personnel"],setup(k,{emit:_}){const $=fe(),v=$==null?void 0:$.proxy,d=ce(),w=_,m=I(!1),R=I(null),f=I(""),C=I(""),x=I(""),E=I(null),y=I(null),p=I(null),O=F(()=>{let t=d.companiesWithUserInfo;if(f.value){const l=f.value.toLowerCase();t=t.filter(n=>n.companyName.toLowerCase().includes(l)||n.companyCode.includes(l)||n.companyType.toLowerCase().includes(l))}return C.value&&(t=t.filter(l=>l.companyType===C.value)),x.value&&(t=t.filter(l=>l.status===x.value)),t}),B=t=>{const l=ne.find(n=>n.value===t);return l?l.label:t},h=t=>{const l=ne.find(n=>n.value===t);return l?l.color:"secondary"},b=t=>{const l=ue.find(n=>n.value===t);return l?l.label:t},T=t=>{const l=ue.find(n=>n.value===t);return l?l.color:"secondary"},q=t=>{const l=pe.find(n=>n.value===t);return l?l.label:t},W=t=>{R.value=t||null,m.value=!0},Y=()=>{m.value=!1,R.value=null},te=async t=>{try{R.value?await d.updateCompany(R.value.companyId,t)?(v.$toast.success("公司更新成功！"),Y()):v.$toast.error("公司更新失敗，請重試！"):await d.createCompany(t)?(v.$toast.success("公司建立成功！"),Y()):v.$toast.error("公司建立失敗，請重試！")}catch(l){console.error("Company form submit error:",l),v.$toast.error("操作失敗，請重試！")}},G=async t=>{if(window.confirm(`確定要刪除公司「${t.companyName}」嗎？此操作無法撤銷。`))try{await d.deleteCompany(t.companyId)?v.$toast.success("公司刪除成功！"):v.$toast.error("公司刪除失敗，請重試！")}catch(n){console.error("Delete company error:",n),v.$toast.error("刪除失敗，請重試！")}},K=t=>{w("manage-members",t.companyId)},X=t=>{w("manage-site-personnel",t.companyId,t.companyName)},c=t=>{E.value=E.value===t?null:t},s=()=>{E.value=null},r=t=>{y.value=t,p.value&&clearTimeout(p.value),p.value=setTimeout(()=>{E.value&&E.value!==t&&(E.value=null)},100)},Q=()=>{y.value=null,p.value&&clearTimeout(p.value)},u=()=>{f.value="",C.value="",x.value=""};return re(()=>{d.initCompanies()}),(t,l)=>(o(),a("div",Oe,[e("div",Pe,[e("div",je,[e("div",Ue,[e("div",Fe,[l[12]||(l[12]=e("span",{class:"input-group-text"},[e("i",{class:"fa fa-search"})],-1)),N(e("input",{type:"text",class:"form-control",placeholder:"搜索公司名稱、統編、聯絡人或信箱...","onUpdate:modelValue":l[0]||(l[0]=n=>f.value=n)},null,512),[[S,f.value]]),f.value?(o(),a("button",{key:0,class:"btn btn-outline-secondary",type:"button",onClick:l[1]||(l[1]=n=>f.value="")},l[11]||(l[11]=[e("i",{class:"fa fa-times"},null,-1)]))):A("",!0)])]),e("div",Be,[N(e("select",{class:"form-select","onUpdate:modelValue":l[2]||(l[2]=n=>C.value=n)},[l[13]||(l[13]=e("option",{value:""},"所有類型",-1)),(o(!0),a(P,null,j(L(ne),n=>(o(),a("option",{key:n.value,value:n.value},i(n.label),9,We))),128))],512),[[V,C.value]])]),e("div",ze,[N(e("select",{class:"form-select","onUpdate:modelValue":l[3]||(l[3]=n=>x.value=n)},[l[14]||(l[14]=e("option",{value:""},"所有狀態",-1)),(o(!0),a(P,null,j(L(ue),n=>(o(),a("option",{key:n.value,value:n.value},i(n.label),9,Ze))),128))],512),[[V,x.value]])]),f.value||C.value||x.value?(o(),a("button",{key:0,class:"btn btn-outline-secondary",onClick:u},l[15]||(l[15]=[e("i",{class:"fa fa-eraser me-1"},null,-1),g(" 清除 ")]))):A("",!0)]),e("button",{class:"btn btn-theme",onClick:l[4]||(l[4]=n=>W())},l[16]||(l[16]=[e("i",{class:"fa fa-plus me-2"},null,-1),g(" 新增公司 ")]))]),L(d).isLoading?(o(),a("div",qe,l[17]||(l[17]=[e("div",{class:"spinner-border text-theme",role:"status"},[e("span",{class:"visually-hidden"},"載入中...")],-1),e("div",{class:"mt-2 text-muted"},"載入公司資料中...",-1)]))):L(d).error?(o(),a("div",Ye,[l[18]||(l[18]=e("i",{class:"fa fa-exclamation-triangle me-2"},null,-1)),g(" "+i(L(d).error)+" ",1),e("button",{class:"btn btn-sm btn-outline-danger ms-2",onClick:l[5]||(l[5]=n=>L(d).initCompanies())}," 重試 ")])):O.value.length===0?(o(),a("div",Ge,[l[20]||(l[20]=e("div",{class:"mb-3"},[e("i",{class:"fa fa-building fa-3x text-muted"})],-1)),e("h5",Qe,i(L(d).companies.length===0?"尚未建立任何公司":"找不到符合條件的公司"),1),e("p",He,i(L(d).companies.length===0?"開始建立您的第一個公司":"請調整搜索條件或新增公司"),1),e("button",{class:"btn btn-theme",onClick:l[6]||(l[6]=n=>W())},l[19]||(l[19]=[e("i",{class:"fa fa-plus me-2"},null,-1),g(" 新增公司 ")]))])):(o(),a("div",Je,[(o(!0),a(P,null,j(O.value,n=>(o(),a("div",{key:n.companyId,class:"col-xl-4 col-lg-6 col-md-6"},[M(J,{class:U(["h-100",{"dropdown-open":E.value===n.companyId,"card-hover":y.value===n.companyId&&E.value!==n.companyId}]),onMouseenter:le=>r(n.companyId),onMouseleave:Q},{default:D(()=>[M(H,null,{default:D(()=>[e("div",Ke,[e("div",Xe,[e("h6",{class:"card-title mb-1 text-truncate",title:n.companyName},i(n.companyName),9,et),e("div",tt," 統編："+i(n.companyCode),1)]),e("div",lt,[e("button",{class:"btn btn-sm btn-outline-secondary dropdown-toggle",type:"button",onClick:Z(le=>c(n.companyId),["stop"])},l[21]||(l[21]=[e("i",{class:"fa fa-cog"},null,-1)]),8,st),N(e("ul",{class:"dropdown-menu dropdown-menu-end show",onClick:l[7]||(l[7]=Z(()=>{},["stop"])),onMouseenter:l[8]||(l[8]=Z(()=>{},["stop"])),onMouseleave:l[9]||(l[9]=Z(()=>{},["stop"]))},[e("li",null,[e("button",{class:"dropdown-item",onClick:le=>{W(n),s()}},l[22]||(l[22]=[e("i",{class:"fa fa-edit me-2"},null,-1),g(" 編輯公司 ")]),8,ot)]),e("li",null,[e("button",{class:"dropdown-item",onClick:le=>{K(n),s()}},l[23]||(l[23]=[e("i",{class:"fa fa-users me-2"},null,-1),g(" 管理成員 ")]),8,at)]),e("li",null,[e("button",{class:"dropdown-item",onClick:le=>{X(n),s()}},l[24]||(l[24]=[e("i",{class:"fa fa-hard-hat me-2"},null,-1),g(" 工地人員管理 ")]),8,nt)]),l[26]||(l[26]=e("li",null,[e("hr",{class:"dropdown-divider"})],-1)),e("li",null,[e("button",{class:"dropdown-item text-danger",onClick:le=>{G(n),s()}},l[25]||(l[25]=[e("i",{class:"fa fa-trash me-2"},null,-1),g(" 刪除公司 ")]),8,it)])],544),[[ye,E.value===n.companyId]])])]),e("div",rt,[e("div",ut,[e("span",{class:U(["badge border px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center",`border-${h(n.companyType)} text-${h(n.companyType)}`])},i(B(n.companyType)),3),e("span",{class:U(["badge border px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center",`border-${T(n.status)} text-${T(n.status)}`])},i(b(n.status)),3)]),n.companyType==="CONTRACTOR"&&n.contractorLevel?(o(),a("div",dt,[l[27]||(l[27]=e("i",{class:"fa fa-star me-1",style:{width:"16px","text-align":"center"}},null,-1)),g(" 營造等級："+i(q(n.contractorLevel)),1)])):A("",!0),e("div",ct,[e("div",mt,[l[28]||(l[28]=e("i",{class:"fa fa-user-tag me-1",style:{width:"16px","text-align":"center"}},null,-1)),g(" 用戶角色："+i(n.userRole==="OWNER"?"擁有者":n.userRole==="ADMIN"?"管理員":n.userRole==="MEMBER"?"成員":n.userRole==="VIEWER"?"檢視者":n.userRole),1)]),e("div",pt,[l[29]||(l[29]=e("i",{class:"fa fa-calendar me-1",style:{width:"16px","text-align":"center"}},null,-1)),g(" 加入時間："+i(new Date(n.joinedAt||n.createdAt).toLocaleDateString()),1)])])])]),_:2},1024)]),_:2},1032,["class","onMouseenter"])]))),128))])),M(Le,{show:m.value,"onUpdate:show":l[10]||(l[10]=n=>m.value=n),company:R.value,onHide:Y,onSubmit:te},null,8,["show","company"])]))}}),ft=ae(vt,[["__scopeId","data-v-7f683a65"]]),yt={class:"company-member-management"},bt={class:"row mb-3"},gt={class:"col-12"},xt={class:"d-flex align-items-center justify-content-between"},Nt={class:"d-flex align-items-center gap-4"},It={class:"badge border border-primary text-primary"},$t={class:"badge border border-success text-success"},Et={class:"badge border border-info text-info"},_t={class:"badge border border-warning text-warning"},Ct={class:"badge border border-secondary text-secondary"},Tt={class:"badge border border-success text-success"},wt={class:"badge border border-warning text-warning"},ht={class:"badge border border-danger text-danger"},kt={class:"text-muted"},At={class:"row g-3"},Mt={class:"col-md-6"},Dt={class:"input-group"},Rt={class:"col-md-2"},St={class:"col-md-2"},Vt={key:0,class:"text-center py-5"},Lt={key:1,class:"table-responsive"},Ot={class:"table table-hover mb-0"},Pt={class:"px-4 py-3"},jt={class:"d-flex align-items-center"},Ut={class:"avatar-circle me-3"},Ft={class:"fw-bold"},Bt={class:"text-muted small"},Wt={key:0,class:"text-muted small"},zt={class:"px-4 py-3"},Zt={key:0,class:"fa fa-crown me-1"},qt={key:1,class:"fa fa-user-shield me-1"},Yt={key:2,class:"fa fa-user me-1"},Gt={key:3,class:"fa fa-eye me-1"},Qt={class:"px-4 py-3"},Ht={class:"px-4 py-3 text-muted small"},Jt={class:"px-4 py-3 text-muted small"},Kt={class:"px-4 py-3"},Xt={class:"d-flex justify-content-center gap-1"},el=["onClick"],tl=["onClick"],ll=["onClick"],sl={class:"mb-3"},ol={class:"mb-3"},al={class:"mb-3"},nl={class:"mb-3"},il={class:"mb-3"},rl={class:"mb-3"},ul={class:"mb-3"},dl=oe({__name:"CompanyMemberManagement",props:{companyId:{}},setup(k){const _=k;ce();const $=I(!1),v=I(""),d=I(""),w=I(""),m=I(!1),R=I(!1),f=I(null),C=I({email:"",role:"MEMBER",message:""}),x=I([{id:"member-001",userId:"user-001",userName:"王小明",userEmail:"wang@example.com",userPhone:"0912-345-678",role:"OWNER",joinedAt:"2024-01-15T08:00:00Z",status:"ACTIVE",companyId:"comp-001",companyName:"台灣建設股份有限公司"},{id:"member-002",userId:"user-002",userName:"李小華",userEmail:"lee@example.com",userPhone:"0923-456-789",role:"ADMIN",joinedAt:"2024-02-01T09:30:00Z",status:"ACTIVE",invitedBy:"user-001",companyId:"comp-001",companyName:"台灣建設股份有限公司"},{id:"member-003",userId:"user-003",userName:"張工程師",userEmail:"zhang@example.com",role:"MEMBER",joinedAt:"2024-02-15T14:20:00Z",status:"ACTIVE",invitedBy:"user-001",companyId:"comp-001",companyName:"台灣建設股份有限公司"},{id:"member-004",userId:"user-004",userName:"陳助理",userEmail:"chen@example.com",role:"VIEWER",joinedAt:"2024-03-01T10:15:00Z",status:"PENDING",invitedBy:"user-002",companyId:"comp-001",companyName:"台灣建設股份有限公司"}]),E=F(()=>{let c=x.value;if(v.value){const s=v.value.toLowerCase();c=c.filter(r=>r.userName.toLowerCase().includes(s)||r.userEmail.toLowerCase().includes(s)||r.userPhone&&r.userPhone.includes(s))}return d.value&&(c=c.filter(s=>s.role===d.value)),w.value&&(c=c.filter(s=>s.status===w.value)),c}),y=F(()=>{const c=x.value.length,s=x.value.filter(t=>t.status==="ACTIVE").length,r=x.value.filter(t=>t.status==="PENDING").length,Q=x.value.filter(t=>t.status==="INACTIVE").length,u={OWNER:x.value.filter(t=>t.role==="OWNER").length,ADMIN:x.value.filter(t=>t.role==="ADMIN").length,MEMBER:x.value.filter(t=>t.role==="MEMBER").length,VIEWER:x.value.filter(t=>t.role==="VIEWER").length};return{total:c,active:s,pending:r,inactive:Q,byRole:u}}),p=c=>({OWNER:"擁有者",ADMIN:"管理員",MEMBER:"成員",VIEWER:"檢視者"})[c]||c,O=c=>({OWNER:"danger",ADMIN:"warning",MEMBER:"primary",VIEWER:"secondary"})[c]||"secondary",B=c=>({ACTIVE:"已加入",INACTIVE:"已停用",PENDING:"待確認"})[c]||c,h=c=>({ACTIVE:"success",INACTIVE:"secondary",PENDING:"warning"})[c]||"secondary",b=c=>new Date(c).toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),T=c=>c.role!=="OWNER",q=c=>c.role!=="OWNER",W=()=>{C.value={email:"",role:"MEMBER",message:""},m.value=!0},Y=async()=>{$.value=!0;try{console.log("邀請成員:",C.value);const c={id:`member-${Date.now()}`,userId:`user-${Date.now()}`,userName:C.value.email.split("@")[0],userEmail:C.value.email,role:C.value.role,joinedAt:new Date().toISOString(),status:"PENDING",invitedBy:"current-user",companyId:_.companyId,companyName:"當前公司"};x.value.push(c),m.value=!1}catch(c){console.error("邀請成員失敗:",c)}finally{$.value=!1}},te=c=>{f.value={...c},R.value=!0},G=async()=>{if(f.value){$.value=!0;try{console.log("更新成員:",f.value);const c=x.value.findIndex(s=>s.id===f.value.id);c!==-1&&(x.value[c]={...f.value}),R.value=!1,f.value=null}catch(c){console.error("更新成員失敗:",c)}finally{$.value=!1}}},K=async c=>{if(window.confirm(`確定要移除成員「${c.userName}」嗎？`)){$.value=!0;try{console.log("移除成員:",c.id),x.value=x.value.filter(r=>r.id!==c.id)}catch(r){console.error("移除成員失敗:",r)}finally{$.value=!1}}},X=async c=>{$.value=!0;try{console.log("重新發送邀請:",c.id)}catch(s){console.error("重新發送邀請失敗:",s)}finally{$.value=!1}};return re(()=>{console.log("載入公司成員:",_.companyId)}),(c,s)=>(o(),a("div",yt,[M(J,{class:"mb-4"},{default:D(()=>[M(H,null,{default:D(()=>[e("div",bt,[e("div",gt,[e("div",xt,[e("div",Nt,[s[12]||(s[12]=e("span",{class:"text-muted"},"總計：",-1)),e("span",It,i(x.value.length)+" 人",1),e("span",$t,i(y.value.byRole.OWNER)+" 擁有者",1),e("span",Et,i(y.value.byRole.ADMIN)+" 管理員",1),e("span",_t,i(y.value.byRole.MEMBER)+" 成員",1),e("span",Ct,i(y.value.byRole.VIEWER)+" 檢視者",1),s[13]||(s[13]=e("span",{class:"text-muted ms-3"},"狀態：",-1)),e("span",Tt,i(y.value.active)+" 已加入",1),e("span",wt,i(y.value.pending)+" 待確認",1),e("span",ht,i(y.value.inactive)+" 已停用",1)]),e("small",kt,"顯示 "+i(E.value.length)+" / "+i(x.value.length)+" 人",1)])])]),e("div",At,[e("div",Mt,[e("div",Dt,[s[14]||(s[14]=e("span",{class:"input-group-text"},[e("i",{class:"fa fa-search"})],-1)),N(e("input",{type:"text",class:"form-control",placeholder:"搜索成員姓名、信箱或電話...","onUpdate:modelValue":s[0]||(s[0]=r=>v.value=r)},null,512),[[S,v.value]])])]),e("div",Rt,[N(e("select",{class:"form-select","onUpdate:modelValue":s[1]||(s[1]=r=>d.value=r)},s[15]||(s[15]=[e("option",{value:""},"所有角色",-1),e("option",{value:"OWNER"},"擁有者",-1),e("option",{value:"ADMIN"},"管理員",-1),e("option",{value:"MEMBER"},"成員",-1),e("option",{value:"VIEWER"},"檢視者",-1)]),512),[[V,d.value]])]),e("div",St,[N(e("select",{class:"form-select","onUpdate:modelValue":s[2]||(s[2]=r=>w.value=r)},s[16]||(s[16]=[e("option",{value:""},"所有狀態",-1),e("option",{value:"ACTIVE"},"已加入",-1),e("option",{value:"PENDING"},"待確認",-1),e("option",{value:"INACTIVE"},"已停用",-1)]),512),[[V,w.value]])]),e("div",{class:"col-md-2"},[e("button",{class:"btn btn-theme w-100",onClick:W},s[17]||(s[17]=[e("i",{class:"fa fa-plus me-2"},null,-1),g(" 邀請成員 ")]))])])]),_:1})]),_:1}),M(J,null,{default:D(()=>[M(H,{class:"p-0"},{default:D(()=>[E.value.length===0?(o(),a("div",Vt,s[18]||(s[18]=[e("i",{class:"fa fa-users fa-3x text-muted mb-3"},null,-1),e("h5",{class:"text-muted"},"沒有找到成員",-1),e("p",{class:"text-muted"},"請嘗試調整搜索條件或邀請新成員",-1)]))):(o(),a("div",Lt,[e("table",Ot,[s[23]||(s[23]=e("thead",{class:""},[e("tr",null,[e("th",{class:"px-4 py-3"},"成員資訊"),e("th",{class:"px-4 py-3"},"角色"),e("th",{class:"px-4 py-3"},"狀態"),e("th",{class:"px-4 py-3"},"加入時間"),e("th",{class:"px-4 py-3"},"邀請者"),e("th",{class:"px-4 py-3 text-center"},"操作")])],-1)),e("tbody",null,[(o(!0),a(P,null,j(E.value,r=>(o(),a("tr",{key:r.id},[e("td",Pt,[e("div",jt,[e("div",Ut,i(r.userName.charAt(0)),1),e("div",null,[e("div",Ft,i(r.userName),1),e("div",Bt,i(r.userEmail),1),r.userPhone?(o(),a("div",Wt,[s[19]||(s[19]=e("i",{class:"fa fa-phone me-1"},null,-1)),g(" "+i(r.userPhone),1)])):A("",!0)])])]),e("td",zt,[e("span",{class:U(["badge border px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center",`border-${O(r.role)} text-${O(r.role)}`])},[r.role==="OWNER"?(o(),a("i",Zt)):r.role==="ADMIN"?(o(),a("i",qt)):r.role==="MEMBER"?(o(),a("i",Yt)):(o(),a("i",Gt)),g(" "+i(p(r.role)),1)],2)]),e("td",Qt,[e("span",{class:U(["badge border px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center",`border-${h(r.status)} text-${h(r.status)}`])},i(B(r.status)),3)]),e("td",Ht,i(b(r.joinedAt)),1),e("td",Jt,i(r.invitedBy?"已邀請":"-"),1),e("td",Kt,[e("div",Xt,[T(r)?(o(),a("button",{key:0,class:"btn btn-sm btn-outline-theme",onClick:Q=>te(r),title:"編輯成員"},s[20]||(s[20]=[e("i",{class:"fa fa-edit"},null,-1)]),8,el)):A("",!0),r.status==="PENDING"?(o(),a("button",{key:1,class:"btn btn-sm btn-outline-warning",onClick:Q=>X(r),title:"重新發送邀請"},s[21]||(s[21]=[e("i",{class:"fa fa-paper-plane"},null,-1)]),8,tl)):A("",!0),q(r)?(o(),a("button",{key:2,class:"btn btn-sm btn-outline-danger",onClick:Q=>K(r),title:"移除成員"},s[22]||(s[22]=[e("i",{class:"fa fa-trash"},null,-1)]),8,ll)):A("",!0)])])]))),128))])])]))]),_:1})]),_:1}),M(ie,{show:m.value,"onUpdate:show":s[6]||(s[6]=r=>m.value=r),title:"邀請新成員",onSubmit:Y,loading:$.value},{default:D(()=>[e("form",{onSubmit:Z(Y,["prevent"])},[e("div",sl,[s[24]||(s[24]=e("label",{class:"form-label"},"電子信箱 *",-1)),N(e("input",{type:"email",class:"form-control","onUpdate:modelValue":s[3]||(s[3]=r=>C.value.email=r),placeholder:"請輸入要邀請的電子信箱",required:""},null,512),[[S,C.value.email]])]),e("div",ol,[s[26]||(s[26]=e("label",{class:"form-label"},"角色 *",-1)),N(e("select",{class:"form-select","onUpdate:modelValue":s[4]||(s[4]=r=>C.value.role=r),required:""},s[25]||(s[25]=[e("option",{value:"MEMBER"},"成員",-1),e("option",{value:"ADMIN"},"管理員",-1),e("option",{value:"VIEWER"},"檢視者",-1)]),512),[[V,C.value.role]]),s[27]||(s[27]=e("div",{class:"form-text"},[e("small",{class:"text-muted"},[g(" • "),e("strong",null,"管理員"),g("：可以管理公司資料和成員"),e("br"),g(" • "),e("strong",null,"成員"),g("：可以參與專案和查看公司資料"),e("br"),g(" • "),e("strong",null,"檢視者"),g("：只能查看被授權的內容 ")])],-1))]),e("div",al,[s[28]||(s[28]=e("label",{class:"form-label"},"邀請訊息",-1)),N(e("textarea",{class:"form-control",rows:"3","onUpdate:modelValue":s[5]||(s[5]=r=>C.value.message=r),placeholder:"可以在邀請信中加入自訂訊息..."},null,512),[[S,C.value.message]])])],32)]),_:1},8,["show","loading"]),f.value?(o(),ve(ie,{key:0,show:R.value,"onUpdate:show":s[11]||(s[11]=r=>R.value=r),title:"編輯成員",onSubmit:G,loading:$.value},{default:D(()=>[e("form",{onSubmit:Z(G,["prevent"])},[e("div",nl,[s[29]||(s[29]=e("label",{class:"form-label"},"成員姓名",-1)),N(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[7]||(s[7]=r=>f.value.userName=r),readonly:""},null,512),[[S,f.value.userName]])]),e("div",il,[s[30]||(s[30]=e("label",{class:"form-label"},"電子信箱",-1)),N(e("input",{type:"email",class:"form-control","onUpdate:modelValue":s[8]||(s[8]=r=>f.value.userEmail=r),readonly:""},null,512),[[S,f.value.userEmail]])]),e("div",rl,[s[32]||(s[32]=e("label",{class:"form-label"},"角色 *",-1)),N(e("select",{class:"form-select","onUpdate:modelValue":s[9]||(s[9]=r=>f.value.role=r),required:""},s[31]||(s[31]=[e("option",{value:"ADMIN"},"管理員",-1),e("option",{value:"MEMBER"},"成員",-1),e("option",{value:"VIEWER"},"檢視者",-1)]),512),[[V,f.value.role]])]),e("div",ul,[s[34]||(s[34]=e("label",{class:"form-label"},"狀態 *",-1)),N(e("select",{class:"form-select","onUpdate:modelValue":s[10]||(s[10]=r=>f.value.status=r),required:""},s[33]||(s[33]=[e("option",{value:"ACTIVE"},"已加入",-1),e("option",{value:"INACTIVE"},"已停用",-1),e("option",{value:"PENDING"},"待確認",-1)]),512),[[V,f.value.status]])])],32)]),_:1},8,["show","loading"])):A("",!0)]))}}),cl=ae(dl,[["__scopeId","data-v-4af2b063"]]),ee=[{value:"QUALITY_CONTROL",label:"品管人員",color:"primary",icon:"fa-check-circle"},{value:"SAFETY_OFFICER",label:"勞安人員",color:"warning",icon:"fa-shield-alt"},{value:"PROFESSIONAL_ENGINEER",label:"專業技師",color:"success",icon:"fa-user-graduate"}],se=[{value:"ACTIVE",label:"在職",color:"success",icon:"fa-check"},{value:"ON_LEAVE",label:"休假",color:"info",icon:"fa-calendar-times"},{value:"TERMINATED",label:"離職",color:"danger",icon:"fa-times"}],de={async getList(k,_=1,$=20){return await z.get(`/management/company/${k}/site-personnel`,{params:{page:_,pageSize:$}})},async getDetail(k){return await z.get(`/management/site-personnel/${k}`)},async create(k){return await z.post("/management/site-personnel/create",k)},async update(k){return await z.patch("/management/site-personnel/update",k)},async delete(k){await z.delete(`/management/site-personnel/delete/${k}`)},async assignProject(k){return await z.post("/management/site-personnel/assign-project",k)},async removeProjectAssignment(k){return await z.post("/management/site-personnel/remove-project",{personnelId:k})},async search(k,_){return await z.get(`/management/company/${k}/site-personnel/search`,{params:{query:_}})},async getByProject(k){return await z.get(`/management/project/${k}/site-personnel`)}},ml={class:"site-personnel-management"},pl={class:"row mb-3"},vl={class:"col-12"},fl={class:"d-flex align-items-center justify-content-between"},yl={class:"d-flex align-items-center gap-4"},bl={class:"badge border border-primary text-primary"},gl={class:"badge border border-success text-success"},xl={class:"badge border border-info text-info"},Nl={class:"badge border border-warning text-warning"},Il={class:"badge border border-success text-success"},$l={class:"badge border border-info text-info"},El={class:"badge border border-danger text-danger"},_l={class:"text-muted"},Cl={class:"row g-3"},Tl={class:"col-md-3"},wl={class:"input-group"},hl={class:"col-md-2"},kl=["value"],Al={class:"col-md-2"},Ml=["value"],Dl={class:"col-md-3"},Rl=["value"],Sl={class:"col-md-2"},Vl={class:"row"},Ll={key:0,class:"col-12"},Ol={key:1,class:"col-12"},Pl={class:"text-muted mb-3"},jl={key:2,class:"col-12"},Ul={class:"table-responsive"},Fl={class:"table table-hover mb-0 align-middle"},Bl={class:"fw-bold"},Wl={class:"text-muted"},zl={class:"small"},Zl={class:"small"},ql={key:0,class:"mb-1"},Yl={key:1,class:"text-muted mb-1"},Gl={key:2,class:"mb-1"},Ql=["onClick"],Hl={key:3,class:"text-muted"},Jl={class:"small"},Kl={key:0,class:"text-muted"},Xl=["onClick"],es=["onClick"],ts={class:"row g-3"},ls={class:"col-md-6"},ss={class:"col-md-6"},os={class:"col-md-6"},as={class:"col-md-6"},ns={class:"col-md-6"},is=["value"],rs={class:"col-md-6"},us=["value"],ds={class:"col-md-6"},cs={class:"col-md-6"},ms={class:"col-md-6"},ps={class:"col-md-6"},vs=["value"],fs={class:"col-md-6"},ys={class:"col-12"},bs=oe({__name:"SitePersonnelManagement",props:{companyId:{},companyName:{}},setup(k){const _=k,$=fe(),v=$==null?void 0:$.proxy,d=be(),w=I([]),m=I(!1),R=I(!1),f=I(null),C=I(""),x=I(""),E=I(""),y=I(""),p=I({name:"",email:"",phone:"",idNumber:"",position:"QUALITY_CONTROL",specialization:"",licenseNumber:"",licenseExpiryDate:"",licenseFile:"",companyId:_.companyId,projectId:"",hireDate:new Date().toISOString().split("T")[0],notes:"",status:"ACTIVE"}),O=F(()=>{let u=w.value;if(C.value){const t=C.value.toLowerCase();u=u.filter(l=>l.name.toLowerCase().includes(t)||l.email.toLowerCase().includes(t)||l.phone.includes(t)||l.idNumber.includes(t))}return x.value&&(u=u.filter(t=>t.position===x.value)),E.value&&(u=u.filter(t=>t.status===E.value)),y.value&&(u=u.filter(t=>t.projectId===y.value)),u}),B=[{id:"proj-001",name:"台北市信義區辦公大樓新建工程",status:"ACTIVE"},{id:"proj-002",name:"新北市板橋區住宅建案",status:"ACTIVE"},{id:"proj-003",name:"桃園市龜山區工業園區工程",status:"ACTIVE"}],h=F(()=>B),b=F(()=>{const u={};return ee.forEach(t=>{u[t.value]=w.value.filter(l=>l.position===t.value&&l.status==="ACTIVE").length}),u}),T=F(()=>{const u={};return se.forEach(t=>{u[t.value]=w.value.filter(l=>l.status===t.value).length}),u}),q=u=>ee.find(t=>t.value===u)||ee[ee.length-1],W=u=>se.find(t=>t.value===u)||se[0],Y=u=>{if(!u)return"未分配";const t=h.value.find(l=>l.id===u);return t?t.name:"未知項目"},te=[{id:"1",personnelId:"SP001",name:"張志明",email:"zhang.zhiming@example.com",phone:"0912-345-678",idNumber:"A123456789",position:"QUALITY_CONTROL",specialization:"",licenseNumber:"QC-2024-001",licenseExpiryDate:"2025-06-15",licenseFile:"/uploads/licenses/qc-001.pdf",companyId:_.companyId,projectId:"proj-001",projectName:"台北市信義區辦公大樓新建工程",status:"ACTIVE",hireDate:"2024-01-15",leaveDate:"",notes:"資深品管人員，有10年經驗",createdAt:"2024-01-15T08:00:00Z",updatedAt:"2024-01-15T08:00:00Z"},{id:"2",personnelId:"SP002",name:"李美玲",email:"li.meiling@example.com",phone:"0923-456-789",idNumber:"B987654321",position:"SAFETY_OFFICER",specialization:"",licenseNumber:"SO-2024-002",licenseExpiryDate:"2025-03-20",licenseFile:"/uploads/licenses/so-002.pdf",companyId:_.companyId,projectId:"proj-002",projectName:"新北市板橋區住宅建案",status:"ACTIVE",hireDate:"2024-02-01",leaveDate:"",notes:"勞安專員，具備多項安全證照",createdAt:"2024-02-01T09:00:00Z",updatedAt:"2024-02-01T09:00:00Z"},{id:"3",personnelId:"SP003",name:"王建國",email:"wang.jianguo@example.com",phone:"0934-567-890",idNumber:"C456789123",position:"PROFESSIONAL_ENGINEER",specialization:"",licenseNumber:"PE-2024-003",licenseExpiryDate:"2025-12-31",licenseFile:"/uploads/licenses/pe-003.pdf",companyId:_.companyId,projectId:"proj-001",projectName:"台北市信義區辦公大樓新建工程",status:"ACTIVE",hireDate:"2024-01-20",leaveDate:"",notes:"結構技師，專精於高層建築設計",createdAt:"2024-01-20T10:00:00Z",updatedAt:"2024-01-20T10:00:00Z"},{id:"4",personnelId:"SP004",name:"陳雅婷",email:"chen.yating@example.com",phone:"0945-678-901",idNumber:"D789123456",position:"QUALITY_CONTROL",specialization:"",licenseNumber:"QC-2024-004",licenseExpiryDate:"2024-11-30",licenseFile:"",companyId:_.companyId,projectId:"proj-003",projectName:"桃園市龜山區工業園區工程",status:"ON_LEAVE",hireDate:"2024-03-01",leaveDate:"",notes:"品管人員，目前請假中",createdAt:"2024-03-01T11:00:00Z",updatedAt:"2024-03-01T11:00:00Z"},{id:"5",personnelId:"SP005",name:"劉志豪",email:"liu.zhihao@example.com",phone:"0956-789-012",idNumber:"E321654987",position:"PROFESSIONAL_ENGINEER",specialization:"",licenseNumber:"PE-2024-005",licenseExpiryDate:"2025-08-15",licenseFile:"/uploads/licenses/pe-005.pdf",companyId:_.companyId,projectId:"proj-002",projectName:"新北市板橋區住宅建案",status:"ACTIVE",hireDate:"2024-02-15",leaveDate:"",notes:"機電技師，專精於智慧建築系統",createdAt:"2024-02-15T12:00:00Z",updatedAt:"2024-02-15T12:00:00Z"},{id:"6",personnelId:"SP006",name:"黃淑芬",email:"huang.shufen@example.com",phone:"0967-890-123",idNumber:"F654321987",position:"SAFETY_OFFICER",specialization:"",licenseNumber:"",licenseExpiryDate:"",licenseFile:"",companyId:_.companyId,projectId:"",projectName:"",status:"TERMINATED",hireDate:"2024-01-10",leaveDate:"2024-04-15",notes:"已離職",createdAt:"2024-01-10T13:00:00Z",updatedAt:"2024-04-15T13:00:00Z"},{id:"7",personnelId:"SP007",name:"林俊傑",email:"lin.junjie@example.com",phone:"0978-901-234",idNumber:"G987654321",position:"PROFESSIONAL_ENGINEER",specialization:"",licenseNumber:"PE-2024-007",licenseExpiryDate:"2025-05-20",licenseFile:"/uploads/licenses/pe-007.pdf",companyId:_.companyId,projectId:"proj-003",projectName:"桃園市龜山區工業園區工程",status:"ACTIVE",hireDate:"2024-03-15",leaveDate:"",notes:"土木技師，專精於基礎工程",createdAt:"2024-03-15T14:00:00Z",updatedAt:"2024-03-15T14:00:00Z"},{id:"8",personnelId:"SP008",name:"吳佳玲",email:"wu.jialing@example.com",phone:"0989-012-345",idNumber:"H123789456",position:"QUALITY_CONTROL",specialization:"",licenseNumber:"QC-2024-008",licenseExpiryDate:"2025-09-10",licenseFile:"/uploads/licenses/qc-008.pdf",companyId:_.companyId,projectId:"proj-001",projectName:"台北市信義區辦公大樓新建工程",status:"ON_LEAVE",hireDate:"2024-02-20",leaveDate:"",notes:"品管人員，目前休假中",createdAt:"2024-02-20T15:00:00Z",updatedAt:"2024-02-20T15:00:00Z"}],G=async()=>{m.value=!0;try{w.value=te,console.log("載入假資料:",w.value.length,"筆工地人員資料")}catch(u){console.error("載入工地人員失敗:",u),v.$toast.error("載入工地人員失敗！"),w.value=[]}finally{m.value=!1}},K=u=>{u?(f.value=u,p.value={name:u.name,email:u.email,phone:u.phone,idNumber:u.idNumber,position:u.position,specialization:u.specialization||"",licenseNumber:u.licenseNumber||"",licenseExpiryDate:u.licenseExpiryDate||"",licenseFile:u.licenseFile||"",companyId:u.companyId,projectId:u.projectId||"",hireDate:u.hireDate,notes:u.notes||"",status:u.status}):(f.value=null,p.value={name:"",email:"",phone:"",idNumber:"",position:"QUALITY_CONTROL",specialization:"",licenseNumber:"",licenseExpiryDate:"",licenseFile:"",companyId:_.companyId,projectId:"",hireDate:new Date().toISOString().split("T")[0],notes:"",status:"ACTIVE"}),R.value=!0},X=()=>{R.value=!1,f.value=null},c=async()=>{try{f.value?(await de.update({personnelId:f.value.personnelId,...p.value}),v.$toast.success("工地人員更新成功！")):(await de.create(p.value),v.$toast.success("工地人員建立成功！")),X(),await G()}catch(u){console.error("操作失敗:",u),v.$toast.error("操作失敗，請重試！")}},s=async u=>{if(window.confirm(`確定要刪除工地人員「${u.name}」嗎？此操作無法撤銷。`))try{await de.delete(u.personnelId),v.$toast.success("工地人員刪除成功！"),await G()}catch(l){console.error("刪除失敗:",l),v.$toast.error("刪除失敗，請重試！")}},r=u=>{console.log("下載證照檔案:",u),window.open(u,"_blank")},Q=u=>{const t=u.target;if(t.files&&t.files[0]){const l=t.files[0];console.log("選擇的證照檔案:",l.name,l.size),p.value.licenseFile=l.name}};return re(()=>{G(),d.initWorkspaces()}),(u,t)=>(o(),a("div",ml,[M(J,{class:"mb-4"},{default:D(()=>[M(H,null,{default:D(()=>[e("div",pl,[e("div",vl,[e("div",fl,[e("div",yl,[t[18]||(t[18]=e("span",{class:"text-muted"},"總計：",-1)),e("span",bl,i(w.value.length)+" 人",1),e("span",gl,i(b.value.QUALITY_CONTROL)+" 品管",1),e("span",xl,i(b.value.SAFETY_OFFICER)+" 勞安",1),e("span",Nl,i(b.value.PROFESSIONAL_ENGINEER)+" 技師",1),t[19]||(t[19]=e("span",{class:"text-muted ms-3"},"狀態：",-1)),e("span",Il,i(T.value.ACTIVE)+" 在職",1),e("span",$l,i(T.value.ON_LEAVE)+" 休假",1),e("span",El,i(T.value.TERMINATED)+" 離職",1)]),e("small",_l,"顯示 "+i(O.value.length)+" / "+i(w.value.length)+" 人",1)])])]),e("div",Cl,[e("div",Tl,[e("div",wl,[t[21]||(t[21]=e("span",{class:"input-group-text"},[e("i",{class:"fa fa-search"})],-1)),N(e("input",{type:"text",class:"form-control",placeholder:"搜索姓名、信箱、電話、身分證...","onUpdate:modelValue":t[0]||(t[0]=l=>C.value=l)},null,512),[[S,C.value]]),C.value?(o(),a("button",{key:0,class:"btn btn-outline-secondary",type:"button",onClick:t[1]||(t[1]=l=>C.value="")},t[20]||(t[20]=[e("i",{class:"fa fa-times"},null,-1)]))):A("",!0)])]),e("div",hl,[N(e("select",{class:"form-select","onUpdate:modelValue":t[2]||(t[2]=l=>x.value=l)},[t[22]||(t[22]=e("option",{value:""},"所有職位",-1)),(o(!0),a(P,null,j(L(ee),l=>(o(),a("option",{key:l.value,value:l.value},i(l.label),9,kl))),128))],512),[[V,x.value]])]),e("div",Al,[N(e("select",{class:"form-select","onUpdate:modelValue":t[3]||(t[3]=l=>E.value=l)},[t[23]||(t[23]=e("option",{value:""},"所有狀態",-1)),(o(!0),a(P,null,j(L(se),l=>(o(),a("option",{key:l.value,value:l.value},i(l.label),9,Ml))),128))],512),[[V,E.value]])]),e("div",Dl,[N(e("select",{class:"form-select","onUpdate:modelValue":t[4]||(t[4]=l=>y.value=l)},[t[24]||(t[24]=e("option",{value:""},"所有項目",-1)),t[25]||(t[25]=e("option",{value:"unassigned"},"未分配",-1)),(o(!0),a(P,null,j(h.value,l=>(o(),a("option",{key:l.id,value:l.id},i(l.name),9,Rl))),128))],512),[[V,y.value]])]),e("div",Sl,[e("button",{class:"btn btn-theme w-100",onClick:t[5]||(t[5]=l=>K())},t[26]||(t[26]=[e("i",{class:"fa fa-plus me-2"},null,-1),g(" 新增工地人員 ")]))])])]),_:1})]),_:1}),e("div",Vl,[m.value?(o(),a("div",Ll,[M(J,null,{default:D(()=>[M(H,{class:"text-center py-4"},{default:D(()=>t[27]||(t[27]=[e("i",{class:"fa fa-spinner fa-spin fa-2x text-muted mb-3"},null,-1),e("p",{class:"text-muted mb-0"},"載入中...",-1)])),_:1,__:[27]})]),_:1})])):O.value.length===0?(o(),a("div",Ol,[M(J,null,{default:D(()=>[M(H,{class:"text-center py-4"},{default:D(()=>[t[29]||(t[29]=e("i",{class:"fa fa-users fa-3x text-muted mb-3"},null,-1)),t[30]||(t[30]=e("h5",{class:"text-muted"},"暫無工地人員",-1)),e("p",Pl,i(C.value||x.value||E.value||y.value?"沒有符合條件的工地人員":"還沒有新增任何工地人員"),1),!C.value&&!x.value&&!E.value&&!y.value?(o(),a("button",{key:0,class:"btn btn-theme",onClick:t[6]||(t[6]=l=>K())},t[28]||(t[28]=[e("i",{class:"fa fa-plus me-2"},null,-1),g(" 新增第一個工地人員 ")]))):A("",!0)]),_:1,__:[29,30]})]),_:1})])):(o(),a("div",jl,[M(J,null,{default:D(()=>[M(H,{class:"p-0"},{default:D(()=>[e("div",Ul,[e("table",Fl,[t[39]||(t[39]=e("thead",null,[e("tr",null,[e("th",null,"姓名"),e("th",null,"職位"),e("th",null,"聯絡資訊"),e("th",null,"分配項目"),e("th",null,"狀態"),e("th",null,"證照"),e("th",null,"僱用日期"),e("th",{width:"120"},"操作")])],-1)),e("tbody",null,[(o(!0),a(P,null,j(O.value,l=>(o(),a("tr",{key:l.id},[e("td",null,[e("div",null,[e("div",Bl,i(l.name),1),e("small",Wl,i(l.idNumber),1)])]),e("td",null,[e("span",{class:U(["badge border px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center",`border-${q(l.position).color} text-${q(l.position).color}`])},[e("i",{class:U(`fa ${q(l.position).icon} me-1`)},null,2),g(" "+i(q(l.position).label),1)],2)]),e("td",null,[e("div",zl,[e("div",null,[t[31]||(t[31]=e("i",{class:"fa fa-envelope me-1"},null,-1)),g(i(l.email),1)]),e("div",null,[t[32]||(t[32]=e("i",{class:"fa fa-phone me-1"},null,-1)),g(i(l.phone),1)])])]),e("td",null,[e("span",null,i(Y(l.projectId)),1)]),e("td",null,[e("span",{class:U(["badge border px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center",`border-${W(l.status).color} text-${W(l.status).color}`])},[e("i",{class:U(`fa ${W(l.status).icon} me-1`)},null,2),g(" "+i(W(l.status).label),1)],2)]),e("td",null,[e("div",Zl,[l.licenseNumber?(o(),a("div",ql,[t[33]||(t[33]=e("i",{class:"fa fa-id-card me-1"},null,-1)),g(i(l.licenseNumber),1)])):A("",!0),l.licenseExpiryDate?(o(),a("div",Yl,[t[34]||(t[34]=e("i",{class:"fa fa-calendar me-1"},null,-1)),g(i(l.licenseExpiryDate),1)])):A("",!0),l.licenseFile?(o(),a("div",Gl,[e("a",{href:"#",class:"text-decoration-none",onClick:Z(n=>r(l.licenseFile),["prevent"])},t[35]||(t[35]=[e("i",{class:"fa fa-download me-1"},null,-1),g("下載證照 ")]),8,Ql)])):A("",!0),!l.licenseNumber&&!l.licenseExpiryDate&&!l.licenseFile?(o(),a("div",Hl,t[36]||(t[36]=[e("i",{class:"fa fa-minus me-1"},null,-1),g("無證照 ")]))):A("",!0)])]),e("td",null,[e("div",Jl,[e("div",null,i(l.hireDate),1),l.leaveDate?(o(),a("div",Kl," 離職: "+i(l.leaveDate),1)):A("",!0)])]),e("td",null,[e("button",{class:"btn btn-sm btn-outline-primary me-1",onClick:n=>K(l),title:"編輯"},t[37]||(t[37]=[e("i",{class:"fa fa-edit"},null,-1)]),8,Xl),e("button",{class:"btn btn-sm btn-outline-danger",onClick:n=>s(l),title:"刪除"},t[38]||(t[38]=[e("i",{class:"fa fa-trash"},null,-1)]),8,es)])]))),128))])])])]),_:1})]),_:1})]))]),M(ie,{show:R.value,title:f.value?"編輯工地人員":"新增工地人員",icon:"fa fa-user",size:"lg","modal-id":"personnelFormModal","confirm-text":f.value?"更新":"新增","confirm-icon":"fa fa-save",onHide:X,onConfirm:c},{body:D(()=>[e("form",{onSubmit:Z(c,["prevent"])},[e("div",ts,[e("div",ls,[t[40]||(t[40]=e("label",{class:"form-label"},"姓名 *",-1)),N(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[7]||(t[7]=l=>p.value.name=l),required:""},null,512),[[S,p.value.name]])]),e("div",ss,[t[41]||(t[41]=e("label",{class:"form-label"},"身分證號 *",-1)),N(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[8]||(t[8]=l=>p.value.idNumber=l),maxlength:"10",required:""},null,512),[[S,p.value.idNumber]])]),e("div",os,[t[42]||(t[42]=e("label",{class:"form-label"},"電子信箱 *",-1)),N(e("input",{type:"email",class:"form-control","onUpdate:modelValue":t[9]||(t[9]=l=>p.value.email=l),required:""},null,512),[[S,p.value.email]])]),e("div",as,[t[43]||(t[43]=e("label",{class:"form-label"},"聯絡電話 *",-1)),N(e("input",{type:"tel",class:"form-control","onUpdate:modelValue":t[10]||(t[10]=l=>p.value.phone=l),required:""},null,512),[[S,p.value.phone]])]),e("div",ns,[t[44]||(t[44]=e("label",{class:"form-label"},"職位 *",-1)),N(e("select",{class:"form-select","onUpdate:modelValue":t[11]||(t[11]=l=>p.value.position=l),required:""},[(o(!0),a(P,null,j(L(ee),l=>(o(),a("option",{key:l.value,value:l.value},i(l.label),9,is))),128))],512),[[V,p.value.position]])]),e("div",rs,[t[45]||(t[45]=e("label",{class:"form-label"},"狀態 *",-1)),N(e("select",{class:"form-select","onUpdate:modelValue":t[12]||(t[12]=l=>p.value.status=l),required:""},[(o(!0),a(P,null,j(L(se),l=>(o(),a("option",{key:l.value,value:l.value},i(l.label),9,us))),128))],512),[[V,p.value.status]])]),e("div",ds,[t[46]||(t[46]=e("label",{class:"form-label"},"證照號碼",-1)),N(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[13]||(t[13]=l=>p.value.licenseNumber=l),placeholder:"請輸入證照號碼"},null,512),[[S,p.value.licenseNumber]])]),e("div",cs,[t[47]||(t[47]=e("label",{class:"form-label"},"證照到期日",-1)),N(e("input",{type:"date",class:"form-control","onUpdate:modelValue":t[14]||(t[14]=l=>p.value.licenseExpiryDate=l)},null,512),[[S,p.value.licenseExpiryDate]])]),e("div",ms,[t[48]||(t[48]=e("label",{class:"form-label"},"證照檔案",-1)),e("input",{type:"file",class:"form-control",onChange:Q,accept:".pdf,.jpg,.jpeg,.png,.doc,.docx"},null,32),t[49]||(t[49]=e("div",{class:"form-text"},"支援 PDF、圖片、Word 格式",-1))]),e("div",ps,[t[51]||(t[51]=e("label",{class:"form-label"},"分配項目",-1)),N(e("select",{class:"form-select","onUpdate:modelValue":t[15]||(t[15]=l=>p.value.projectId=l)},[t[50]||(t[50]=e("option",{value:""},"請選擇項目（可不選）",-1)),(o(!0),a(P,null,j(h.value,l=>(o(),a("option",{key:l.id,value:l.id},i(l.name),9,vs))),128))],512),[[V,p.value.projectId]]),t[52]||(t[52]=e("div",{class:"form-text"},"一個工地人員只能分配到一個項目",-1))]),e("div",fs,[t[53]||(t[53]=e("label",{class:"form-label"},"僱用日期 *",-1)),N(e("input",{type:"date",class:"form-control","onUpdate:modelValue":t[16]||(t[16]=l=>p.value.hireDate=l),required:""},null,512),[[S,p.value.hireDate]])]),e("div",ys,[t[54]||(t[54]=e("label",{class:"form-label"},"備註",-1)),N(e("textarea",{class:"form-control","onUpdate:modelValue":t[17]||(t[17]=l=>p.value.notes=l),rows:"3",placeholder:"其他備註資訊..."},null,512),[[S,p.value.notes]])])])],32)]),_:1},8,["show","title","confirm-text"])]))}}),gs=ae(bs,[["__scopeId","data-v-8ef30853"]]),xs={class:"container-xxl"},Ns={class:"row justify-content-center"},Is={class:"col-xl-12"},$s={class:"d-flex align-items-center justify-content-between mb-4"},Es={class:"page-header-title"},_s={key:0},Cs={key:1},Ts={key:2},ws={class:"text-muted mb-0"},hs={key:0},ks={key:1},As={key:2},Ms={class:"d-flex gap-2"},Ds=["disabled"],Rs={key:0,class:"spinner-border spinner-border-sm me-2"},Ss={key:1,class:"fa fa-refresh me-2"},Vs={key:0},Ls={key:1},Os={key:2},Ps=oe({__name:"CompanyManagement",setup(k){const _=ce(),$=I(!1),v=I("companies"),d=I(""),w=I(""),m=F(()=>d.value?_.companies.find(E=>E.id===d.value):null),R=async()=>{$.value=!0;try{await _.initCompanies()}catch(E){console.error("Failed to refresh data:",E)}finally{$.value=!1}},f=(E,y)=>{v.value=E,y&&(d.value=y)},C=(E,y)=>{v.value="site-personnel",d.value=E,w.value=y},x=()=>{v.value="companies",d.value="",w.value=""};return re(()=>{_.initCompanies()}),(E,y)=>{var p;return o(),a("div",xs,[e("div",Ns,[e("div",Is,[e("div",$s,[e("div",null,[e("h1",Es,[y[1]||(y[1]=e("i",{class:"fa fa-building me-3"},null,-1)),v.value==="companies"?(o(),a("span",_s,"公司管理")):v.value==="members"?(o(),a("span",Cs,i(((p=m.value)==null?void 0:p.companyName)||"公司")+" - 成員管理 ",1)):v.value==="site-personnel"?(o(),a("span",Ts,i(w.value||"公司")+" - 工地人員管理 ",1)):A("",!0)]),e("p",ws,[v.value==="companies"?(o(),a("span",hs,"管理您的公司資料")):v.value==="members"?(o(),a("span",ks,"管理公司成員和權限")):v.value==="site-personnel"?(o(),a("span",As,"管理工地人員、設定職位和項目分配")):A("",!0)])]),e("div",Ms,[v.value==="members"||v.value==="site-personnel"?(o(),a("button",{key:0,class:"btn btn-outline-secondary",onClick:x},y[2]||(y[2]=[e("i",{class:"fa fa-arrow-left me-2"},null,-1),g(" 返回公司列表 ")]))):A("",!0),e("button",{class:"btn btn-outline-theme",onClick:R,disabled:$.value},[$.value?(o(),a("span",Rs)):(o(),a("i",Ss)),y[3]||(y[3]=g(" 重新載入 "))],8,Ds)])]),v.value==="companies"?(o(),a("div",Vs,[M(J,null,{default:D(()=>[M(ge,null,{default:D(()=>y[4]||(y[4]=[e("div",{class:"d-flex align-items-center"},[e("i",{class:"fa fa-building me-2"}),e("h5",{class:"mb-0"},"公司列表")],-1)])),_:1,__:[4]}),M(H,{class:"p-0"},{default:D(()=>[M(ft,{onManageMembers:y[0]||(y[0]=O=>f("members",O)),onManageSitePersonnel:C})]),_:1})]),_:1})])):v.value==="members"&&d.value?(o(),a("div",Ls,[M(cl,{"company-id":d.value},null,8,["company-id"])])):v.value==="site-personnel"&&d.value?(o(),a("div",Os,[M(gs,{"company-id":d.value,"company-name":w.value},null,8,["company-id","company-name"])])):A("",!0)])])])}}}),Fs=ae(Ps,[["__scopeId","data-v-5d75514d"]]);export{Fs as default};
