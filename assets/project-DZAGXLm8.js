import{X as s,Y as n}from"./index-CB9Z8Gmd.js";const a=s("project",{state:()=>({projects:[],currentProject:null,loading:!1,error:null}),getters:{currentProjectName:t=>{var r;return((r=t.currentProject)==null?void 0:r.constructionName)||"請選擇項目工程"},projectCount:t=>t.projects.length,hasCurrentProject:t=>!!t.currentProject},actions:{async initProjects(){this.loading=!0;try{const t=await n();this.projects=t;const r=localStorage.getItem("currentProject");if(r){const o=JSON.parse(r),e=this.projects.find(c=>c.constructionId===o.constructionId);e&&(this.currentProject=e)}!this.currentProject&&this.projects.length>0&&this.setCurrentProject(this.projects[0]),this.error=null}catch(t){this.error="載入項目失敗",console.error("載入項目失敗:",t),await this.loadProjectsFromStorage()}finally{this.loading=!1}},async loadProjectsFromStorage(){const t=localStorage.getItem("projects"),r=localStorage.getItem("currentProject");t&&(this.projects=JSON.parse(t)),r&&(this.currentProject=JSON.parse(r))},saveCurrentProjectToStorage(){this.currentProject&&localStorage.setItem("currentProject",JSON.stringify(this.currentProject))},setCurrentProject(t){this.currentProject=t,this.saveCurrentProjectToStorage()},async refreshProjects(){await this.initProjects()},clearError(){this.error=null}}});export{a as u};
