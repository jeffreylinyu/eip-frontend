import{d as J,r as x,k as P,w as ie,B as ue,f as i,p as k,l as e,A as O,e as u,m as T,I as M,s as g,J as D,z as S,v as c,Q as V,F,y as j,L as A,V as ae,_ as K,g as ce,a as ne,i as h,x as Z,W as me,C as Q,E as ve,c as pe,q as fe}from"./index-CB9Z8Gmd.js";import{C as Y,a as de,u as re,b as oe}from"./company-Dv077Pgh.js";import{S as ye}from"./SitePersonnelManagement-B5IWoYKQ.js";const be={class:"mb-3"},ge=["disabled"],xe={key:0,class:"invalid-feedback"},Ne={class:"form-text"},Ce={class:"mb-3"},_e=["disabled"],Ee={key:0,class:"invalid-feedback"},$e={class:"mb-3"},we=["disabled"],Me=["value"],Ie={key:0,class:"invalid-feedback"},he={key:0,class:"mb-3"},Te=["disabled"],ke=["value"],Re={key:0,class:"invalid-feedback"},Ae={key:1,class:"alert alert-danger"},Le=J({__name:"CompanyFormModal",props:{show:{type:Boolean},company:{}},emits:["update:show","hide","submit"],setup(G,{emit:U}){const y=G,C=U,n=x({companyName:"",companyUnifiedNumber:"",companyType:"THIRD_PARTY",contractorLevel:"CLASS_A"}),b=x(!1),d=x({}),I=P(()=>!!y.company),v=P(()=>I.value?"編輯公司":"新增公司"),_=P(()=>I.value?"更新":"創建"),p=()=>{C("update:show",!1),C("hide")},w=()=>{n.value={companyName:"",companyUnifiedNumber:"",companyType:"THIRD_PARTY",contractorLevel:"CLASS_A"},d.value={}};ie(()=>y.company,N=>{N?n.value={companyName:N.companyName,companyUnifiedNumber:N.companyCode,companyType:N.companyType,contractorLevel:N.contractorLevel||"CLASS_A"}:w()},{immediate:!0}),ie(()=>y.show,N=>{N?d.value={}:w()});const E=()=>(d.value={},n.value.companyName.trim()?n.value.companyName.trim().length<2?d.value.companyName="公司名稱至少需要2個字符":n.value.companyName.trim().length>100&&(d.value.companyName="公司名稱不能超過100個字符"):d.value.companyName="公司名稱不能為空",n.value.companyUnifiedNumber.trim()?/^\d{8}$/.test(n.value.companyUnifiedNumber.trim())||(d.value.companyUnifiedNumber="統一編號必須為8位數字"):d.value.companyUnifiedNumber="統一編號不能為空",n.value.companyType||(d.value.companyType="請選擇公司類型"),n.value.companyType==="CONTRACTOR"&&!n.value.contractorLevel&&(d.value.contractorLevel="請選擇營造等級"),Object.keys(d.value).length===0),$=async()=>{if(E()){b.value=!0;try{const N={companyName:n.value.companyName.trim(),companyUnifiedNumber:n.value.companyUnifiedNumber.trim(),companyType:n.value.companyType,contractorLevel:n.value.contractorLevel};C("submit",N)}catch(N){console.error("Submit error:",N)}finally{b.value=!1}}},L=()=>{$()},R=N=>{d.value[N]&&delete d.value[N]};return(N,m)=>(i(),ue(ae,{show:y.show,"onUpdate:show":m[8]||(m[8]=f=>y.show=f),title:v.value,icon:"fa fa-building",size:"lg","modal-id":"companyFormModal","confirm-text":_.value,"confirm-icon":"fa fa-save","is-loading":b.value,"loading-text":"處理中...",onHide:p,onConfirm:L},{body:k(()=>[e("form",{onSubmit:O($,["prevent"])},[e("div",be,[m[9]||(m[9]=e("label",{for:"companyName",class:"form-label"},[g(" 公司名稱 "),e("span",{class:"text-danger"},"*")],-1)),M(e("input",{id:"companyName",type:"text",class:S(["form-control",{"is-invalid":d.value.companyName}]),"onUpdate:modelValue":m[0]||(m[0]=f=>n.value.companyName=f),onInput:m[1]||(m[1]=f=>R("companyName")),placeholder:"請輸入公司名稱",maxlength:"100",disabled:b.value},null,42,ge),[[D,n.value.companyName]]),d.value.companyName?(i(),u("div",xe,c(d.value.companyName),1)):T("",!0),e("div",Ne,c(n.value.companyName.length)+"/100 字符 ",1)]),e("div",Ce,[m[10]||(m[10]=e("label",{for:"companyCode",class:"form-label"},[g(" 統一編號 "),e("span",{class:"text-danger"},"*")],-1)),M(e("input",{id:"companyCode",type:"text",class:S(["form-control",{"is-invalid":d.value.companyUnifiedNumber}]),"onUpdate:modelValue":m[2]||(m[2]=f=>n.value.companyUnifiedNumber=f),onInput:m[3]||(m[3]=f=>R("companyUnifiedNumber")),placeholder:"請輸入8位數統一編號",maxlength:"8",disabled:b.value},null,42,_e),[[D,n.value.companyUnifiedNumber]]),d.value.companyUnifiedNumber?(i(),u("div",Ee,c(d.value.companyUnifiedNumber),1)):T("",!0),m[11]||(m[11]=e("div",{class:"form-text"}," 請輸入8位數字的統一編號 ",-1))]),e("div",$e,[m[12]||(m[12]=e("label",{for:"companyType",class:"form-label"},[g(" 公司類型 "),e("span",{class:"text-danger"},"*")],-1)),M(e("select",{id:"companyType",class:S(["form-select",{"is-invalid":d.value.companyType}]),"onUpdate:modelValue":m[4]||(m[4]=f=>n.value.companyType=f),onChange:m[5]||(m[5]=f=>R("companyType")),disabled:b.value},[(i(!0),u(F,null,j(A(Y),f=>(i(),u("option",{key:f.value,value:f.value},c(f.label),9,Me))),128))],42,we),[[V,n.value.companyType]]),d.value.companyType?(i(),u("div",Ie,c(d.value.companyType),1)):T("",!0)]),n.value.companyType==="CONTRACTOR"?(i(),u("div",he,[m[13]||(m[13]=e("label",{for:"contractorLevel",class:"form-label"},[g(" 營造等級 "),e("span",{class:"text-danger"},"*")],-1)),M(e("select",{id:"contractorLevel",class:S(["form-select",{"is-invalid":d.value.contractorLevel}]),"onUpdate:modelValue":m[6]||(m[6]=f=>n.value.contractorLevel=f),onChange:m[7]||(m[7]=f=>R("contractorLevel")),disabled:b.value},[(i(!0),u(F,null,j(A(de),f=>(i(),u("option",{key:f.value,value:f.value},c(f.label),9,ke))),128))],42,Te),[[V,n.value.contractorLevel]]),d.value.contractorLevel?(i(),u("div",Re,c(d.value.contractorLevel),1)):T("",!0)])):T("",!0),Object.keys(d.value).length>0?(i(),u("div",Ae," 請修正以上錯誤後再提交 ")):T("",!0)],32)]),_:1},8,["show","title","confirm-text","is-loading"]))}}),Ve=K(Le,[["__scopeId","data-v-2e8a56d6"]]),Se={class:"company-management-tab"},De={class:"d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4 gap-3"},Ue={class:"d-flex flex-column flex-md-row gap-3 flex-grow-1"},Oe={class:"flex-grow-1",style:{"max-width":"400px"}},Pe={class:"input-group"},Be={style:{"min-width":"150px"}},We=["value"],Fe={style:{"min-width":"120px"}},je=["value"],Ge={key:0,class:"text-center py-4"},qe={key:1,class:"alert alert-danger"},He={key:2,class:"text-center py-5"},ze={class:"text-muted mb-2"},Ye={class:"text-muted mb-3"},Ze={key:3,class:"row g-3"},Qe={class:"d-flex justify-content-between align-items-start mb-3"},Je={class:"flex-grow-1"},Ke=["title"],Xe={class:"text-muted small"},et={class:"dropdown"},tt=["onClick"],st=["onClick"],lt=["onClick"],ot=["onClick"],at=["onClick"],nt={class:"company-info"},rt={class:"d-flex gap-2 mb-2"},it={key:0,class:"text-muted small mb-2 d-flex align-items-center"},ut={class:"text-muted small"},dt={class:"mb-2 d-flex align-items-center"},ct={class:"d-flex align-items-center"},mt=J({__name:"CompanyManagementTab",emits:["manage-members","manage-site-personnel"],setup(G,{emit:U}){const y=ce(),C=y==null?void 0:y.proxy,n=re(),b=U,d=x(!1),I=x(null),v=x(""),_=x(""),p=x(""),w=x(null),E=x(null),$=x(null),L=P(()=>{let a=n.companiesWithUserInfo;if(v.value){const s=v.value.toLowerCase();a=a.filter(l=>l.companyName.toLowerCase().includes(s)||l.companyCode.includes(s)||l.companyType.toLowerCase().includes(s))}return _.value&&(a=a.filter(s=>s.companyType===_.value)),p.value&&(a=a.filter(s=>s.status===p.value)),a}),R=a=>{const s=Y.find(l=>l.value===a);return s?s.label:a},N=a=>{const s=Y.find(l=>l.value===a);return s?s.color:"secondary"},m=a=>{const s=oe.find(l=>l.value===a);return s?s.label:a},f=a=>{const s=oe.find(l=>l.value===a);return s?s.color:"secondary"},X=a=>{const s=de.find(l=>l.value===a);return s?s.label:a},q=a=>{I.value=a||null,d.value=!0},B=()=>{d.value=!1,I.value=null},ee=async a=>{try{I.value?await n.updateCompany(I.value.companyId,a)?(C.$toast.success("公司更新成功！"),B()):C.$toast.error("公司更新失敗，請重試！"):await n.createCompany(a)?(C.$toast.success("公司建立成功！"),B()):C.$toast.error("公司建立失敗，請重試！")}catch(s){console.error("Company form submit error:",s),C.$toast.error("操作失敗，請重試！")}},z=async a=>{if(window.confirm(`確定要刪除公司「${a.companyName}」嗎？此操作無法撤銷。`))try{await n.deleteCompany(a.companyId)?C.$toast.success("公司刪除成功！"):C.$toast.error("公司刪除失敗，請重試！")}catch(l){console.error("Delete company error:",l),C.$toast.error("刪除失敗，請重試！")}},te=a=>{b("manage-members",a.companyId)},se=a=>{b("manage-site-personnel",a.companyId,a.companyName)},r=a=>{w.value=w.value===a?null:a},t=()=>{w.value=null},o=a=>{E.value=a,$.value&&clearTimeout($.value),$.value=setTimeout(()=>{w.value&&w.value!==a&&(w.value=null)},100)},W=()=>{E.value=null,$.value&&clearTimeout($.value)},le=()=>{v.value="",_.value="",p.value=""};return ne(()=>{n.initCompanies()}),(a,s)=>(i(),u("div",Se,[e("div",De,[e("div",Ue,[e("div",Oe,[e("div",Pe,[s[12]||(s[12]=e("span",{class:"input-group-text"},[e("i",{class:"fa fa-search"})],-1)),M(e("input",{type:"text",class:"form-control",placeholder:"搜索公司名稱、統編、聯絡人或信箱...","onUpdate:modelValue":s[0]||(s[0]=l=>v.value=l)},null,512),[[D,v.value]]),v.value?(i(),u("button",{key:0,class:"btn btn-outline-secondary",type:"button",onClick:s[1]||(s[1]=l=>v.value="")},s[11]||(s[11]=[e("i",{class:"fa fa-times"},null,-1)]))):T("",!0)])]),e("div",Be,[M(e("select",{class:"form-select","onUpdate:modelValue":s[2]||(s[2]=l=>_.value=l)},[s[13]||(s[13]=e("option",{value:""},"所有類型",-1)),(i(!0),u(F,null,j(A(Y),l=>(i(),u("option",{key:l.value,value:l.value},c(l.label),9,We))),128))],512),[[V,_.value]])]),e("div",Fe,[M(e("select",{class:"form-select","onUpdate:modelValue":s[3]||(s[3]=l=>p.value=l)},[s[14]||(s[14]=e("option",{value:""},"所有狀態",-1)),(i(!0),u(F,null,j(A(oe),l=>(i(),u("option",{key:l.value,value:l.value},c(l.label),9,je))),128))],512),[[V,p.value]])]),v.value||_.value||p.value?(i(),u("button",{key:0,class:"btn btn-outline-secondary",onClick:le},s[15]||(s[15]=[e("i",{class:"fa fa-eraser me-1"},null,-1),g(" 清除 ")]))):T("",!0)]),e("button",{class:"btn btn-theme",onClick:s[4]||(s[4]=l=>q())},s[16]||(s[16]=[e("i",{class:"fa fa-plus me-2"},null,-1),g(" 新增公司 ")]))]),A(n).isLoading?(i(),u("div",Ge,s[17]||(s[17]=[e("div",{class:"spinner-border text-theme",role:"status"},[e("span",{class:"visually-hidden"},"載入中...")],-1),e("div",{class:"mt-2 text-muted"},"載入公司資料中...",-1)]))):A(n).error?(i(),u("div",qe,[s[18]||(s[18]=e("i",{class:"fa fa-exclamation-triangle me-2"},null,-1)),g(" "+c(A(n).error)+" ",1),e("button",{class:"btn btn-sm btn-outline-danger ms-2",onClick:s[5]||(s[5]=l=>A(n).initCompanies())}," 重試 ")])):L.value.length===0?(i(),u("div",He,[s[20]||(s[20]=e("div",{class:"mb-3"},[e("i",{class:"fa fa-building fa-3x text-muted"})],-1)),e("h5",ze,c(A(n).companies.length===0?"尚未建立任何公司":"找不到符合條件的公司"),1),e("p",Ye,c(A(n).companies.length===0?"開始建立您的第一個公司":"請調整搜索條件或新增公司"),1),e("button",{class:"btn btn-theme",onClick:s[6]||(s[6]=l=>q())},s[19]||(s[19]=[e("i",{class:"fa fa-plus me-2"},null,-1),g(" 新增公司 ")]))])):(i(),u("div",Ze,[(i(!0),u(F,null,j(L.value,l=>(i(),u("div",{key:l.companyId,class:"col-xl-4 col-lg-6 col-md-6"},[h(Q,{class:S(["h-100",{"dropdown-open":w.value===l.companyId,"card-hover":E.value===l.companyId&&w.value!==l.companyId}]),onMouseenter:H=>o(l.companyId),onMouseleave:W},{default:k(()=>[h(Z,null,{default:k(()=>[e("div",Qe,[e("div",Je,[e("h6",{class:"card-title mb-1 text-truncate",title:l.companyName},c(l.companyName),9,Ke),e("div",Xe," 統編："+c(l.companyCode),1)]),e("div",et,[e("button",{class:"btn btn-sm btn-outline-secondary dropdown-toggle",type:"button",onClick:O(H=>r(l.companyId),["stop"])},s[21]||(s[21]=[e("i",{class:"fa fa-cog"},null,-1)]),8,tt),M(e("ul",{class:"dropdown-menu dropdown-menu-end show",onClick:s[7]||(s[7]=O(()=>{},["stop"])),onMouseenter:s[8]||(s[8]=O(()=>{},["stop"])),onMouseleave:s[9]||(s[9]=O(()=>{},["stop"]))},[e("li",null,[e("button",{class:"dropdown-item",onClick:H=>{q(l),t()}},s[22]||(s[22]=[e("i",{class:"fa fa-edit me-2"},null,-1),g(" 編輯公司 ")]),8,st)]),e("li",null,[e("button",{class:"dropdown-item",onClick:H=>{te(l),t()}},s[23]||(s[23]=[e("i",{class:"fa fa-users me-2"},null,-1),g(" 管理成員 ")]),8,lt)]),e("li",null,[e("button",{class:"dropdown-item",onClick:H=>{se(l),t()}},s[24]||(s[24]=[e("i",{class:"fa fa-hard-hat me-2"},null,-1),g(" 工地人員管理 ")]),8,ot)]),s[26]||(s[26]=e("li",null,[e("hr",{class:"dropdown-divider"})],-1)),e("li",null,[e("button",{class:"dropdown-item text-danger",onClick:H=>{z(l),t()}},s[25]||(s[25]=[e("i",{class:"fa fa-trash me-2"},null,-1),g(" 刪除公司 ")]),8,at)])],544),[[me,w.value===l.companyId]])])]),e("div",nt,[e("div",rt,[e("span",{class:S(["badge border px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center",`border-${N(l.companyType)} text-${N(l.companyType)}`])},c(R(l.companyType)),3),e("span",{class:S(["badge border px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center",`border-${f(l.status)} text-${f(l.status)}`])},c(m(l.status)),3)]),l.companyType==="CONTRACTOR"&&l.contractorLevel?(i(),u("div",it,[s[27]||(s[27]=e("i",{class:"fa fa-star me-1",style:{width:"16px","text-align":"center"}},null,-1)),g(" 營造等級："+c(X(l.contractorLevel)),1)])):T("",!0),e("div",ut,[e("div",dt,[s[28]||(s[28]=e("i",{class:"fa fa-user-tag me-1",style:{width:"16px","text-align":"center"}},null,-1)),g(" 用戶角色："+c(l.userRole==="OWNER"?"擁有者":l.userRole==="ADMIN"?"管理員":l.userRole==="MEMBER"?"成員":l.userRole==="VIEWER"?"檢視者":l.userRole),1)]),e("div",ct,[s[29]||(s[29]=e("i",{class:"fa fa-calendar me-1",style:{width:"16px","text-align":"center"}},null,-1)),g(" 加入時間："+c(new Date(l.joinedAt||l.createdAt).toLocaleDateString()),1)])])])]),_:2},1024)]),_:2},1032,["class","onMouseenter"])]))),128))])),h(Ve,{show:d.value,"onUpdate:show":s[10]||(s[10]=l=>d.value=l),company:I.value,onHide:B,onSubmit:ee},null,8,["show","company"])]))}}),vt=K(mt,[["__scopeId","data-v-7f683a65"]]),pt={class:"company-member-management"},ft={class:"row mb-3"},yt={class:"col-12"},bt={class:"d-flex align-items-center justify-content-between"},gt={class:"d-flex align-items-center gap-4"},xt={class:"badge border border-primary text-primary"},Nt={class:"badge border border-success text-success"},Ct={class:"badge border border-info text-info"},_t={class:"badge border border-warning text-warning"},Et={class:"badge border border-secondary text-secondary"},$t={class:"badge border border-success text-success"},wt={class:"badge border border-warning text-warning"},Mt={class:"badge border border-danger text-danger"},It={class:"text-muted"},ht={class:"row g-3"},Tt={class:"col-md-6"},kt={class:"input-group"},Rt={class:"col-md-2"},At={class:"col-md-2"},Lt={key:0,class:"text-center py-5"},Vt={key:1,class:"table-responsive"},St={class:"table table-hover mb-0"},Dt={class:"px-4 py-3"},Ut={class:"d-flex align-items-center"},Ot={class:"avatar-circle me-3"},Pt={class:"fw-bold"},Bt={class:"text-muted small"},Wt={key:0,class:"text-muted small"},Ft={class:"px-4 py-3"},jt={key:0,class:"fa fa-crown me-1"},Gt={key:1,class:"fa fa-user-shield me-1"},qt={key:2,class:"fa fa-user me-1"},Ht={key:3,class:"fa fa-eye me-1"},zt={class:"px-4 py-3"},Yt={class:"px-4 py-3 text-muted small"},Zt={class:"px-4 py-3 text-muted small"},Qt={class:"px-4 py-3"},Jt={class:"d-flex justify-content-center gap-1"},Kt=["onClick"],Xt=["onClick"],es=["onClick"],ts={class:"mb-3"},ss={class:"mb-3"},ls={class:"mb-3"},os={class:"mb-3"},as={class:"mb-3"},ns={class:"mb-3"},rs={class:"mb-3"},is=J({__name:"CompanyMemberManagement",props:{companyId:{}},setup(G){const U=G;re();const y=x(!1),C=x(""),n=x(""),b=x(""),d=x(!1),I=x(!1),v=x(null),_=x({email:"",role:"MEMBER",message:""}),p=x([{id:"member-001",userId:"user-001",userName:"王小明",userEmail:"wang@example.com",userPhone:"0912-345-678",role:"OWNER",joinedAt:"2024-01-15T08:00:00Z",status:"ACTIVE",companyId:"comp-001",companyName:"台灣建設股份有限公司"},{id:"member-002",userId:"user-002",userName:"李小華",userEmail:"lee@example.com",userPhone:"0923-456-789",role:"ADMIN",joinedAt:"2024-02-01T09:30:00Z",status:"ACTIVE",invitedBy:"user-001",companyId:"comp-001",companyName:"台灣建設股份有限公司"},{id:"member-003",userId:"user-003",userName:"張工程師",userEmail:"zhang@example.com",role:"MEMBER",joinedAt:"2024-02-15T14:20:00Z",status:"ACTIVE",invitedBy:"user-001",companyId:"comp-001",companyName:"台灣建設股份有限公司"},{id:"member-004",userId:"user-004",userName:"陳助理",userEmail:"chen@example.com",role:"VIEWER",joinedAt:"2024-03-01T10:15:00Z",status:"PENDING",invitedBy:"user-002",companyId:"comp-001",companyName:"台灣建設股份有限公司"}]),w=P(()=>{let r=p.value;if(C.value){const t=C.value.toLowerCase();r=r.filter(o=>o.userName.toLowerCase().includes(t)||o.userEmail.toLowerCase().includes(t)||o.userPhone&&o.userPhone.includes(t))}return n.value&&(r=r.filter(t=>t.role===n.value)),b.value&&(r=r.filter(t=>t.status===b.value)),r}),E=P(()=>{const r=p.value.length,t=p.value.filter(a=>a.status==="ACTIVE").length,o=p.value.filter(a=>a.status==="PENDING").length,W=p.value.filter(a=>a.status==="INACTIVE").length,le={OWNER:p.value.filter(a=>a.role==="OWNER").length,ADMIN:p.value.filter(a=>a.role==="ADMIN").length,MEMBER:p.value.filter(a=>a.role==="MEMBER").length,VIEWER:p.value.filter(a=>a.role==="VIEWER").length};return{total:r,active:t,pending:o,inactive:W,byRole:le}}),$=r=>({OWNER:"擁有者",ADMIN:"管理員",MEMBER:"成員",VIEWER:"檢視者"})[r]||r,L=r=>({OWNER:"danger",ADMIN:"warning",MEMBER:"primary",VIEWER:"secondary"})[r]||"secondary",R=r=>({ACTIVE:"已加入",INACTIVE:"已停用",PENDING:"待確認"})[r]||r,N=r=>({ACTIVE:"success",INACTIVE:"secondary",PENDING:"warning"})[r]||"secondary",m=r=>new Date(r).toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),f=r=>r.role!=="OWNER",X=r=>r.role!=="OWNER",q=()=>{_.value={email:"",role:"MEMBER",message:""},d.value=!0},B=async()=>{y.value=!0;try{const r={id:`member-${Date.now()}`,userId:`user-${Date.now()}`,userName:_.value.email.split("@")[0],userEmail:_.value.email,role:_.value.role,joinedAt:new Date().toISOString(),status:"PENDING",invitedBy:"current-user",companyId:U.companyId,companyName:"當前公司"};p.value.push(r),d.value=!1}catch(r){console.error("邀請成員失敗:",r)}finally{y.value=!1}},ee=r=>{v.value={...r},I.value=!0},z=async()=>{if(v.value){y.value=!0;try{const r=p.value.findIndex(t=>t.id===v.value.id);r!==-1&&(p.value[r]={...v.value}),I.value=!1,v.value=null}catch(r){console.error("更新成員失敗:",r)}finally{y.value=!1}}},te=async r=>{if(window.confirm(`確定要移除成員「${r.userName}」嗎？`)){y.value=!0;try{p.value=p.value.filter(o=>o.id!==r.id)}catch(o){console.error("移除成員失敗:",o)}finally{y.value=!1}}},se=async r=>{y.value=!0,y.value=!1};return ne(()=>{}),(r,t)=>(i(),u("div",pt,[h(Q,{class:"mb-4"},{default:k(()=>[h(Z,null,{default:k(()=>[e("div",ft,[e("div",yt,[e("div",bt,[e("div",gt,[t[12]||(t[12]=e("span",{class:"text-muted"},"總計：",-1)),e("span",xt,c(p.value.length)+" 人",1),e("span",Nt,c(E.value.byRole.OWNER)+" 擁有者",1),e("span",Ct,c(E.value.byRole.ADMIN)+" 管理員",1),e("span",_t,c(E.value.byRole.MEMBER)+" 成員",1),e("span",Et,c(E.value.byRole.VIEWER)+" 檢視者",1),t[13]||(t[13]=e("span",{class:"text-muted ms-3"},"狀態：",-1)),e("span",$t,c(E.value.active)+" 已加入",1),e("span",wt,c(E.value.pending)+" 待確認",1),e("span",Mt,c(E.value.inactive)+" 已停用",1)]),e("small",It,"顯示 "+c(w.value.length)+" / "+c(p.value.length)+" 人",1)])])]),e("div",ht,[e("div",Tt,[e("div",kt,[t[14]||(t[14]=e("span",{class:"input-group-text"},[e("i",{class:"fa fa-search"})],-1)),M(e("input",{type:"text",class:"form-control",placeholder:"搜索成員姓名、信箱或電話...","onUpdate:modelValue":t[0]||(t[0]=o=>C.value=o)},null,512),[[D,C.value]])])]),e("div",Rt,[M(e("select",{class:"form-select","onUpdate:modelValue":t[1]||(t[1]=o=>n.value=o)},t[15]||(t[15]=[e("option",{value:""},"所有角色",-1),e("option",{value:"OWNER"},"擁有者",-1),e("option",{value:"ADMIN"},"管理員",-1),e("option",{value:"MEMBER"},"成員",-1),e("option",{value:"VIEWER"},"檢視者",-1)]),512),[[V,n.value]])]),e("div",At,[M(e("select",{class:"form-select","onUpdate:modelValue":t[2]||(t[2]=o=>b.value=o)},t[16]||(t[16]=[e("option",{value:""},"所有狀態",-1),e("option",{value:"ACTIVE"},"已加入",-1),e("option",{value:"PENDING"},"待確認",-1),e("option",{value:"INACTIVE"},"已停用",-1)]),512),[[V,b.value]])]),e("div",{class:"col-md-2"},[e("button",{class:"btn btn-theme w-100",onClick:q},t[17]||(t[17]=[e("i",{class:"fa fa-plus me-2"},null,-1),g(" 邀請成員 ")]))])])]),_:1})]),_:1}),h(Q,null,{default:k(()=>[h(Z,{class:"p-0"},{default:k(()=>[w.value.length===0?(i(),u("div",Lt,t[18]||(t[18]=[e("i",{class:"fa fa-users fa-3x text-muted mb-3"},null,-1),e("h5",{class:"text-muted"},"沒有找到成員",-1),e("p",{class:"text-muted"},"請嘗試調整搜索條件或邀請新成員",-1)]))):(i(),u("div",Vt,[e("table",St,[t[23]||(t[23]=e("thead",{class:""},[e("tr",null,[e("th",{class:"px-4 py-3"},"成員資訊"),e("th",{class:"px-4 py-3"},"角色"),e("th",{class:"px-4 py-3"},"狀態"),e("th",{class:"px-4 py-3"},"加入時間"),e("th",{class:"px-4 py-3"},"邀請者"),e("th",{class:"px-4 py-3 text-center"},"操作")])],-1)),e("tbody",null,[(i(!0),u(F,null,j(w.value,o=>(i(),u("tr",{key:o.id},[e("td",Dt,[e("div",Ut,[e("div",Ot,c(o.userName.charAt(0)),1),e("div",null,[e("div",Pt,c(o.userName),1),e("div",Bt,c(o.userEmail),1),o.userPhone?(i(),u("div",Wt,[t[19]||(t[19]=e("i",{class:"fa fa-phone me-1"},null,-1)),g(" "+c(o.userPhone),1)])):T("",!0)])])]),e("td",Ft,[e("span",{class:S(["badge border px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center",`border-${L(o.role)} text-${L(o.role)}`])},[o.role==="OWNER"?(i(),u("i",jt)):o.role==="ADMIN"?(i(),u("i",Gt)):o.role==="MEMBER"?(i(),u("i",qt)):(i(),u("i",Ht)),g(" "+c($(o.role)),1)],2)]),e("td",zt,[e("span",{class:S(["badge border px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center",`border-${N(o.status)} text-${N(o.status)}`])},c(R(o.status)),3)]),e("td",Yt,c(m(o.joinedAt)),1),e("td",Zt,c(o.invitedBy?"已邀請":"-"),1),e("td",Qt,[e("div",Jt,[f(o)?(i(),u("button",{key:0,class:"btn btn-sm btn-outline-theme",onClick:W=>ee(o),title:"編輯成員"},t[20]||(t[20]=[e("i",{class:"fa fa-edit"},null,-1)]),8,Kt)):T("",!0),o.status==="PENDING"?(i(),u("button",{key:1,class:"btn btn-sm btn-outline-warning",onClick:W=>se(o),title:"重新發送邀請"},t[21]||(t[21]=[e("i",{class:"fa fa-paper-plane"},null,-1)]),8,Xt)):T("",!0),X(o)?(i(),u("button",{key:2,class:"btn btn-sm btn-outline-danger",onClick:W=>te(o),title:"移除成員"},t[22]||(t[22]=[e("i",{class:"fa fa-trash"},null,-1)]),8,es)):T("",!0)])])]))),128))])])]))]),_:1})]),_:1}),h(ae,{show:d.value,"onUpdate:show":t[6]||(t[6]=o=>d.value=o),title:"邀請新成員",onSubmit:B,isLoading:y.value},{default:k(()=>[e("form",{onSubmit:O(B,["prevent"])},[e("div",ts,[t[24]||(t[24]=e("label",{class:"form-label"},"電子信箱 *",-1)),M(e("input",{type:"email",class:"form-control","onUpdate:modelValue":t[3]||(t[3]=o=>_.value.email=o),placeholder:"請輸入要邀請的電子信箱",required:""},null,512),[[D,_.value.email]])]),e("div",ss,[t[26]||(t[26]=e("label",{class:"form-label"},"角色 *",-1)),M(e("select",{class:"form-select","onUpdate:modelValue":t[4]||(t[4]=o=>_.value.role=o),required:""},t[25]||(t[25]=[e("option",{value:"MEMBER"},"成員",-1),e("option",{value:"ADMIN"},"管理員",-1),e("option",{value:"VIEWER"},"檢視者",-1)]),512),[[V,_.value.role]]),t[27]||(t[27]=e("div",{class:"form-text"},[e("small",{class:"text-muted"},[g(" • "),e("strong",null,"管理員"),g("：可以管理公司資料和成員"),e("br"),g(" • "),e("strong",null,"成員"),g("：可以參與專案和查看公司資料"),e("br"),g(" • "),e("strong",null,"檢視者"),g("：只能查看被授權的內容 ")])],-1))]),e("div",ls,[t[28]||(t[28]=e("label",{class:"form-label"},"邀請訊息",-1)),M(e("textarea",{class:"form-control",rows:"3","onUpdate:modelValue":t[5]||(t[5]=o=>_.value.message=o),placeholder:"可以在邀請信中加入自訂訊息..."},null,512),[[D,_.value.message]])])],32)]),_:1},8,["show","isLoading"]),v.value?(i(),ue(ae,{key:0,show:I.value,"onUpdate:show":t[11]||(t[11]=o=>I.value=o),title:"編輯成員",onSubmit:z,isLoading:y.value},{default:k(()=>[e("form",{onSubmit:O(z,["prevent"])},[e("div",os,[t[29]||(t[29]=e("label",{class:"form-label"},"成員姓名",-1)),M(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[7]||(t[7]=o=>v.value.userName=o),readonly:""},null,512),[[D,v.value.userName]])]),e("div",as,[t[30]||(t[30]=e("label",{class:"form-label"},"電子信箱",-1)),M(e("input",{type:"email",class:"form-control","onUpdate:modelValue":t[8]||(t[8]=o=>v.value.userEmail=o),readonly:""},null,512),[[D,v.value.userEmail]])]),e("div",ns,[t[32]||(t[32]=e("label",{class:"form-label"},"角色 *",-1)),M(e("select",{class:"form-select","onUpdate:modelValue":t[9]||(t[9]=o=>v.value.role=o),required:""},t[31]||(t[31]=[e("option",{value:"ADMIN"},"管理員",-1),e("option",{value:"MEMBER"},"成員",-1),e("option",{value:"VIEWER"},"檢視者",-1)]),512),[[V,v.value.role]])]),e("div",rs,[t[34]||(t[34]=e("label",{class:"form-label"},"狀態 *",-1)),M(e("select",{class:"form-select","onUpdate:modelValue":t[10]||(t[10]=o=>v.value.status=o),required:""},t[33]||(t[33]=[e("option",{value:"ACTIVE"},"已加入",-1),e("option",{value:"INACTIVE"},"已停用",-1),e("option",{value:"PENDING"},"待確認",-1)]),512),[[V,v.value.status]])])],32)]),_:1},8,["show","isLoading"])):T("",!0)]))}}),us=K(is,[["__scopeId","data-v-b72fb6cf"]]),ds={class:"container-fluid"},cs={class:"row"},ms={class:"col-12"},vs={key:0},ps={key:1},fs={key:2},ys=J({__name:"CompanyManagement",setup(G){const U=ve(),y=re(),C=x(!1),n=x("companies"),b=x(""),d=x(""),I=P(()=>b.value?y.companies.find(E=>E.id===b.value):null),v=async()=>{C.value=!0;try{await y.initCompanies()}catch(E){console.error("Failed to refresh data:",E)}finally{C.value=!1}},_=(E,$)=>{n.value=E,$&&(b.value=$)},p=(E,$)=>{U.push("/company/site-personnel")},w=()=>{n.value="companies",b.value="",d.value=""};return ne(()=>{y.initCompanies()}),(E,$)=>{var R;const L=pe("PageHeader");return i(),u("div",ds,[e("div",cs,[e("div",ms,[h(L,{title:n.value==="companies"?"公司管理":n.value==="members"?`${((R=I.value)==null?void 0:R.companyName)||"公司"} - 成員管理`:`${d.value||"公司"} - 工地人員管理`,icon:"fa fa-building",breadcrumbs:[{text:"公司管理",active:!0}],actions:[...n.value==="members"||n.value==="site-personnel"?[{text:"返回公司列表",icon:"fa fa-arrow-left",variant:"btn-outline-secondary",click:w}]:[],{text:"重新載入",icon:"fa fa-refresh",variant:"btn-outline-theme",click:v,disabled:C.value,loading:C.value}]},null,8,["title","actions"]),n.value==="companies"?(i(),u("div",vs,[h(Q,null,{default:k(()=>[h(fe,null,{default:k(()=>$[1]||($[1]=[e("div",{class:"d-flex align-items-center"},[e("i",{class:"fa fa-building me-2"}),e("h5",{class:"mb-0"},"公司列表")],-1)])),_:1,__:[1]}),h(Z,{class:"p-0"},{default:k(()=>[h(vt,{onManageMembers:$[0]||($[0]=N=>_("members",N)),onManageSitePersonnel:p})]),_:1})]),_:1})])):n.value==="members"&&b.value?(i(),u("div",ps,[h(us,{"company-id":b.value},null,8,["company-id"])])):n.value==="site-personnel"&&b.value?(i(),u("div",fs,[h(ye,{"company-id":b.value,"company-name":d.value},null,8,["company-id","company-name"])])):T("",!0)])])])}}}),Ns=K(ys,[["__scopeId","data-v-25a955b1"]]);export{Ns as default};
