import{d as M,j as P,r as m,k as N,a as V,c as W,e as f,f as v,l as e,i as o,p as n,q as y,x,v as a,C as h,m as U,I as k,J as H,K as F,s as q,z as E,S as L,F as R,y as J,_ as K}from"./index-DpB6-9r-.js";import{c as j,d as z,a as O,h as D}from"./forms-bpEku523.js";const G={class:"container-fluid"},Q={class:"row"},X={class:"col-12"},Y={class:"row"},Z={class:"col-lg-4 mb-4"},ee={class:"flex-grow-1 d-flex flex-column justify-content-around"},se={class:"d-flex align-items-center"},te={class:"badge border border-primary text-primary px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center me-2"},le={class:"badge border border-secondary text-secondary px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center"},ae={class:"mb-2"},oe={class:"text-muted small"},ne={class:"row"},ie={class:"col-6"},de={class:"border rounded p-2"},ce={class:"fw-bold"},re={class:"col-6"},ue={class:"border rounded p-2"},me={class:"fw-bold small"},fe={class:"col-lg-8 mb-4"},ve={class:"row"},_e={class:"col-lg-6"},pe={class:"mb-3"},be={class:"form-text small"},xe={class:"col-lg-6"},he={class:"mb-3"},ge={class:"form-check mb-2"},we={class:"form-check"},ye={class:"d-flex justify-content-between align-items-center mt-3 pt-3 border-top"},ke=["disabled"],Se={key:0,class:"mt-3"},Ae={class:"d-flex justify-content-between align-items-center mb-2"},Ie={class:"small"},Ce={class:"progress"},Ne={class:"col-lg-4 mb-4"},Fe={key:0,class:"text-center py-3"},je={key:1},ze={class:"d-flex justify-content-between align-items-start mb-2"},De={class:"mb-1 small"},Te=["onClick"],$e={class:"text-muted small mb-1"},Be={class:"d-flex justify-content-between"},Me={class:"text-muted"},Pe={class:"text-muted"},Ve=M({__name:"FormA7Download",setup(We){const p=P();m(!1);const i=m(!1),r=m(0),b=m(""),S=m(!1),A=m(!0),d={code:"A-7",name:"職安報備書",description:"職業安全衛生管理單位(人員)設置(變更)報備書是確保工程安全衛生符合法規要求的重要文件，包含安全衛生計畫、危害評估、防護措施等內容。",category:"A類表單",version:"v2.1",lastUpdate:"2024-01-20",requiredFields:["安全衛生政策","危害辨識與評估","安全衛生組織","安全衛生教育訓練","個人防護設備","緊急應變計畫","安全衛生檢查","事故調查與改善"]},u=m([{id:1,fileName:"A-7_職安報備書_台北市政府建管處版本_2024-01-20.docx",template:"台北市政府建管處版本",downloadTime:"2024-01-20 16:45:12",fileSize:"1.2 MB"},{id:2,fileName:"A-7_職安報備書_新北市政府工務局版本_2024-01-18.docx",template:"新北市政府工務局版本",downloadTime:"2024-01-18 11:20:35",fileSize:"1.1 MB"}]),I=N(()=>!i.value),g=N(()=>b.value.trim()?b.value.trim():`A-7_職安報備書_${new Date().toISOString().split("T")[0]}`),T=async()=>{var s,c;if(!I.value||i.value)return;i.value=!0,r.value=0;let l=null;try{const t={title:g.value,constructionId:((s=p.currentProject)==null?void 0:s.id)||"",companyId:((c=p.currentWorkspace)==null?void 0:c.companyId)||""};l=setInterval(()=>{r.value<90&&(r.value+=Math.random()*10)},200);const _=await j.downloadReport(t);r.value=100,l&&(clearInterval(l),l=null);const w=`${g.value}.docx`;z(_,w);const B={id:u.value.length+1,fileName:w,template:"A-7 職安報備書",downloadTime:new Date().toLocaleString("zh-TW"),fileSize:O(_.size)};u.value.unshift(B),u.value.length>10&&(u.value=u.value.slice(0,10)),C("下載成功！",`${w} 已開始下載`,"success")}catch(t){console.error("下載失敗:",t),D(t)}finally{l&&clearInterval(l),i.value=!1,r.value=0}},C=(l,s,c="success")=>{},$=async l=>{var s,c;try{i.value=!0;const t={title:l.fileName.replace(".docx","").replace(".pdf",""),constructionId:((s=p.currentProject)==null?void 0:s.id)||"",companyId:((c=p.currentWorkspace)==null?void 0:c.companyId)||""},_=await j.downloadReport(t);z(_,l.fileName),C("重新下載成功",`${l.fileName} 已開始下載`,"success")}catch(t){D(t)}finally{i.value=!1}};return V(()=>{}),(l,s)=>{const c=W("PageHeader");return v(),f("div",G,[e("div",Q,[e("div",X,[o(c,{title:`${d.code} - ${d.name}`,icon:"fa fa-shield-alt",breadcrumbs:[{text:"表單生成與管理",href:"javascript:;"},{text:"A類表單",href:"javascript:;"},{text:`${d.code} ${d.name}`,active:!0}]},null,8,["title","breadcrumbs"]),e("div",Y,[e("div",Z,[o(h,{class:"h-100"},{default:n(()=>[o(y,null,{default:n(()=>s[3]||(s[3]=[e("div",{class:"d-flex align-items-center"},[e("i",{class:"fa fa-info-circle me-2"}),e("h5",{class:"mb-0"},"表單資訊")],-1)])),_:1,__:[3]}),o(x,{class:"d-flex flex-column h-100"},{default:n(()=>[e("div",ee,[e("div",se,[e("span",te,a(d.code),1),e("span",le,a(d.category),1)]),e("div",null,[e("h6",ae,a(d.name),1),e("p",oe,a(d.description),1)]),e("div",null,[e("div",ne,[e("div",ie,[e("div",de,[s[4]||(s[4]=e("div",{class:"text-muted small"},"版本",-1)),e("div",ce,a(d.version),1)])]),e("div",re,[e("div",ue,[s[5]||(s[5]=e("div",{class:"text-muted small"},"更新日期",-1)),e("div",me,a(d.lastUpdate),1)])])])])])]),_:1})]),_:1})]),e("div",fe,[o(h,null,{default:n(()=>[o(y,null,{default:n(()=>s[6]||(s[6]=[e("div",{class:"d-flex align-items-center"},[e("i",{class:"fa fa-cog me-2"}),e("h5",{class:"mb-0"},"下載設定")],-1)])),_:1,__:[6]}),o(x,null,{default:n(()=>[e("div",ve,[e("div",_e,[e("div",pe,[s[7]||(s[7]=e("label",{class:"form-label"},"自訂檔案名稱",-1)),k(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[0]||(s[0]=t=>b.value=t),placeholder:"留空則使用預設名稱"},null,512),[[H,b.value]]),e("div",be," 預設名稱："+a(g.value),1)])]),e("div",xe,[e("div",he,[s[10]||(s[10]=e("label",{class:"form-label"},"附加選項",-1)),e("div",ge,[k(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":s[1]||(s[1]=t=>S.value=t),id:"includeWatermark"},null,512),[[F,S.value]]),s[8]||(s[8]=e("label",{class:"form-check-label small",for:"includeWatermark"}," 包含浮水印 ",-1))]),e("div",we,[k(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":s[2]||(s[2]=t=>A.value=t),id:"includeSignature"},null,512),[[F,A.value]]),s[9]||(s[9]=e("label",{class:"form-check-label small",for:"includeSignature"}," 包含簽名欄位 ",-1))])])])]),e("div",ye,[s[11]||(s[11]=e("div",{class:"text-muted"},[e("i",{class:"fa fa-info-circle me-1"}),e("span",null,"準備下載：A-7 職安報備書")],-1)),e("button",{class:"btn btn-theme btn-lg",onClick:T,disabled:!I.value},[e("i",{class:E(["fa me-2",{"fa-spin fa-spinner":i.value,"fa-download":!i.value}])},null,2),q(" "+a(i.value?"處理中...":"下載表單"),1)],8,ke)]),i.value?(v(),f("div",Se,[e("div",Ae,[s[12]||(s[12]=e("span",{class:"small"},"正在生成文件...",-1)),e("span",Ie,a(Math.round(r.value))+"%",1)]),e("div",Ce,[e("div",{class:"progress-bar progress-bar-striped progress-bar-animated",style:L({width:r.value+"%"})},null,4)])])):U("",!0)]),_:1})]),_:1})]),e("div",Ne,[o(h,null,{default:n(()=>[o(y,null,{default:n(()=>s[13]||(s[13]=[e("div",{class:"d-flex align-items-center"},[e("i",{class:"fa fa-history me-2"}),e("h5",{class:"mb-0"},"最近下載")],-1)])),_:1,__:[13]}),o(x,null,{default:n(()=>[u.value.length===0?(v(),f("div",Fe,s[14]||(s[14]=[e("i",{class:"fa fa-download fa-2x text-muted mb-2"},null,-1),e("p",{class:"text-muted small mb-0"},"尚無下載記錄",-1)]))):(v(),f("div",je,[(v(!0),f(R,null,J(u.value,t=>(v(),f("div",{key:t.id,class:"mb-3"},[o(h,{class:"download-item"},{default:n(()=>[o(x,{class:"p-3"},{default:n(()=>[e("div",ze,[e("h6",De,a(t.template),1),e("button",{class:"btn btn-outline-theme btn-sm",onClick:_=>$(t)},s[15]||(s[15]=[e("i",{class:"fa fa-download"},null,-1)]),8,Te)]),e("p",$e,a(t.fileName),1),e("div",Be,[e("small",Me,a(t.downloadTime),1),e("small",Pe,a(t.fileSize),1)])]),_:2},1024)]),_:2},1024)]))),128))]))]),_:1})]),_:1})])])])])])}}}),qe=K(Ve,[["__scopeId","data-v-a3cdc5b8"]]);export{qe as default};
