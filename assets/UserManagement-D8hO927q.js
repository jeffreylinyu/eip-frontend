import{r as b,$ as I,k as j,a as de,a0 as z,c as D,e as n,f as d,i as f,l as e,p as w,s as c,I as p,J as g,Q as W,v as a,m as x,F as P,y as U,z as v,A as ie,K as re,S as ue}from"./index-CB9Z8Gmd.js";const ce={class:"row mb-4"},me={class:"col-lg-12"},pe={class:"d-flex justify-content-between align-items-center"},be={class:"d-flex align-items-center"},ve={class:"input-group",style:{width:"300px"}},fe={class:"d-flex align-items-center"},ge={class:"row"},xe={class:"col-lg-12"},_e={class:"badge border border-success text-success px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center"},ye={class:"table-responsive"},we={class:"table table-striped table-hover mb-0"},he={class:"d-flex align-items-center"},ke=["src","alt"],Me={class:"fw-bold"},Ce={class:"d-flex flex-wrap gap-1"},Pe=["onClick"],Ue=["onClick"],Le=["onClick"],Ve={key:0,class:"d-flex justify-content-between align-items-center p-3"},Ee={class:"text-muted"},Se={class:"pagination pagination-sm mb-0"},$e=["onClick"],je={class:"modal fade",id:"userModal",tabindex:"-1","aria-labelledby":"userModalLabel","aria-hidden":"true"},De={class:"modal-dialog modal-lg"},qe={class:"modal-content"},Te={class:"modal-header"},Be={class:"modal-title",id:"userModalLabel"},Fe={class:"modal-body"},Ie={class:"row"},ze={class:"col-md-6"},Ae={class:"form-group mb-3"},Ne={class:"col-md-6"},Oe={class:"form-group mb-3"},He=["disabled"],Ke={key:0,class:"form-text"},Re={class:"row"},Je={class:"col-md-6"},Qe={class:"form-group mb-3"},We={class:"col-md-6"},Ge={class:"form-group mb-3"},Xe={key:0,class:"row"},Ye={class:"col-md-6"},Ze={class:"form-group mb-3"},es=["required"],ss={class:"col-md-6"},ts={class:"form-group mb-3"},ls=["required"],os={class:"row"},as={class:"col-12"},ns={class:"form-group mb-3"},ds={class:"row"},is={class:"col-12"},rs={class:"border rounded p-3 mb-3"},us={class:"row"},cs={class:"form-check"},ms=["id","value"],ps=["for"],bs={class:"d-flex align-items-center"},vs={class:"fw-bold"},fs={class:"text-muted"},gs={class:"row"},xs={class:"col-12"},_s={class:"form-group mb-3"},ys={class:"modal-footer"},ws={class:"modal fade",id:"detailModal",tabindex:"-1","aria-labelledby":"detailModalLabel","aria-hidden":"true"},hs={class:"modal-dialog modal-lg"},ks={class:"modal-content"},Ms={key:0,class:"modal-body"},Cs={class:"row"},Ps={class:"col-md-4 text-center"},Us=["src","alt"],Ls={class:"col-md-8"},Vs={class:"table table-borderless"},Es={key:0},Ss={class:"d-flex flex-wrap gap-1"},$s={key:1},js={class:"modal-footer"},Ds={class:"modal fade",id:"deleteModal",tabindex:"-1","aria-labelledby":"deleteModalLabel","aria-hidden":"true"},qs={class:"modal-dialog"},Ts={class:"modal-content"},Bs={key:0,class:"modal-body"},zs={__name:"UserManagement",setup(Fs){const L=b(""),V=b(""),m=b(1),h=b(10),G=I([{key:"general",name:"通用權限",icon:"fa-user",color:"#6c757d",description:"系統基本功能權限，包含查看和基本操作"},{key:"chief_engineer",name:"主辦工程師權限",icon:"fa-crown",color:"#dc3545",description:"最高權限，可管理所有功能和用戶"},{key:"contractor",name:"營造廠商權限",icon:"fa-hard-hat",color:"#fd7e14",description:"營造廠商相關功能權限，包含施工管理"},{key:"supervisor",name:"監造單位權限",icon:"fa-eye",color:"#0d6efd",description:"監造單位相關功能權限，包含監督檢查"}]),_=I([]),r=b(null),k=b(null),u=b(!1),o=I({name:"",username:"",email:"",phone:"",status:"",password:"",confirmPassword:"",permissions:[],remarks:""}),E=b(null),q=b(null),T=b(null),C=j(()=>{let l=_;if(L.value.trim()){const s=L.value.toLowerCase();l=l.filter(i=>i.name.toLowerCase().includes(s)||i.username.toLowerCase().includes(s)||i.email.toLowerCase().includes(s))}return V.value&&(l=l.filter(s=>s.permissions.includes(V.value))),l}),S=j(()=>Math.ceil(C.value.length/h.value)),X=j(()=>{const l=(m.value-1)*h.value,s=l+h.value;return C.value.slice(l,s)}),Y=j(()=>{const l=[],s=S.value,i=m.value;if(s<=7)for(let y=1;y<=s;y++)l.push(y);else i<=4?l.push(1,2,3,4,5,"...",s):i>=s-3?l.push(1,"...",s-4,s-3,s-2,s-1,s):l.push(1,"...",i-1,i,i+1,"...",s);return l}),Z=()=>{var l;u.value=!1,H(),(l=E.value)==null||l.show()},A=l=>{var s,i;u.value=!0,Object.assign(o,{...l,password:"",confirmPassword:"",permissions:[...l.permissions]}),(s=q.value)==null||s.hide(),(i=E.value)==null||i.show()},ee=l=>{var s;r.value=l,(s=q.value)==null||s.show()},N=l=>{var s;k.value=l,(s=T.value)==null||s.show()},se=()=>{var l;if(k.value){const s=_.findIndex(i=>i.id===k.value.id);s!==-1&&_.splice(s,1),k.value=null,(l=T.value)==null||l.hide()}},O=()=>{var l;if(oe()){const s={...o,id:u.value?o.id:Date.now(),createdAt:u.value?o.createdAt:new Date().toLocaleString("zh-TW"),lastLogin:u.value?o.lastLogin:null};u.value?le(s):te(s),(l=E.value)==null||l.hide(),H()}},te=l=>{_.push(l)},le=l=>{const s=_.findIndex(i=>i.id===l.id);s!==-1&&Object.assign(_[s],l)},oe=()=>!(!o.name||!o.username||!o.email||!o.status||o.permissions.length===0||!u.value&&(!o.password||!o.confirmPassword||o.password!==o.confirmPassword||_.some(s=>s.username===o.username))||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o.email)),H=()=>{Object.assign(o,{name:"",username:"",email:"",phone:"",status:"",password:"",confirmPassword:"",permissions:[],remarks:""})},ae=l=>o.permissions.includes(l),K=l=>({active:"啟用",inactive:"停用",pending:"待啟用"})[l]||l,R=l=>({active:"badge border border-success text-success px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center",inactive:"badge border border-danger text-danger px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center",pending:"badge border border-warning text-warning px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center"})[l]||"badge border border-secondary text-secondary px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center",J=l=>({general:"通用",chief_engineer:"主辦工程師",contractor:"營造廠商",supervisor:"監造單位"})[l]||l,Q=l=>({general:"badge border border-secondary text-secondary px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center",chief_engineer:"badge border border-danger text-danger px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center",contractor:"badge border border-warning text-warning px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center",supervisor:"badge border border-primary text-primary px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center"})[l]||"badge border border-secondary text-secondary px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center",B=l=>{l>=1&&l<=S.value&&(m.value=l)};return de(()=>{E.value=new z(document.getElementById("userModal")),q.value=new z(document.getElementById("detailModal")),T.value=new z(document.getElementById("deleteModal"))}),(l,s)=>{const i=D("PageHeader"),y=D("card-body"),F=D("card"),ne=D("card-header");return d(),n("div",null,[f(i,{title:"用戶管理與權限",icon:"fa fa-users",breadcrumbs:[{text:"用戶管理",href:"javascript:;"},{text:"用戶管理與權限",active:!0}]}),e("div",ce,[e("div",me,[f(F,null,{default:w(()=>[f(y,null,{default:w(()=>[e("div",pe,[e("div",be,[e("button",{type:"button",class:"btn btn-theme me-2",onClick:Z},s[15]||(s[15]=[e("i",{class:"fa fa-plus me-1"},null,-1),c(" 新增用戶 ")])),e("div",ve,[s[16]||(s[16]=e("span",{class:"input-group-text"},[e("i",{class:"fa fa-search"})],-1)),p(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[0]||(s[0]=t=>L.value=t),placeholder:"搜尋用戶姓名、帳號或Email..."},null,512),[[g,L.value]])])]),e("div",fe,[s[18]||(s[18]=e("label",{class:"form-label me-2 mb-0"},"權限篩選：",-1)),p(e("select",{class:"form-select","onUpdate:modelValue":s[1]||(s[1]=t=>V.value=t),style:{width:"200px"}},s[17]||(s[17]=[e("option",{value:""},"全部權限",-1),e("option",{value:"general"},"通用權限",-1),e("option",{value:"chief_engineer"},"主辦工程師權限",-1),e("option",{value:"contractor"},"營造廠商權限",-1),e("option",{value:"supervisor"},"監造單位權限",-1)]),512),[[W,V.value]])])])]),_:1})]),_:1})])]),e("div",ge,[e("div",xe,[f(F,null,{default:w(()=>[f(ne,{class:"fw-bold d-flex justify-content-between align-items-center"},{default:w(()=>[s[19]||(s[19]=e("span",null,"用戶列表",-1)),e("span",_e,"總計 "+a(C.value.length)+" 位用戶",1)]),_:1,__:[19]}),f(y,{class:"p-0"},{default:w(()=>[e("div",ye,[e("table",we,[s[23]||(s[23]=e("thead",{class:"table-theme"},[e("tr",null,[e("th",{width:"5%"},"#"),e("th",{width:"15%"},"姓名"),e("th",{width:"15%"},"帳號"),e("th",{width:"20%"},"Email"),e("th",{width:"10%"},"狀態"),e("th",{width:"25%"},"權限"),e("th",{width:"10%"},"操作")])],-1)),e("tbody",null,[(d(!0),n(P,null,U(X.value,(t,$)=>(d(),n("tr",{key:t.id},[e("td",null,a((m.value-1)*h.value+$+1),1),e("td",null,[e("div",he,[e("img",{src:t.avatar,alt:t.name,class:"rounded-circle me-2",width:"32",height:"32"},null,8,ke),e("span",Me,a(t.name),1)])]),e("td",null,a(t.username),1),e("td",null,a(t.email),1),e("td",null,[e("span",{class:v(R(t.status))},a(K(t.status)),3)]),e("td",null,[e("div",Ce,[(d(!0),n(P,null,U(t.permissions,M=>(d(),n("span",{key:M,class:v(Q(M))},a(J(M)),3))),128))])]),e("td",null,[e("div",null,[e("button",{type:"button",class:"btn btn-sm btn-outline-primary me-1",onClick:M=>ee(t)},s[20]||(s[20]=[e("i",{class:"fa fa-eye"},null,-1)]),8,Pe),e("button",{type:"button",class:"btn btn-sm btn-outline-warning me-1",onClick:M=>A(t)},s[21]||(s[21]=[e("i",{class:"fa fa-edit"},null,-1)]),8,Ue),e("button",{type:"button",class:"btn btn-sm btn-outline-danger",onClick:M=>N(t)},s[22]||(s[22]=[e("i",{class:"fa fa-trash"},null,-1)]),8,Le)])])]))),128))])])]),S.value>1?(d(),n("div",Ve,[e("div",Ee," 顯示第 "+a((m.value-1)*h.value+1)+" - "+a(Math.min(m.value*h.value,C.value.length))+" 項，共 "+a(C.value.length)+" 項 ",1),e("nav",null,[e("ul",Se,[e("li",{class:v(["page-item",{disabled:m.value===1}])},[e("button",{class:"page-link",onClick:s[2]||(s[2]=t=>B(m.value-1))},"上一頁")],2),(d(!0),n(P,null,U(Y.value,t=>(d(),n("li",{key:t,class:v(["page-item",{active:t===m.value}])},[e("button",{class:"page-link",onClick:$=>B(t)},a(t),9,$e)],2))),128)),e("li",{class:v(["page-item",{disabled:m.value===S.value}])},[e("button",{class:"page-link",onClick:s[3]||(s[3]=t=>B(m.value+1))},"下一頁")],2)])])])):x("",!0)]),_:1})]),_:1})])]),e("div",je,[e("div",De,[e("div",qe,[e("div",Te,[e("h5",Be,a(u.value?"編輯用戶":"新增用戶"),1),s[24]||(s[24]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",Fe,[e("form",{onSubmit:ie(O,["prevent"])},[e("div",Ie,[e("div",ze,[e("div",Ae,[s[25]||(s[25]=e("label",{class:"form-label"},[c(" 姓名 "),e("span",{class:"text-danger"},"*")],-1)),p(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[4]||(s[4]=t=>o.name=t),required:""},null,512),[[g,o.name]])])]),e("div",Ne,[e("div",Oe,[s[26]||(s[26]=e("label",{class:"form-label"},[c(" 帳號 "),e("span",{class:"text-danger"},"*")],-1)),p(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[5]||(s[5]=t=>o.username=t),disabled:u.value,required:""},null,8,He),[[g,o.username]]),u.value?(d(),n("div",Ke," 帳號建立後無法修改 ")):x("",!0)])])]),e("div",Re,[e("div",Je,[e("div",Qe,[s[27]||(s[27]=e("label",{class:"form-label"},[c(" Email "),e("span",{class:"text-danger"},"*")],-1)),p(e("input",{type:"email",class:"form-control","onUpdate:modelValue":s[6]||(s[6]=t=>o.email=t),required:""},null,512),[[g,o.email]])])]),e("div",We,[e("div",Ge,[s[29]||(s[29]=e("label",{class:"form-label"},[c(" 狀態 "),e("span",{class:"text-danger"},"*")],-1)),p(e("select",{class:"form-select","onUpdate:modelValue":s[7]||(s[7]=t=>o.status=t),required:""},s[28]||(s[28]=[e("option",{value:""},"請選擇狀態",-1),e("option",{value:"active"},"啟用",-1),e("option",{value:"inactive"},"停用",-1),e("option",{value:"pending"},"待啟用",-1)]),512),[[W,o.status]])])])]),u.value?x("",!0):(d(),n("div",Xe,[e("div",Ye,[e("div",Ze,[s[30]||(s[30]=e("label",{class:"form-label"},[c(" 密碼 "),e("span",{class:"text-danger"},"*")],-1)),p(e("input",{type:"password",class:"form-control","onUpdate:modelValue":s[8]||(s[8]=t=>o.password=t),required:!u.value},null,8,es),[[g,o.password]])])]),e("div",ss,[e("div",ts,[s[31]||(s[31]=e("label",{class:"form-label"},[c(" 確認密碼 "),e("span",{class:"text-danger"},"*")],-1)),p(e("input",{type:"password",class:"form-control","onUpdate:modelValue":s[9]||(s[9]=t=>o.confirmPassword=t),required:!u.value},null,8,ls),[[g,o.confirmPassword]])])])])),e("div",os,[e("div",as,[e("div",ns,[s[32]||(s[32]=e("label",{class:"form-label"},"聯絡電話",-1)),p(e("input",{type:"tel",class:"form-control","onUpdate:modelValue":s[10]||(s[10]=t=>o.phone=t)},null,512),[[g,o.phone]])])])]),e("div",ds,[e("div",is,[s[34]||(s[34]=e("label",{class:"form-label"},[c(" 權限設定 "),e("span",{class:"text-danger"},"*")],-1)),e("div",rs,[e("div",us,[(d(!0),n(P,null,U(G,t=>(d(),n("div",{key:t.key,class:"col-md-6 mb-3"},[f(F,{class:v(["h-100 permission-card",{"border-theme":ae(t.key)}])},{default:w(()=>[f(y,{class:"p-3"},{default:w(()=>[e("div",cs,[p(e("input",{class:"form-check-input",type:"checkbox",id:t.key,value:t.key,"onUpdate:modelValue":s[11]||(s[11]=$=>o.permissions=$)},null,8,ms),[[re,o.permissions]]),e("label",{class:"form-check-label",for:t.key},[e("div",bs,[e("i",{class:v(["fa me-2",t.icon]),style:ue({color:t.color})},null,6),e("div",null,[e("div",vs,a(t.name),1),e("small",fs,a(t.description),1)])])],8,ps)])]),_:2},1024)]),_:2},1032,["class"])]))),128))]),s[33]||(s[33]=e("div",{class:"form-text"},[e("i",{class:"fa fa-info-circle me-1"}),c(" 用戶可以擁有多種權限，主辦工程師權限為最高權限 ")],-1))])])]),e("div",gs,[e("div",xs,[e("div",_s,[s[35]||(s[35]=e("label",{class:"form-label"},"備註",-1)),p(e("textarea",{class:"form-control",rows:"3","onUpdate:modelValue":s[12]||(s[12]=t=>o.remarks=t)},null,512),[[g,o.remarks]])])])])],32)]),e("div",ys,[s[37]||(s[37]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 取消 ",-1)),e("button",{type:"button",class:"btn btn-theme",onClick:O},[e("i",{class:v(["fa me-1",u.value?"fa-save":"fa-plus"])},null,2),c(" "+a(u.value?"更新":"新增"),1)]),u.value?(d(),n("button",{key:0,type:"button",class:"btn btn-danger",onClick:s[13]||(s[13]=t=>N(o))},s[36]||(s[36]=[e("i",{class:"fa fa-trash me-1"},null,-1),c(" 刪除 ")]))):x("",!0)])])])]),e("div",ws,[e("div",hs,[e("div",ks,[s[47]||(s[47]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"detailModalLabel"},"用戶詳細資訊"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),r.value?(d(),n("div",Ms,[e("div",Cs,[e("div",Ps,[e("img",{src:r.value.avatar||"/assets/img/user/profile.jpg",alt:r.value.name,class:"img-fluid rounded-circle mb-3",style:{width:"120px",height:"120px","object-fit":"cover"}},null,8,Us),e("h5",null,a(r.value.name),1),e("span",{class:v(R(r.value.status))},a(K(r.value.status)),3)]),e("div",Ls,[e("table",Vs,[e("tbody",null,[e("tr",null,[s[38]||(s[38]=e("td",{class:"fw-bold"},"帳號：",-1)),e("td",null,a(r.value.username),1)]),e("tr",null,[s[39]||(s[39]=e("td",{class:"fw-bold"},"Email：",-1)),e("td",null,a(r.value.email),1)]),r.value.phone?(d(),n("tr",Es,[s[40]||(s[40]=e("td",{class:"fw-bold"},"聯絡電話：",-1)),e("td",null,a(r.value.phone),1)])):x("",!0),e("tr",null,[s[41]||(s[41]=e("td",{class:"fw-bold"},"建立時間：",-1)),e("td",null,a(r.value.createdAt),1)]),e("tr",null,[s[42]||(s[42]=e("td",{class:"fw-bold"},"最後登入：",-1)),e("td",null,a(r.value.lastLogin||"尚未登入"),1)]),e("tr",null,[s[43]||(s[43]=e("td",{class:"fw-bold"},"權限：",-1)),e("td",null,[e("div",Ss,[(d(!0),n(P,null,U(r.value.permissions,t=>(d(),n("span",{key:t,class:v(Q(t))},a(J(t)),3))),128))])])]),r.value.remarks?(d(),n("tr",$s,[s[44]||(s[44]=e("td",{class:"fw-bold"},"備註：",-1)),e("td",null,a(r.value.remarks),1)])):x("",!0)])])])])])):x("",!0),e("div",js,[s[46]||(s[46]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 關閉 ",-1)),e("button",{type:"button",class:"btn btn-theme",onClick:s[14]||(s[14]=t=>A(r.value))},s[45]||(s[45]=[e("i",{class:"fa fa-edit me-1"},null,-1),c(" 編輯 ")]))])])])]),e("div",Ds,[e("div",qs,[e("div",Ts,[s[50]||(s[50]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title text-danger",id:"deleteModalLabel"}," 確認刪除 "),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),k.value?(d(),n("div",Bs,[e("p",null,"確定要刪除用戶「"+a(k.value.name)+"」嗎？",1),s[48]||(s[48]=e("p",{class:"text-muted"},"此操作無法復原，將會刪除該用戶的所有相關資料。",-1))])):x("",!0),e("div",{class:"modal-footer"},[s[49]||(s[49]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 取消 ",-1)),e("button",{type:"button",class:"btn btn-danger",onClick:se}," 確認刪除 ")])])])])])}}};export{zs as default};
