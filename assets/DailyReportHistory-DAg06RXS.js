import{X,r as v,k as x,d as G,E as Z,a as ee,e as b,f as y,l as e,i as T,m as V,s as k,p as C,x as $,I as g,J as S,Q as q,C as H,q as te,v as c,K as N,F as z,y as W,z as M,_ as le}from"./index-DpB6-9r-.js";const se=X("dailyReport",()=>{const u=v(null),n=v(!1),r=v(null),p=v([]),i=x(()=>!1),D=x(()=>u.value?u.value.status==="DRAFT"&&u.value.basicInfo.projectName.trim()!=="":!1),h=x(()=>{var a;return((a=u.value)==null?void 0:a.materials.length)||0}),d=x(()=>u.value?u.value.laborRecords.reduce((a,o)=>a+(o.morning||0)+(o.afternoon||0)+(o.night||0),0):0),E=x(()=>u.value?u.value.equipmentRecords.reduce((a,o)=>a+(o.todayUsage||0),0):0);return{currentReport:u,isLoading:n,error:r,reportHistory:p,hasUnsavedChanges:i,canSubmit:D,totalMaterials:h,totalLabor:d,totalEquipment:E,createNewReport:(a,o)=>{u.value={projectId:a,reportDate:o,status:"DRAFT",basicInfo:{projectName:"",contractPeriod:0,cumulativePeriod:0,todayPeriod:0,todayLaborCount:0,todayEquipmentCount:0,todayMaterialInbound:0},weather:{morning:"",afternoon:""},materials:[],laborRecords:[],equipmentRecords:[],incomingRecords:[],materialInspections:[],safetyRecords:[],constructionRecords:[],importantNotes:[],tomorrowPlans:[],preparer:{reportingDepartment:"",supervisingDepartment:"",reviewer:"",associateManager:"",manager:"",siteManager:"",generalManager:""}}},loadReport:async a=>{n.value=!0,r.value=null;try{await new Promise(o=>setTimeout(o,1e3))}catch(o){r.value="載入日報表失敗",console.error("載入日報表失敗:",o)}finally{n.value=!1}},saveDraft:async()=>{if(u.value){n.value=!0,r.value=null;try{await new Promise(a=>setTimeout(a,1e3))}catch(a){r.value="儲存草稿失敗",console.error("儲存草稿失敗:",a)}finally{n.value=!1}}},submitReport:async()=>{if(!(!u.value||!D.value)){n.value=!0,r.value=null;try{await new Promise(a=>setTimeout(a,1e3)),u.value.status="SUBMITTED"}catch(a){r.value="送出審核失敗",console.error("送出審核失敗:",a)}finally{n.value=!1}}},copyFromYesterday:async()=>{if(u.value){n.value=!0,r.value=null;try{await new Promise(a=>setTimeout(a,1e3))}catch(a){r.value="複製昨天資料失敗",console.error("複製昨天資料失敗:",a)}finally{n.value=!1}}},loadReportHistory:async(a,o,I)=>{n.value=!0,r.value=null;try{await new Promise(R=>setTimeout(R,1e3))}catch(R){r.value="載入歷史記錄失敗",console.error("載入歷史記錄失敗:",R)}finally{n.value=!1}},exportToExcel:async a=>{n.value=!0,r.value=null;try{await new Promise(o=>setTimeout(o,2e3))}catch(o){r.value="匯出 Excel 失敗",console.error("匯出 Excel 失敗:",o)}finally{n.value=!1}},importFromExcel:async a=>{n.value=!0,r.value=null;try{await new Promise(o=>setTimeout(o,2e3))}catch(o){r.value="匯入 Excel 失敗",console.error("匯入 Excel 失敗:",o)}finally{n.value=!1}},clearError:()=>{r.value=null},reset:()=>{u.value=null,n.value=!1,r.value=null,p.value=[]}}}),ae={class:"daily-report-history"},oe={class:"d-flex justify-content-between align-items-center mb-4"},ne={class:"d-flex gap-2"},re=["disabled"],ue={class:"row"},ie={class:"col-md-3 mb-3"},de={class:"col-md-2 mb-3"},ce={class:"col-md-2 mb-3"},ve={class:"col-md-2 mb-3"},me={class:"col-md-3 mb-3 d-flex align-items-end"},pe={class:"d-flex gap-2 w-100"},fe=["disabled"],be={class:"d-flex justify-content-between align-items-center"},ye={class:"d-flex align-items-center gap-2"},ge={class:"text-muted fs-sm"},xe={class:"form-check"},De={class:"table-responsive"},Re={class:"table table-hover"},we={class:"table-light"},Ee={style:{width:"40px"}},Te=["value"],ke={class:"fw-bold"},Ce={class:"text-muted"},he={class:"badge bg-primary"},Pe={class:"badge bg-success"},Me={class:"badge bg-warning"},Ie={class:"btn-group btn-group-sm"},Ve=["onClick"],Se=["onClick"],Ne=["onClick"],Ue={key:0},Ae={class:"d-flex justify-content-between align-items-center mt-4"},Fe={class:"d-flex align-items-center gap-2"},je={class:"pagination pagination-sm mb-0"},Be=["onClick"],Le={key:0,class:"loading-overlay"},_e=G({__name:"DailyReportHistory",setup(u){const n=Z(),r=se(),p=v([]),i=v([]),D=v(!1),h=v(0),d=v(1),E=v(20),m=v({projectName:"",startDate:"",endDate:"",status:""}),w=x({get:()=>i.value.length===p.value.length&&p.value.length>0,set:s=>{s?i.value=p.value.map(t=>t.id).filter(Boolean):i.value=[]}}),P=x(()=>Math.ceil(h.value/E.value)),U=x(()=>{const s=[],t=Math.max(1,d.value-2),l=Math.min(P.value,d.value+2);for(let f=t;f<=l;f++)s.push(f);return s}),A=s=>new Date(s).toLocaleDateString("zh-TW"),F=s=>s?new Date(s).toLocaleString("zh-TW"):"-",j=s=>({DRAFT:"bg-secondary",SUBMITTED:"bg-primary",REVIEWED:"bg-warning",APPROVED:"bg-success",REJECTED:"bg-danger"})[s]||"bg-secondary",B=s=>({DRAFT:"草稿",SUBMITTED:"已送出",REVIEWED:"審核中",APPROVED:"已核准",REJECTED:"已退回"})[s]||"未知",L=s=>s.laborRecords.reduce((t,l)=>t+(l.morning||0)+(l.afternoon||0)+(l.night||0),0),_=s=>s.equipmentRecords.reduce((t,l)=>t+(l.todayUsage||0),0),a=async()=>{D.value=!0;try{await new Promise(s=>setTimeout(s,1e3))}catch(s){console.error("搜尋失敗:",s)}finally{D.value=!1}},o=()=>{m.value={projectName:"",startDate:"",endDate:"",status:""},d.value=1,a()},I=()=>{w.value?i.value=p.value.map(s=>s.id).filter(Boolean):i.value=[]},R=s=>{s>=1&&s<=P.value&&(d.value=s,a())},J=()=>{n.push("/daily-report")},O=s=>{n.push(`/daily-report/view/${s}`)},Y=s=>{n.push(`/daily-report/edit/${s}`)},K=async s=>{try{await r.exportToExcel(s)}catch(t){console.error("匯出失敗:",t)}},Q=async()=>{i.value.length};return ee(()=>{a()}),(s,t)=>(y(),b("div",ae,[e("div",oe,[t[12]||(t[12]=e("div",null,[e("h4",{class:"mb-1"},"日報表歷史記錄"),e("p",{class:"text-muted mb-0"},"瀏覽和管理歷史日報表")],-1)),e("div",ne,[e("button",{class:"btn btn-outline-primary",onClick:J},t[10]||(t[10]=[e("i",{class:"fa fa-plus me-1"},null,-1),k("新增日報表 ")])),e("button",{class:"btn btn-outline-success",onClick:Q,disabled:i.value.length===0},t[11]||(t[11]=[e("i",{class:"fa fa-download me-1"},null,-1),k("匯出選取 ")]),8,re)])]),T(H,{class:"mb-4"},{default:C(()=>[T($,null,{default:C(()=>[e("div",ue,[e("div",ie,[t[13]||(t[13]=e("label",{class:"form-label"},"工程名稱",-1)),g(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=l=>m.value.projectName=l),placeholder:"搜尋工程名稱"},null,512),[[S,m.value.projectName]])]),e("div",de,[t[14]||(t[14]=e("label",{class:"form-label"},"開始日期",-1)),g(e("input",{type:"date",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=l=>m.value.startDate=l)},null,512),[[S,m.value.startDate]])]),e("div",ce,[t[15]||(t[15]=e("label",{class:"form-label"},"結束日期",-1)),g(e("input",{type:"date",class:"form-control","onUpdate:modelValue":t[2]||(t[2]=l=>m.value.endDate=l)},null,512),[[S,m.value.endDate]])]),e("div",ve,[t[17]||(t[17]=e("label",{class:"form-label"},"狀態",-1)),g(e("select",{class:"form-select","onUpdate:modelValue":t[3]||(t[3]=l=>m.value.status=l)},t[16]||(t[16]=[e("option",{value:""},"全部狀態",-1),e("option",{value:"DRAFT"},"草稿",-1),e("option",{value:"SUBMITTED"},"已送出",-1),e("option",{value:"REVIEWED"},"審核中",-1),e("option",{value:"APPROVED"},"已核准",-1),e("option",{value:"REJECTED"},"已退回",-1)]),512),[[q,m.value.status]])]),e("div",me,[e("div",pe,[e("button",{class:"btn btn-primary flex-fill",onClick:a,disabled:D.value},t[18]||(t[18]=[e("i",{class:"fa fa-search me-1"},null,-1),k("搜尋 ")]),8,fe),e("button",{class:"btn btn-outline-secondary",onClick:o},t[19]||(t[19]=[e("i",{class:"fa fa-times me-1"},null,-1),k("清除 ")]))])])])]),_:1})]),_:1}),T(H,null,{default:C(()=>[T(te,null,{default:C(()=>[e("div",be,[t[21]||(t[21]=e("h6",{class:"mb-0"},[e("i",{class:"fa fa-list me-2"}),k("日報表列表 ")],-1)),e("div",ye,[e("span",ge,"共 "+c(h.value)+" 筆記錄",1),e("div",xe,[g(e("input",{class:"form-check-input",type:"checkbox",id:"selectAll","onUpdate:modelValue":t[4]||(t[4]=l=>w.value=l),onChange:I},null,544),[[N,w.value]]),t[20]||(t[20]=e("label",{class:"form-check-label fs-sm",for:"selectAll"}," 全選 ",-1))])])])]),_:1}),T($,null,{default:C(()=>[e("div",De,[e("table",Re,[e("thead",we,[e("tr",null,[e("th",Ee,[g(e("input",{type:"checkbox",class:"form-check-input","onUpdate:modelValue":t[5]||(t[5]=l=>w.value=l),onChange:I},null,544),[[N,w.value]])]),t[22]||(t[22]=e("th",null,"工程名稱",-1)),t[23]||(t[23]=e("th",null,"日期",-1)),t[24]||(t[24]=e("th",null,"狀態",-1)),t[25]||(t[25]=e("th",null,"材料種類",-1)),t[26]||(t[26]=e("th",null,"出工人數",-1)),t[27]||(t[27]=e("th",null,"機具數量",-1)),t[28]||(t[28]=e("th",null,"製表人",-1)),t[29]||(t[29]=e("th",null,"建立時間",-1)),t[30]||(t[30]=e("th",{style:{width:"120px"}},"操作",-1))])]),e("tbody",null,[(y(!0),b(z,null,W(p.value,l=>(y(),b("tr",{key:l.id},[e("td",null,[g(e("input",{type:"checkbox",class:"form-check-input",value:l.id,"onUpdate:modelValue":t[6]||(t[6]=f=>i.value=f)},null,8,Te),[[N,i.value]])]),e("td",null,[e("div",ke,c(l.basicInfo.projectName),1),e("small",Ce,c(l.projectId),1)]),e("td",null,c(A(l.reportDate)),1),e("td",null,[e("span",{class:M(["badge",j(l.status)])},c(B(l.status)),3)]),e("td",null,[e("span",he,c(l.materials.length),1)]),e("td",null,[e("span",Pe,c(L(l)),1)]),e("td",null,[e("span",Me,c(_(l)),1)]),e("td",null,c(l.preparer.reportingDepartment||"-"),1),e("td",null,c(F(l.createdAt)),1),e("td",null,[e("div",Ie,[e("button",{class:"btn btn-outline-primary",onClick:f=>O(l.id),title:"檢視"},t[31]||(t[31]=[e("i",{class:"fa fa-eye"},null,-1)]),8,Ve),l.status==="DRAFT"?(y(),b("button",{key:0,class:"btn btn-outline-secondary",onClick:f=>Y(l.id),title:"編輯"},t[32]||(t[32]=[e("i",{class:"fa fa-edit"},null,-1)]),8,Se)):V("",!0),e("button",{class:"btn btn-outline-success",onClick:f=>K(l.id),title:"匯出"},t[33]||(t[33]=[e("i",{class:"fa fa-download"},null,-1)]),8,Ne)])])]))),128)),p.value.length===0?(y(),b("tr",Ue,t[34]||(t[34]=[e("td",{colspan:"10",class:"text-center text-muted py-4"},[e("i",{class:"fa fa-inbox fa-2x mb-2"}),e("p",{class:"mb-0"},"沒有找到符合條件的日報表")],-1)]))):V("",!0)])])])]),_:1})]),_:1}),e("div",Ae,[e("div",Fe,[t[36]||(t[36]=e("span",{class:"text-muted"},"每頁顯示",-1)),g(e("select",{class:"form-select form-select-sm",style:{width:"auto"},"onUpdate:modelValue":t[7]||(t[7]=l=>E.value=l)},t[35]||(t[35]=[e("option",{value:"10"},"10",-1),e("option",{value:"20"},"20",-1),e("option",{value:"50"},"50",-1),e("option",{value:"100"},"100",-1)]),512),[[q,E.value]]),t[37]||(t[37]=e("span",{class:"text-muted"},"筆記錄",-1))]),e("nav",null,[e("ul",je,[e("li",{class:M(["page-item",{disabled:d.value===1}])},[e("button",{class:"page-link",onClick:t[8]||(t[8]=l=>R(d.value-1))},t[38]||(t[38]=[e("i",{class:"fa fa-chevron-left"},null,-1)]))],2),(y(!0),b(z,null,W(U.value,l=>(y(),b("li",{key:l,class:M(["page-item",{active:l===d.value}])},[e("button",{class:"page-link",onClick:f=>R(l)},c(l),9,Be)],2))),128)),e("li",{class:M(["page-item",{disabled:d.value===P.value}])},[e("button",{class:"page-link",onClick:t[9]||(t[9]=l=>R(d.value+1))},t[39]||(t[39]=[e("i",{class:"fa fa-chevron-right"},null,-1)]))],2)])])]),D.value?(y(),b("div",Le,t[40]||(t[40]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"載入中...")],-1)]))):V("",!0)]))}}),qe=le(_e,[["__scopeId","data-v-c4216683"]]);export{qe as default};
