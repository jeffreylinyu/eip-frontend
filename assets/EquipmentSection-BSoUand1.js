import{d as j,u as F,r as C,C as v,o as I,f as i,g as d,h as t,n as a,k as r,p as n,F as U,G as c,i as V,H as h,I as x,j as f,t as m,y as D,v as b,J as p,N as H,_ as L}from"./index-D_u9nkte.js";import{E as z}from"./dailyReport-CO5OWQqK.js";const G={class:"equipment-section"},J={class:"table-responsive"},Q={class:"table table-bordered table-hover"},W=["onUpdate:modelValue"],Y=["value"],A=["onUpdate:modelValue"],K={class:"input-group"},O=["onUpdate:modelValue"],X={class:"input-group"},Z=["onUpdate:modelValue"],tt={class:"input-group"},et=["onUpdate:modelValue"],st=["onUpdate:modelValue"],lt=["onClick"],at={key:0},nt={class:"table-secondary"},ot={class:"row mt-4"},ut={class:"col-md-3"},it={class:"mb-1"},dt={class:"col-md-3"},mt={class:"mb-1"},rt={class:"col-md-3"},ct={class:"mb-1"},pt={class:"col-md-3"},vt={class:"mb-1"},ft={class:"row mt-4"},_t={class:"col-md-6"},bt={key:0,class:"text-center text-muted"},gt={key:1},yt={class:"d-flex justify-content-between mb-1"},ht={class:"badge bg-primary"},xt={class:"progress",style:{height:"6px"}},Ut={class:"col-md-6"},kt={key:0,class:"text-center text-muted"},wt={key:1,class:"list-unstyled mb-0"},qt={class:"d-flex justify-content-between mt-4"},Nt={class:"d-flex gap-2"},Ct=["disabled"],Vt=["disabled"],Et=j({__name:"EquipmentSection",setup(St){const k=F(),u=C([]),g=C(!1),E=v(()=>z),_=v(()=>u.value.reduce((l,e)=>l+(e.todayUsage||0),0)),w=v(()=>u.value.reduce((l,e)=>l+(e.cumulative||0),0)),S=v(()=>u.value.length===0?0:Math.round(_.value/u.value.length)),q=v(()=>u.value.filter(l=>l.todayUsage>0).sort((l,e)=>(e.todayUsage||0)-(l.todayUsage||0)).slice(0,5).map(l=>({name:l.equipmentName,usage:l.todayUsage,unit:l.unit,percentage:_.value>0?Math.round((l.todayUsage||0)/_.value*100):0}))),N=v(()=>{const l=[];return u.value.forEach((e,s)=>{e.todayUsage>100&&l.push(`${e.equipmentName||`機具${s+1}`}：本日使用量(${e.todayUsage})異常偏高`)}),u.value.forEach((e,s)=>{e.equipmentName||l.push(`第${s+1}行機具未選擇`)}),l}),T=()=>{u.value.push({equipmentName:"",unit:"",todayUsage:0,cumulative:0,remarks:""})},M=l=>{u.value.splice(l,1)},R=()=>{const l=[{equipmentName:"PC-200",unit:"台",todayUsage:0,cumulative:0,remarks:""},{equipmentName:"PC-100",unit:"台",todayUsage:0,cumulative:0,remarks:""},{equipmentName:"PC-60",unit:"台",todayUsage:0,cumulative:0,remarks:""},{equipmentName:"挖土機",unit:"台",todayUsage:0,cumulative:0,remarks:""},{equipmentName:"吊車",unit:"台",todayUsage:0,cumulative:0,remarks:""}];u.value=[...u.value,...l]},B=async()=>{g.value=!0;try{console.log("儲存機具紀錄:",u.value)}catch(l){console.error("儲存失敗:",l)}finally{g.value=!1}},P=()=>{k.push("/daily-report/labor")},$=()=>{k.push("/daily-report/incoming")};return I(()=>{console.log("載入機具紀錄資料")}),(l,e)=>(d(),i("div",G,[t("div",{class:"d-flex justify-content-between align-items-center mb-4"},[e[2]||(e[2]=t("div",null,[t("h4",{class:"mb-1"},"機具出工紀錄"),t("p",{class:"text-muted mb-0"},"管理每日機具使用情況")],-1)),t("div",{class:"d-flex gap-2"},[t("button",{class:"btn btn-outline-primary",onClick:T},e[0]||(e[0]=[t("i",{class:"fa fa-plus me-1"},null,-1),r("新增機具 ")])),t("button",{class:"btn btn-outline-secondary",onClick:R},e[1]||(e[1]=[t("i",{class:"fa fa-download me-1"},null,-1),r("匯入範本 ")]))])]),a(p,null,{default:n(()=>[a(U,null,{default:n(()=>e[3]||(e[3]=[t("h6",{class:"mb-0"},[t("i",{class:"fa fa-cogs me-2"}),r("機具出工紀錄表 ")],-1)])),_:1,__:[3]}),a(c,null,{default:n(()=>[t("div",J,[t("table",Q,[e[12]||(e[12]=t("thead",{class:"table-light"},[t("tr",null,[t("th",{style:{width:"25%"}},"機具名稱"),t("th",{style:{width:"10%"}},"單位"),t("th",{style:{width:"15%"}},"本日出工"),t("th",{style:{width:"15%"}},"累計"),t("th",{style:{width:"20%"}},"備註"),t("th",{style:{width:"5%"}},"操作")])],-1)),t("tbody",null,[(d(!0),i(h,null,x(u.value,(s,y)=>(d(),i("tr",{key:s.id||y},[t("td",null,[f(t("select",{class:"form-select","onUpdate:modelValue":o=>s.equipmentName=o},[e[4]||(e[4]=t("option",{value:""},"請選擇機具",-1)),(d(!0),i(h,null,x(E.value,o=>(d(),i("option",{key:o.name,value:o.name},m(o.name),9,Y))),128)),e[5]||(e[5]=t("option",{value:"custom"},"其他（自訂）",-1))],8,W),[[D,s.equipmentName]]),s.equipmentName==="custom"?f((d(),i("input",{key:0,type:"text",class:"form-control mt-1","onUpdate:modelValue":o=>s.customName=o,placeholder:"請輸入機具名稱"},null,8,A)),[[b,s.customName]]):V("",!0)]),t("td",null,[t("div",K,[f(t("input",{type:"text",class:"form-control","onUpdate:modelValue":o=>s.unit=o,placeholder:"單位"},null,8,O),[[b,s.unit]])])]),t("td",null,[t("div",X,[f(t("input",{type:"number",class:"form-control","onUpdate:modelValue":o=>s.todayUsage=o,min:"0",step:"0.01",placeholder:"0"},null,8,Z),[[b,s.todayUsage]])])]),t("td",null,[t("div",tt,[f(t("input",{type:"number",class:"form-control","onUpdate:modelValue":o=>s.cumulative=o,min:"0",step:"0.01",placeholder:"0"},null,8,et),[[b,s.cumulative]])])]),t("td",null,[f(t("input",{type:"text",class:"form-control","onUpdate:modelValue":o=>s.remarks=o,placeholder:"備註"},null,8,st),[[b,s.remarks]])]),t("td",null,[t("button",{class:"btn btn-sm btn-outline-danger",onClick:o=>M(y),title:"刪除"},e[6]||(e[6]=[t("i",{class:"fa fa-trash"},null,-1)]),8,lt)])]))),128)),u.value.length===0?(d(),i("tr",at,e[7]||(e[7]=[t("td",{colspan:"6",class:"text-center text-muted py-4"},[t("i",{class:"fa fa-cogs fa-2x mb-2"}),t("p",{class:"mb-0"},"尚未新增任何機具紀錄")],-1)]))):V("",!0)]),t("tfoot",nt,[t("tr",null,[e[8]||(e[8]=t("td",null,[t("strong",null,"總計")],-1)),e[9]||(e[9]=t("td",null,null,-1)),t("td",null,[t("strong",null,m(_.value),1)]),t("td",null,[t("strong",null,m(w.value),1)]),e[10]||(e[10]=t("td",null,null,-1)),e[11]||(e[11]=t("td",null,null,-1))])])])])]),_:1})]),_:1}),t("div",ot,[t("div",ut,[a(p,{class:"bg-primary text-white"},{default:n(()=>[a(c,{class:"text-center"},{default:n(()=>[t("h4",it,m(u.value.length),1),e[13]||(e[13]=t("p",{class:"mb-0"},"機具種類",-1))]),_:1,__:[13]})]),_:1})]),t("div",dt,[a(p,{class:"bg-success text-white"},{default:n(()=>[a(c,{class:"text-center"},{default:n(()=>[t("h4",mt,m(_.value),1),e[14]||(e[14]=t("p",{class:"mb-0"},"本日出工總量",-1))]),_:1,__:[14]})]),_:1})]),t("div",rt,[a(p,{class:"bg-warning text-white"},{default:n(()=>[a(c,{class:"text-center"},{default:n(()=>[t("h4",ct,m(w.value),1),e[15]||(e[15]=t("p",{class:"mb-0"},"累計出工總量",-1))]),_:1,__:[15]})]),_:1})]),t("div",pt,[a(p,{class:"bg-info text-white"},{default:n(()=>[a(c,{class:"text-center"},{default:n(()=>[t("h4",vt,m(S.value),1),e[16]||(e[16]=t("p",{class:"mb-0"},"平均使用量",-1))]),_:1,__:[16]})]),_:1})])]),t("div",ft,[t("div",_t,[a(p,null,{default:n(()=>[a(U,null,{default:n(()=>e[17]||(e[17]=[t("h6",{class:"mb-0"},[t("i",{class:"fa fa-chart-bar me-2"}),r("機具使用排行 ")],-1)])),_:1,__:[17]}),a(c,null,{default:n(()=>[q.value.length===0?(d(),i("div",bt,e[18]||(e[18]=[t("i",{class:"fa fa-chart-bar fa-2x mb-2"},null,-1),t("p",{class:"mb-0"},"尚無使用資料",-1)]))):(d(),i("div",gt,[(d(!0),i(h,null,x(q.value,(s,y)=>(d(),i("div",{key:y,class:"mb-3"},[t("div",yt,[t("span",null,m(s.name),1),t("span",ht,m(s.usage)+m(s.unit),1)]),t("div",xt,[t("div",{class:"progress-bar bg-primary",style:H({width:s.percentage+"%"})},null,4)])]))),128))]))]),_:1})]),_:1})]),t("div",Ut,[a(p,null,{default:n(()=>[a(U,null,{default:n(()=>e[19]||(e[19]=[t("h6",{class:"mb-0"},[t("i",{class:"fa fa-exclamation-triangle me-2"}),r("異常提醒 ")],-1)])),_:1,__:[19]}),a(c,null,{default:n(()=>[N.value.length===0?(d(),i("div",kt,e[20]||(e[20]=[t("i",{class:"fa fa-check-circle fa-2x mb-2 text-success"},null,-1),t("p",{class:"mb-0"},"無異常情況",-1)]))):(d(),i("ul",wt,[(d(!0),i(h,null,x(N.value,s=>(d(),i("li",{key:s,class:"mb-2"},[e[21]||(e[21]=t("i",{class:"fa fa-exclamation-triangle text-warning me-2"},null,-1)),r(" "+m(s),1)]))),128))]))]),_:1})]),_:1})])]),t("div",qt,[t("button",{class:"btn btn-outline-secondary",onClick:P},e[22]||(e[22]=[t("i",{class:"fa fa-arrow-left me-1"},null,-1),r("返回出工紀錄 ")])),t("div",Nt,[t("button",{class:"btn btn-primary",onClick:B,disabled:g.value},e[23]||(e[23]=[t("i",{class:"fa fa-save me-1"},null,-1),r("儲存 ")]),8,Ct),t("button",{class:"btn btn-success",onClick:$,disabled:g.value},e[24]||(e[24]=[r(" 下一步 "),t("i",{class:"fa fa-arrow-right ms-1"},null,-1)]),8,Vt)])])]))}}),Rt=L(Et,[["__scopeId","data-v-6a33d30e"]]);export{Rt as default};
