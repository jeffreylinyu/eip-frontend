import{d as T,g as R,j as V,r as o,w as A,a as E,b as O,N as I,c as J,e as b,f as w,i as D,l as r,m as L,s as p,z as U,v as W,F as $,O as M,P as z,_ as H}from"./index-DpB6-9r-.js";import{P as j}from"./ProjectForm-BFEj1EYo.js";import"./format-DXaH7iKE.js";const q={class:"row gx-4"},G={class:"col-lg-12"},K={class:"d-flex justify-content-end gap-2"},Q=["disabled"],X=["disabled"],Y={key:0,class:"alert alert-warning mt-3",role:"alert"},Z=T({__name:"BasicData",setup(ee){const{proxy:l}=R(),a=V(),c=o({project_name:"",contract_number:"",project_location:"",host_agency:"",supervision_unit:"",contractor_name:"",construction_period:"",project_amount:"",project_grade:"",current_contract_amount:"",project_category:"",funding_source:"",sign_date:"",start_date:"",completion_date:"",construction_confirm_date:"",construction_project_id:"",payment_method:"",advance_payment_ratio:"",retention_ratio:"",inspection_methods:[],segmented_acceptance:!1,partial_acceptance:!1,completion_acceptance:!1,insurance_policy_number:"",insurance_company:"",insurance_start_date:"",insurance_end_date:"",insurance_type:"",signLevel:[]}),f=o({}),s=o(!1),i=o(!1),g=o(!1);o(""),o([{text:"åœŸæœ¨å·¥ç¨‹"},{text:"å»ºç¯‰å·¥ç¨‹"}]),o(""),o([{text:"ç”²ç­‰"},{text:"ä¹™ç­‰"}]),o(""),o([{text:"äº¤é€šéƒ¨"}]),o(""),o([]),o([{text:"é“è·¯å·¥ç¨‹"},{text:"æ©‹æ¢å·¥ç¨‹"},{text:"éš§é“å·¥ç¨‹"}]);const u=o(null),v=async e=>{if(!e)return;const t=a.workspaceProjects.find(n=>n.id===e.id);t?d(t):await P(),f.value=JSON.parse(JSON.stringify(c.value)),i.value=!1};A(()=>a.currentProject,async(e,t)=>{e&&e.id!==(t==null?void 0:t.id)&&await v(e)},{immediate:!1});const P=async()=>{if(!a.currentProject)return;const e=a.currentProject;try{await a.getProjectsByWorkspace(e.workspaceId);const t=a.workspaceProjects.find(n=>n.id===e.id);d(t||e)}catch(t){console.error("âŒ è¼‰å…¥å·¥ç¨‹é …ç›®è³‡æ–™å¤±æ•—:",t),d(e),l.$toast.error("è¼‰å…¥å·¥ç¨‹é …ç›®è³‡æ–™å¤±æ•—")}},d=e=>{g.value=!0;try{const t={A1:"ç”²ç­‰",A2:"ç”²ç­‰",B1:"ä¹™ç­‰",B2:"ä¹™ç­‰",C1:"ä¸™ç­‰",C2:"ä¸™ç­‰"},n={ä¸­å¤®æ”¿åºœ:"ä¸€èˆ¬é ç®—",åœ°æ–¹æ”¿åºœ:"ä¸€èˆ¬é ç®—",å‰ç»åŸºç¤å»ºè¨­è¨ˆç•«:"å‰ç»åŸºç¤å»ºè¨­è¨ˆç•«",å°ˆæ¡ˆè£œåŠ©:"å°ˆæ¡ˆè£œåŠ©",ç‰¹åˆ¥é ç®—:"ç‰¹åˆ¥é ç®—"};c.value={project_name:e.name||"",contract_number:e.contractNumber||"",project_location:e.location||"",host_agency:e.hostAgency||"",supervision_unit:e.supervisionUnit||"",contractor_name:e.contractorName||"",construction_period:e.constructionPeriod||"",project_amount:e.budget||"",project_grade:t[e.projectGrade]||e.projectGrade||"",current_contract_amount:e.currentContractAmount||e.budget||"",project_category:e.projectCategory||"",funding_source:n[e.fundingSource]||e.fundingSource||"",sign_date:e.signDate?e.signDate.split("T")[0]:"",start_date:e.startDate?e.startDate.split("T")[0]:"",completion_date:e.endDate?e.endDate.split("T")[0]:"",construction_confirm_date:e.constructionConfirmDate?e.constructionConfirmDate.split("T")[0]:"",construction_project_id:e.constructionProjectId||"",payment_method:e.paymentMethod||"",advance_payment_ratio:e.advancePaymentRatio||"",retention_ratio:e.retentionRatio||"",inspection_methods:e.inspectionMethods||[],segmented_acceptance:e.segmentedAcceptance||!1,partial_acceptance:e.partialAcceptance||!1,completion_acceptance:e.completionAcceptance||!1,insurance_policy_number:e.insurancePolicyNumber||"",insurance_company:e.insuranceCompany||"",insurance_start_date:e.insuranceStartDate?e.insuranceStartDate.split("T")[0]:"",insurance_end_date:e.insuranceEndDate?e.insuranceEndDate.split("T")[0]:"",insurance_type:e.insuranceType||"",signLevel:e.signLevel||[]}}finally{g.value=!1}},y=e=>{if(i.value)return e.preventDefault(),e.returnValue="æ‚¨æœ‰æœªä¿å­˜çš„è®Šæ›´ï¼Œç¢ºå®šè¦é›¢é–‹å—ï¼Ÿ","æ‚¨æœ‰æœªä¿å­˜çš„è®Šæ›´ï¼Œç¢ºå®šè¦é›¢é–‹å—ï¼Ÿ"},h=async()=>{u.value?await u.value.handleSubmit():(console.error("âŒ ç„¡æ³•æ‰¾åˆ° ProjectForm çµ„ä»¶å¼•ç”¨"),l.$toast.error("è¡¨å–®çµ„ä»¶æœªæ­£ç¢ºè¼‰å…¥ï¼Œè«‹é‡æ–°æ•´ç†é é¢"))},C=async e=>{s.value=!0;try{await S(e),f.value=JSON.parse(JSON.stringify(c.value)),i.value=!1,l.$toast.success("å·¥ç¨‹è³‡æ–™ä¿å­˜æˆåŠŸï¼")}catch(t){console.error("ä¿å­˜å¤±æ•—:",t),l.$toast.error("ä¿å­˜å¤±æ•—ï¼Œè«‹é‡è©¦ï¼")}finally{s.value=!1}},S=async e=>{const t=a.currentProject;if(!t)throw new Error("æ²’æœ‰é¸æ“‡å·¥ç¨‹é …ç›®");const n=a.currentWorkspace;if(!n)throw new Error("æ²’æœ‰é¸æ“‡å·¥ä½œç©ºé–“");const m=e||c.value,B=M(m,n.id),x=await z(t.id,B),F=`eip-workspace-projects-${n.id}`;localStorage.removeItem(F),await a.getProjectsByWorkspace(n.id);const _=a.workspaceProjects.find(N=>N.id===t.id);return _&&(a.updateProject(t.id,_),a.setCurrentProject(_,!1),d(_)),x},k=()=>{i.value&&!window.confirm("ç¢ºå®šè¦é‡ç½®è¡¨å–®å—ï¼Ÿæ‰€æœ‰æœªä¿å­˜çš„è®Šæ›´å°‡æœƒä¸Ÿå¤±ã€‚")||(c.value=JSON.parse(JSON.stringify(f.value)),i.value=!1,u.value&&u.value.handleReset(),l.$toast.info("è¡¨å–®å·²é‡ç½®"))};return E(async()=>{console.log("ğŸš€ BasicData: é é¢è¼‰å…¥..."),console.log("ğŸ”§ å·¥ç¨‹é …ç›®ç·¨è¼¯å™¨é–‹å•Ÿ - æ¨¡å¼: edit"),a.isInitialized?console.log("âœ… BasicData: å·¥ä½œç©ºé–“å·²åˆå§‹åŒ–"):(console.log("ğŸ”„ BasicData: å·¥ä½œç©ºé–“æœªåˆå§‹åŒ–ï¼Œé–‹å§‹åˆå§‹åŒ–..."),await a.initWorkspaces(),console.log("âœ… BasicData: å·¥ä½œç©ºé–“åˆå§‹åŒ–å®Œæˆ")),a.currentProject?(console.log("ğŸ”„ BasicData: é–‹å§‹è¼‰å…¥å·¥ç¨‹é …ç›®è³‡æ–™..."),await v(a.currentProject)):console.log("âš ï¸ BasicData: æ²’æœ‰ç•¶å‰å·¥ç¨‹é …ç›®"),window.addEventListener("beforeunload",y),console.log("âœ… BasicData: é é¢è¼‰å…¥å®Œæˆ")}),O(()=>{window.removeEventListener("beforeunload",y)}),I((e,t,n)=>{i.value?window.confirm("æ‚¨æœ‰æœªä¿å­˜çš„è®Šæ›´ï¼Œç¢ºå®šè¦é›¢é–‹å—ï¼Ÿ")?n():n(!1):n()}),(e,t)=>{const n=J("PageHeader");return w(),b($,null,[D(n,{title:"åŸºæœ¬è³‡æ–™ç¶­è­·",icon:"fa fa-edit",breadcrumbs:[{text:"è¡¨å–®ç”Ÿæˆèˆ‡ç®¡ç†",href:"javascript:;"},{text:"åŸºæœ¬è³‡æ–™ç¶­è­·",active:!0}]}),r("div",q,[r("div",G,[D(j,{ref_key:"projectFormRef",ref:u,class:"mb-4",modelValue:c.value,"onUpdate:modelValue":t[0]||(t[0]=m=>c.value=m),mode:"edit","is-submitting":s.value,"show-submit-button":!1,"show-reset-button":!1,onSubmit:C},null,8,["modelValue","is-submitting"]),r("div",K,[r("button",{type:"button",class:"btn btn-outline-secondary",onClick:k,disabled:s.value},t[1]||(t[1]=[r("i",{class:"fa fa-undo me-1"},null,-1),p(" é‡ç½® ")]),8,Q),r("button",{type:"button",class:"btn btn-theme",onClick:h,disabled:s.value},[r("i",{class:U(["fa me-1",{"fa-spin fa-spinner":s.value,"fa-save":!s.value}])},null,2),p(" "+W(s.value?"è™•ç†ä¸­...":"ä¿å­˜"),1)],8,X)]),i.value?(w(),b("div",Y,t[2]||(t[2]=[r("i",{class:"fa fa-exclamation-triangle me-2"},null,-1),p(" æ‚¨æœ‰æœªä¿å­˜çš„è®Šæ›´ ")]))):L("",!0)])])],64)}}}),oe=H(Z,[["__scopeId","data-v-d7869a8a"]]);export{oe as default};
