import{d as se,r as A,k as M,w as ae,a as ne,e as o,f as n,i as _,l as a,B as Q,m as p,C,p as b,q as R,s as g,v as r,S as oe,z as F,F as S,y as I,x as L,I as Y,W as Z,_ as re,c as ce,L as de}from"./index-CB9Z8Gmd.js";import{u as ue}from"./project-DZAGXLm8.js";import{b as J,d as le,h as K,a as me}from"./forms-OBaJqV0P.js";const ve={class:"form-parameter-manager"},pe={class:"d-flex justify-content-between align-items-center"},ye={class:"mb-1"},be={class:"text-muted mb-0 small"},he={class:"text-end"},_e={class:"d-flex align-items-center"},ge={class:"progress me-2",style:{width:"80px",height:"8px"}},fe={class:"small fw-bold"},xe={class:"small text-muted"},ke={class:"form-sections"},qe={class:"d-flex justify-content-between align-items-center"},we={class:"d-flex align-items-center"},Ae={key:0,class:"badge border border-primary text-primary px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center me-2"},$e={class:"mb-1"},Pe={key:0,class:"text-muted small mb-0"},je={class:"d-flex align-items-center"},Fe={class:"me-3 text-end"},Ce={class:"small fw-bold"},De={class:"row"},Se={key:0,class:"form-group"},Ie=["for"],Le={key:0,class:"text-danger"},Me=["id","value","onInput","placeholder","readonly"],Ne={key:0,class:"invalid-feedback"},Ve={key:1,class:"form-text"},Ee={key:1,class:"form-group"},Oe=["for"],Te={key:0,class:"text-danger"},Re=["id","value","onInput","placeholder","readonly"],Be={key:0,class:"invalid-feedback"},Ue={key:1,class:"form-text"},ze={key:2,class:"form-group"},We=["for"],He={key:0,class:"text-danger"},Xe=["id","value","onInput","placeholder","readonly","min","max"],Ge={key:0,class:"invalid-feedback"},Qe={key:1,class:"form-text"},Je={key:3,class:"form-group"},Ke=["for"],Ye={key:0,class:"text-danger"},Ze=["id","value","onInput","readonly"],et={key:0,class:"invalid-feedback"},tt={key:1,class:"form-text"},at={key:4,class:"form-group"},lt=["for"],st={key:0,class:"text-danger"},nt=["id","value","onChange","disabled"],ot=["value"],rt={key:0,class:"invalid-feedback"},it={key:1,class:"form-text"},ct={key:5,class:"form-group"},dt={class:"form-label"},ut={key:0,class:"text-danger"},mt={class:"form-check-group"},vt=["id","value","checked","onChange","disabled"],pt=["for"],yt={key:0,class:"invalid-feedback d-block"},bt={key:1,class:"form-text"},ht={key:6,class:"form-group"},_t={class:"form-label"},gt={key:0,class:"text-danger"},ft={class:"form-check-group"},xt=["id","name","value","checked","onChange","disabled"],kt=["for"],qt={key:0,class:"invalid-feedback d-block"},wt={key:1,class:"form-text"},At={class:"text-danger mb-3"},$t={class:"list-unstyled mb-0"},Pt=se({__name:"FormParameterManager",props:{formConfig:{},initialData:{default:()=>({})},readonly:{type:Boolean,default:!1},showSectionNumbers:{type:Boolean,default:!0}},emits:["update:modelValue","validate","section-toggle"],setup(v,{expose:k,emit:f}){const m=v,h=f,y=A({}),d=A({}),q=A(new Set),x=A(!1),P=M(()=>Object.keys(d.value).length===0),N=M(()=>m.formConfig.sections.reduce((s,l)=>s+l.fields.filter(t=>t.required).length,0)),O=M(()=>m.formConfig.sections.reduce((s,l)=>s+l.fields.filter(t=>{const i=y.value[t.name];return t.required&&i&&i!==""&&(!Array.isArray(i)||i.length>0)}).length,0)),$=M(()=>N.value===0?100:Math.round(O.value/N.value*100)),B=()=>{const s={...m.initialData};m.formConfig.sections.forEach(l=>{l.fields.forEach(t=>{var i;if(!(t.name in s))switch(t.type){case"checkbox":s[t.name]=t.defaultValue||[];break;case"number":s[t.name]=t.defaultValue||((i=t.validation)==null?void 0:i.min)||0;break;case"date":s[t.name]=t.defaultValue||"";break;default:s[t.name]=t.defaultValue||""}}),l.defaultExpanded!==!1&&q.value.add(l.id)}),y.value=s},U=(s,l)=>{if(s.required&&(!l||l===""||Array.isArray(l)&&l.length===0))return`${s.label}為必填項目`;if(l&&s.validation){const t=s.validation;if(typeof l=="string"){if(t.minLength&&l.length<t.minLength)return`${s.label}至少需要${t.minLength}個字符`;if(t.maxLength&&l.length>t.maxLength)return`${s.label}不能超過${t.maxLength}個字符`;if(t.pattern&&!new RegExp(t.pattern).test(l))return`${s.label}格式不正確`}if(typeof l=="number"){if(t.min!==void 0&&l<t.min)return`${s.label}不能小於${t.min}`;if(t.max!==void 0&&l>t.max)return`${s.label}不能大於${t.max}`}if(t.custom){const i=t.custom(l);if(i)return i}}return null},T=()=>{const s={};return m.formConfig.sections.forEach(l=>{l.fields.forEach(t=>{if(t.showWhen&&!t.showWhen(y.value))return;const i=U(t,y.value[t.name]);i&&(s[t.name]=i)})}),d.value=s,h("validate",s),Object.keys(s).length===0},j=(s,l)=>{y.value[s]=l,x.value=!0;const t=W().find(i=>i.name===s);if(t){const i=U(t,l);i?d.value[s]=i:delete d.value[s]}h("update:modelValue",{...y.value})},z=s=>{q.value.has(s)?q.value.delete(s):q.value.add(s),h("section-toggle",s,q.value.has(s))},W=()=>m.formConfig.sections.reduce((s,l)=>s.concat(l.fields),[]),V=s=>!s.showWhen||s.showWhen(y.value),X=s=>{const l=s.fields.filter(i=>i.required&&V(i));if(l.length===0)return 100;const t=l.filter(i=>{const e=y.value[i.name];return e&&e!==""&&(!Array.isArray(e)||e.length>0)});return Math.round(t.length/l.length*100)};return ae(()=>m.initialData,s=>{y.value={...y.value,...s}},{deep:!0}),ae(y,()=>{T()},{deep:!0}),ne(()=>{B(),T()}),k({validate:T,getFormData:()=>y.value,reset:B,setFieldValue:j,isDirty:()=>x.value,isValid:()=>P.value}),(s,l)=>(n(),o("div",ve,[_(C,{class:"mb-4"},{default:b(()=>[_(R,null,{default:b(()=>[a("div",pe,[a("div",null,[a("h5",ye,[l[0]||(l[0]=a("i",{class:"fa fa-file-alt me-2"},null,-1)),g(" "+r(s.formConfig.name)+" ("+r(s.formConfig.id)+") ",1)]),a("p",be,r(s.formConfig.description),1)]),a("div",he,[l[1]||(l[1]=a("div",{class:"small text-muted mb-1"},"完成度",-1)),a("div",_e,[a("div",ge,[a("div",{class:F(["progress-bar",{"bg-danger":$.value<30,"bg-warning":$.value>=30&&$.value<70,"bg-success":$.value>=70}]),style:oe({width:$.value+"%"})},null,6)]),a("span",fe,r($.value)+"%",1)]),a("div",xe,r(O.value)+"/"+r(N.value)+" 必填項目 ",1)])])]),_:1})]),_:1}),a("div",ke,[(n(!0),o(S,null,I(s.formConfig.sections,(t,i)=>(n(),Q(C,{key:t.id,class:"mb-3"},{default:b(()=>[t.collapsible!==!1?(n(),Q(R,{key:0,class:"cursor-pointer",onClick:e=>z(t.id)},{default:b(()=>[a("div",qe,[a("div",we,[s.showSectionNumbers?(n(),o("span",Ae,r(i+1),1)):p("",!0),a("div",null,[a("h6",$e,r(t.title),1),t.description?(n(),o("p",Pe,r(t.description),1)):p("",!0)])]),a("div",je,[a("div",Fe,[l[2]||(l[2]=a("div",{class:"small text-muted"},"進度",-1)),a("div",Ce,r(X(t))+"%",1)]),a("i",{class:F(["fa",{"fa-chevron-up":q.value.has(t.id),"fa-chevron-down":!q.value.has(t.id)}])},null,2)])])]),_:2},1032,["onClick"])):p("",!0),Y(_(L,null,{default:b(()=>[a("div",De,[(n(!0),o(S,null,I(t.fields,e=>{var w,D;return n(),o("div",{key:e.id,class:F([{"col-12":e.type==="textarea","col-lg-6":e.type!=="textarea","d-none":!V(e)},"mb-3"])},[e.type==="text"?(n(),o("div",Se,[a("label",{for:e.id,class:"form-label"},[g(r(e.label)+" ",1),e.required?(n(),o("span",Le,"*")):p("",!0)],8,Ie),a("input",{id:e.id,type:"text",class:F(["form-control",{"is-invalid":d.value[e.name]}]),value:y.value[e.name],onInput:u=>j(e.name,u.target.value),placeholder:e.placeholder,readonly:s.readonly},null,42,Me),d.value[e.name]?(n(),o("div",Ne,r(d.value[e.name]),1)):p("",!0),e.description?(n(),o("div",Ve,r(e.description),1)):p("",!0)])):e.type==="textarea"?(n(),o("div",Ee,[a("label",{for:e.id,class:"form-label"},[g(r(e.label)+" ",1),e.required?(n(),o("span",Te,"*")):p("",!0)],8,Oe),a("textarea",{id:e.id,class:F(["form-control",{"is-invalid":d.value[e.name]}]),value:y.value[e.name],onInput:u=>j(e.name,u.target.value),placeholder:e.placeholder,readonly:s.readonly,rows:"4"},null,42,Re),d.value[e.name]?(n(),o("div",Be,r(d.value[e.name]),1)):p("",!0),e.description?(n(),o("div",Ue,r(e.description),1)):p("",!0)])):e.type==="number"?(n(),o("div",ze,[a("label",{for:e.id,class:"form-label"},[g(r(e.label)+" ",1),e.required?(n(),o("span",He,"*")):p("",!0)],8,We),a("input",{id:e.id,type:"number",class:F(["form-control",{"is-invalid":d.value[e.name]}]),value:y.value[e.name],onInput:u=>j(e.name,parseInt(u.target.value)||0),placeholder:e.placeholder,readonly:s.readonly,min:(w=e.validation)==null?void 0:w.min,max:(D=e.validation)==null?void 0:D.max},null,42,Xe),d.value[e.name]?(n(),o("div",Ge,r(d.value[e.name]),1)):p("",!0),e.description?(n(),o("div",Qe,r(e.description),1)):p("",!0)])):e.type==="date"?(n(),o("div",Je,[a("label",{for:e.id,class:"form-label"},[g(r(e.label)+" ",1),e.required?(n(),o("span",Ye,"*")):p("",!0)],8,Ke),a("input",{id:e.id,type:"date",class:F(["form-control",{"is-invalid":d.value[e.name]}]),value:y.value[e.name],onInput:u=>j(e.name,u.target.value),readonly:s.readonly},null,42,Ze),d.value[e.name]?(n(),o("div",et,r(d.value[e.name]),1)):p("",!0),e.description?(n(),o("div",tt,r(e.description),1)):p("",!0)])):e.type==="select"?(n(),o("div",at,[a("label",{for:e.id,class:"form-label"},[g(r(e.label)+" ",1),e.required?(n(),o("span",st,"*")):p("",!0)],8,lt),a("select",{id:e.id,class:F(["form-select",{"is-invalid":d.value[e.name]}]),value:y.value[e.name],onChange:u=>j(e.name,u.target.value),disabled:s.readonly},[l[3]||(l[3]=a("option",{value:""},"請選擇...",-1)),(n(!0),o(S,null,I(e.options,u=>(n(),o("option",{key:u.value,value:u.value},r(u.label),9,ot))),128))],42,nt),d.value[e.name]?(n(),o("div",rt,r(d.value[e.name]),1)):p("",!0),e.description?(n(),o("div",it,r(e.description),1)):p("",!0)])):e.type==="checkbox"?(n(),o("div",ct,[a("label",dt,[g(r(e.label)+" ",1),e.required?(n(),o("span",ut,"*")):p("",!0)]),a("div",mt,[(n(!0),o(S,null,I(e.options,u=>(n(),o("div",{key:u.value,class:"form-check"},[a("input",{id:`${e.id}_${u.value}`,type:"checkbox",class:"form-check-input",value:u.value,checked:(y.value[e.name]||[]).includes(u.value),onChange:H=>{const te=H.target.checked,E=y.value[e.name]||[];let G;te?G=[...E,u.value]:G=E.filter(ie=>ie!==u.value),j(e.name,G)},disabled:s.readonly},null,40,vt),a("label",{for:`${e.id}_${u.value}`,class:"form-check-label"},r(u.label),9,pt)]))),128))]),d.value[e.name]?(n(),o("div",yt,r(d.value[e.name]),1)):p("",!0),e.description?(n(),o("div",bt,r(e.description),1)):p("",!0)])):e.type==="radio"?(n(),o("div",ht,[a("label",_t,[g(r(e.label)+" ",1),e.required?(n(),o("span",gt,"*")):p("",!0)]),a("div",ft,[(n(!0),o(S,null,I(e.options,u=>(n(),o("div",{key:u.value,class:"form-check"},[a("input",{id:`${e.id}_${u.value}`,type:"radio",class:"form-check-input",name:e.name,value:u.value,checked:y.value[e.name]===u.value,onChange:H=>j(e.name,u.value),disabled:s.readonly},null,40,xt),a("label",{for:`${e.id}_${u.value}`,class:"form-check-label"},r(u.label),9,kt)]))),128))]),d.value[e.name]?(n(),o("div",qt,r(d.value[e.name]),1)):p("",!0),e.description?(n(),o("div",wt,r(e.description),1)):p("",!0)])):p("",!0)],2)}),128))])]),_:2},1536),[[Z,q.value.has(t.id)]])]),_:2},1024))),128))]),!P.value&&Object.keys(d.value).length>0?(n(),Q(C,{key:0,class:"border-danger"},{default:b(()=>[_(L,null,{default:b(()=>[a("h6",At,[l[4]||(l[4]=a("i",{class:"fa fa-exclamation-triangle me-2"},null,-1)),g(" 發現 "+r(Object.keys(d.value).length)+" 個驗證錯誤 ",1)]),a("ul",$t,[(n(!0),o(S,null,I(d.value,(t,i)=>(n(),o("li",{key:i,class:"text-danger small mb-1"},[l[5]||(l[5]=a("i",{class:"fa fa-times me-1"},null,-1)),g(" "+r(t),1)]))),128))])]),_:1})]),_:1})):p("",!0)]))}}),jt=re(Pt,[["__scopeId","data-v-517ed247"]]),c={projectName:{id:"projectName",name:"projectName",label:"工程名稱",type:"text",required:!0,placeholder:"請輸入工程名稱",validation:{minLength:2,maxLength:100},category:"基本資訊"},constructionId:{id:"constructionId",name:"constructionId",label:"工程編號",type:"text",required:!0,placeholder:"請輸入工程編號",category:"工程資訊"},title:{id:"title",name:"title",label:"表單標題",type:"text",required:!0,placeholder:"請輸入表單標題",category:"工程資訊"},supervisoryName:{id:"supervisoryName",name:"supervisoryName",label:"監工姓名",type:"text",required:!1,placeholder:"請輸入監工姓名",category:"監工資訊"},supervisoryFactory:{id:"supervisoryFactory",name:"supervisoryFactory",label:"監工地址",type:"text",required:!1,placeholder:"請輸入監工地址",category:"監工資訊"},contractDate:{id:"contractDate",name:"contractDate",label:"簽約日期",type:"date",required:!1,category:"時程資訊"},workedDay:{id:"workedDay",name:"workedDay",label:"工作天數",type:"number",required:!1,placeholder:"請輸入工作天數",validation:{min:1,max:3650},category:"時程資訊"},disbursementAdvancePayment:{id:"disbursementAdvancePayment",name:"disbursementAdvancePayment",label:"預付款金額",type:"number",required:!1,placeholder:"請輸入預付款金額",validation:{min:0},category:"財務資訊"},estimateAmount:{id:"estimateAmount",name:"estimateAmount",label:"預估金額",type:"number",required:!1,placeholder:"請輸入預估金額",validation:{min:0},category:"財務資訊"},adjustPriceIndex:{id:"adjustPriceIndex",name:"adjustPriceIndex",label:"物價調整指數",type:"number",required:!1,placeholder:"請輸入物價調整指數",validation:{min:0,max:200},category:"財務資訊"},deductAmount:{id:"deductAmount",name:"deductAmount",label:"扣款金額",type:"number",required:!1,placeholder:"請輸入扣款金額",validation:{min:0},category:"財務資訊"},retention:{id:"retention",name:"retention",label:"保留款",type:"number",required:!1,placeholder:"請輸入保留款",validation:{min:0},category:"財務資訊"},deductionAdvancePayment:{id:"deductionAdvancePayment",name:"deductionAdvancePayment",label:"預付款扣款",type:"number",required:!1,placeholder:"請輸入預付款扣款",validation:{min:0},category:"財務資訊"},comment:{id:"comment",name:"comment",label:"備註",type:"textarea",required:!1,placeholder:"請輸入備註",category:"其他資訊"},deductedColumnReason:{id:"deductedColumnReason",name:"deductedColumnReason",label:"扣款原因",type:"textarea",required:!1,placeholder:"請輸入扣款原因",category:"其他資訊"},explainActualAmount:{id:"explainActualAmount",name:"explainActualAmount",label:"實際金額說明",type:"textarea",required:!1,placeholder:"請輸入實際金額說明",category:"其他資訊"},projectLocation:{id:"projectLocation",name:"projectLocation",label:"工程地點",type:"text",required:!0,placeholder:"請輸入工程地點",validation:{minLength:5,maxLength:200},category:"基本資訊"},projectOwner:{id:"projectOwner",name:"projectOwner",label:"業主單位",type:"text",required:!0,placeholder:"請輸入業主單位名稱",category:"基本資訊"},contractorName:{id:"contractorName",name:"contractorName",label:"承包商名稱",type:"text",required:!0,placeholder:"請輸入承包商名稱",category:"基本資訊"},projectManager:{id:"projectManager",name:"projectManager",label:"工程主辦",type:"text",required:!0,placeholder:"請輸入工程主辦姓名",category:"基本資訊"},supervisorUnit:{id:"supervisorUnit",name:"supervisorUnit",label:"監造單位",type:"text",required:!0,placeholder:"請輸入監造單位名稱",category:"基本資訊"},startDate:{id:"startDate",name:"startDate",label:"開工日期",type:"date",required:!0,category:"時程"},endDate:{id:"endDate",name:"endDate",label:"預定完工日期",type:"date",required:!0,category:"時程"},constructionPeriod:{id:"constructionPeriod",name:"constructionPeriod",label:"施工期間（天）",type:"number",required:!0,validation:{min:1,max:3650},category:"時程"},contractAmount:{id:"contractAmount",name:"contractAmount",label:"契約金額",type:"number",required:!0,placeholder:"請輸入契約金額（元）",validation:{min:0},category:"預算"},projectType:{id:"projectType",name:"projectType",label:"工程類別",type:"select",required:!0,options:[{value:"building",label:"建築工程"},{value:"civil",label:"土木工程"},{value:"mechanical",label:"機械工程"},{value:"electrical",label:"電機工程"},{value:"environmental",label:"環境工程"},{value:"other",label:"其他"}],category:"基本資訊"},projectScale:{id:"projectScale",name:"projectScale",label:"工程規模",type:"select",required:!0,options:[{value:"small",label:"小型工程（<1千萬）"},{value:"medium",label:"中型工程（1千萬-1億）"},{value:"large",label:"大型工程（1億-10億）"},{value:"mega",label:"巨型工程（>10億）"}],category:"基本資訊"},contactPerson:{id:"contactPerson",name:"contactPerson",label:"聯絡人",type:"text",required:!0,placeholder:"請輸入聯絡人姓名",category:"聯絡資訊"},contactPhone:{id:"contactPhone",name:"contactPhone",label:"聯絡電話",type:"text",required:!0,placeholder:"請輸入聯絡電話",validation:{pattern:"^[0-9\\-\\+\\(\\)\\s]+$"},category:"聯絡資訊"},contactEmail:{id:"contactEmail",name:"contactEmail",label:"電子郵件",type:"text",required:!1,placeholder:"請輸入電子郵件",validation:{pattern:"^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$"},category:"聯絡資訊"},qualityStandard:{id:"qualityStandard",name:"qualityStandard",label:"品質標準",type:"select",required:!0,options:[{value:"cns",label:"CNS國家標準"},{value:"astm",label:"ASTM美國標準"},{value:"jis",label:"JIS日本標準"},{value:"iso",label:"ISO國際標準"},{value:"custom",label:"客製化標準"}],category:"品質管制"},inspectionMethod:{id:"inspectionMethod",name:"inspectionMethod",label:"檢驗方式",type:"checkbox",required:!0,options:[{value:"visual",label:"目視檢查"},{value:"measurement",label:"尺寸測量"},{value:"material_test",label:"材料試驗"},{value:"ndt",label:"非破壞檢測"},{value:"load_test",label:"載重試驗"}],category:"品質管制"},safetyLevel:{id:"safetyLevel",name:"safetyLevel",label:"安全等級",type:"select",required:!0,options:[{value:"general",label:"一般等級"},{value:"high",label:"高風險等級"},{value:"special",label:"特殊等級"}],category:"安全衛生"}},ee={id:"A-5",name:"施工計畫書",version:"2.1",description:"工程施工計畫書是確保工程順利進行的重要文件",submitUrl:"/management/construction/a5/update",downloadUrl:"/management/construction/export/report/AFive",sections:[{id:"project_info",title:"工程資訊",description:"請填寫工程的基本資訊",defaultExpanded:!0,fields:[c.constructionId,c.title,c.projectName,c.projectLocation,c.projectOwner,c.contractorName,c.projectManager,c.supervisorUnit,c.projectType,c.projectScale]},{id:"supervisory_info",title:"監工資訊",description:"請填寫監工相關資訊",fields:[c.supervisoryName,c.supervisoryFactory]},{id:"schedule",title:"施工時程",description:"請填寫施工相關時程資訊",fields:[c.contractDate,c.startDate,c.endDate,c.constructionPeriod,c.workedDay,{id:"milestones",name:"milestones",label:"重要里程碑",type:"textarea",required:!0,placeholder:"請列出重要的施工里程碑",validation:{minLength:10,maxLength:1e3},category:"時程"}]},{id:"construction_method",title:"施工方法",description:"請詳細說明施工方法與程序",fields:[{id:"constructionSequence",name:"constructionSequence",label:"施工順序",type:"textarea",required:!0,placeholder:"請詳述施工順序與步驟",validation:{minLength:50,maxLength:2e3},category:"施工方法"},{id:"equipment",name:"equipment",label:"主要施工設備",type:"textarea",required:!0,placeholder:"請列出主要施工設備清單",category:"施工方法"},{id:"workforce",name:"workforce",label:"人力配置",type:"number",required:!0,placeholder:"預估所需人力數量",validation:{min:1,max:1e3},category:"施工方法"}]},{id:"safety",title:"安全衛生計畫",description:"請填寫安全衛生相關措施",fields:[c.safetyLevel,{id:"safetyMeasures",name:"safetyMeasures",label:"安全防護措施",type:"textarea",required:!0,placeholder:"請詳述安全防護措施",category:"安全衛生"},{id:"emergencyPlan",name:"emergencyPlan",label:"緊急應變計畫",type:"textarea",required:!0,placeholder:"請說明緊急應變處理程序",category:"安全衛生"}]},{id:"budget",title:"預算規劃",description:"請填寫預算相關資訊",fields:[c.contractAmount,c.disbursementAdvancePayment,c.estimateAmount,c.adjustPriceIndex,c.deductAmount,c.retention,c.deductionAdvancePayment,{id:"costBreakdown",name:"costBreakdown",label:"成本分析",type:"textarea",required:!0,placeholder:"請說明主要成本項目分析",category:"預算"}]},{id:"other_info",title:"其他資訊",description:"請填寫其他相關資訊",fields:[c.comment,c.deductedColumnReason,c.explainActualAmount]},{id:"contact",title:"聯絡資訊",description:"請填寫相關聯絡資訊",collapsible:!0,fields:[c.contactPerson,c.contactPhone,c.contactEmail]}]},Ft={id:"A-7",name:"品質管制計畫",version:"3.0",description:"品質管制計畫是確保工程品質符合規範要求的重要文件",submitUrl:"/management/construction/a7/update",downloadUrl:"/management/construction/export/report/ASeven",sections:[{id:"basic_info",title:"工程基本資訊",description:"請填寫工程的基本資訊",defaultExpanded:!0,fields:[c.projectName,c.projectLocation,c.projectOwner,c.contractorName,c.supervisorUnit,c.projectType]},{id:"quality_policy",title:"品質政策與目標",description:"請定義品質政策與目標",fields:[{id:"qualityPolicy",name:"qualityPolicy",label:"品質政策",type:"textarea",required:!0,placeholder:"請說明公司的品質政策",validation:{minLength:20,maxLength:500},category:"品質政策"},{id:"qualityObjectives",name:"qualityObjectives",label:"品質目標",type:"textarea",required:!0,placeholder:"請列出具體的品質目標",category:"品質政策"}]},{id:"quality_organization",title:"品質管制組織",description:"請說明品質管制組織架構",fields:[{id:"qualityManager",name:"qualityManager",label:"品質管理負責人",type:"text",required:!0,placeholder:"請輸入品質管理負責人姓名",category:"組織架構"},{id:"qualityTeam",name:"qualityTeam",label:"品質管制團隊",type:"textarea",required:!0,placeholder:"請說明品質管制團隊組成",category:"組織架構"},{id:"responsibilities",name:"responsibilities",label:"職責分工",type:"textarea",required:!0,placeholder:"請說明各職位的品質管制職責",category:"組織架構"}]},{id:"quality_standards",title:"品質標準與規範",description:"請說明適用的品質標準",fields:[c.qualityStandard,{id:"specifications",name:"specifications",label:"技術規範",type:"textarea",required:!0,placeholder:"請列出適用的技術規範",category:"品質標準"},{id:"acceptanceCriteria",name:"acceptanceCriteria",label:"驗收標準",type:"textarea",required:!0,placeholder:"請說明各項工程的驗收標準",category:"品質標準"}]},{id:"inspection_plan",title:"檢驗測試計畫",description:"請說明檢驗測試相關計畫",fields:[c.inspectionMethod,{id:"inspectionSchedule",name:"inspectionSchedule",label:"檢驗時程",type:"textarea",required:!0,placeholder:"請說明各階段檢驗時程安排",category:"檢驗計畫"},{id:"testingProcedures",name:"testingProcedures",label:"測試程序",type:"textarea",required:!0,placeholder:"請詳述測試程序與方法",category:"檢驗計畫"}]},{id:"material_control",title:"材料品質管制",description:"請說明材料品質管制措施",fields:[{id:"materialSpecs",name:"materialSpecs",label:"材料規格要求",type:"textarea",required:!0,placeholder:"請說明主要材料的規格要求",category:"材料管制"},{id:"supplierQualification",name:"supplierQualification",label:"供應商資格",type:"textarea",required:!0,placeholder:"請說明供應商資格要求與評估標準",category:"材料管制"},{id:"receivingInspection",name:"receivingInspection",label:"進料檢驗",type:"textarea",required:!0,placeholder:"請說明進料檢驗程序",category:"材料管制"}]},{id:"improvement",title:"持續改善計畫",description:"請說明持續改善相關措施",fields:[{id:"corrective_action",name:"corrective_action",label:"矯正措施",type:"textarea",required:!0,placeholder:"請說明發現問題時的矯正措施程序",category:"持續改善"},{id:"preventive_action",name:"preventive_action",label:"預防措施",type:"textarea",required:!0,placeholder:"請說明預防品質問題的措施",category:"持續改善"}]},{id:"contact",title:"聯絡資訊",description:"請填寫相關聯絡資訊",collapsible:!0,fields:[c.contactPerson,c.contactPhone,c.contactEmail]}]},Ct=v=>({"A-5":ee,"A-7":Ft})[v]||null,Dt=v=>{const k=Ct(v);return k?k.sections.reduce((f,m)=>f.concat(m.fields),[]):[]},St=v=>{const k=Dt(v),f={};return k.forEach(m=>{var h;if(m.defaultValue!==void 0)f[m.name]=m.defaultValue;else switch(m.type){case"checkbox":f[m.name]=[];break;case"number":f[m.name]=((h=m.validation)==null?void 0:h.min)||0;break;default:f[m.name]=""}}),f},It={constructionId:"CTq3CMSVeDUuBYCEM2KRkjl40DSjTnPf",title:"afive file",supervisoryName:"王小明",supervisoryFactory:"台北市信義區XX路XX號",contractDate:"2024-06-15T09:00:00",startDate:"2024-07-01T08:30:00",finishDate:"2025-12-31T17:00:00",workedDay:"45",disbursementAdvancePayment:"1500000",estimateAmount:"3000000",adjustPriceIndex:"102",deductAmount:"50000",retention:"100000",deductionAdvancePayment:"200000",comment:"this is test file 4",deductedColumnReason:"just want to right lol",explainActualAmount:"eight iiiilll"},Lt=(v,k)=>({constructionId:k||v.constructionId||"",title:v.title||"A-5 施工計畫書",supervisoryName:v.supervisoryName||"",supervisoryFactory:v.supervisoryFactory||"",contractDate:v.contractDate||"",startDate:v.startDate||"",finishDate:v.endDate||v.finishDate||"",workedDay:v.workedDay||v.constructionPeriod||"",disbursementAdvancePayment:v.disbursementAdvancePayment||"",estimateAmount:v.estimateAmount||"",adjustPriceIndex:v.adjustPriceIndex||"",deductAmount:v.deductAmount||"",retention:v.retention||"",deductionAdvancePayment:v.deductionAdvancePayment||"",comment:v.comment||"",deductedColumnReason:v.deductedColumnReason||"",explainActualAmount:v.explainActualAmount||""}),Mt={class:"container-fluid"},Nt={class:"row"},Vt={class:"col-12"},Et={class:"row"},Ot={class:"col-lg-4 mb-4"},Tt={class:"row text-center mb-3"},Rt={class:"col-6"},Bt={class:"border rounded p-2"},Ut={class:"fw-bold"},zt={class:"col-6"},Wt={class:"border rounded p-2"},Ht={class:"fw-bold"},Xt={class:"row text-center"},Gt={class:"col-6"},Qt={class:"border rounded p-2"},Jt={class:"fw-bold"},Kt={class:"col-6"},Yt={class:"border rounded p-2"},Zt={class:"fw-bold text-danger"},ea={class:"d-grid gap-2"},ta=["disabled"],aa={key:0,class:"text-center py-3"},la={key:1},sa={class:"d-flex justify-content-between align-items-start mb-1"},na={class:"flex-grow-1"},oa={class:"small fw-bold"},ra={class:"d-flex align-items-center mt-1"},ia={class:"text-muted"},ca={class:"text-muted small"},da={class:"col-lg-8"},ua={class:"d-flex justify-content-between align-items-center"},ma={class:"text-muted"},va={key:0},pa={key:1,class:"text-danger"},ya={class:"btn-group"},ba=["disabled"],ha=["disabled"],_a=["disabled"],ga={key:0,class:"mt-3"},fa={class:"d-flex justify-content-between align-items-center mb-2"},xa={class:"small"},ka={class:"progress"},qa=se({__name:"FormA5WithParams",setup(v){const k=ue(),f=A(!1),m=A(!1),h=A(0),y=A(!1),d=A({}),q=A({}),x=A(null),P=A([]),N=M(()=>!m.value),O=M(()=>{var l;return!m.value&&((l=x.value)==null?void 0:l.isValid())}),$=M(()=>{const l=ee,t=l.sections.reduce((e,w)=>e+w.fields.length,0),i=l.sections.reduce((e,w)=>e+w.fields.filter(D=>D.required).length,0);return{totalSections:l.sections.length,totalFields:t,requiredFields:i,version:l.version}}),B=async()=>{if(!N.value)return;m.value=!0,h.value=0;let l=null;try{l=setInterval(()=>{h.value<90&&(h.value+=Math.random()*15)},200);const t=await J.downloadReport();h.value=100,l&&(clearInterval(l),l=null);const w=`A-5_施工計畫書_空白表單_${new Date().toISOString().split("T")[0]}.docx`;le(t,w),z(w,t.size,!1),V("下載成功",`${w} 已開始下載`,"success")}catch(t){console.error("下載失敗:",t),K(t)}finally{l&&clearInterval(l),m.value=!1,h.value=0}},U=async()=>{var i;if(!O.value||!x.value||!x.value.validate())return;m.value=!0,h.value=0;let t=null;try{t=setInterval(()=>{h.value<90&&(h.value+=Math.random()*10)},250);const e=x.value.getFormData(),w=Lt(e,(i=k.currentProject)==null?void 0:i.constructionId),D=await J.downloadReport(w);h.value=100,t&&(clearInterval(t),t=null);const H=new Date().toISOString().split("T")[0],E=`A-5_施工計畫書_${e.projectName||w.title||"未命名工程"}_${H}.docx`;le(D,E),z(E,D.size,!0),V("下載成功",`${E} 已開始下載`,"success")}catch(e){console.error("下載失敗:",e),K(e)}finally{t&&clearInterval(t),m.value=!1,h.value=0}},T=async()=>{var t;if(!(!x.value||!x.value.validate())){f.value=!0;try{const e={formData:x.value.getFormData(),projectId:(t=k.currentProject)==null?void 0:t.constructionId,workspaceId:void 0};await J.updateForm(e),V("儲存成功","表單資料已成功儲存","success"),x.value&&(x.value.isDirty=()=>!1)}catch(i){K(i)}finally{f.value=!1}}},j=()=>{if(!x.value)return;const l={...d.value,...It};Object.keys(l).forEach(t=>{var i;l[t]!==void 0&&((i=x.value)==null||i.setFieldValue(t,l[t]))})},z=(l,t,i)=>{const e={id:P.value.length+1,fileName:l,downloadTime:new Date().toLocaleString("zh-TW"),fileSize:me(t),hasParameters:i};P.value.unshift(e),P.value.length>10&&(P.value=P.value.slice(0,10))},W=()=>{y.value=!y.value},V=(l,t,i="success")=>{},X=l=>{d.value=l},s=l=>{q.value=l};return ne(()=>{var l;d.value={...St("A-5"),constructionId:((l=k.currentProject)==null?void 0:l.constructionId)||"",title:"A-5 施工計畫書",supervisoryName:"",supervisoryFactory:"",contractDate:"",startDate:"",endDate:"",workedDay:"",disbursementAdvancePayment:"",estimateAmount:"",adjustPriceIndex:"",deductAmount:"",retention:"",deductionAdvancePayment:"",comment:"",deductedColumnReason:"",explainActualAmount:""}}),(l,t)=>{const i=ce("PageHeader");return n(),o("div",Mt,[a("div",Nt,[a("div",Vt,[_(i,{title:"A-5 施工計畫書",icon:"fa fa-file-alt",breadcrumbs:[{text:"表單生成與管理",href:"javascript:;"},{text:"A類表單",href:"javascript:;"},{text:"A-5 施工計畫書（含參數）",active:!0}]}),a("div",Et,[a("div",Ot,[_(C,{class:"mb-4"},{default:b(()=>[_(R,null,{default:b(()=>t[0]||(t[0]=[a("div",{class:"d-flex align-items-center"},[a("i",{class:"fa fa-info-circle me-2"}),a("h5",{class:"mb-0"},"表單資訊")],-1)])),_:1,__:[0]}),_(L,null,{default:b(()=>[a("div",Tt,[a("div",Rt,[a("div",Bt,[t[1]||(t[1]=a("div",{class:"text-muted small"},"版本",-1)),a("div",Ut,r($.value.version),1)])]),a("div",zt,[a("div",Wt,[t[2]||(t[2]=a("div",{class:"text-muted small"},"區段數",-1)),a("div",Ht,r($.value.totalSections),1)])])]),a("div",Xt,[a("div",Gt,[a("div",Qt,[t[3]||(t[3]=a("div",{class:"text-muted small"},"總欄位",-1)),a("div",Jt,r($.value.totalFields),1)])]),a("div",Kt,[a("div",Yt,[t[4]||(t[4]=a("div",{class:"text-muted small"},"必填欄位",-1)),a("div",Zt,r($.value.requiredFields),1)])])])]),_:1})]),_:1}),_(C,{class:"mb-4"},{default:b(()=>[_(R,null,{default:b(()=>t[5]||(t[5]=[a("div",{class:"d-flex align-items-center"},[a("i",{class:"fa fa-download me-2"}),a("h5",{class:"mb-0"},"快速下載")],-1)])),_:1,__:[5]}),_(L,null,{default:b(()=>[a("div",ea,[a("button",{class:"btn btn-outline-theme",onClick:B,disabled:!N.value},t[6]||(t[6]=[a("i",{class:"fa fa-file me-2"},null,-1),g(" 下載空白表單 "),a("small",{class:"d-block"},"台北市政府建管處版本",-1)]),8,ta),a("button",{class:"btn btn-theme",onClick:W},[t[7]||(t[7]=a("i",{class:"fa fa-edit me-2"},null,-1)),g(" "+r(y.value?"隱藏":"顯示")+"參數設定 ",1)])]),t[8]||(t[8]=a("div",{class:"mt-3 text-center"},[a("small",{class:"text-muted"}," 空白表單無需填寫參數，適合手動填寫 "),a("div",{class:"mt-2"},[a("small",{class:"text-primary"},[a("i",{class:"fa fa-info-circle me-1"}),g(" 目前提供台北市政府建管處核定版本 ")])])],-1))]),_:1,__:[8]})]),_:1}),_(C,null,{default:b(()=>[_(R,null,{default:b(()=>t[9]||(t[9]=[a("div",{class:"d-flex align-items-center"},[a("i",{class:"fa fa-history me-2"}),a("h5",{class:"mb-0"},"下載歷史")],-1)])),_:1,__:[9]}),_(L,null,{default:b(()=>[P.value.length===0?(n(),o("div",aa,t[10]||(t[10]=[a("i",{class:"fa fa-download fa-2x text-muted mb-2"},null,-1),a("p",{class:"text-muted small mb-0"},"尚無下載記錄",-1)]))):(n(),o("div",la,[(n(!0),o(S,null,I(P.value,e=>(n(),o("div",{key:e.id,class:"border rounded p-2 mb-2"},[a("div",sa,[a("div",na,[a("div",oa,r(e.fileName),1),a("div",ra,[a("span",{class:F(["badge border px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center me-1",{"border-success text-success":e.hasParameters,"border-secondary text-secondary":!e.hasParameters}])},r(e.hasParameters?"含參數":"空白表單"),3),a("small",ia,r(e.fileSize),1)])])]),a("div",ca,r(e.downloadTime),1)]))),128))]))]),_:1})]),_:1})]),a("div",da,[Y(a("div",null,[_(jt,{ref_key:"parameterManager",ref:x,"form-config":de(ee),"initial-data":d.value,"onUpdate:modelValue":X,onValidate:s},null,8,["form-config","initial-data"]),_(C,{class:"mt-4"},{default:b(()=>[_(L,null,{default:b(()=>[a("div",ua,[a("div",ma,[t[11]||(t[11]=a("i",{class:"fa fa-info-circle me-1"},null,-1)),Object.keys(q.value).length===0?(n(),o("span",va," 表單驗證通過，可以下載 ")):(n(),o("span",pa," 發現 "+r(Object.keys(q.value).length)+" 個驗證錯誤 ",1))]),a("div",ya,[a("button",{class:"btn btn-outline-info",onClick:j,disabled:f.value},t[12]||(t[12]=[a("i",{class:"fa fa-file-text me-1"},null,-1),g(" 載入範例 ")]),8,ba),a("button",{class:"btn btn-outline-secondary",onClick:T,disabled:f.value||Object.keys(q.value).length>0},[t[13]||(t[13]=a("i",{class:"fa fa-save me-1"},null,-1)),g(" "+r(f.value?"儲存中...":"儲存資料"),1)],8,ha),a("button",{class:"btn btn-theme",onClick:U,disabled:!O.value},[a("i",{class:F(["fa me-1",{"fa-spin fa-spinner":m.value,"fa-download":!m.value}])},null,2),g(" "+r(m.value?"處理中...":"下載表單"),1)],8,_a)])]),m.value?(n(),o("div",ga,[a("div",fa,[t[14]||(t[14]=a("span",{class:"small"},"正在生成表單...",-1)),a("span",xa,r(Math.round(h.value))+"%",1)]),a("div",ka,[a("div",{class:"progress-bar progress-bar-striped progress-bar-animated",style:oe({width:h.value+"%"})},null,4)])])):p("",!0)]),_:1})]),_:1})],512),[[Z,y.value]]),Y(_(C,null,{default:b(()=>[_(L,{class:"text-center py-5"},{default:b(()=>[t[16]||(t[16]=a("i",{class:"fa fa-edit fa-3x text-muted mb-3"},null,-1)),t[17]||(t[17]=a("h5",{class:"text-muted mb-2"},"參數化表單",-1)),t[18]||(t[18]=a("p",{class:"text-muted mb-3"}," 填寫表單參數後，系統將自動生成包含您資料的施工計畫書 ",-1)),a("button",{class:"btn btn-theme",onClick:W},t[15]||(t[15]=[a("i",{class:"fa fa-edit me-2"},null,-1),g(" 開始填寫參數 ")]))]),_:1,__:[16,17,18]})]),_:1},512),[[Z,!y.value]])])])])])])}}}),Pa=re(qa,[["__scopeId","data-v-ea66da1d"]]);export{Pa as default};
