import{r as v,B as z,C as A,o as ie,U as B,L as I,f as i,g as d,c as de,h as e,n as y,p as w,k as c,j as p,v as g,y as J,t as o,i as x,H as U,I as P,z as b,w as re,l as ue,N as ce}from"./index-D_u9nkte.js";const me={class:"row mb-4"},pe={class:"col-lg-12"},ve={class:"d-flex justify-content-between align-items-center"},be={class:"d-flex align-items-center"},fe={class:"input-group",style:{width:"300px"}},ge={class:"d-flex align-items-center"},xe={class:"row"},_e={class:"col-lg-12"},he={class:"badge border border-success text-success px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center"},ye={class:"table-responsive"},we={class:"table table-striped table-hover mb-0"},ke={class:"d-flex align-items-center"},Me=["src","alt"],Ce={class:"fw-bold"},Le={class:"d-flex flex-wrap gap-1"},Ue=["onClick"],Pe=["onClick"],Ve=["onClick"],je={key:0,class:"d-flex justify-content-between align-items-center p-3"},Ee={class:"text-muted"},$e={class:"pagination pagination-sm mb-0"},Se=["onClick"],Ae={class:"modal fade",id:"userModal",tabindex:"-1","aria-labelledby":"userModalLabel","aria-hidden":"true"},De={class:"modal-dialog modal-lg"},Te={class:"modal-content"},qe={class:"modal-header"},ze={class:"modal-title",id:"userModalLabel"},Be={class:"modal-body"},Ie={class:"row"},Ne={class:"col-md-6"},Fe={class:"form-group mb-3"},Oe={class:"col-md-6"},Re={class:"form-group mb-3"},He=["disabled"],Ke={key:0,class:"form-text"},We={class:"row"},Ge={class:"col-md-6"},Je={class:"form-group mb-3"},Qe={class:"col-md-6"},Xe={class:"form-group mb-3"},Ye={key:0,class:"row"},Ze={class:"col-md-6"},es={class:"form-group mb-3"},ss=["required"],ts={class:"col-md-6"},ls={class:"form-group mb-3"},as=["required"],os={class:"row"},ns={class:"col-12"},is={class:"form-group mb-3"},ds={class:"row"},rs={class:"col-12"},us={class:"border rounded p-3 mb-3"},cs={class:"row"},ms={class:"form-check"},ps=["id","value"],vs=["for"],bs={class:"d-flex align-items-center"},fs={class:"fw-bold"},gs={class:"text-muted"},xs={class:"row"},_s={class:"col-12"},hs={class:"form-group mb-3"},ys={class:"modal-footer"},ws={class:"modal fade",id:"detailModal",tabindex:"-1","aria-labelledby":"detailModalLabel","aria-hidden":"true"},ks={class:"modal-dialog modal-lg"},Ms={class:"modal-content"},Cs={key:0,class:"modal-body"},Ls={class:"row"},Us={class:"col-md-4 text-center"},Ps=["src","alt"],Vs={class:"col-md-8"},js={class:"table table-borderless"},Es={key:0},$s={class:"d-flex flex-wrap gap-1"},Ss={key:1},As={class:"modal-footer"},Ds={class:"modal fade",id:"deleteModal",tabindex:"-1","aria-labelledby":"deleteModalLabel","aria-hidden":"true"},Ts={class:"modal-dialog"},qs={class:"modal-content"},zs={key:0,class:"modal-body"},Ns={__name:"UserManagement",setup(Bs){const V=v(""),j=v(""),m=v(1),k=v(10),Q=z([{key:"general",name:"通用權限",icon:"fa-user",color:"#6c757d",description:"系統基本功能權限，包含查看和基本操作"},{key:"chief_engineer",name:"主辦工程師權限",icon:"fa-crown",color:"#dc3545",description:"最高權限，可管理所有功能和用戶"},{key:"contractor",name:"營造廠商權限",icon:"fa-hard-hat",color:"#fd7e14",description:"營造廠商相關功能權限，包含施工管理"},{key:"supervisor",name:"監造單位權限",icon:"fa-eye",color:"#0d6efd",description:"監造單位相關功能權限，包含監督檢查"}]),_=z([{id:1,name:"王主任",username:"chief_wang",email:"wang@example.com",phone:"0912-345-678",status:"active",permissions:["general","chief_engineer"],avatar:"./assets/img/user/user-1.jpg",createdAt:"2024-01-15 09:30:00",lastLogin:"2024-03-15 14:25:30",remarks:"系統管理員，負責整體專案管控"},{id:2,name:"李工程師",username:"engineer_li",email:"li@contractor.com",phone:"0923-456-789",status:"active",permissions:["general","contractor"],avatar:"./assets/img/user/user-2.jpg",createdAt:"2024-02-01 10:15:00",lastLogin:"2024-03-14 16:45:20",remarks:"營造廠商代表，負責現場施工管理"},{id:3,name:"張監工",username:"supervisor_zhang",email:"zhang@supervisor.com",phone:"0934-567-890",status:"active",permissions:["general","supervisor"],avatar:"./assets/img/user/user-3.jpg",createdAt:"2024-02-10 11:20:00",lastLogin:"2024-03-13 08:30:15",remarks:"監造單位代表，負責工程監督"},{id:4,name:"陳助理",username:"assistant_chen",email:"chen@example.com",phone:"0945-678-901",status:"inactive",permissions:["general"],avatar:"./assets/img/user/profile.jpg",createdAt:"2024-03-01 14:00:00",lastLogin:null,remarks:"一般助理人員，目前暫停使用"},{id:5,name:"劉技師",username:"tech_liu",email:"liu@contractor.com",phone:"0956-789-012",status:"pending",permissions:["general","contractor","supervisor"],avatar:"./assets/img/user/user-6.jpg",createdAt:"2024-03-10 09:45:00",lastLogin:null,remarks:"新進技師，具備雙重權限"}]),r=v(null),M=v(null),u=v(!1),a=z({name:"",username:"",email:"",phone:"",status:"",password:"",confirmPassword:"",permissions:[],remarks:""}),E=v(null),D=v(null),T=v(null),L=A(()=>{let t=_;if(V.value.trim()){const s=V.value.toLowerCase();t=t.filter(n=>n.name.toLowerCase().includes(s)||n.username.toLowerCase().includes(s)||n.email.toLowerCase().includes(s))}return j.value&&(t=t.filter(s=>s.permissions.includes(j.value))),t}),$=A(()=>Math.ceil(L.value.length/k.value)),X=A(()=>{const t=(m.value-1)*k.value,s=t+k.value;return L.value.slice(t,s)}),Y=A(()=>{const t=[],s=$.value,n=m.value;if(s<=7)for(let h=1;h<=s;h++)t.push(h);else n<=4?t.push(1,2,3,4,5,"...",s):n>=s-3?t.push(1,"...",s-4,s-3,s-2,s-1,s):t.push(1,"...",n-1,n,n+1,"...",s);return t}),Z=()=>{var t;u.value=!1,R(),(t=E.value)==null||t.show()},N=t=>{var s,n;u.value=!0,Object.assign(a,{...t,password:"",confirmPassword:"",permissions:[...t.permissions]}),(s=D.value)==null||s.hide(),(n=E.value)==null||n.show()},ee=t=>{var s;r.value=t,(s=D.value)==null||s.show()},F=t=>{var s;M.value=t,(s=T.value)==null||s.show()},se=()=>{var t;if(M.value){const s=_.findIndex(n=>n.id===M.value.id);s!==-1&&_.splice(s,1),M.value=null,(t=T.value)==null||t.hide(),f("用戶已成功刪除","success")}},O=()=>{var t;if(ae()){const s={...a,id:u.value?a.id:Date.now(),createdAt:u.value?a.createdAt:new Date().toLocaleString("zh-TW"),lastLogin:u.value?a.lastLogin:null};u.value?le(s):te(s),(t=E.value)==null||t.hide(),R()}},te=t=>{_.push(t),f("用戶已成功新增","success")},le=t=>{const s=_.findIndex(n=>n.id===t.id);s!==-1&&Object.assign(_[s],t),f("用戶資料已更新","success")},ae=()=>{if(!a.name||!a.username||!a.email||!a.status)return f("請填寫所有必填欄位","danger"),!1;if(a.permissions.length===0)return f("請至少選擇一個權限","danger"),!1;if(!u.value){if(!a.password||!a.confirmPassword)return f("請填寫密碼欄位","danger"),!1;if(a.password!==a.confirmPassword)return f("密碼與確認密碼不相符","danger"),!1;if(_.some(s=>s.username===a.username))return f("帳號已存在，請選擇其他帳號","danger"),!1}return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.email)?!0:(f("請輸入有效的Email格式","danger"),!1)},R=()=>{Object.assign(a,{name:"",username:"",email:"",phone:"",status:"",password:"",confirmPassword:"",permissions:[],remarks:""})},oe=t=>a.permissions.includes(t),H=t=>({active:"啟用",inactive:"停用",pending:"待啟用"})[t]||t,K=t=>({active:"badge border border-success text-success px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center",inactive:"badge border border-danger text-danger px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center",pending:"badge border border-warning text-warning px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center"})[t]||"badge border border-secondary text-secondary px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center",W=t=>({general:"通用",chief_engineer:"主辦工程師",contractor:"營造廠商",supervisor:"監造單位"})[t]||t,G=t=>({general:"badge border border-secondary text-secondary px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center",chief_engineer:"badge border border-danger text-danger px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center",contractor:"badge border border-warning text-warning px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center",supervisor:"badge border border-primary text-primary px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center"})[t]||"badge border border-secondary text-secondary px-2 pt-5px pb-5px rounded fs-12px d-inline-flex align-items-center",q=t=>{t>=1&&t<=$.value&&(m.value=t)},f=(t,s)=>{console.log(`Toast: ${t} (${s})`)};return ie(()=>{E.value=new B(document.getElementById("userModal")),D.value=new B(document.getElementById("detailModal")),T.value=new B(document.getElementById("deleteModal"))}),(t,s)=>{const n=I("card-body"),h=I("card"),ne=I("card-header");return d(),i("div",null,[s[51]||(s[51]=de('<div class="d-flex align-items-center mb-3"><div><ol class="breadcrumb"><li class="breadcrumb-item"><a href="javascript:;">用戶管理</a></li><li class="breadcrumb-item active">用戶管理與權限</li></ol><h1 class="page-header mb-0">用戶管理與權限</h1></div></div>',1)),e("div",me,[e("div",pe,[y(h,null,{default:w(()=>[y(n,null,{default:w(()=>[e("div",ve,[e("div",be,[e("button",{type:"button",class:"btn btn-theme me-2",onClick:Z},s[15]||(s[15]=[e("i",{class:"fa fa-plus me-1"},null,-1),c(" 新增用戶 ")])),e("div",fe,[s[16]||(s[16]=e("span",{class:"input-group-text"},[e("i",{class:"fa fa-search"})],-1)),p(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[0]||(s[0]=l=>V.value=l),placeholder:"搜尋用戶姓名、帳號或Email..."},null,512),[[g,V.value]])])]),e("div",ge,[s[18]||(s[18]=e("label",{class:"form-label me-2 mb-0"},"權限篩選：",-1)),p(e("select",{class:"form-select","onUpdate:modelValue":s[1]||(s[1]=l=>j.value=l),style:{width:"200px"}},s[17]||(s[17]=[e("option",{value:""},"全部權限",-1),e("option",{value:"general"},"通用權限",-1),e("option",{value:"chief_engineer"},"主辦工程師權限",-1),e("option",{value:"contractor"},"營造廠商權限",-1),e("option",{value:"supervisor"},"監造單位權限",-1)]),512),[[J,j.value]])])])]),_:1})]),_:1})])]),e("div",xe,[e("div",_e,[y(h,null,{default:w(()=>[y(ne,{class:"fw-bold d-flex justify-content-between align-items-center"},{default:w(()=>[s[19]||(s[19]=e("span",null,"用戶列表",-1)),e("span",he,"總計 "+o(L.value.length)+" 位用戶",1)]),_:1,__:[19]}),y(n,{class:"p-0"},{default:w(()=>[e("div",ye,[e("table",we,[s[23]||(s[23]=e("thead",{class:"table-theme"},[e("tr",null,[e("th",{width:"5%"},"#"),e("th",{width:"15%"},"姓名"),e("th",{width:"15%"},"帳號"),e("th",{width:"20%"},"Email"),e("th",{width:"10%"},"狀態"),e("th",{width:"25%"},"權限"),e("th",{width:"10%"},"操作")])],-1)),e("tbody",null,[(d(!0),i(U,null,P(X.value,(l,S)=>(d(),i("tr",{key:l.id},[e("td",null,o((m.value-1)*k.value+S+1),1),e("td",null,[e("div",ke,[e("img",{src:l.avatar,alt:l.name,class:"rounded-circle me-2",width:"32",height:"32"},null,8,Me),e("span",Ce,o(l.name),1)])]),e("td",null,o(l.username),1),e("td",null,o(l.email),1),e("td",null,[e("span",{class:b(K(l.status))},o(H(l.status)),3)]),e("td",null,[e("div",Le,[(d(!0),i(U,null,P(l.permissions,C=>(d(),i("span",{key:C,class:b(G(C))},o(W(C)),3))),128))])]),e("td",null,[e("div",null,[e("button",{type:"button",class:"btn btn-sm btn-outline-primary me-1",onClick:C=>ee(l)},s[20]||(s[20]=[e("i",{class:"fa fa-eye"},null,-1)]),8,Ue),e("button",{type:"button",class:"btn btn-sm btn-outline-warning me-1",onClick:C=>N(l)},s[21]||(s[21]=[e("i",{class:"fa fa-edit"},null,-1)]),8,Pe),e("button",{type:"button",class:"btn btn-sm btn-outline-danger",onClick:C=>F(l)},s[22]||(s[22]=[e("i",{class:"fa fa-trash"},null,-1)]),8,Ve)])])]))),128))])])]),$.value>1?(d(),i("div",je,[e("div",Ee," 顯示第 "+o((m.value-1)*k.value+1)+" - "+o(Math.min(m.value*k.value,L.value.length))+" 項，共 "+o(L.value.length)+" 項 ",1),e("nav",null,[e("ul",$e,[e("li",{class:b(["page-item",{disabled:m.value===1}])},[e("button",{class:"page-link",onClick:s[2]||(s[2]=l=>q(m.value-1))},"上一頁")],2),(d(!0),i(U,null,P(Y.value,l=>(d(),i("li",{key:l,class:b(["page-item",{active:l===m.value}])},[e("button",{class:"page-link",onClick:S=>q(l)},o(l),9,Se)],2))),128)),e("li",{class:b(["page-item",{disabled:m.value===$.value}])},[e("button",{class:"page-link",onClick:s[3]||(s[3]=l=>q(m.value+1))},"下一頁")],2)])])])):x("",!0)]),_:1})]),_:1})])]),e("div",Ae,[e("div",De,[e("div",Te,[e("div",qe,[e("h5",ze,o(u.value?"編輯用戶":"新增用戶"),1),s[24]||(s[24]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",Be,[e("form",{onSubmit:re(O,["prevent"])},[e("div",Ie,[e("div",Ne,[e("div",Fe,[s[25]||(s[25]=e("label",{class:"form-label"},[c(" 姓名 "),e("span",{class:"text-danger"},"*")],-1)),p(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[4]||(s[4]=l=>a.name=l),required:""},null,512),[[g,a.name]])])]),e("div",Oe,[e("div",Re,[s[26]||(s[26]=e("label",{class:"form-label"},[c(" 帳號 "),e("span",{class:"text-danger"},"*")],-1)),p(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[5]||(s[5]=l=>a.username=l),disabled:u.value,required:""},null,8,He),[[g,a.username]]),u.value?(d(),i("div",Ke," 帳號建立後無法修改 ")):x("",!0)])])]),e("div",We,[e("div",Ge,[e("div",Je,[s[27]||(s[27]=e("label",{class:"form-label"},[c(" Email "),e("span",{class:"text-danger"},"*")],-1)),p(e("input",{type:"email",class:"form-control","onUpdate:modelValue":s[6]||(s[6]=l=>a.email=l),required:""},null,512),[[g,a.email]])])]),e("div",Qe,[e("div",Xe,[s[29]||(s[29]=e("label",{class:"form-label"},[c(" 狀態 "),e("span",{class:"text-danger"},"*")],-1)),p(e("select",{class:"form-select","onUpdate:modelValue":s[7]||(s[7]=l=>a.status=l),required:""},s[28]||(s[28]=[e("option",{value:""},"請選擇狀態",-1),e("option",{value:"active"},"啟用",-1),e("option",{value:"inactive"},"停用",-1),e("option",{value:"pending"},"待啟用",-1)]),512),[[J,a.status]])])])]),u.value?x("",!0):(d(),i("div",Ye,[e("div",Ze,[e("div",es,[s[30]||(s[30]=e("label",{class:"form-label"},[c(" 密碼 "),e("span",{class:"text-danger"},"*")],-1)),p(e("input",{type:"password",class:"form-control","onUpdate:modelValue":s[8]||(s[8]=l=>a.password=l),required:!u.value},null,8,ss),[[g,a.password]])])]),e("div",ts,[e("div",ls,[s[31]||(s[31]=e("label",{class:"form-label"},[c(" 確認密碼 "),e("span",{class:"text-danger"},"*")],-1)),p(e("input",{type:"password",class:"form-control","onUpdate:modelValue":s[9]||(s[9]=l=>a.confirmPassword=l),required:!u.value},null,8,as),[[g,a.confirmPassword]])])])])),e("div",os,[e("div",ns,[e("div",is,[s[32]||(s[32]=e("label",{class:"form-label"},"聯絡電話",-1)),p(e("input",{type:"tel",class:"form-control","onUpdate:modelValue":s[10]||(s[10]=l=>a.phone=l)},null,512),[[g,a.phone]])])])]),e("div",ds,[e("div",rs,[s[34]||(s[34]=e("label",{class:"form-label"},[c(" 權限設定 "),e("span",{class:"text-danger"},"*")],-1)),e("div",us,[e("div",cs,[(d(!0),i(U,null,P(Q,l=>(d(),i("div",{key:l.key,class:"col-md-6 mb-3"},[y(h,{class:b(["h-100 permission-card",{"border-theme":oe(l.key)}])},{default:w(()=>[y(n,{class:"p-3"},{default:w(()=>[e("div",ms,[p(e("input",{class:"form-check-input",type:"checkbox",id:l.key,value:l.key,"onUpdate:modelValue":s[11]||(s[11]=S=>a.permissions=S)},null,8,ps),[[ue,a.permissions]]),e("label",{class:"form-check-label",for:l.key},[e("div",bs,[e("i",{class:b(["fa me-2",l.icon]),style:ce({color:l.color})},null,6),e("div",null,[e("div",fs,o(l.name),1),e("small",gs,o(l.description),1)])])],8,vs)])]),_:2},1024)]),_:2},1032,["class"])]))),128))]),s[33]||(s[33]=e("div",{class:"form-text"},[e("i",{class:"fa fa-info-circle me-1"}),c(" 用戶可以擁有多種權限，主辦工程師權限為最高權限 ")],-1))])])]),e("div",xs,[e("div",_s,[e("div",hs,[s[35]||(s[35]=e("label",{class:"form-label"},"備註",-1)),p(e("textarea",{class:"form-control",rows:"3","onUpdate:modelValue":s[12]||(s[12]=l=>a.remarks=l)},null,512),[[g,a.remarks]])])])])],32)]),e("div",ys,[s[37]||(s[37]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 取消 ",-1)),e("button",{type:"button",class:"btn btn-theme",onClick:O},[e("i",{class:b(["fa me-1",u.value?"fa-save":"fa-plus"])},null,2),c(" "+o(u.value?"更新":"新增"),1)]),u.value?(d(),i("button",{key:0,type:"button",class:"btn btn-danger",onClick:s[13]||(s[13]=l=>F(a))},s[36]||(s[36]=[e("i",{class:"fa fa-trash me-1"},null,-1),c(" 刪除 ")]))):x("",!0)])])])]),e("div",ws,[e("div",ks,[e("div",Ms,[s[47]||(s[47]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"detailModalLabel"},"用戶詳細資訊"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),r.value?(d(),i("div",Cs,[e("div",Ls,[e("div",Us,[e("img",{src:r.value.avatar||"/assets/img/user/profile.jpg",alt:r.value.name,class:"img-fluid rounded-circle mb-3",style:{width:"120px",height:"120px","object-fit":"cover"}},null,8,Ps),e("h5",null,o(r.value.name),1),e("span",{class:b(K(r.value.status))},o(H(r.value.status)),3)]),e("div",Vs,[e("table",js,[e("tbody",null,[e("tr",null,[s[38]||(s[38]=e("td",{class:"fw-bold"},"帳號：",-1)),e("td",null,o(r.value.username),1)]),e("tr",null,[s[39]||(s[39]=e("td",{class:"fw-bold"},"Email：",-1)),e("td",null,o(r.value.email),1)]),r.value.phone?(d(),i("tr",Es,[s[40]||(s[40]=e("td",{class:"fw-bold"},"聯絡電話：",-1)),e("td",null,o(r.value.phone),1)])):x("",!0),e("tr",null,[s[41]||(s[41]=e("td",{class:"fw-bold"},"建立時間：",-1)),e("td",null,o(r.value.createdAt),1)]),e("tr",null,[s[42]||(s[42]=e("td",{class:"fw-bold"},"最後登入：",-1)),e("td",null,o(r.value.lastLogin||"尚未登入"),1)]),e("tr",null,[s[43]||(s[43]=e("td",{class:"fw-bold"},"權限：",-1)),e("td",null,[e("div",$s,[(d(!0),i(U,null,P(r.value.permissions,l=>(d(),i("span",{key:l,class:b(G(l))},o(W(l)),3))),128))])])]),r.value.remarks?(d(),i("tr",Ss,[s[44]||(s[44]=e("td",{class:"fw-bold"},"備註：",-1)),e("td",null,o(r.value.remarks),1)])):x("",!0)])])])])])):x("",!0),e("div",As,[s[46]||(s[46]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 關閉 ",-1)),e("button",{type:"button",class:"btn btn-theme",onClick:s[14]||(s[14]=l=>N(r.value))},s[45]||(s[45]=[e("i",{class:"fa fa-edit me-1"},null,-1),c(" 編輯 ")]))])])])]),e("div",Ds,[e("div",Ts,[e("div",qs,[s[50]||(s[50]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title text-danger",id:"deleteModalLabel"}," 確認刪除 "),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),M.value?(d(),i("div",zs,[e("p",null,"確定要刪除用戶「"+o(M.value.name)+"」嗎？",1),s[48]||(s[48]=e("p",{class:"text-muted"},"此操作無法復原，將會刪除該用戶的所有相關資料。",-1))])):x("",!0),e("div",{class:"modal-footer"},[s[49]||(s[49]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 取消 ",-1)),e("button",{type:"button",class:"btn btn-danger",onClick:se}," 確認刪除 ")])])])])])}}};export{Ns as default};
