import{U as m,X as h,r as p,an as _,k as v}from"./index-CB9Z8Gmd.js";const U=[{value:"CONTRACTOR",label:"營造廠商",color:"primary"},{value:"SUPERVISOR",label:"監造單位",color:"info"},{value:"THIRD_PARTY",label:"第三方單位",color:"success"}],V=[{value:"CLASS_A",label:"甲等",color:"primary"},{value:"CLASS_B",label:"乙等",color:"info"},{value:"CLASS_C",label:"丙等",color:"success"},{value:"CIVIL_CONTRACTOR",label:"土木包工業",color:"danger"}],k=[{value:"ACTIVE",label:"啟用",color:"success"},{value:"INACTIVE",label:"停用",color:"danger"}],i={async create(e){return await m.post("/management/company/create",e)},async getList(){var s;const t=await m.get("/management/company/list");return((s=t.data)==null?void 0:s.data)||t.data||t},async getDetail(e){return await m.get(`/management/company/${e}`)},async update(e){return await m.patch("/management/company/update",e)},async delete(e){await m.delete(`/management/company/delete/${e}`)},async checkPermission(e){return await m.get(`/management/company/${e}/permission`)}},f={fromApi(e){return{id:e.id,companyId:e.companyId||e.company_id,companyName:e.companyName||e.company_name,companyCode:e.companyUnifiedNumber||e.companyCode||e.company_code,companyType:e.companyType||e.company_type,contractorLevel:e.contractorLevel||e.contractor_level||e.contractLevel,contactPerson:e.contactPerson||e.contact_person||"",contactPhone:e.contactPhone||e.contact_phone||"",contactEmail:e.contactEmail||e.contact_email||"",address:e.address||"",description:e.description||"",status:e.status||"ACTIVE",ownerUserId:e.ownerUserId||e.owner_user_id,createdAt:e.createdAt||e.created_at,updatedAt:e.updatedAt||e.updated_at,userRole:e.userRole,joinedAt:e.joinedAt,memberCount:e.memberCount}},toApi(e){const t={companyName:e.companyName,companyUnifiedNumber:e.companyCode,companyType:e.companyType};return e.companyType==="CONTRACTOR"&&e.contractorLevel&&(t.contractorLevel=e.contractorLevel),t},toUpdateApi(e){const t={companyName:e.companyName,companyUnifiedNumber:e.companyCode,companyType:e.companyType,contactPerson:e.contactPerson,contactPhone:e.contactPhone,contactEmail:e.contactEmail,address:e.address,description:e.description,status:e.status};return e.companyType==="CONTRACTOR"&&e.contractorLevel&&(t.contractorLevel=e.contractorLevel),t}},F=h("company",()=>{const e=p([]),t=p(null),s=p(!1),d=p(null),a=p({total:0,page:1,pageSize:10});_();const T=v(()=>e.value.map(n=>({...n,userRole:n.userRole||"MEMBER",joinedAt:n.joinedAt||n.createdAt,memberCount:n.memberCount||1}))),A=v(()=>e.value.filter(n=>n.status==="ACTIVE")),g=v(()=>e.value),r=n=>{s.value=n},l=n=>{d.value=n},u=()=>{d.value=null},C=async()=>{r(!0),u();try{const n=await i.getList();e.value=n.map(f.fromApi),a.value.total=n.length,a.value.page=1,a.value.pageSize=n.length}catch(n){console.error("Failed to load companies:",n),l("載入公司列表失敗"),e.value=[]}finally{r(!1)}};return{companies:e,currentCompany:t,isLoading:s,error:d,pagination:a,companiesWithUserInfo:T,activeCompanies:A,myCompanies:g,initCompanies:C,createCompany:async n=>{r(!0),u();try{const o=await i.create(n);return await C(),o}catch(o){return console.error("Failed to create company:",o),l("建立公司失敗"),null}finally{r(!1)}},getCompanyDetail:async n=>{r(!0),u();try{const o=await i.getDetail(n),c=f.fromApi(o),y=e.value.findIndex(N=>N.companyId===n);return y!==-1&&(e.value[y]=c),c}catch(o){return console.error("Failed to get company detail:",o),l("載入公司詳情失敗"),null}finally{r(!1)}},updateCompany:async(n,o)=>{r(!0),u();try{const c={companyId:n,companyName:o.companyName,companyUnifiedNumber:o.companyUnifiedNumber,companyType:o.companyType,contractorLevel:o.contractorLevel,companyStatus:"Y"},y=await i.update(c);return await C(),y}catch(c){return console.error("Failed to update company:",c),l("更新公司失敗"),null}finally{r(!1)}},deleteCompany:async n=>{r(!0),u();try{await i.delete(n);const o=e.value.findIndex(c=>c.companyId===n);return o!==-1&&(e.value.splice(o,1),a.value.total-=1),!0}catch(o){return console.error("Failed to delete company:",o),l("刪除公司失敗"),!1}finally{r(!1)}},checkCompanyPermission:async n=>{try{return await i.checkPermission(n)}catch(o){return console.error("Failed to check company permission:",o),{hasPermission:!1,userRole:""}}},setCurrentCompany:n=>{t.value=n},getCompanyById:n=>e.value.find(o=>o.companyId===n),resetState:()=>{e.value=[],t.value=null,s.value=!1,d.value=null,a.value={total:0,page:1,pageSize:10}},setLoading:r,setError:l,clearError:u}});export{U as C,V as a,k as b,F as u};
